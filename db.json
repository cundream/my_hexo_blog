{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"source/image/shouye.jpg","path":"image/shouye.jpg","modified":0,"renderable":0},{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/butterfly-icon.png","path":"img/butterfly-icon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/error-page.png","path":"img/error-page.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"source/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","path":"typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","modified":0,"renderable":0},{"_id":"source/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","path":"typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","path":"typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","modified":0,"renderable":0},{"_id":"source/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","path":"typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","modified":0,"renderable":0},{"_id":"source/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","path":"typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","modified":0,"renderable":0},{"_id":"source/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","path":"typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","modified":0,"renderable":0},{"_id":"source/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","path":"typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","modified":0,"renderable":0},{"_id":"source/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","path":"typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250419091747915.png","path":"typora-user-images/image-20250419091747915.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250419092017527.png","path":"typora-user-images/image-20250419092017527.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250419102848756.png","path":"typora-user-images/image-20250419102848756.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250419105704031.png","path":"typora-user-images/image-20250419105704031.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250419112758947.png","path":"typora-user-images/image-20250419112758947.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250419113622811.png","path":"typora-user-images/image-20250419113622811.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250419181524113.png","path":"typora-user-images/image-20250419181524113.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250419181631076.png","path":"typora-user-images/image-20250419181631076.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250419181745960.png","path":"typora-user-images/image-20250419181745960.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250422114422258.png","path":"typora-user-images/image-20250422114422258.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250422114322913.png","path":"typora-user-images/image-20250422114322913.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250422114555482.png","path":"typora-user-images/image-20250422114555482.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250422114642336.png","path":"typora-user-images/image-20250422114642336.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250425174252871.png","path":"typora-user-images/image-20250425174252871.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250425104935964.png","path":"typora-user-images/image-20250425104935964.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250425104935964-5549379.png","path":"typora-user-images/image-20250425104935964-5549379.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429172724826.png","path":"typora-user-images/image-20250429172724826.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429174851066.png","path":"typora-user-images/image-20250429174851066.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429175228086.png","path":"typora-user-images/image-20250429175228086.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429174959408.png","path":"typora-user-images/image-20250429174959408.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429175342611.png","path":"typora-user-images/image-20250429175342611.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429175421998.png","path":"typora-user-images/image-20250429175421998.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429175540574.png","path":"typora-user-images/image-20250429175540574.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429180401580.png","path":"typora-user-images/image-20250429180401580.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429181131778.png","path":"typora-user-images/image-20250429181131778.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429181039571.png","path":"typora-user-images/image-20250429181039571.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429181312813.png","path":"typora-user-images/image-20250429181312813.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250429183142516.png","path":"typora-user-images/image-20250429183142516.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250508161105090.png","path":"typora-user-images/image-20250508161105090.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250508161546610.png","path":"typora-user-images/image-20250508161546610.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20250508162115569.png","path":"typora-user-images/image-20250508162115569.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/1134316536b140eda97bef40993a2072.png","path":"typora-user-images/1134316536b140eda97bef40993a2072.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/20220314-b46efe3c-5ede-471f-a116-ce05fcccd7c6.png","path":"typora-user-images/20220314-b46efe3c-5ede-471f-a116-ce05fcccd7c6.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/20220315-2c2a053e-ddb6-4656-bc61-9a94d8b14598.png","path":"typora-user-images/20220315-2c2a053e-ddb6-4656-bc61-9a94d8b14598.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/20220315-917e43b8-7523-4f2f-804c-49855963dbb5.png","path":"typora-user-images/20220315-917e43b8-7523-4f2f-804c-49855963dbb5.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/2afdf3d7222117202a1069d7e1587c12.png#align=left&display=inline&height=655&name=image.png","path":"typora-user-images/2afdf3d7222117202a1069d7e1587c12.png#align=left&display=inline&height=655&name=image.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/32fe9b12c9192392c3a50b5f04759eec.png","path":"typora-user-images/32fe9b12c9192392c3a50b5f04759eec.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/72746e97a2cd474bb21601f507779a25.png","path":"typora-user-images/72746e97a2cd474bb21601f507779a25.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/779689.png","path":"typora-user-images/779689.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/a7002eb5f5b8429c8b8728b9f2e3e10d.png","path":"typora-user-images/a7002eb5f5b8429c8b8728b9f2e3e10d.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/afb25fa106bada4b37da64e902060269.png","path":"typora-user-images/afb25fa106bada4b37da64e902060269.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/c5abda0a657e59634fb07442a84bf5e0.png","path":"typora-user-images/c5abda0a657e59634fb07442a84bf5e0.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/fe3e2f4ebbbc4a28b707459e2e9fa511.png","path":"typora-user-images/fe3e2f4ebbbc4a28b707459e2e9fa511.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230627191528034.png","path":"typora-user-images/image-20230627191528034.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230628093611653.png","path":"typora-user-images/image-20230628093611653.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230628093823674.png","path":"typora-user-images/image-20230628093823674.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230628094058045.png","path":"typora-user-images/image-20230628094058045.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230628094428585.png","path":"typora-user-images/image-20230628094428585.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230628094521252.png","path":"typora-user-images/image-20230628094521252.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230921165730484.png","path":"typora-user-images/image-20230921165730484.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230921170222187.png","path":"typora-user-images/image-20230921170222187.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230921170734063.png","path":"typora-user-images/image-20230921170734063.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230921171005578.png","path":"typora-user-images/image-20230921171005578.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230921171251668.png","path":"typora-user-images/image-20230921171251668.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923144124237.png","path":"typora-user-images/image-20230923144124237.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923144238782.png","path":"typora-user-images/image-20230923144238782.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923144315232.png","path":"typora-user-images/image-20230923144315232.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923144347556.png","path":"typora-user-images/image-20230923144347556.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923144414595.png","path":"typora-user-images/image-20230923144414595.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923144526897.png","path":"typora-user-images/image-20230923144526897.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923144634136.png","path":"typora-user-images/image-20230923144634136.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923144953818.png","path":"typora-user-images/image-20230923144953818.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923145029314.png","path":"typora-user-images/image-20230923145029314.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923145122020.png","path":"typora-user-images/image-20230923145122020.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923145717673.png","path":"typora-user-images/image-20230923145717673.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923145922760.png","path":"typora-user-images/image-20230923145922760.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923150103329.png","path":"typora-user-images/image-20230923150103329.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923151411555.png","path":"typora-user-images/image-20230923151411555.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923152344429.png","path":"typora-user-images/image-20230923152344429.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923154459874.png","path":"typora-user-images/image-20230923154459874.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923154644281.png","path":"typora-user-images/image-20230923154644281.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923162506692.png","path":"typora-user-images/image-20230923162506692.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20230923162555344.png","path":"typora-user-images/image-20230923162555344.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231008103734081.png","path":"typora-user-images/image-20231008103734081.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024092452701.png","path":"typora-user-images/image-20231024092452701.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024092756314.png","path":"typora-user-images/image-20231024092756314.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024092913063.png","path":"typora-user-images/image-20231024092913063.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024094558547.png","path":"typora-user-images/image-20231024094558547.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024095726856.png","path":"typora-user-images/image-20231024095726856.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024095816182.png","path":"typora-user-images/image-20231024095816182.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024095843156.png","path":"typora-user-images/image-20231024095843156.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024101307177.png","path":"typora-user-images/image-20231024101307177.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024102201145.png","path":"typora-user-images/image-20231024102201145.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231024104338016.png","path":"typora-user-images/image-20231024104338016.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231201143940420.png","path":"typora-user-images/image-20231201143940420.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231201144020748.png","path":"typora-user-images/image-20231201144020748.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231201144119343.png","path":"typora-user-images/image-20231201144119343.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20231201153117052.png","path":"typora-user-images/image-20231201153117052.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219113719157.png","path":"typora-user-images/image-20240219113719157.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219114233026.png","path":"typora-user-images/image-20240219114233026.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219114343151.png","path":"typora-user-images/image-20240219114343151.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219114515952.png","path":"typora-user-images/image-20240219114515952.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219144606520.png","path":"typora-user-images/image-20240219144606520.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219150634816.png","path":"typora-user-images/image-20240219150634816.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219150821657.png","path":"typora-user-images/image-20240219150821657.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219150910898.png","path":"typora-user-images/image-20240219150910898.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219151031448.png","path":"typora-user-images/image-20240219151031448.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219151212695.png","path":"typora-user-images/image-20240219151212695.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219152607457.png","path":"typora-user-images/image-20240219152607457.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219152638390.png","path":"typora-user-images/image-20240219152638390.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219153810692.png","path":"typora-user-images/image-20240219153810692.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240219154032740.png","path":"typora-user-images/image-20240219154032740.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220094227461.png","path":"typora-user-images/image-20240220094227461.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220095107292.png","path":"typora-user-images/image-20240220095107292.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220095645324.png","path":"typora-user-images/image-20240220095645324.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220101010503.png","path":"typora-user-images/image-20240220101010503.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220101429844.png","path":"typora-user-images/image-20240220101429844.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220101701432.png","path":"typora-user-images/image-20240220101701432.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220102231198.png","path":"typora-user-images/image-20240220102231198.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220102332812.png","path":"typora-user-images/image-20240220102332812.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220102431979.png","path":"typora-user-images/image-20240220102431979.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220102457440.png","path":"typora-user-images/image-20240220102457440.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220102621265.png","path":"typora-user-images/image-20240220102621265.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220102752041.png","path":"typora-user-images/image-20240220102752041.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220103006353.png","path":"typora-user-images/image-20240220103006353.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220103217414.png","path":"typora-user-images/image-20240220103217414.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240220144907721.png","path":"typora-user-images/image-20240220144907721.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221091441127.png","path":"typora-user-images/image-20240221091441127.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221091728143.png","path":"typora-user-images/image-20240221091728143.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221091837069.png","path":"typora-user-images/image-20240221091837069.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221092028120.png","path":"typora-user-images/image-20240221092028120.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221092353574.png","path":"typora-user-images/image-20240221092353574.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221092419244.png","path":"typora-user-images/image-20240221092419244.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221092834785.png","path":"typora-user-images/image-20240221092834785.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221093021265.png","path":"typora-user-images/image-20240221093021265.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221093711599.png","path":"typora-user-images/image-20240221093711599.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221093819873.png","path":"typora-user-images/image-20240221093819873.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221094018816.png","path":"typora-user-images/image-20240221094018816.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221094225094.png","path":"typora-user-images/image-20240221094225094.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221094244920.png","path":"typora-user-images/image-20240221094244920.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221094447664.png","path":"typora-user-images/image-20240221094447664.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221094852671.png","path":"typora-user-images/image-20240221094852671.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221095745495.png","path":"typora-user-images/image-20240221095745495.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240221155333042.png","path":"typora-user-images/image-20240221155333042.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222152145318.png","path":"typora-user-images/image-20240222152145318.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222164404555.png","path":"typora-user-images/image-20240222164404555.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222164433038.png","path":"typora-user-images/image-20240222164433038.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222164517003.png","path":"typora-user-images/image-20240222164517003.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222164533515.png","path":"typora-user-images/image-20240222164533515.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222175326047.png","path":"typora-user-images/image-20240222175326047.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222175403127.png","path":"typora-user-images/image-20240222175403127.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222180227522.png","path":"typora-user-images/image-20240222180227522.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222180306582.png","path":"typora-user-images/image-20240222180306582.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222180325402.png","path":"typora-user-images/image-20240222180325402.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222180337721.png","path":"typora-user-images/image-20240222180337721.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240222181235735.png","path":"typora-user-images/image-20240222181235735.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240223110332038.png","path":"typora-user-images/image-20240223110332038.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240223110630296.png","path":"typora-user-images/image-20240223110630296.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240318202804603.png","path":"typora-user-images/image-20240318202804603.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240412121048381.png","path":"typora-user-images/image-20240412121048381.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240415090937231.png","path":"typora-user-images/image-20240415090937231.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240415091018922.png","path":"typora-user-images/image-20240415091018922.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240415094839642.png","path":"typora-user-images/image-20240415094839642.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240416113821316.png","path":"typora-user-images/image-20240416113821316.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240416114024941.png","path":"typora-user-images/image-20240416114024941.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240416114808884.png","path":"typora-user-images/image-20240416114808884.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240416114924463.png","path":"typora-user-images/image-20240416114924463.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240416120116317.png","path":"typora-user-images/image-20240416120116317.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240417091316659.png","path":"typora-user-images/image-20240417091316659.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240417092003988.png","path":"typora-user-images/image-20240417092003988.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240417092118543.png","path":"typora-user-images/image-20240417092118543.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240507111933014.png","path":"typora-user-images/image-20240507111933014.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240507112405845.png","path":"typora-user-images/image-20240507112405845.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240507112941777.png","path":"typora-user-images/image-20240507112941777.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240507112114709.png","path":"typora-user-images/image-20240507112114709.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240509105505568.png","path":"typora-user-images/image-20240509105505568.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240509105539663.png","path":"typora-user-images/image-20240509105539663.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240510121326830.png","path":"typora-user-images/image-20240510121326830.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240510121631586.png","path":"typora-user-images/image-20240510121631586.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240510121854650.png","path":"typora-user-images/image-20240510121854650.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240514095424805.png","path":"typora-user-images/image-20240514095424805.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240514095650303.png","path":"typora-user-images/image-20240514095650303.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240514095835213.png","path":"typora-user-images/image-20240514095835213.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240516094845785.png","path":"typora-user-images/image-20240516094845785.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240520161819461.png","path":"typora-user-images/image-20240520161819461.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240521094502177.png","path":"typora-user-images/image-20240521094502177.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240522090312508.png","path":"typora-user-images/image-20240522090312508.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240522090352573.png","path":"typora-user-images/image-20240522090352573.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240522090958255.png","path":"typora-user-images/image-20240522090958255.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240522091143334.png","path":"typora-user-images/image-20240522091143334.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240524174544128.png","path":"typora-user-images/image-20240524174544128.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240524175254196.png","path":"typora-user-images/image-20240524175254196.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/image-20240524175527451.png","path":"typora-user-images/image-20240524175527451.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/u=3986274733,3849268543&fm=253&fmt=auto&app=138&f=PNG.png","path":"typora-user-images/u=3986274733,3849268543&fm=253&fmt=auto&app=138&f=PNG.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/u=641752398,1880469199&fm=253&fmt=auto&app=138&f=PNG.png","path":"typora-user-images/u=641752398,1880469199&fm=253&fmt=auto&app=138&f=PNG.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70-6340401.png","path":"typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70-6340401.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70.png","path":"typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70.png","modified":0,"renderable":0},{"_id":"source/typora-user-images/webp","path":"typora-user-images/webp","modified":0,"renderable":0}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"1d076d150ac008c580e43b38ef410b6fb577d993","modified":1749034204525},{"_id":"source/about/index.md","hash":"6f31565e4e99bb6fbf55be5771c727ada0bb6bdb","modified":1749030067185},{"_id":"source/categories/index.md","hash":"063dbfa737baf9009645a00100ec0cec8d0eb92b","modified":1749030043836},{"_id":"source/comments/index.md","hash":"7b6b47f281ec1a444ee3e4cc13d6f47d11b17534","modified":1749030059963},{"_id":"source/image/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1748598547000},{"_id":"source/link/index.md","hash":"d25bfd8890c1a4680257bafd013de0323a449965","modified":1749030063718},{"_id":"source/movies/index.md","hash":"e903c93c69e2e624fd3aad6be2efafad14c612ab","modified":1749030056487},{"_id":"source/music/index.md","hash":"a98702749c899f0b85eea15eccf737e5fd13b09d","modified":1749030048081},{"_id":"source/picture/index.md","hash":"9d8a79dcdd7be979da2d4aef0a3c8e67a34cad5e","modified":1749030052571},{"_id":"source/tags/index-1.md","hash":"64e1a23855a7dbd195d4db7219d48f7b240476e4","modified":1749030035728},{"_id":"source/tags/index.md","hash":"5fdc6f265d17bd71664bb6b844bf6e1a36e1755b","modified":1749029228364},{"_id":"source/image/shouye.jpg","hash":"e75ad850c0d85a460832e196ab1940ce99841c8f","modified":1748598528000},{"_id":"themes/butterfly/.gitignore","hash":"76e6365d33cec02b90d00699da3c0ddef1cd7efa","modified":1748584750000},{"_id":"themes/butterfly/LICENSE","hash":"c8bc7df08db9dd3b39c2c2259a163a36cf2f6808","modified":1748584750000},{"_id":"themes/butterfly/README.md","hash":"e1b9096ae0c4e5ef0a911aec05dbad4a3aae3173","modified":1748584750000},{"_id":"themes/butterfly/README_CN.md","hash":"92e45255b8725f0a00450c88fcfd51ec61e1db67","modified":1748584750000},{"_id":"themes/butterfly/_config.butterfly.yml","hash":"7166aff350fcf84cbc01835fad5731eb855cecd7","modified":1748584750000},{"_id":"themes/butterfly/package.json","hash":"dd598502734c702eed104a3f955f75568e18a29e","modified":1748584750000},{"_id":"themes/butterfly/plugins.yml","hash":"a2704f0406484fdae3410e9992cf996f9859356e","modified":1748584750000},{"_id":"themes/butterfly/.github/FUNDING.yml","hash":"da5e77f5e0cdb7e11b36546fb6796d10e3dfbe5d","modified":1748584750000},{"_id":"themes/butterfly/languages/default.yml","hash":"a2c938b1ef69195aec10c90dc7d1871953548e01","modified":1748584750000},{"_id":"themes/butterfly/languages/en.yml","hash":"a2c938b1ef69195aec10c90dc7d1871953548e01","modified":1748584750000},{"_id":"themes/butterfly/languages/ja.yml","hash":"a281d3cc3e117e90597b783dc5569dba3976d2eb","modified":1748584750000},{"_id":"themes/butterfly/languages/ko.yml","hash":"c7d861c58f204f47a5b4d6e118e1f1e8fb8a852f","modified":1748584750000},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"e0bf36edf18cf3380b900be7528b536252990c26","modified":1748584750000},{"_id":"themes/butterfly/languages/zh-HK.yml","hash":"bac3063ad2892be232f7d91361c28585a3cc7eb5","modified":1748584750000},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"bd7ee35aa30964493d2729ef105bb86331b096c3","modified":1748584750000},{"_id":"themes/butterfly/layout/archive.pug","hash":"bc77220dfc269b8faad0930e1a4142ebf68165e5","modified":1748584750000},{"_id":"themes/butterfly/layout/category.pug","hash":"a7e9805a781e34e38d27462e6ce2a5821c34bb9f","modified":1748584750000},{"_id":"themes/butterfly/layout/index.pug","hash":"a93004cc8ec8050df603d32a6e6e02cd96fd9875","modified":1748584750000},{"_id":"themes/butterfly/layout/page.pug","hash":"7ce2a49c6c41847de4ccea377ade116339984434","modified":1748584750000},{"_id":"themes/butterfly/layout/post.pug","hash":"65c4a49c65c3fc4d9dc88b9791a75710c698c3a1","modified":1748584750000},{"_id":"themes/butterfly/layout/tag.pug","hash":"ca5333bd262cb58c195c844b593a0eed0c721766","modified":1748584750000},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"10ce05c8dbde09f53bdabe40b5388de9ccc71a31","modified":1748584750000},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"63ad2249ad09fb3fe21bd5ff9adefb304a7ab24a","modified":1748584750000},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"6e0f9470b18bd37d4891282ac73d61676b040e8c","modified":1748584750000},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"e320b40c051bae1549156cd5ea4a51383cf78598","modified":1748584750000},{"_id":"themes/butterfly/.github/workflows/stale.yml","hash":"4040c76547e270aaf184e9b219a44ca41bbb1b9f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"f9b02aac0dbbb2b71c037dd215e70c8b7ec7741c","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"6bd41add3a45e55d5e51eab5285a2d1a909d37f3","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"1d11e334b22dbbedcb0f751f9ee9789d4416605e","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"e5e6c05a621483b3542f2884e8ba45e84b1e973a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"bd45e6fa935ace9cb54499b0491dacfb78ccc354","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"43f951b639038f3bc01deea03368d8dcf492cbb0","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"3e65b7bf6bccccbba7e15349f0a44f15c64c5b5e","modified":1748584750000},{"_id":"themes/butterfly/scripts/common/postDesc.js","hash":"272613a71d16f0de6dac883be4839259f774be76","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/404.js","hash":"039fc75f363d79669b0b2177d929cdff6f2ef7a4","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/comment.js","hash":"7b1b16e1e8e08245a345764616956be50487eb53","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/init.js","hash":"ce68e84a9ccfcf91100befbaa9afc392a0cd93bb","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"bac639c404588ea62e601ef0bcd368c3bd0119af","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"f59e10305fef59ea3e62a7395106c0927582879d","modified":1748584750000},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"b23108d29fff3e32384d8689c8bcd2ab306a1ae7","modified":1748584750000},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"20a6ebf63439501a4b3fc81e7a2a2ea5d103bace","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"7864ba45716c51aef8d8b04fd4bc212e0008ce3b","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/getArchiveLength.js","hash":"bf77635e920eaf52bceebc95f87c7c87a7ca8038","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"3eb0bbb1288dc7b0ff82cc46ceb53bd666893416","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"0cdf781a8c14d7b50d309e69f282ec7b178804bb","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"00c5742ad1c75b3c5684d02ffc6a1921399e5376","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/series.js","hash":"45367c4ce827329867dbcc750ec125da9ccb2cfd","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"2f44e1b3ccd170b256eae178299d6fa933a8d490","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/chartjs.js","hash":"195ba802d7e8406c155124a9c939a2318f82938b","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"25eefe10189caf3910a0e5d5b2f2043ae9255531","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"a07b586b510aa2df953102d998e84207acc34f9b","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/merge_config.js","hash":"10ffed853a935498f1f5da2c5b57200c957874a7","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"950b7d0966429bf0f9e6c5e1161e50e545e320b4","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"fa3d0a64f7fce4aff7928d4ddd95548978ba001c","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"f02fb085a88a2c0c82aeffacc24e1b71c74bd7c0","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"89c6c78d2db43b190055d5690741a79bab4f3e7e","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"cf0bc17d0180231167cc6aa8a00fc64f198cb9f9","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"50d8d8fac5c5b6e26317028895d7d82a2cf46606","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"e68d8d21f3a86e3646907a3685550ee20e8d4a9f","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/score.js","hash":"f589fb6646bd17cf12d77a9b251dd614e1c8b899","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/series.js","hash":"40bc9a065e3a1423e0e66f4911e00713ca9f5e9e","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"3c486b149e28edd1a06843f05a5c355000991b82","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"176804f07567aa80f1ed95897a968a996b155dec","modified":1748584750000},{"_id":"themes/butterfly/source/css/index.styl","hash":"b13d96924a5534bff91d75566b196ac87b4fac22","modified":1748584750000},{"_id":"themes/butterfly/source/css/var.styl","hash":"d1eec577074ab7b262182885576135bf1896e12c","modified":1748584750000},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1748584750000},{"_id":"themes/butterfly/source/img/error-page.png","hash":"d2519710498a871ca3e913c57e2ba20a805b6430","modified":1748584750000},{"_id":"themes/butterfly/source/img/favicon.ico","hash":"455ac256580bf31a45813dbbdb87219bfc8bfb04","modified":1748584750000},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1748584750000},{"_id":"themes/butterfly/source/js/main.js","hash":"5a52047b8520f79864d5a4ee2379a29751aead23","modified":1748584750000},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"fdb5482d04a75bd79946ad1ed291d281d0e9362d","modified":1748584750000},{"_id":"themes/butterfly/source/js/utils.js","hash":"48637ad8e405306772b93837f33400bde1055819","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"e93a36d3c29b5a02c7f26a23f96e1f84b063cbe8","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"e792a435afee1f9491095084a00dc77e3522c1fd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"9ea75b06f19bf356f340f4a3fc1bdc0713cfe445","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"56a3c32de1a15627ff38c67f1131cdd6ec5ac924","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"f29123e603cbbcc6ce277d4e8f600ba67498077c","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"1e1a69aa2cbda2e621c741b3802093244b3cc04e","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"83ed05ef1e39f2ee70c3fba2cf96e488d8ffec66","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"5168caadc4cf541f5d6676a9c5e8ae47a948f9ad","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/structured_data.pug","hash":"1b83ae33961528f128596753fd05067c672d6bff","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"44331c9db74b281b5c5c41439d3407a9076df1a1","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"733184f88e3a586a5fcc9d193ad500556b6c8eed","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"18b984ce184ea53d2dff5a03cc2d0d39d2ec3406","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"7d799c4694adb6e265e3f4b975d7f7f6a7021a17","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"e2d31e0f450ad42c47f7ee96375799342bf2f19b","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/loading/fullpage-loading.pug","hash":"a2f7d69ca7ec58f24fe7d4e04ae21d5b62b01567","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/loading/index.pug","hash":"d76ce71ba106e350670c021a3dcae57547d01830","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/loading/pace.pug","hash":"9d2d539555bab495959b9df734ed5c43a9f9e5a9","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"ef7afe0df7a3746744ac8185da7163b7406120ca","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/mixins/indexPostUI.pug","hash":"f3389fa9ae4fa32e3c16573286583bc3023e57ad","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/404.pug","hash":"15d32c511e4875066fcbe9cb84c3ada07b5a7c41","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"efb40388e37cca0b5e7c3c66e811a42f8d32c910","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"6b0fa5f048aca8e9cbe56978301af918cf7ac34a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/shuoshuo.pug","hash":"b2423cfc57a5e3a0e1112ff7c18d5c5c720d89d5","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"79ad31eb72a9e14007770b18a426406a25315b38","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/post/outdate-notice.pug","hash":"b7ce9484bc5c97ea6154f0b78fb9b8951fafedbd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"b96c232e5178d927987791d9ae386dd83679535a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"db92f25ff3fd061882f81bf74ca560ff66983a0c","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"ed79fef5b5025415ea12eaed970f3fe7f6ef9596","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"43014bfc63583d3ee8808d526dd165848c0ed52f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"efe4f8019632b51c92c4f7628758538305e06e47","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"88f979a0b1a19eeb0db229247833bf9c6865c3b9","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"236c3ce26dd76e80b04d457789475c42da5ac0c8","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/umami_analytics.pug","hash":"bc35a1552d26ecdeeadbf06300078dbb5128a6e5","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"a8312b527493dabbadbb1280760168d3bc909a3b","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"21e019bdc3b1e796bb00976bb29af2d51f873624","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"73d33b6930e7944187a4b3403daf25d27077a2dd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"1aba8aa7cd767dc96879d13a13b4c8ceb9023233","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"1dba77d250eeebfb6e293d504352c7e9ea31980b","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"66e383b4ef374951eb87dd1bf4cdb7a667193fb5","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"d8753772889b5d0f4d15639ed6af5e91e53b1d03","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_post_series.pug","hash":"e0bb72fa0ce15964b11b8fe421cae3432394e35f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"1dd19a564320d248dbcee7f118a5b96c6466da65","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"bb842d2aa6469d65bf06af1372f0a19a9e4ef44c","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"842b772a387b576550fa127030e1c2e9bf65716d","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"7b5ae404a1205546b7de4be42291315cf918f2b3","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"fcddd80cdeb6aa81f342cd9f0102302f6ba087a8","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"45f620cd87b9ef2aa9d1e024e697ed6b4eecff34","modified":1748584750000},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"d12340a7df4601b9a23f070e16645861aeb3bb0a","modified":1748584750000},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"4fcb8222b9548e22f7b76f12d33e3698240cbae0","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"67062d597408068e4a59e95851e98fed34b745da","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"a51edfd3e499e7d38c32241c40e8e4d371efca73","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"ba174889e770ae9f6683379b9eae9d8c94253080","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"4cc02bcbaa4a1933a82a9ea57a603fe2d059fc77","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"fbfce4d67cacd1df22fb73d89d008693f59d9d91","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"d7b988d8588207086670f39aa49fce442c429f7a","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"094108f2a4e351a2fa496d6bd3e2388151416b3f","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"f0b01bbf321c2c24fdccaee367dd9fd448031a72","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"7d7554573c005399bc8c2264a85896d2d51be1e1","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"543eaf9c7df7e0db841e5946ee5f9082c3c46290","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"ef8e8549fe7ad4b99793844a93b4a89f77f417d5","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"d9cdf564a822a585e67fd5bac8573ba87eeb3743","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"a0f5835f04358122e8b1d38dd3e8da09a1b5b431","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"084dc4dfb41f55e237a9d6cf8c2f5dba729b83be","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"0af7c8754f04bdd9a02a14d880774753bd2e35ee","modified":1748584750000},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"4c9849df9c68d892c7df0ca28123aeb0dc9dc424","modified":1748584750000},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"ad66212554468b7067590308ed4cf40524fea662","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"205ccc7d0ec6ce1193b46bc0c9ce0385594581fb","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"5abe5480d83ff8b452a780a484d50a44091475bf","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"c4cda7b0c99015df29ce00fdfddd2f7679653754","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"dcff804c4c237e1e908481b44c1ac4e39ac0da34","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"1f8d715faf3b91b53426e38195c0920afb3bfa1c","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"992d192db7d1c96e995b85ed11c20c571d33fbad","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/shuoshuo.styl","hash":"79bb1d9a27822ed5675d1e52f5dbd0e2f5d5010a","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"7543bb688876a946538d66b991c71b94b5216277","modified":1748584750000},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"d8a8275a68a1421c4c09b604cf78bea16c1d0463","modified":1748584750000},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"6c4cbdadd9a49029fe0c59e29808d873e5b6b6ee","modified":1748584750000},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"1f2b86df86df81c3a59377b29102314ffc73dfa6","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"de8437a058a315d14d7e7034066f095b7b3ed4b4","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"30d1f809efd252ed0233d96d4374efd2b01d2292","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"985b183db7b7bfd8f9bdb60494549fb7f850348b","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"d27dbccaf3de1c9158d19e4fd49a25953cb5778d","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"3be8d0a75e7cc96548667cae0cb6a474279bd0b5","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"216f52fefc2274b542b549d8470503e6f1a308fb","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"4929382bd60788d34752a66e2fe764ef797a72a0","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/series.styl","hash":"0657169849bc4bf4d93b5492ade040c8f58c1901","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"3a88eedcb694da79e92581ce50cb1a430b1fb615","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"e846ddaef494d46cdfa2379deacfe74fa1cc5264","modified":1748584750000},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"8549829fb7d3c21cd9e119884962e8c463a4a267","modified":1748584750000},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"7119f2f2943de71999d3dd6ba5c60cde846f114b","modified":1748584750000},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"a2b783230a9143de69004cfc914d9f55e6fc1660","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/abcjs.pug","hash":"febff991595504d8e850ced0b9cc090f02ed97f0","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/index.pug","hash":"f0a90d8e39915a74b16ef22e851f179415cd7eaa","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"b03ee8625149191f9d5d057bbc9824b68d8dd0c4","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d6fff5a7f84c8b09f282f9ddc0020a68a8aac9ea","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"cbfbcf34a24d21ba2b21cf9eedb76f4c3c563c5a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"846cabae287ae31b3bbfac3da022475713dd5ecc","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"716dc463fe4ef5112e7018ed60804125fdfa5cad","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"b5db4203a1392385838c73549ddeae0a4be67eba","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"7884883ec15792f7e54daacb3c62b851dde2b66a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"fd2320ee25507bb8ef49f932c2d170586b44ea4d","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"5b29badecbbe828112c001156023fc0566045cf6","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"24d094fd917947c0ca7492fa094328b1a183b873","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"e8438941085def0591a72fc9b0d705dbf107f54f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"62466b251052cae609b6369d4cb4b6a85320757d","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"89c63a5f0c0ab6314de7158fbc8fcbc84997fc55","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"f2ea5249b3e6670f6c8c77868f4f42c502e43830","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"c81fa7d8a5cb96d1ae07bfa8c46b84a58161add1","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"8af585e6d6f73ee57114eefad574dc6e8ea9f570","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"592b2251db6c1abeb8b0eebe3b2e6d9aa0dec445","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"58914c58a190e3bc0aa37cb581e77e442b563501","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"db6713d2b90eb8183f86ac92c26761a8501c0ddb","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"3abbaaa4ea575c45b3cebffd40bad1acc6ffce84","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"7a80231fc71822e503879383a2d9611edf1d72dd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"84f7cfde00f929fa3dc40349bcab060ec68f1b9f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"53d99831f29aeb2e336ed1407d79590041f77002","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"30a7d157890de69deab28baa47fb7bb28b040efd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"24f18b0c67803210d53abbf9c1d454c000b06eee","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"e2bf15357485cd502414b3b20f5b1f762a2fd014","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/chartjs.pug","hash":"732eb1118ea1a73aa5c164d639097c614f8e9953","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"af66d13204030d47537b9e31a6173e63589ce7ff","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"b83db9fa64d42a0bfd97efb660e09be3f166a144","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"db2f4fff80a1166476ea76ae004aa186df11bad3","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"ca2fc5928ca292f29fd8333c73733344994096fb","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"187302dbc916852ff2fdf47061e272c061611dda","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/common.pug","hash":"27fa75affebc6e84a487c62bceff783bde595256","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"fa4b4194749d05f7249f365f2b89c0281057ce54","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"72e2970b23570e308f8af5d8ba8e5e3321d01bbf","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"a7c07dbc1e970a5b247091458e1ee9b144a3366d","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"34edfebf0cace0852806be774910ccb0e0914650","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"d2e12a9fc302a4efe52c90d44896fbd73e193a1f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d376ec17fb19fcdcf0d2ad71330190146d3af879","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"ec6c685080634ac46ffbea1b8f10313388888f43","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"7f0ede1cd3fed2669c94a8e1b21bc0b183f310b8","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/search/docsearch.pug","hash":"013756ff3363344987cc00fc9bd833baf193c341","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"f8557548d2ad8dd149c562193991c6c6cda02415","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"2622b4cf9189fa23e4a422aaf9ef272e4f2c6137","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"f5ee1c9c8ffa4bca972d30f4de69268b8d47f052","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"e51e896ccb13900de38dc81cf44dc789e2418a12","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"efef352c1d122409575386bf3894dce8e87032e2","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"9f02598b5e4296aec6470639d4bac4c9ac46392e","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"ef52ebf1e8e751a412f9456fdaeee7d88afd9a72","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"077ec530831be1d80e93da380406b9f5abd0918a","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"1883c91d43bff10aae55122a21e0b064b6f5c9dd","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"de4bb5fc2dfca368b35e4c1109c92f7abc9e2245","modified":1748584750000},{"_id":"themes/butterfly/source/img/butterfly-icon.png","hash":"f5dd732fed5c3bcd4aa76bac3441bac8485fb432","modified":1748584750000},{"_id":"public/about/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/categories/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/comments/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/link/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/movies/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/music/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/picture/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/tags/index-1.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/tags/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/2025/06/04/hello-world/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/archives/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/archives/2025/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/archives/2025/06/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1749030102757},{"_id":"public/img/error-page.png","hash":"d2519710498a871ca3e913c57e2ba20a805b6430","modified":1749030102757},{"_id":"public/img/favicon.ico","hash":"455ac256580bf31a45813dbbdb87219bfc8bfb04","modified":1749030102757},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1749030102757},{"_id":"public/css/index.css","hash":"a134b9ab9b0d4ca6444a66bdcc55bd8f600244f7","modified":1749030102757},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/js/main.js","hash":"fb746a3e67d0373deea8481110dd436fea4ca38c","modified":1749030102757},{"_id":"public/js/tw_cn.js","hash":"7ef59df188ea523da89f4caf69c5c0f14e78da69","modified":1749030102757},{"_id":"public/js/utils.js","hash":"fd3c26366c78dd82bc87d4ddebe76c582122e1b7","modified":1749030102757},{"_id":"public/js/search/algolia.js","hash":"e5821f78381af9f0f646952a7dd118daab2a79a6","modified":1749030102757},{"_id":"public/js/search/local-search.js","hash":"4e11d033fb58563f5e1b497f1a6f1c62d3501ee6","modified":1749030102757},{"_id":"public/image/shouye.jpg","hash":"e75ad850c0d85a460832e196ab1940ce99841c8f","modified":1749030102757},{"_id":"public/img/butterfly-icon.png","hash":"f5dd732fed5c3bcd4aa76bac3441bac8485fb432","modified":1749030102757},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/.DS_Store","hash":"f265e4b85368bb93c3a912886e5b4397d2b85f99","modified":1745918838711},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","hash":"f928e205aed451715e66fcdabeda40acc17016a4","modified":1745053627459},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","hash":"ca777da537d0a7d9f37c3ee40b05b5c5004e2b05","modified":1745053849829},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","hash":"731bac951d911ce1d06ab2fffad52071e9e173ec","modified":1745053521350},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","hash":"9ae3c7049609cfddf93e501d51c6f6b2f9c54fe1","modified":1745053653702},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419105704031.png","hash":"ad3c04f5ceef79bac1791e61f283a27491face21","modified":1745031424039},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429172724826.png","hash":"da273dc2bd390a26138020b93e706ca8fbf8b261","modified":1745918844838},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429181131778.png","hash":"0e4282464cd34c9a1222095b0922267be1422f08","modified":1745921491779},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429181312813.png","hash":"aebd7fad268451f30150c11f08cc75190e10f78b","modified":1745921592816},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","hash":"6ee6552a20c710aa26ace986d93c09f17ab35a8d","modified":1745053715414},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","hash":"9881da6dc6387905b676019588e4d61dc9be066f","modified":1745053779852},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419113622811.png","hash":"c5263c854a53d3d911d53bc11404b5867969c0a5","modified":1745033782812},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250425174252871.png","hash":"c33f809927ec425d0ec5a5de446efeb804cc0714","modified":1745574172883},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429181039571.png","hash":"ac3ff91bad60dd8fcf32470de8468bd10c0a1cc3","modified":1745921439575},{"_id":"source/categories/Spring AI Alibaba/Spring AI Agent.md","hash":"d7b384fc0abb9cc26595b28c6a8fdff5513e4b08","modified":1745396492161},{"_id":"source/categories/Spring AI Alibaba/.DS_Store","hash":"ab66dc2c07d915c77eb7ae77d9f6a17171b49e61","modified":1746758325209},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-00-Spring Ai Alibaba.md","hash":"3e8e52832ab059338441700da2ef5edc38a17989","modified":1745056576496},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .md","hash":"4614676542fda9942a414b8c7b7b49991cc26181","modified":1745056587668},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-02-.md","hash":"66a8cc5009fe492b9eefab173931e9138130c6ae","modified":1745923292331},{"_id":"source/categories/Spring AI Alibaba/Untitled.md","hash":"852945edd8f145c8130c9a32a924b6daf4b284bb","modified":1746585186342},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .md","hash":"a935ba41973210a2d25f32608240378e56fccc66","modified":1745923323405},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-04- Spring AI + + ToolCalling .md","hash":"c30f71ce919f7384e101a058c6deeb1d673d36c8","modified":1746692515849},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","hash":"3f5c8e5d220e8ee80edd693aa28b38db2042606f","modified":1745053412261},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419181745960.png","hash":"202acd3f001b8bc0c1eeae98b758b1651f83021a","modified":1745057865972},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419092017527.png","hash":"651a6f76b900f6d32f5c8dcef8b24803841dc1c2","modified":1745025617528},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","hash":"9a12d9ec34beb4470dd34ee9cdbf24795a8ce8ba","modified":1745053589651},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419102848756.png","hash":"46350b8cc65a3e542d3c721fff82d18b7f42cfc6","modified":1745029728757},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419112758947.png","hash":"472e0caec1f9bedaa1e95acdeb4e0a21b0b74ee0","modified":1745033278949},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114642336.png","hash":"2be0181072e00a32cf7c4ffc3da3fc9b59ee6bae","modified":1745293602337},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429183142516.png","hash":"344896ff25fb43bf4ee4b651041ac1cbceda290c","modified":1745922702519},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419091747915.png","hash":"abbb5a2b42a2feea4f067124327ba7a2e0b49844","modified":1745025467915},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419181631076.png","hash":"30174e45262d9a229860a7cb6c8cc056d56a2f16","modified":1745057791077},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175540574.png","hash":"99de9164e275203a2e77465a3c79b96e1ce6dcd4","modified":1745920540584},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250508161546610.png","hash":"b278e1e74774ebf76673cd87797fd25599530a42","modified":1746692146612},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250425104935964-5549379.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250508161105090.png","hash":"c5baca122ea19651a96d3e2008e7eefb815794fa","modified":1746691865104},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175342611.png","hash":"9ab1b9aaa6241fbe4c8d2e16f82f09bfdba51311","modified":1745920422612},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250425104935964.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419181524113.png","hash":"f0a282ddcc5dd3b69d8cfa679c4bcd976ad82e5b","modified":1745057724118},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114322913.png","hash":"6a02df96a96bb0544d1d009868bdba0a8fe5850a","modified":1745293402925},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114422258.png","hash":"6d9b7578a561388f37ad2647180a50dcaa735b07","modified":1745293462259},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175228086.png","hash":"698a2ecc2f30b5c94f52121a41290c671451afa9","modified":1745920348093},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175421998.png","hash":"fe77c6a9999c12a0148bb1990ae045b2bcb63418","modified":1745920462000},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250508162115569.png","hash":"a05a74331a80ea339f895adfcd63f451569a9f23","modified":1746692475571},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114555482.png","hash":"e33332a744c886e568bfe33b306d6f57b0e54f49","modified":1745293555482},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429180401580.png","hash":"a9206b3cba0d01688e0feac3ccba76ce81b93408","modified":1745921041592},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429174851066.png","hash":"1e66607d3f47bb278267622dd24df86e4e26237e","modified":1745920131077},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429174959408.png","hash":"12c835276e5309ffd874ab41de15a9148b6d65ca","modified":1745920199410},{"_id":"source/categories/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","hash":"f928e205aed451715e66fcdabeda40acc17016a4","modified":1745053627459},{"_id":"source/categories/typora-user-images/.DS_Store","hash":"f265e4b85368bb93c3a912886e5b4397d2b85f99","modified":1745918838711},{"_id":"source/categories/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","hash":"ca777da537d0a7d9f37c3ee40b05b5c5004e2b05","modified":1745053849829},{"_id":"source/categories/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","hash":"731bac951d911ce1d06ab2fffad52071e9e173ec","modified":1745053521350},{"_id":"source/categories/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","hash":"9ae3c7049609cfddf93e501d51c6f6b2f9c54fe1","modified":1745053653702},{"_id":"source/categories/typora-user-images/image-20250419105704031.png","hash":"ad3c04f5ceef79bac1791e61f283a27491face21","modified":1745031424039},{"_id":"source/categories/typora-user-images/image-20250429172724826.png","hash":"da273dc2bd390a26138020b93e706ca8fbf8b261","modified":1745918844838},{"_id":"source/categories/typora-user-images/image-20250429181131778.png","hash":"0e4282464cd34c9a1222095b0922267be1422f08","modified":1745921491779},{"_id":"source/categories/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","hash":"6ee6552a20c710aa26ace986d93c09f17ab35a8d","modified":1745053715414},{"_id":"source/categories/typora-user-images/image-20250429181312813.png","hash":"aebd7fad268451f30150c11f08cc75190e10f78b","modified":1745921592816},{"_id":"source/categories/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","hash":"9881da6dc6387905b676019588e4d61dc9be066f","modified":1745053779852},{"_id":"source/categories/typora-user-images/image-20250419113622811.png","hash":"c5263c854a53d3d911d53bc11404b5867969c0a5","modified":1745033782812},{"_id":"source/categories/typora-user-images/image-20250425174252871.png","hash":"c33f809927ec425d0ec5a5de446efeb804cc0714","modified":1745574172883},{"_id":"source/categories/typora-user-images/image-20250429181039571.png","hash":"ac3ff91bad60dd8fcf32470de8468bd10c0a1cc3","modified":1745921439575},{"_id":"source/categories/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","hash":"3f5c8e5d220e8ee80edd693aa28b38db2042606f","modified":1745053412261},{"_id":"source/categories/typora-user-images/image-20250419181745960.png","hash":"202acd3f001b8bc0c1eeae98b758b1651f83021a","modified":1745057865972},{"_id":"source/categories/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","hash":"9a12d9ec34beb4470dd34ee9cdbf24795a8ce8ba","modified":1745053589651},{"_id":"source/categories/typora-user-images/image-20250419092017527.png","hash":"651a6f76b900f6d32f5c8dcef8b24803841dc1c2","modified":1745025617528},{"_id":"source/categories/typora-user-images/image-20250419102848756.png","hash":"46350b8cc65a3e542d3c721fff82d18b7f42cfc6","modified":1745029728757},{"_id":"source/categories/typora-user-images/image-20250419112758947.png","hash":"472e0caec1f9bedaa1e95acdeb4e0a21b0b74ee0","modified":1745033278949},{"_id":"source/categories/typora-user-images/image-20250422114642336.png","hash":"2be0181072e00a32cf7c4ffc3da3fc9b59ee6bae","modified":1745293602337},{"_id":"source/categories/typora-user-images/image-20250429183142516.png","hash":"344896ff25fb43bf4ee4b651041ac1cbceda290c","modified":1745922702519},{"_id":"source/categories/typora-user-images/image-20250419091747915.png","hash":"abbb5a2b42a2feea4f067124327ba7a2e0b49844","modified":1745025467915},{"_id":"source/categories/typora-user-images/image-20250419181631076.png","hash":"30174e45262d9a229860a7cb6c8cc056d56a2f16","modified":1745057791077},{"_id":"source/categories/typora-user-images/image-20250429175540574.png","hash":"99de9164e275203a2e77465a3c79b96e1ce6dcd4","modified":1745920540584},{"_id":"source/categories/typora-user-images/image-20250508161546610.png","hash":"b278e1e74774ebf76673cd87797fd25599530a42","modified":1746692146612},{"_id":"source/categories/typora-user-images/image-20250425104935964.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/categories/typora-user-images/image-20250425104935964-5549379.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/categories/typora-user-images/image-20250429175342611.png","hash":"9ab1b9aaa6241fbe4c8d2e16f82f09bfdba51311","modified":1745920422612},{"_id":"source/categories/typora-user-images/image-20250508161105090.png","hash":"c5baca122ea19651a96d3e2008e7eefb815794fa","modified":1746691865104},{"_id":"source/categories/typora-user-images/image-20250422114322913.png","hash":"6a02df96a96bb0544d1d009868bdba0a8fe5850a","modified":1745293402925},{"_id":"source/categories/typora-user-images/image-20250419181524113.png","hash":"f0a282ddcc5dd3b69d8cfa679c4bcd976ad82e5b","modified":1745057724118},{"_id":"source/categories/typora-user-images/image-20250422114422258.png","hash":"6d9b7578a561388f37ad2647180a50dcaa735b07","modified":1745293462259},{"_id":"source/categories/typora-user-images/image-20250429175421998.png","hash":"fe77c6a9999c12a0148bb1990ae045b2bcb63418","modified":1745920462000},{"_id":"source/categories/typora-user-images/image-20250429175228086.png","hash":"698a2ecc2f30b5c94f52121a41290c671451afa9","modified":1745920348093},{"_id":"source/categories/typora-user-images/image-20250508162115569.png","hash":"a05a74331a80ea339f895adfcd63f451569a9f23","modified":1746692475571},{"_id":"source/categories/typora-user-images/image-20250422114555482.png","hash":"e33332a744c886e568bfe33b306d6f57b0e54f49","modified":1745293555482},{"_id":"source/categories/typora-user-images/image-20250429174851066.png","hash":"1e66607d3f47bb278267622dd24df86e4e26237e","modified":1745920131077},{"_id":"source/categories/typora-user-images/image-20250429180401580.png","hash":"a9206b3cba0d01688e0feac3ccba76ce81b93408","modified":1745921041592},{"_id":"source/categories/typora-user-images/image-20250429174959408.png","hash":"12c835276e5309ffd874ab41de15a9148b6d65ca","modified":1745920199410},{"_id":"source/categories/Spring AI Agent.md","hash":"09b37f49cbb6f15990b273d57f1fbf2195591d4f","modified":1749033074977},{"_id":"source/categories/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .md","hash":"4614676542fda9942a414b8c7b7b49991cc26181","modified":1745056587668},{"_id":"source/categories/Spring AI Alibaba-02-.md","hash":"66a8cc5009fe492b9eefab173931e9138130c6ae","modified":1745923292331},{"_id":"source/categories/Spring AI Alibaba-00-Spring Ai Alibaba.md","hash":"3e8e52832ab059338441700da2ef5edc38a17989","modified":1745056576496},{"_id":"source/categories/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .md","hash":"a935ba41973210a2d25f32608240378e56fccc66","modified":1745923323405},{"_id":"source/categories/Spring AI Alibaba-04- Spring AI + + ToolCalling .md","hash":"c30f71ce919f7384e101a058c6deeb1d673d36c8","modified":1746692515849},{"_id":"source/categories/Untitled.md","hash":"852945edd8f145c8130c9a32a924b6daf4b284bb","modified":1746585186342},{"_id":"source/categories/.DS_Store","hash":"35a1c54ece7ada401ae8a4fe999cd92211d26d8e","modified":1749032004230},{"_id":"source/.DS_Store","hash":"55e507a54f68f4fe0662b2c0816130e920d24400","modified":1749034889408},{"_id":"source/categories/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1749024109000},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250419105704031.png","hash":"ad3c04f5ceef79bac1791e61f283a27491face21","modified":1745031424039},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429172724826.png","hash":"da273dc2bd390a26138020b93e706ca8fbf8b261","modified":1745918844838},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429181131778.png","hash":"0e4282464cd34c9a1222095b0922267be1422f08","modified":1745921491779},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429181312813.png","hash":"aebd7fad268451f30150c11f08cc75190e10f78b","modified":1745921592816},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250419113622811.png","hash":"c5263c854a53d3d911d53bc11404b5867969c0a5","modified":1745033782812},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250425174252871.png","hash":"c33f809927ec425d0ec5a5de446efeb804cc0714","modified":1745574172883},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429181039571.png","hash":"ac3ff91bad60dd8fcf32470de8468bd10c0a1cc3","modified":1745921439575},{"_id":"source/_posts/Spring AI Alibaba/Untitled.md","hash":"852945edd8f145c8130c9a32a924b6daf4b284bb","modified":1746585186342},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250419181745960.png","hash":"202acd3f001b8bc0c1eeae98b758b1651f83021a","modified":1745057865972},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250419092017527.png","hash":"651a6f76b900f6d32f5c8dcef8b24803841dc1c2","modified":1745025617528},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250419102848756.png","hash":"46350b8cc65a3e542d3c721fff82d18b7f42cfc6","modified":1745029728757},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250419112758947.png","hash":"472e0caec1f9bedaa1e95acdeb4e0a21b0b74ee0","modified":1745033278949},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250422114642336.png","hash":"2be0181072e00a32cf7c4ffc3da3fc9b59ee6bae","modified":1745293602337},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429183142516.png","hash":"344896ff25fb43bf4ee4b651041ac1cbceda290c","modified":1745922702519},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250419091747915.png","hash":"abbb5a2b42a2feea4f067124327ba7a2e0b49844","modified":1745025467915},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250419181631076.png","hash":"30174e45262d9a229860a7cb6c8cc056d56a2f16","modified":1745057791077},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429175540574.png","hash":"99de9164e275203a2e77465a3c79b96e1ce6dcd4","modified":1745920540584},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250425104935964.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429175342611.png","hash":"9ab1b9aaa6241fbe4c8d2e16f82f09bfdba51311","modified":1745920422612},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250508161105090.png","hash":"c5baca122ea19651a96d3e2008e7eefb815794fa","modified":1746691865104},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250419181524113.png","hash":"f0a282ddcc5dd3b69d8cfa679c4bcd976ad82e5b","modified":1745057724118},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250422114422258.png","hash":"6d9b7578a561388f37ad2647180a50dcaa735b07","modified":1745293462259},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250422114322913.png","hash":"6a02df96a96bb0544d1d009868bdba0a8fe5850a","modified":1745293402925},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429175228086.png","hash":"698a2ecc2f30b5c94f52121a41290c671451afa9","modified":1745920348093},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429175421998.png","hash":"fe77c6a9999c12a0148bb1990ae045b2bcb63418","modified":1745920462000},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250508161546610.png","hash":"b278e1e74774ebf76673cd87797fd25599530a42","modified":1746692146612},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250422114555482.png","hash":"e33332a744c886e568bfe33b306d6f57b0e54f49","modified":1745293555482},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429174851066.png","hash":"1e66607d3f47bb278267622dd24df86e4e26237e","modified":1745920131077},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429180401580.png","hash":"a9206b3cba0d01688e0feac3ccba76ce81b93408","modified":1745921041592},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250429174959408.png","hash":"12c835276e5309ffd874ab41de15a9148b6d65ca","modified":1745920199410},{"_id":"source/_posts/Skywalking/Untitled.md","hash":"2b8dc79927f969db6ec808b1b26a1197d77388b6","modified":1716456899230},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","hash":"f928e205aed451715e66fcdabeda40acc17016a4","modified":1745053627459},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/.DS_Store","hash":"f265e4b85368bb93c3a912886e5b4397d2b85f99","modified":1745918838711},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","hash":"9ae3c7049609cfddf93e501d51c6f6b2f9c54fe1","modified":1745053653702},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","hash":"731bac951d911ce1d06ab2fffad52071e9e173ec","modified":1745053521350},{"_id":"source/_posts/Spring AI Alibaba/Spring AI Agent.md","hash":"7d90d1cdefcd21cb5ce6e1b2e63c5265bd956cc2","modified":1749033843478},{"_id":"source/_posts/Spring AI Alibaba/.DS_Store","hash":"ab66dc2c07d915c77eb7ae77d9f6a17171b49e61","modified":1746758325209},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","hash":"6ee6552a20c710aa26ace986d93c09f17ab35a8d","modified":1745053715414},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","hash":"9881da6dc6387905b676019588e4d61dc9be066f","modified":1745053779852},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","hash":"3f5c8e5d220e8ee80edd693aa28b38db2042606f","modified":1745053412261},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","hash":"9a12d9ec34beb4470dd34ee9cdbf24795a8ce8ba","modified":1745053589651},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250425104935964-5549379.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/image-20250508162115569.png","hash":"a05a74331a80ea339f895adfcd63f451569a9f23","modified":1746692475571},{"_id":"source/_posts/Spring AI Alibaba/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","hash":"ca777da537d0a7d9f37c3ee40b05b5c5004e2b05","modified":1745053849829},{"_id":"source/_posts/Spring AI Alibaba/Spring AI Alibaba-00-Spring Ai Alibaba.md","hash":"31e300640ee4364a8342c7f9df0ae591c000889d","modified":1749034196785},{"_id":"source/_posts/Spring AI Alibaba/Spring AI Alibaba-02-.md","hash":"f5cbc235a6616f224cab4d4c41dae56faa68433d","modified":1749034196741},{"_id":"source/_posts/Spring AI Alibaba/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .md","hash":"99c93be4332e926636fdbf7c8d445a6b7271c568","modified":1749034196775},{"_id":"source/_posts/Spring AI Alibaba/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .md","hash":"672e43c1dc85540e12b1554390a3eb7f22326093","modified":1749034196759},{"_id":"source/_posts/Spring AI Alibaba/Spring AI Alibaba-04- Spring AI + + ToolCalling .md","hash":"1905fde13c8b79daa3cfa74a788312fd435118db","modified":1749034196730},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230628093611653.png","hash":"e65a781d388d67b94ec024f11df0ac23c62a9f77","modified":1687916171654},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/.DS_Store","hash":"59ae33c178ac5ec44343d6286454e883b1ff2d2b","modified":1715823483185},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/afb25fa106bada4b37da64e902060269.png","hash":"6590c9d6fe25132a7ad233925fb74c12f99378a3","modified":1708398236439},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230628093823674.png","hash":"2a20d7c05ada9fd931f4785fb83a027484e204f9","modified":1687916303675},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923145029314.png","hash":"3672cc9eefa8fd90fb67b6e34e39a7a56a98b8ce","modified":1695451829315},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024095726856.png","hash":"154f847ec928c50cd100095339c2e345a1136c2b","modified":1698112646856},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024095816182.png","hash":"17c9a3ec2fea9d3f9e6520e7b38babebd5fba5f3","modified":1698112696182},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024092452701.png","hash":"1704780e7d642ee53865c4e76846273a9c8140b6","modified":1698110692701},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024095843156.png","hash":"d1ae6931331a864aa6c62fdf995942035f501cf8","modified":1698112723156},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024092913063.png","hash":"c85d5c02104a13abb53561f20b023068586d7462","modified":1698110953063},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219151212695.png","hash":"574ef7b7b393248e20b88fcb4b26a71d627ad618","modified":1708326732696},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231201153117052.png","hash":"a26438f05ec3d15b64a29063cfe83a0aceedd880","modified":1701415877054},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220102457440.png","hash":"00c0b12ce12e6ea0c49548d33b403687cfdc0189","modified":1708395897440},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220144907721.png","hash":"d37668b1aad5f030616464724deb8f0db117a507","modified":1708411747722},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220094227461.png","hash":"1448a7ab99d3ad8d704c3210d4c63faaa2b380f3","modified":1708393347462},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220102231198.png","hash":"13781da444bffea1fa86f57dce57761b6d9b41fd","modified":1708395751198},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221094244920.png","hash":"bd1cc1cf8e360a26b53d7d713d4d96dd5c646194","modified":1708479764921},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222152145318.png","hash":"ea0bfdcb4d5b983eddc66470b884e3184cac0dc7","modified":1708586505320},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222164404555.png","hash":"8cee0474bbe622aabb71ccc0e98bb19865c7e8a9","modified":1708591444557},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222164533515.png","hash":"3918c9d39bab53b1274d95e023882faf9d933afe","modified":1708591533515},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222164433038.png","hash":"5ec85e744795a997dd2bd6bae4d5cfecc5b87a7e","modified":1708591473038},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240415094839642.png","hash":"aadd5058a4a39b4066d1fc8cce856c21d9b6ae23","modified":1713145719643},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/1134316536b140eda97bef40993a2072.png","hash":"7b8ca16e7db13f3c62b1e2623598f8e6a98978c2","modified":1708657293338},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230921170222187.png","hash":"37856e5ff5e106ecfe0c2bddae56cb1ac3bd8513","modified":1695286942187},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230628094058045.png","hash":"2638081ba870b1a217a1cd2df33e6a370b012d24","modified":1687916458046},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923144315232.png","hash":"804a761075a2d1f9cd89802a5863696dfaab950b","modified":1695451395232},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923144526897.png","hash":"65a4d29e2aa8f042d86b68d2640c6bbbcb27268b","modified":1695451526898},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923152344429.png","hash":"424baff60afbd3ee54a43081fc2a5e6b87855e56","modified":1695453824430},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221091728143.png","hash":"9922743caba2ccc606b79b076dcdbb108dcca8f8","modified":1708478248144},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-03-NacosDataID.md","hash":"470b283b120a4ad7d1a11817c2046f11756419b4","modified":1717727317208},{"_id":"source/_posts/Spring Cloud Alibaba /.DS_Store","hash":"8c76adecaea10e5c97842d95843b7e5cf89937db","modified":1749034904069},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-01-.md","hash":"23589aebcae47a7953c56983efeda4ec418beae8","modified":1717148204224},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-06-Sleuth.md","hash":"5ae125c0185ce06a94b45fc5523798c5a8059955","modified":1713316948705},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-05-Gateway-02-(Predicate).md","hash":"7648244966a32ea78aab39f8064062d9130a36c2","modified":1708657200466},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923145922760.png","hash":"11d4561b7e8111a8185c1704d85b1fde21e0386f","modified":1695452362760},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221091837069.png","hash":"028d6df4053a834c1b8e2b57fccbb9d0a6cd4cc7","modified":1708478317070},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222180325402.png","hash":"d78f6b372e50726b2494420829013994150acd7c","modified":1708596205402},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240223110630296.png","hash":"bfc87b3d6fa611ce06ab14bd35b9ccca47d70048","modified":1708657590296},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230921171005578.png","hash":"475e87595ea06dfe13ef06aeb6f88ee1c17723e1","modified":1695287405578},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923144634136.png","hash":"d567d6a6f01e575f315824c3417e510e16b6eb05","modified":1695451594137},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230921170734063.png","hash":"e3db4d79b4eb89d8a7e6ca0703e7e6c55604a9c0","modified":1695287254063},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923145717673.png","hash":"e8bc3c7beab2f62218290f38a636714d4af5e3f5","modified":1695452237673},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222180306582.png","hash":"97a69d286a268a115e21cac5d1cbcb3e0f53b1f7","modified":1708596186582},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240514095650303.png","hash":"1e3bbddc41c515dd5c19429d68264bbaf08e3371","modified":1715651810303},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240509105539663.png","hash":"1db876cda46958efbf6c4d19a5b8f8aa7a4dd97c","modified":1715223339664},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240522090312508.png","hash":"3139ccea0ce9f8ff4089b7a920e87c0763c81f68","modified":1716339792519},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70-6340401.png","hash":"b5d3395e2ce2b2834898b81d5d0c77eba2680494","modified":1716340401877},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221092834785.png","hash":"69ff079a54850f2141298e697bd4ea539e26af53","modified":1708478914788},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240223110332038.png","hash":"f6602e6e7b303d2116561200abfbeebbafb737ec","modified":1708657412038},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/32fe9b12c9192392c3a50b5f04759eec.png","hash":"361d07b792b4efb822a20044471ed1c9c5e0fc39","modified":1708592052132},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240516094845785.png","hash":"3d3999ff1248f9e98f822f133fdc07d7f111f26f","modified":1715824125786},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230921171251668.png","hash":"c2918e0518513a92d9186de9312aa7fb5ccc0225","modified":1695287571669},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240417091316659.png","hash":"c05a5eee17c67ffac9e8e46396a42768b702f1e0","modified":1713316396661},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240417092003988.png","hash":"aec1f1669ef01a5965d955dc982877b7a14acf1f","modified":1713316803990},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240416114924463.png","hash":"e9d239af67f13fae73f92d2c36e7470b36eea866","modified":1713239364463},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/20220314-b46efe3c-5ede-471f-a116-ce05fcccd7c6.png","hash":"60bc69303831eaa5a06110f5a4147931940cc101","modified":1709257029801},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/a7002eb5f5b8429c8b8728b9f2e3e10d.png","hash":"c5e244e5336cc471095a64bee8a67f28d8ba149b","modified":1708398181346},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/c5abda0a657e59634fb07442a84bf5e0.png","hash":"f2f87a7079f1a7fe567471813b2882046a826468","modified":1708400595152},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230627191528034.png","hash":"9b76a4f7807f96de5504e9727ad5b5fe8d870038","modified":1687864528034},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230628094521252.png","hash":"7dc31c03583543027a1693d549b62fbdf365ce1d","modified":1687916721253},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230628094428585.png","hash":"7036b3a680755d8e95691c50a36aebcfb48b6723","modified":1687916668586},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231008103734081.png","hash":"34b1863b5414b5631199561e25b1b85f2a80562c","modified":1696732654082},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024092756314.png","hash":"281de629b5fe60b2e44c607939f9ea15ffb1fb98","modified":1698110876314},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024094558547.png","hash":"91523ddf4349efd4b748b7f2ae0a407a5c4827ce","modified":1698111958548},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024104338016.png","hash":"6cc18536d413a7a3f6ca1f5c19d33750ba092dbb","modified":1698115418017},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231201144020748.png","hash":"1392543f061f1ce9d1d52892d526e3f8e28fd679","modified":1701412820749},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231201143940420.png","hash":"4247c1336893ff8b052a11eb2d4cd5f1e6a73b6b","modified":1701412780421},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231201144119343.png","hash":"a820cf629adeb01acd835846a78b29a086c5c8da","modified":1701412879344},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219114233026.png","hash":"1be9d5bfa4b1ca6461ca8ab935f4bad98ad22dd9","modified":1708314153026},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219114515952.png","hash":"1d882390262cf4e71a4e3547b93f7ac0a6bc8745","modified":1708314315953},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219144606520.png","hash":"de6e7555a2365a23bc9a9450d02f0ebc632012a1","modified":1708325166521},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219150634816.png","hash":"85234fcc2d67718c5a68ef510aefe5f11bba6a81","modified":1708326394819},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219150821657.png","hash":"6adf92a4a7c88db5264fb9492ffe0df84dfb0114","modified":1708326501657},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219150910898.png","hash":"7a134a3ca9b7c3c2f719637364a51739cf553dd4","modified":1708326550898},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219151031448.png","hash":"a3f4c7cd2accae54259c9679c448f70442afe403","modified":1708326631448},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219152638390.png","hash":"e48fcf5cad156e92ec5f77874371df4df6fe03ec","modified":1708327598391},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219153810692.png","hash":"dcf90eff4ec211e449491b5f63ff0efb3ec03e42","modified":1708328290694},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219154032740.png","hash":"3ecd3821b36206bb69c3dd57e28c5c0687ba004e","modified":1708328432740},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220095645324.png","hash":"631e4c210d3bcc234ab9af63699e9ec87d4313c7","modified":1708394205325},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220101429844.png","hash":"59758bd263655f5b58b534dbfc81be39a5a89b14","modified":1708395269845},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220102332812.png","hash":"ed9db142789f1c8ca74018a4cd1745da10947a45","modified":1708395812813},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220103006353.png","hash":"4d3b13b8784cd20a6a0e3356f3c079450288bf93","modified":1708396206354},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220102621265.png","hash":"ec54793adff3e22aa977f7a838302497efc592a5","modified":1708395981265},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220102752041.png","hash":"67bd31742cd7960739a0bab4da5675904aa84f99","modified":1708396072042},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220103217414.png","hash":"218f2e2ced5e54f34a1200c684bcbd712f8ca2d8","modified":1708396337414},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221092419244.png","hash":"fd61d9abaceb1d713a4c8fa976df8a6ea4635004","modified":1708478659245},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221093021265.png","hash":"132880d4de49a3f95fc8b3653b35492348edf2c0","modified":1708479021266},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221094225094.png","hash":"59b02ba2161ba7d6a9cc1d17a04b4ba1aa9b1255","modified":1708479745096},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221155333042.png","hash":"c3f9d29db5350eaf1a35696a29772681237faf15","modified":1708502013046},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222164517003.png","hash":"dc07595b9a529bf01b82425000b486aa4199d6f5","modified":1708591517003},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240507111933014.png","hash":"e53c218c730e9aee66f7a8f65f85e229596d5f58","modified":1715051973015},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240507112405845.png","hash":"e65a781d388d67b94ec024f11df0ac23c62a9f77","modified":1715052245847},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240507112114709.png","hash":"e65a781d388d67b94ec024f11df0ac23c62a9f77","modified":1715052074710},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/webp","hash":"f917f3e033ab2d6dbad539dde95f8caebdf07a02","modified":1708591877163},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923144124237.png","hash":"f68b880a2863b7529ade8e592c6bec5afdfe4a05","modified":1695451284239},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923144238782.png","hash":"6dd6156846efaa9f344a3aab4e02e552a8edec35","modified":1695451358783},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923144347556.png","hash":"107bbe2e4e44f49d21293eb4da1d57ba4db5df75","modified":1695451427556},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923144953818.png","hash":"c57fb2a037a97415f885c118f6fe0ca4b9a6964d","modified":1695451793820},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923144414595.png","hash":"2d05bc76b351bc883a7195a787f920c2c19ca85f","modified":1695451454595},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923154459874.png","hash":"65c0f272b6964bd2e03e376e15938f148bd8b9f8","modified":1695455099874},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024101307177.png","hash":"6d2c18dab3d07a9b86acb5e73ebcfbbc5c5170b1","modified":1698113587177},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20231024102201145.png","hash":"42a805c7ee1585218f5cb4038a7b85ae56eeffc9","modified":1698114121145},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219114343151.png","hash":"dc3e3955b4b26107db0d98badbe43363803f3db4","modified":1708314223152},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220095107292.png","hash":"dc3e1488b33e1af2b21370a8c72a538801049f5a","modified":1708393867293},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220101701432.png","hash":"27638722b6c87cc3953b44dcf9df8432133ab43d","modified":1708395421433},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220101010503.png","hash":"63b7c6935ee80b5eb36ffe375b04f8010a5d896c","modified":1708395010504},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240220102431979.png","hash":"e2b7ee4d99c89aed792b71b39a16bbb43f4ea4f5","modified":1708395871980},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221092028120.png","hash":"b38336f634e9b3fbf8dc3750e5098dbd2adfba60","modified":1708478428122},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221093819873.png","hash":"61aaece6568ebdb28ebfe1d4d7673c7db038d9b7","modified":1708479499873},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221094447664.png","hash":"3fad626e34213498460b69d420911eadc4798f03","modified":1708479887665},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221094852671.png","hash":"65d823ae285eb6e7d4501ba580be05737b242409","modified":1708480132672},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222175403127.png","hash":"759466b76af037d17aef71082b60fd4444d98e88","modified":1708595643127},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222181235735.png","hash":"446d65cd2cabfc3739546eb9e34bfde3bc74c9c0","modified":1708596755736},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240510121326830.png","hash":"99d7ea26194892bb37cc2d600bee0c6c62681773","modified":1715314406831},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240522090958255.png","hash":"de082694dac20df20c7e703b65b5fdf41d3ced15","modified":1716340198255},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/u=641752398,1880469199&fm=253&fmt=auto&app=138&f=PNG.png","hash":"5f3cf68545f65e6efa160e5a7a8b20b8b12f31b9","modified":1708591997910},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70.png","hash":"2ed39a0c534189dabb51f290d50af84c5a1e0bd4","modified":1708397424132},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/20220315-917e43b8-7523-4f2f-804c-49855963dbb5.png","hash":"a5f7c41c0f29418b336a08d9aab3a0ae3b1e1938","modified":1709257198169},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/2afdf3d7222117202a1069d7e1587c12.png#align=left&display=inline&height=655&name=image.png","hash":"d2ef63ee6c52898e5271ae7c016ea21db4e3f410","modified":1708397853737},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/72746e97a2cd474bb21601f507779a25.png","hash":"8c2982ef63c0fb718af012618fd2c1086ec86006","modified":1715075069072},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/fe3e2f4ebbbc4a28b707459e2e9fa511.png","hash":"de0940531ee2b6f2dbe186229aa8c46557ffb9b0","modified":1709255988564},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923151411555.png","hash":"dc0765cd34e084e0e7cc11c061fd2ec32cf00077","modified":1695453251556},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923162555344.png","hash":"04db850e51d79aacb52a8fc0bf54a3c812ddf2fa","modified":1695457555344},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219152607457.png","hash":"4bf67bf0a76285cd265b4d31ad23b3496ce0b1ba","modified":1708327567459},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221091441127.png","hash":"779e8c8a4e9d6a99f3f5b46ddd3042ba9b460f63","modified":1708478081128},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221092353574.png","hash":"78d606391142724c4b2712cf14f9ffb835c0dbfd","modified":1708478633575},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222175326047.png","hash":"1ee1c1c6ef47ad9dc08a842dcb351cec04516f2d","modified":1708595606050},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222180337721.png","hash":"d78f6b372e50726b2494420829013994150acd7c","modified":1708596217721},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240318202804603.png","hash":"0cd6675c6685aadccde6ef503a660d4195e5e127","modified":1710764884603},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240514095424805.png","hash":"0fa4fd657fc9095c29a2c785ae0eac834eacd8d8","modified":1715651664806},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240510121631586.png","hash":"cab1a82b5ee99a68a80e57388cf5ce794f103f22","modified":1715314591586},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240520161819461.png","hash":"854829d75e3ef499d7a3dd8ca2071b14107e9009","modified":1716193099463},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/u=3986274733,3849268543&fm=253&fmt=auto&app=138&f=PNG.png","hash":"ae473891e1ba05f2a0b04d2869a033a8c9e5993d","modified":1709256578297},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230921165730484.png","hash":"8005d88378965d391adfeb682849a8eb7bc0fb36","modified":1695286650485},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923150103329.png","hash":"465b742fedcf9e9dd5df14a08c771fc8c4fb5900","modified":1695452463330},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923162506692.png","hash":"66f03aba21d26d5d9657d526548731cc0c471162","modified":1695457506693},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-05-Gateway-03-(Filter).md","hash":"7f53f3f18c3db0fd1ed98752cd6c84b41b08c179","modified":1708660206990},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-02-Nacos Discovery.md","hash":"94dca49c3a8ac08181dcce7721398efd8befaa0a","modified":1698113992216},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-04-SentinelNacos.md","hash":"69ec7d058e5044320d897567d423be6682cc32e4","modified":1708502128076},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-04-Sentinel.md","hash":"baefbe52a804dec148d5925bcd0cce9aaf6b1c0d","modified":1708504203704},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-08- SMS.md","hash":"8fd963ff6d2f850e15469f75ff8e1e4174d61525","modified":1715651164726},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-07-RocketMQ.md","hash":"7d1add2270c1ea8af176a175a60778629377557f","modified":1715648833826},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-05-Gateway-01-Naocs.md","hash":"38296e1c350359e1f0083167954f76d914a9c9db","modified":1708660361497},{"_id":"source/_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-09-Seata .md","hash":"ecd3708c0f9efac8568d4ecfc6f3ed5314615dd1","modified":1717146259065},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240219113719157.png","hash":"57072961b1982c890772c45a63a8af2e91a206c3","modified":1708313839158},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221093711599.png","hash":"9949b95d1c4786a60a3cabf92b9d75ec1307042f","modified":1708479431602},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240222180227522.png","hash":"cb2f2b1268d7a5bdec1b62d4c519f746427116ee","modified":1708596147522},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240514095835213.png","hash":"63057deacd2e3305690510e373dfb70ea9840c45","modified":1715651915214},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240521094502177.png","hash":"da4af49b8625772c350829061e5cf7b938cd2884","modified":1716255902180},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240522090352573.png","hash":"798df439306b8a08434548db9708abdf04de70e8","modified":1716339832574},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923154644281.png","hash":"63e926e126ebe21693302a25cadaeebb19a3c3dc","modified":1695455204282},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221094018816.png","hash":"ad37fce1f1a49fc8661c15c0dbcb38e0aa550bb8","modified":1708479618817},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240221095745495.png","hash":"5cc59fb94af18c29a44aaaae205f4cb7f5c8312a","modified":1708480665499},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240416114808884.png","hash":"b85644b2c128279c75d62b3c98075df968add195","modified":1713239288885},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240522091143334.png","hash":"1f855cb2c4f4b55621718607774f1a84470094f2","modified":1716340303335},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240524175527451.png","hash":"980dfd1cef619a0e13811c6acc129cef9a7a8cc4","modified":1716544527451},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240415090937231.png","hash":"5f5d421b8b2a6e61ece77cb038e75449096f2e1a","modified":1713143377242},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240416120116317.png","hash":"b85e3326515586bcc2a49a86eed1223639032eb2","modified":1713240076321},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240524175254196.png","hash":"2b3e657322d36faa28bf1a10fd72c021a16732ee","modified":1716544374196},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/779689.png","hash":"7b5c3c50868191d92a2e8735e5b5faf7c4cabf20","modified":1708658957355},{"_id":"source/_posts/Spring Scurity/typora-user-images/.DS_Store","hash":"517152b7b3befe16546b5ebb9b61c4c598520183","modified":1730721789447},{"_id":"source/_posts/Spring Scurity/typora-user-images/1196304-20200826192341898-2141471475.png","hash":"320c3057bd406d77868002eb328ef5d907561f3f","modified":1717398031480},{"_id":"source/_posts/Spring Scurity/typora-user-images/afa0f46d4bd1929b2f0035cccec7ec54.png","hash":"cf9ae142fb5b46cac9ef87103fdeaad6c38720c7","modified":1717467350623},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603164717128.png","hash":"b018830445e89005831a371cbd5a0b9a36402425","modified":1717404437129},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603162823348.png","hash":"4c1fa91781e26da2dc63122053bc086d7fede868","modified":1717403303349},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603161843912.png","hash":"d214a388d26b9730ddac6009a4447d6e5d8c1568","modified":1717402723923},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240607151332996.png","hash":"c836e521c700ba4518d01266140b8276173b5d55","modified":1717744412998},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240607152105463.png","hash":"ca56dd718172bd59eeb4b4b8e4231bcc3d6712d1","modified":1717744865465},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240607153316591.png","hash":"f4a422045aeae3e01d945e65ce4d5ba78dc31e2a","modified":1717745596593},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240607152107972-7744869.png","hash":"ca56dd718172bd59eeb4b4b8e4231bcc3d6712d1","modified":1717744867986},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240607152546090.png","hash":"0a496d63e11b45a33e869c596f50d145885f282c","modified":1717745146091},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240607152107972.png","hash":"ca56dd718172bd59eeb4b4b8e4231bcc3d6712d1","modified":1717744867986},{"_id":"source/_posts/Spring Scurity/typora-user-images/u=268724271,3366193905&fm=253&fmt=auto&app=138&f=JPEG.jpeg","hash":"a07974467f997e8e8e41306b426d7af58e51d441","modified":1717467532027},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240509105505568.png","hash":"f3d974c6c56fa3228cb715a853a25766e5b13f44","modified":1715223305572},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603162356643.png","hash":"d340d76fce9df5dd94add8f3f8aed079740c8c24","modified":1717403036644},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603183228302.png","hash":"b16fafafdcc9aa79c463e5facfa3b60f78c8829b","modified":1717410748303},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240604102635317.png","hash":"10ceeb9dfd3a8b87110dbd054483ca2d091c72c7","modified":1717467995317},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240412121048381.png","hash":"e514a0de2cf0d42557d81e97bf51e65cdfa56067","modified":1712895048382},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240415091018922.png","hash":"9d03c61ddacaf863607e74d8fd4cef929367fd9a","modified":1713143418922},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240416113821316.png","hash":"2b971242ebf91ad5c1f3fb81ba7be8c8bafcb497","modified":1713238701320},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240417092118543.png","hash":"350e8c068bfc9e7009e2d5d023c860cf29b0739e","modified":1713316878545},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240510121854650.png","hash":"7fc521f21df0b3261fdb8520eeb89f809614bfdd","modified":1715314734651},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20230923145122020.png","hash":"49917b80ba7d58da9c0a93bb12d31caf292812d9","modified":1695451882021},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240530162145444.png","hash":"3789f03b9584b12c64eea94c340f5c0fbbe731a2","modified":1717057305444},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603152303347.png","hash":"71ace59a06f9c135e5845e662e7447e6d6948687","modified":1717399383354},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603182405443.png","hash":"511c4d8553c742f28a749345bea88b49b759b92b","modified":1717410245444},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240606160509365.png","hash":"376bb9e6d4d349f77c17477c53103b54d72de714","modified":1717661109366},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603171252335.png","hash":"fc4cdcd1b6360db74769b2018ba0c29058bf17f1","modified":1717405972350},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240604104220375.png","hash":"ceb767c6ff7574586f04c27a114386a65d1908b4","modified":1717468940376},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240604104307531.png","hash":"2aae2df9a8c1d25c44b045d990fb9f4c91250de2","modified":1717468987532},{"_id":"source/_posts/Spring Scurity/.DS_Store","hash":"44220161d815bf26c302e50cd61365178f4ef801","modified":1730722700258},{"_id":"source/_posts/Spring Scurity/Spring Security-03-Spring Security.md","hash":"528a2f7c7dac8a4a849de6c4f31fd31e6ee2a133","modified":1742635492239},{"_id":"source/_posts/Spring Scurity/Spring Security-02-Spring SecurityHTTPFormHTTP.md","hash":"eb0248f4f28b165d9a1ed737199ff54317b148d1","modified":1730721969599},{"_id":"source/_posts/Spring Scurity/Spring Security-01-Spring SecuritySpringBoot.md","hash":"10c0b0ef90d0cea58687908d9a0b67959e58c46a","modified":1717404942160},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240604104434062.png","hash":"ad5114be20fa8a4701d22bc64db688ee611168ba","modified":1717469074077},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240604103555842.png","hash":"d388f5cd2068d9f89e9598b08c89b3542add9900","modified":1717468555856},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240524174544128.png","hash":"59654553ec675ebf49fdb7bbbdd03501a57afff5","modified":1716543944129},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240416114024941.png","hash":"78cd820b26821a4b72b0eefabb88439df7114340","modified":1713238824943},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603195422293.png","hash":"d488534ad5b4fb02c967eef93b95df45e3bc4b0b","modified":1717415662295},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/20220315-2c2a053e-ddb6-4656-bc61-9a94d8b14598.png","hash":"8f6ce07ff86f5258b92f78c5af534b409edc5f8d","modified":1709256686636},{"_id":"source/_posts/Spring Scurity/typora-user-images/image-20240603202016962.png","hash":"286487fbf41128214102f3a138154de79978377d","modified":1717417216963},{"_id":"source/_posts/Spring Cloud Alibaba /typora-user-images/image-20240507112941777.png","hash":"b66d1a949da64143e32e83de63df6403051fa111","modified":1715052581779},{"_id":"source/typora-user-images/.DS_Store","hash":"f265e4b85368bb93c3a912886e5b4397d2b85f99","modified":1745918838711},{"_id":"source/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","hash":"f928e205aed451715e66fcdabeda40acc17016a4","modified":1745053627459},{"_id":"source/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","hash":"ca777da537d0a7d9f37c3ee40b05b5c5004e2b05","modified":1745053849829},{"_id":"source/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","hash":"9ae3c7049609cfddf93e501d51c6f6b2f9c54fe1","modified":1745053653702},{"_id":"source/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","hash":"731bac951d911ce1d06ab2fffad52071e9e173ec","modified":1745053521350},{"_id":"source/typora-user-images/image-20250419105704031.png","hash":"ad3c04f5ceef79bac1791e61f283a27491face21","modified":1745031424039},{"_id":"source/typora-user-images/image-20250429172724826.png","hash":"da273dc2bd390a26138020b93e706ca8fbf8b261","modified":1745918844838},{"_id":"source/typora-user-images/image-20250429181131778.png","hash":"0e4282464cd34c9a1222095b0922267be1422f08","modified":1745921491779},{"_id":"source/typora-user-images/image-20250429181312813.png","hash":"aebd7fad268451f30150c11f08cc75190e10f78b","modified":1745921592816},{"_id":"source/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","hash":"6ee6552a20c710aa26ace986d93c09f17ab35a8d","modified":1745053715414},{"_id":"source/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","hash":"9881da6dc6387905b676019588e4d61dc9be066f","modified":1745053779852},{"_id":"source/typora-user-images/image-20250419113622811.png","hash":"c5263c854a53d3d911d53bc11404b5867969c0a5","modified":1745033782812},{"_id":"source/typora-user-images/image-20250425174252871.png","hash":"c33f809927ec425d0ec5a5de446efeb804cc0714","modified":1745574172883},{"_id":"source/typora-user-images/image-20250429181039571.png","hash":"ac3ff91bad60dd8fcf32470de8468bd10c0a1cc3","modified":1745921439575},{"_id":"source/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","hash":"3f5c8e5d220e8ee80edd693aa28b38db2042606f","modified":1745053412261},{"_id":"source/typora-user-images/image-20250419181745960.png","hash":"202acd3f001b8bc0c1eeae98b758b1651f83021a","modified":1745057865972},{"_id":"source/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","hash":"9a12d9ec34beb4470dd34ee9cdbf24795a8ce8ba","modified":1745053589651},{"_id":"source/typora-user-images/image-20250419092017527.png","hash":"651a6f76b900f6d32f5c8dcef8b24803841dc1c2","modified":1745025617528},{"_id":"source/typora-user-images/image-20250419102848756.png","hash":"46350b8cc65a3e542d3c721fff82d18b7f42cfc6","modified":1745029728757},{"_id":"source/typora-user-images/image-20250419112758947.png","hash":"472e0caec1f9bedaa1e95acdeb4e0a21b0b74ee0","modified":1745033278949},{"_id":"source/typora-user-images/image-20250422114642336.png","hash":"2be0181072e00a32cf7c4ffc3da3fc9b59ee6bae","modified":1745293602337},{"_id":"source/typora-user-images/image-20250429183142516.png","hash":"344896ff25fb43bf4ee4b651041ac1cbceda290c","modified":1745922702519},{"_id":"source/typora-user-images/image-20250419091747915.png","hash":"abbb5a2b42a2feea4f067124327ba7a2e0b49844","modified":1745025467915},{"_id":"source/typora-user-images/image-20250419181631076.png","hash":"30174e45262d9a229860a7cb6c8cc056d56a2f16","modified":1745057791077},{"_id":"source/typora-user-images/image-20250429175540574.png","hash":"99de9164e275203a2e77465a3c79b96e1ce6dcd4","modified":1745920540584},{"_id":"source/typora-user-images/image-20250508161546610.png","hash":"b278e1e74774ebf76673cd87797fd25599530a42","modified":1746692146612},{"_id":"source/typora-user-images/image-20250425104935964.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/typora-user-images/image-20250425104935964-5549379.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/typora-user-images/image-20250429175342611.png","hash":"9ab1b9aaa6241fbe4c8d2e16f82f09bfdba51311","modified":1745920422612},{"_id":"source/typora-user-images/image-20250508161105090.png","hash":"c5baca122ea19651a96d3e2008e7eefb815794fa","modified":1746691865104},{"_id":"source/typora-user-images/image-20250419181524113.png","hash":"f0a282ddcc5dd3b69d8cfa679c4bcd976ad82e5b","modified":1745057724118},{"_id":"source/typora-user-images/image-20250422114422258.png","hash":"6d9b7578a561388f37ad2647180a50dcaa735b07","modified":1745293462259},{"_id":"source/typora-user-images/image-20250422114322913.png","hash":"6a02df96a96bb0544d1d009868bdba0a8fe5850a","modified":1745293402925},{"_id":"source/typora-user-images/image-20250429175228086.png","hash":"698a2ecc2f30b5c94f52121a41290c671451afa9","modified":1745920348093},{"_id":"source/typora-user-images/image-20250429175421998.png","hash":"fe77c6a9999c12a0148bb1990ae045b2bcb63418","modified":1745920462000},{"_id":"source/typora-user-images/image-20250508162115569.png","hash":"a05a74331a80ea339f895adfcd63f451569a9f23","modified":1746692475571},{"_id":"source/typora-user-images/image-20250422114555482.png","hash":"e33332a744c886e568bfe33b306d6f57b0e54f49","modified":1745293555482},{"_id":"source/typora-user-images/image-20250429174851066.png","hash":"1e66607d3f47bb278267622dd24df86e4e26237e","modified":1745920131077},{"_id":"source/typora-user-images/image-20250429180401580.png","hash":"a9206b3cba0d01688e0feac3ccba76ce81b93408","modified":1745921041592},{"_id":"source/typora-user-images/image-20250429174959408.png","hash":"12c835276e5309ffd874ab41de15a9148b6d65ca","modified":1745920199410},{"_id":"source/_posts/.DS_Store","hash":"086a01cb4a2c491a1fbcb7e203362e349bf7199d","modified":1749034899057},{"_id":"source/typora-user-images/20220314-b46efe3c-5ede-471f-a116-ce05fcccd7c6.png","hash":"60bc69303831eaa5a06110f5a4147931940cc101","modified":1709257029801},{"_id":"source/typora-user-images/a7002eb5f5b8429c8b8728b9f2e3e10d.png","hash":"c5e244e5336cc471095a64bee8a67f28d8ba149b","modified":1708398181346},{"_id":"source/typora-user-images/afb25fa106bada4b37da64e902060269.png","hash":"6590c9d6fe25132a7ad233925fb74c12f99378a3","modified":1708398236439},{"_id":"source/typora-user-images/c5abda0a657e59634fb07442a84bf5e0.png","hash":"f2f87a7079f1a7fe567471813b2882046a826468","modified":1708400595152},{"_id":"source/typora-user-images/image-20230627191528034.png","hash":"9b76a4f7807f96de5504e9727ad5b5fe8d870038","modified":1687864528034},{"_id":"source/typora-user-images/image-20230628093611653.png","hash":"e65a781d388d67b94ec024f11df0ac23c62a9f77","modified":1687916171654},{"_id":"source/typora-user-images/image-20230628093823674.png","hash":"2a20d7c05ada9fd931f4785fb83a027484e204f9","modified":1687916303675},{"_id":"source/typora-user-images/image-20230628094428585.png","hash":"7036b3a680755d8e95691c50a36aebcfb48b6723","modified":1687916668586},{"_id":"source/typora-user-images/image-20230628094521252.png","hash":"7dc31c03583543027a1693d549b62fbdf365ce1d","modified":1687916721253},{"_id":"source/typora-user-images/image-20230923145029314.png","hash":"3672cc9eefa8fd90fb67b6e34e39a7a56a98b8ce","modified":1695451829315},{"_id":"source/typora-user-images/image-20231008103734081.png","hash":"34b1863b5414b5631199561e25b1b85f2a80562c","modified":1696732654082},{"_id":"source/typora-user-images/image-20231024092452701.png","hash":"1704780e7d642ee53865c4e76846273a9c8140b6","modified":1698110692701},{"_id":"source/typora-user-images/image-20231024092756314.png","hash":"281de629b5fe60b2e44c607939f9ea15ffb1fb98","modified":1698110876314},{"_id":"source/typora-user-images/image-20231024092913063.png","hash":"c85d5c02104a13abb53561f20b023068586d7462","modified":1698110953063},{"_id":"source/typora-user-images/image-20231024094558547.png","hash":"91523ddf4349efd4b748b7f2ae0a407a5c4827ce","modified":1698111958548},{"_id":"source/typora-user-images/image-20231024095726856.png","hash":"154f847ec928c50cd100095339c2e345a1136c2b","modified":1698112646856},{"_id":"source/typora-user-images/image-20231024095816182.png","hash":"17c9a3ec2fea9d3f9e6520e7b38babebd5fba5f3","modified":1698112696182},{"_id":"source/typora-user-images/image-20231024095843156.png","hash":"d1ae6931331a864aa6c62fdf995942035f501cf8","modified":1698112723156},{"_id":"source/typora-user-images/image-20231024104338016.png","hash":"6cc18536d413a7a3f6ca1f5c19d33750ba092dbb","modified":1698115418017},{"_id":"source/typora-user-images/image-20231201143940420.png","hash":"4247c1336893ff8b052a11eb2d4cd5f1e6a73b6b","modified":1701412780421},{"_id":"source/typora-user-images/image-20231201144020748.png","hash":"1392543f061f1ce9d1d52892d526e3f8e28fd679","modified":1701412820749},{"_id":"source/typora-user-images/image-20231201144119343.png","hash":"a820cf629adeb01acd835846a78b29a086c5c8da","modified":1701412879344},{"_id":"source/typora-user-images/image-20231201153117052.png","hash":"a26438f05ec3d15b64a29063cfe83a0aceedd880","modified":1701415877054},{"_id":"source/typora-user-images/image-20240219114233026.png","hash":"1be9d5bfa4b1ca6461ca8ab935f4bad98ad22dd9","modified":1708314153026},{"_id":"source/typora-user-images/image-20240219114515952.png","hash":"1d882390262cf4e71a4e3547b93f7ac0a6bc8745","modified":1708314315953},{"_id":"source/typora-user-images/image-20240219144606520.png","hash":"de6e7555a2365a23bc9a9450d02f0ebc632012a1","modified":1708325166521},{"_id":"source/typora-user-images/image-20240219150634816.png","hash":"85234fcc2d67718c5a68ef510aefe5f11bba6a81","modified":1708326394819},{"_id":"source/typora-user-images/image-20240219150821657.png","hash":"6adf92a4a7c88db5264fb9492ffe0df84dfb0114","modified":1708326501657},{"_id":"source/typora-user-images/image-20240219150910898.png","hash":"7a134a3ca9b7c3c2f719637364a51739cf553dd4","modified":1708326550898},{"_id":"source/typora-user-images/image-20240219151031448.png","hash":"a3f4c7cd2accae54259c9679c448f70442afe403","modified":1708326631448},{"_id":"source/typora-user-images/image-20240219151212695.png","hash":"574ef7b7b393248e20b88fcb4b26a71d627ad618","modified":1708326732696},{"_id":"source/typora-user-images/image-20240219152638390.png","hash":"e48fcf5cad156e92ec5f77874371df4df6fe03ec","modified":1708327598391},{"_id":"source/typora-user-images/image-20240219153810692.png","hash":"dcf90eff4ec211e449491b5f63ff0efb3ec03e42","modified":1708328290694},{"_id":"source/typora-user-images/image-20240219154032740.png","hash":"3ecd3821b36206bb69c3dd57e28c5c0687ba004e","modified":1708328432740},{"_id":"source/typora-user-images/image-20240220094227461.png","hash":"1448a7ab99d3ad8d704c3210d4c63faaa2b380f3","modified":1708393347462},{"_id":"source/typora-user-images/image-20240220095645324.png","hash":"631e4c210d3bcc234ab9af63699e9ec87d4313c7","modified":1708394205325},{"_id":"source/typora-user-images/image-20240220101429844.png","hash":"59758bd263655f5b58b534dbfc81be39a5a89b14","modified":1708395269845},{"_id":"source/typora-user-images/image-20240220102231198.png","hash":"13781da444bffea1fa86f57dce57761b6d9b41fd","modified":1708395751198},{"_id":"source/typora-user-images/image-20240220102332812.png","hash":"ed9db142789f1c8ca74018a4cd1745da10947a45","modified":1708395812813},{"_id":"source/typora-user-images/image-20240220102457440.png","hash":"00c0b12ce12e6ea0c49548d33b403687cfdc0189","modified":1708395897440},{"_id":"source/typora-user-images/image-20240220102752041.png","hash":"67bd31742cd7960739a0bab4da5675904aa84f99","modified":1708396072042},{"_id":"source/typora-user-images/image-20240220102621265.png","hash":"ec54793adff3e22aa977f7a838302497efc592a5","modified":1708395981265},{"_id":"source/typora-user-images/image-20240220103006353.png","hash":"4d3b13b8784cd20a6a0e3356f3c079450288bf93","modified":1708396206354},{"_id":"source/typora-user-images/image-20240220103217414.png","hash":"218f2e2ced5e54f34a1200c684bcbd712f8ca2d8","modified":1708396337414},{"_id":"source/typora-user-images/image-20240220144907721.png","hash":"d37668b1aad5f030616464724deb8f0db117a507","modified":1708411747722},{"_id":"source/typora-user-images/image-20240221092419244.png","hash":"fd61d9abaceb1d713a4c8fa976df8a6ea4635004","modified":1708478659245},{"_id":"source/typora-user-images/image-20240221093021265.png","hash":"132880d4de49a3f95fc8b3653b35492348edf2c0","modified":1708479021266},{"_id":"source/typora-user-images/image-20240221094225094.png","hash":"59b02ba2161ba7d6a9cc1d17a04b4ba1aa9b1255","modified":1708479745096},{"_id":"source/typora-user-images/image-20240221094244920.png","hash":"bd1cc1cf8e360a26b53d7d713d4d96dd5c646194","modified":1708479764921},{"_id":"source/typora-user-images/image-20240221155333042.png","hash":"c3f9d29db5350eaf1a35696a29772681237faf15","modified":1708502013046},{"_id":"source/typora-user-images/image-20240222152145318.png","hash":"ea0bfdcb4d5b983eddc66470b884e3184cac0dc7","modified":1708586505320},{"_id":"source/typora-user-images/image-20240222164404555.png","hash":"8cee0474bbe622aabb71ccc0e98bb19865c7e8a9","modified":1708591444557},{"_id":"source/typora-user-images/image-20240222164433038.png","hash":"5ec85e744795a997dd2bd6bae4d5cfecc5b87a7e","modified":1708591473038},{"_id":"source/typora-user-images/image-20240222164517003.png","hash":"dc07595b9a529bf01b82425000b486aa4199d6f5","modified":1708591517003},{"_id":"source/typora-user-images/image-20240222164533515.png","hash":"3918c9d39bab53b1274d95e023882faf9d933afe","modified":1708591533515},{"_id":"source/typora-user-images/image-20240415094839642.png","hash":"aadd5058a4a39b4066d1fc8cce856c21d9b6ae23","modified":1713145719643},{"_id":"source/typora-user-images/image-20240507111933014.png","hash":"e53c218c730e9aee66f7a8f65f85e229596d5f58","modified":1715051973015},{"_id":"source/typora-user-images/image-20240507112405845.png","hash":"e65a781d388d67b94ec024f11df0ac23c62a9f77","modified":1715052245847},{"_id":"source/typora-user-images/image-20240507112114709.png","hash":"e65a781d388d67b94ec024f11df0ac23c62a9f77","modified":1715052074710},{"_id":"source/typora-user-images/webp","hash":"f917f3e033ab2d6dbad539dde95f8caebdf07a02","modified":1708591877163},{"_id":"source/typora-user-images/1134316536b140eda97bef40993a2072.png","hash":"7b8ca16e7db13f3c62b1e2623598f8e6a98978c2","modified":1708657293338},{"_id":"source/typora-user-images/image-20230628094058045.png","hash":"2638081ba870b1a217a1cd2df33e6a370b012d24","modified":1687916458046},{"_id":"source/typora-user-images/image-20230921170222187.png","hash":"37856e5ff5e106ecfe0c2bddae56cb1ac3bd8513","modified":1695286942187},{"_id":"source/typora-user-images/image-20230923144124237.png","hash":"f68b880a2863b7529ade8e592c6bec5afdfe4a05","modified":1695451284239},{"_id":"source/typora-user-images/image-20230923144238782.png","hash":"6dd6156846efaa9f344a3aab4e02e552a8edec35","modified":1695451358783},{"_id":"source/typora-user-images/image-20230923144315232.png","hash":"804a761075a2d1f9cd89802a5863696dfaab950b","modified":1695451395232},{"_id":"source/typora-user-images/image-20230923144347556.png","hash":"107bbe2e4e44f49d21293eb4da1d57ba4db5df75","modified":1695451427556},{"_id":"source/typora-user-images/image-20230923144414595.png","hash":"2d05bc76b351bc883a7195a787f920c2c19ca85f","modified":1695451454595},{"_id":"source/typora-user-images/image-20230923144953818.png","hash":"c57fb2a037a97415f885c118f6fe0ca4b9a6964d","modified":1695451793820},{"_id":"source/typora-user-images/image-20230923144526897.png","hash":"65a4d29e2aa8f042d86b68d2640c6bbbcb27268b","modified":1695451526898},{"_id":"source/typora-user-images/image-20230923152344429.png","hash":"424baff60afbd3ee54a43081fc2a5e6b87855e56","modified":1695453824430},{"_id":"source/typora-user-images/image-20230923154459874.png","hash":"65c0f272b6964bd2e03e376e15938f148bd8b9f8","modified":1695455099874},{"_id":"source/typora-user-images/image-20231024101307177.png","hash":"6d2c18dab3d07a9b86acb5e73ebcfbbc5c5170b1","modified":1698113587177},{"_id":"source/typora-user-images/image-20231024102201145.png","hash":"42a805c7ee1585218f5cb4038a7b85ae56eeffc9","modified":1698114121145},{"_id":"source/typora-user-images/image-20240219114343151.png","hash":"dc3e3955b4b26107db0d98badbe43363803f3db4","modified":1708314223152},{"_id":"source/typora-user-images/image-20240220095107292.png","hash":"dc3e1488b33e1af2b21370a8c72a538801049f5a","modified":1708393867293},{"_id":"source/typora-user-images/image-20240220101010503.png","hash":"63b7c6935ee80b5eb36ffe375b04f8010a5d896c","modified":1708395010504},{"_id":"source/typora-user-images/image-20240220101701432.png","hash":"27638722b6c87cc3953b44dcf9df8432133ab43d","modified":1708395421433},{"_id":"source/typora-user-images/image-20240220102431979.png","hash":"e2b7ee4d99c89aed792b71b39a16bbb43f4ea4f5","modified":1708395871980},{"_id":"source/typora-user-images/image-20240221091728143.png","hash":"9922743caba2ccc606b79b076dcdbb108dcca8f8","modified":1708478248144},{"_id":"source/typora-user-images/image-20240221092028120.png","hash":"b38336f634e9b3fbf8dc3750e5098dbd2adfba60","modified":1708478428122},{"_id":"source/typora-user-images/image-20240221093819873.png","hash":"61aaece6568ebdb28ebfe1d4d7673c7db038d9b7","modified":1708479499873},{"_id":"source/typora-user-images/image-20240221094447664.png","hash":"3fad626e34213498460b69d420911eadc4798f03","modified":1708479887665},{"_id":"source/typora-user-images/image-20240221094852671.png","hash":"65d823ae285eb6e7d4501ba580be05737b242409","modified":1708480132672},{"_id":"source/typora-user-images/image-20240222175403127.png","hash":"759466b76af037d17aef71082b60fd4444d98e88","modified":1708595643127},{"_id":"source/typora-user-images/image-20240222181235735.png","hash":"446d65cd2cabfc3739546eb9e34bfde3bc74c9c0","modified":1708596755736},{"_id":"source/typora-user-images/image-20240510121326830.png","hash":"99d7ea26194892bb37cc2d600bee0c6c62681773","modified":1715314406831},{"_id":"source/typora-user-images/image-20240522090958255.png","hash":"de082694dac20df20c7e703b65b5fdf41d3ced15","modified":1716340198255},{"_id":"source/typora-user-images/u=641752398,1880469199&fm=253&fmt=auto&app=138&f=PNG.png","hash":"5f3cf68545f65e6efa160e5a7a8b20b8b12f31b9","modified":1708591997910},{"_id":"source/typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70.png","hash":"2ed39a0c534189dabb51f290d50af84c5a1e0bd4","modified":1708397424132},{"_id":"source/typora-user-images/20220315-917e43b8-7523-4f2f-804c-49855963dbb5.png","hash":"a5f7c41c0f29418b336a08d9aab3a0ae3b1e1938","modified":1709257198169},{"_id":"source/typora-user-images/2afdf3d7222117202a1069d7e1587c12.png#align=left&display=inline&height=655&name=image.png","hash":"d2ef63ee6c52898e5271ae7c016ea21db4e3f410","modified":1708397853737},{"_id":"source/typora-user-images/72746e97a2cd474bb21601f507779a25.png","hash":"8c2982ef63c0fb718af012618fd2c1086ec86006","modified":1715075069072},{"_id":"source/typora-user-images/image-20230923145922760.png","hash":"11d4561b7e8111a8185c1704d85b1fde21e0386f","modified":1695452362760},{"_id":"source/typora-user-images/image-20230923151411555.png","hash":"dc0765cd34e084e0e7cc11c061fd2ec32cf00077","modified":1695453251556},{"_id":"source/typora-user-images/image-20230923162555344.png","hash":"04db850e51d79aacb52a8fc0bf54a3c812ddf2fa","modified":1695457555344},{"_id":"source/typora-user-images/image-20240219152607457.png","hash":"4bf67bf0a76285cd265b4d31ad23b3496ce0b1ba","modified":1708327567459},{"_id":"source/typora-user-images/image-20240221091441127.png","hash":"779e8c8a4e9d6a99f3f5b46ddd3042ba9b460f63","modified":1708478081128},{"_id":"source/typora-user-images/image-20240221092353574.png","hash":"78d606391142724c4b2712cf14f9ffb835c0dbfd","modified":1708478633575},{"_id":"source/typora-user-images/image-20240222180325402.png","hash":"d78f6b372e50726b2494420829013994150acd7c","modified":1708596205402},{"_id":"source/typora-user-images/image-20240514095424805.png","hash":"0fa4fd657fc9095c29a2c785ae0eac834eacd8d8","modified":1715651664806},{"_id":"source/typora-user-images/fe3e2f4ebbbc4a28b707459e2e9fa511.png","hash":"de0940531ee2b6f2dbe186229aa8c46557ffb9b0","modified":1709255988564},{"_id":"source/typora-user-images/image-20230921165730484.png","hash":"8005d88378965d391adfeb682849a8eb7bc0fb36","modified":1695286650485},{"_id":"source/typora-user-images/image-20230921171005578.png","hash":"475e87595ea06dfe13ef06aeb6f88ee1c17723e1","modified":1695287405578},{"_id":"source/typora-user-images/image-20230923162506692.png","hash":"66f03aba21d26d5d9657d526548731cc0c471162","modified":1695457506693},{"_id":"source/typora-user-images/image-20240221091837069.png","hash":"028d6df4053a834c1b8e2b57fccbb9d0a6cd4cc7","modified":1708478317070},{"_id":"source/typora-user-images/image-20240222175326047.png","hash":"1ee1c1c6ef47ad9dc08a842dcb351cec04516f2d","modified":1708595606050},{"_id":"source/typora-user-images/image-20240222180337721.png","hash":"d78f6b372e50726b2494420829013994150acd7c","modified":1708596217721},{"_id":"source/typora-user-images/image-20240318202804603.png","hash":"0cd6675c6685aadccde6ef503a660d4195e5e127","modified":1710764884603},{"_id":"source/typora-user-images/image-20240510121631586.png","hash":"cab1a82b5ee99a68a80e57388cf5ce794f103f22","modified":1715314591586},{"_id":"source/typora-user-images/image-20240520161819461.png","hash":"854829d75e3ef499d7a3dd8ca2071b14107e9009","modified":1716193099463},{"_id":"source/typora-user-images/image-20240521094502177.png","hash":"da4af49b8625772c350829061e5cf7b938cd2884","modified":1716255902180},{"_id":"source/typora-user-images/image-20240522090312508.png","hash":"3139ccea0ce9f8ff4089b7a920e87c0763c81f68","modified":1716339792519},{"_id":"source/typora-user-images/image-20240522090352573.png","hash":"798df439306b8a08434548db9708abdf04de70e8","modified":1716339832574},{"_id":"source/typora-user-images/u=3986274733,3849268543&fm=253&fmt=auto&app=138&f=PNG.png","hash":"ae473891e1ba05f2a0b04d2869a033a8c9e5993d","modified":1709256578297},{"_id":"source/typora-user-images/image-20230923144634136.png","hash":"d567d6a6f01e575f315824c3417e510e16b6eb05","modified":1695451594137},{"_id":"source/typora-user-images/image-20230923145717673.png","hash":"e8bc3c7beab2f62218290f38a636714d4af5e3f5","modified":1695452237673},{"_id":"source/typora-user-images/image-20230923150103329.png","hash":"465b742fedcf9e9dd5df14a08c771fc8c4fb5900","modified":1695452463330},{"_id":"source/typora-user-images/image-20230923154644281.png","hash":"63e926e126ebe21693302a25cadaeebb19a3c3dc","modified":1695455204282},{"_id":"source/typora-user-images/image-20240222180227522.png","hash":"cb2f2b1268d7a5bdec1b62d4c519f746427116ee","modified":1708596147522},{"_id":"source/typora-user-images/image-20240222180306582.png","hash":"97a69d286a268a115e21cac5d1cbcb3e0f53b1f7","modified":1708596186582},{"_id":"source/typora-user-images/image-20240223110630296.png","hash":"bfc87b3d6fa611ce06ab14bd35b9ccca47d70048","modified":1708657590296},{"_id":"source/typora-user-images/image-20240509105539663.png","hash":"1db876cda46958efbf6c4d19a5b8f8aa7a4dd97c","modified":1715223339664},{"_id":"source/typora-user-images/image-20240514095835213.png","hash":"63057deacd2e3305690510e373dfb70ea9840c45","modified":1715651915214},{"_id":"source/typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70-6340401.png","hash":"b5d3395e2ce2b2834898b81d5d0c77eba2680494","modified":1716340401877},{"_id":"source/typora-user-images/image-20240221093711599.png","hash":"9949b95d1c4786a60a3cabf92b9d75ec1307042f","modified":1708479431602},{"_id":"source/typora-user-images/image-20240514095650303.png","hash":"1e3bbddc41c515dd5c19429d68264bbaf08e3371","modified":1715651810303},{"_id":"source/typora-user-images/32fe9b12c9192392c3a50b5f04759eec.png","hash":"361d07b792b4efb822a20044471ed1c9c5e0fc39","modified":1708592052132},{"_id":"source/typora-user-images/image-20230921170734063.png","hash":"e3db4d79b4eb89d8a7e6ca0703e7e6c55604a9c0","modified":1695287254063},{"_id":"source/typora-user-images/image-20240219113719157.png","hash":"57072961b1982c890772c45a63a8af2e91a206c3","modified":1708313839158},{"_id":"source/typora-user-images/image-20240416114808884.png","hash":"b85644b2c128279c75d62b3c98075df968add195","modified":1713239288885},{"_id":"source/typora-user-images/image-20240516094845785.png","hash":"3d3999ff1248f9e98f822f133fdc07d7f111f26f","modified":1715824125786},{"_id":"source/typora-user-images/image-20240524175527451.png","hash":"980dfd1cef619a0e13811c6acc129cef9a7a8cc4","modified":1716544527451},{"_id":"source/typora-user-images/779689.png","hash":"7b5c3c50868191d92a2e8735e5b5faf7c4cabf20","modified":1708658957355},{"_id":"source/typora-user-images/image-20240221092834785.png","hash":"69ff079a54850f2141298e697bd4ea539e26af53","modified":1708478914788},{"_id":"source/typora-user-images/image-20240221095745495.png","hash":"5cc59fb94af18c29a44aaaae205f4cb7f5c8312a","modified":1708480665499},{"_id":"source/typora-user-images/image-20240415090937231.png","hash":"5f5d421b8b2a6e61ece77cb038e75449096f2e1a","modified":1713143377242},{"_id":"source/typora-user-images/image-20240416120116317.png","hash":"b85e3326515586bcc2a49a86eed1223639032eb2","modified":1713240076321},{"_id":"source/typora-user-images/image-20240524175254196.png","hash":"2b3e657322d36faa28bf1a10fd72c021a16732ee","modified":1716544374196},{"_id":"source/typora-user-images/image-20240223110332038.png","hash":"f6602e6e7b303d2116561200abfbeebbafb737ec","modified":1708657412038},{"_id":"source/typora-user-images/image-20240509105505568.png","hash":"f3d974c6c56fa3228cb715a853a25766e5b13f44","modified":1715223305572},{"_id":"source/typora-user-images/image-20240221094018816.png","hash":"ad37fce1f1a49fc8661c15c0dbcb38e0aa550bb8","modified":1708479618817},{"_id":"source/typora-user-images/image-20240412121048381.png","hash":"e514a0de2cf0d42557d81e97bf51e65cdfa56067","modified":1712895048382},{"_id":"source/typora-user-images/image-20240416113821316.png","hash":"2b971242ebf91ad5c1f3fb81ba7be8c8bafcb497","modified":1713238701320},{"_id":"source/typora-user-images/image-20240417091316659.png","hash":"c05a5eee17c67ffac9e8e46396a42768b702f1e0","modified":1713316396661},{"_id":"source/typora-user-images/image-20240417092003988.png","hash":"aec1f1669ef01a5965d955dc982877b7a14acf1f","modified":1713316803990},{"_id":"source/typora-user-images/image-20240417092118543.png","hash":"350e8c068bfc9e7009e2d5d023c860cf29b0739e","modified":1713316878545},{"_id":"source/typora-user-images/image-20240522091143334.png","hash":"1f855cb2c4f4b55621718607774f1a84470094f2","modified":1716340303335},{"_id":"source/typora-user-images/image-20230921171251668.png","hash":"c2918e0518513a92d9186de9312aa7fb5ccc0225","modified":1695287571669},{"_id":"source/typora-user-images/image-20240510121854650.png","hash":"7fc521f21df0b3261fdb8520eeb89f809614bfdd","modified":1715314734651},{"_id":"source/typora-user-images/image-20240415091018922.png","hash":"9d03c61ddacaf863607e74d8fd4cef929367fd9a","modified":1713143418922},{"_id":"source/typora-user-images/image-20230923145122020.png","hash":"49917b80ba7d58da9c0a93bb12d31caf292812d9","modified":1695451882021},{"_id":"source/typora-user-images/image-20240524174544128.png","hash":"59654553ec675ebf49fdb7bbbdd03501a57afff5","modified":1716543944129},{"_id":"source/typora-user-images/image-20240416114924463.png","hash":"e9d239af67f13fae73f92d2c36e7470b36eea866","modified":1713239364463},{"_id":"source/typora-user-images/image-20240416114024941.png","hash":"78cd820b26821a4b72b0eefabb88439df7114340","modified":1713238824943},{"_id":"source/typora-user-images/20220315-2c2a053e-ddb6-4656-bc61-9a94d8b14598.png","hash":"8f6ce07ff86f5258b92f78c5af534b409edc5f8d","modified":1709256686636},{"_id":"source/typora-user-images/image-20240507112941777.png","hash":"b66d1a949da64143e32e83de63df6403051fa111","modified":1715052581779}],"Category":[],"Data":[],"Page":[{"title":"about","date":"2025-06-04T09:41:07.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2025-06-04 17:41:07\n---\n","updated":"2025-06-04T09:41:07.185Z","path":"about/index.html","comments":1,"layout":"page","_id":"cmbhrd5ec0000y2ky26zdfx4j","content":"","excerpt":"","more":""},{"title":"comments","date":"2025-06-04T09:40:59.000Z","_content":"","source":"comments/index.md","raw":"---\ntitle: comments\ndate: 2025-06-04 17:40:59\n---\n","updated":"2025-06-04T09:40:59.963Z","path":"comments/index.html","comments":1,"layout":"page","_id":"cmbhrd5er0003y2ky8q73ez2h","content":"","excerpt":"","more":""},{"title":"link","date":"2025-06-04T09:41:03.000Z","_content":"","source":"link/index.md","raw":"---\ntitle: link\ndate: 2025-06-04 17:41:03\n---\n","updated":"2025-06-04T09:41:03.718Z","path":"link/index.html","comments":1,"layout":"page","_id":"cmbhrd5et0004y2ky1ru54cv8","content":"","excerpt":"","more":""},{"title":"movies","date":"2025-06-04T09:40:56.000Z","_content":"","source":"movies/index.md","raw":"---\ntitle: movies\ndate: 2025-06-04 17:40:56\n---\n","updated":"2025-06-04T09:40:56.487Z","path":"movies/index.html","comments":1,"layout":"page","_id":"cmbhrd5eu0005y2ky26b53sdm","content":"","excerpt":"","more":""},{"title":"music","date":"2025-06-04T09:40:48.000Z","_content":"","source":"music/index.md","raw":"---\ntitle: music\ndate: 2025-06-04 17:40:48\n---\n","updated":"2025-06-04T09:40:48.081Z","path":"music/index.html","comments":1,"layout":"page","_id":"cmbhrd5ev0006y2ky8s9b93kb","content":"","excerpt":"","more":""},{"title":"picture","date":"2025-06-04T09:40:52.000Z","_content":"","source":"picture/index.md","raw":"---\ntitle: picture\ndate: 2025-06-04 17:40:52\n---\n","updated":"2025-06-04T09:40:52.571Z","path":"picture/index.html","comments":1,"layout":"page","_id":"cmbhrd5ew0007y2kygtkm4721","content":"","excerpt":"","more":""},{"title":"tags","date":"2025-06-04T09:40:35.000Z","_content":"","source":"tags/index-1.md","raw":"---\ntitle: tags\ndate: 2025-06-04 17:40:35\n---\n","updated":"2025-06-04T09:40:35.728Z","path":"tags/index-1.html","comments":1,"layout":"page","_id":"cmbhrd5ey0008y2ky25jaec7q","content":"","excerpt":"","more":""},{"title":"tags","date":"2025-06-04T09:27:08.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2025-06-04 17:27:08\n---\n","updated":"2025-06-04T09:27:08.364Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cmbhrd5f10009y2kydwr7ctxx","content":"","excerpt":"","more":""}],"Post":[{"title":"Hello World","date":"2025-03-17T10:43:18.000Z","_content":"LIson [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n_## Quick Start_\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n\n![](image/shouye.jpg)\n\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\ndate: 2025-03-17 18:43:18\n---\nLIson [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n_## Quick Start_\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n\n![](image/shouye.jpg)\n\n","slug":"hello-world","published":1,"updated":"2025-06-04T10:50:04.525Z","_id":"cmbhrd5ei0001y2kyb7sccfmh","comments":1,"layout":"post","photos":[],"content":"<p>LIson <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<p><em>## Quick Start</em></p>\n<h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n<p><img src=\"/image/shouye.jpg\" alt=\"\"></p>\n","excerpt":"","more":"<p>LIson <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<p><em>## Quick Start</em></p>\n<h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n<p><img src=\"/image/shouye.jpg\" alt=\"\"></p>\n"},{"title":"Spring AI Agent ","date":"2025-04-17T10:43:18.000Z","_content":"AIAI  Agent Spring AI  Agent\n\n\n# Spring AI Agent \n\n\n\n\nAIAI  Agent Spring AI  Agent\n\nSpring AI \nSpring AI \nSpring AI  Spring Spring AI  Java  AI  AI Spring AI \n\n\nSpring AI Spring AI \n\n Spring  Spring \n\nAgent \nAgent \nAgent  Spring AI Agent \n\n\nAgent  Agent \n\n\n\n AI \n AI Agent Agent  Spring AI Agent  AI  AI \n\nSpring AI  Agent\n\n Spring AI Agent  Agent \n\n\nAgent  AI Agent \n\n\n Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent \n\nSpring AI Agent \n1.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n2.  Agent\nAgent \n\nAgent \nAgent \nAgent \n3.  Agent\nAgent \n\nAgent \nAgent \nAgent \n4.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n5.  Agent\nAgent \n\nAgent \nAgent \nAgent \n6.  Agent\nAgent \n\nAgent Agent \nAgent \nAgent \n7.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n8.  Agent\nAgent \n\nAgent \nAgent Agent \nAgent \nSpring AI Agent \nSpring AI  Agent Agent \n\nAgent \nAgent \nAgent \n Agent Agent \n\nSpring AI  Agent  Spring AI  Agent  Spring AI  Agent\n\n Spring AI  Agent  Agent  Agent  Agent \n\n\n\n# RAG  \n\nRAG\n1.1 RAG\nRAGRetrieval-Augmented GenerationRAG (LLM)\n\n1.2 RAG\nRAG2020RAGRAG\n\n1.3 RAG\nRAGRAG\n\nRAG\n2.1 \n2.1.1 \nRAGRAG\n\n2.1.2 \nRAGRAGRAG\n\n2.2 \n2.2.1 \nRAGRAG\n\n2.2.2 \nRAGRAG\n\n2.3 \n2.3.1 \nRAG\n\n2.3.2 \nRAGRAG\n\nRAG\n4.1 RAG\n4.1.1 \nRAGRAG\n\n4.1.2 \nRAGRAG\n\n4.1.3 \nRAGRAG\n\n4.2 RAG\n4.2.1 \nRAG\n\nRAG\n\n4.2.2 \nRAG\n\nRAG\n\n\nRAGRAG\n","source":"_posts/Spring AI Alibaba/Spring AI Agent.md","raw":"---\ntitle: Spring AI Agent \ndate: 2025-04-17 18:43:18\n---\nAIAI  Agent Spring AI  Agent\n\n\n# Spring AI Agent \n\n\n\n\nAIAI  Agent Spring AI  Agent\n\nSpring AI \nSpring AI \nSpring AI  Spring Spring AI  Java  AI  AI Spring AI \n\n\nSpring AI Spring AI \n\n Spring  Spring \n\nAgent \nAgent \nAgent  Spring AI Agent \n\n\nAgent  Agent \n\n\n\n AI \n AI Agent Agent  Spring AI Agent  AI  AI \n\nSpring AI  Agent\n\n Spring AI Agent  Agent \n\n\nAgent  AI Agent \n\n\n Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent \n\nSpring AI Agent \n1.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n2.  Agent\nAgent \n\nAgent \nAgent \nAgent \n3.  Agent\nAgent \n\nAgent \nAgent \nAgent \n4.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n5.  Agent\nAgent \n\nAgent \nAgent \nAgent \n6.  Agent\nAgent \n\nAgent Agent \nAgent \nAgent \n7.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n8.  Agent\nAgent \n\nAgent \nAgent Agent \nAgent \nSpring AI Agent \nSpring AI  Agent Agent \n\nAgent \nAgent \nAgent \n Agent Agent \n\nSpring AI  Agent  Spring AI  Agent  Spring AI  Agent\n\n Spring AI  Agent  Agent  Agent  Agent \n\n\n\n# RAG  \n\nRAG\n1.1 RAG\nRAGRetrieval-Augmented GenerationRAG (LLM)\n\n1.2 RAG\nRAG2020RAGRAG\n\n1.3 RAG\nRAGRAG\n\nRAG\n2.1 \n2.1.1 \nRAGRAG\n\n2.1.2 \nRAGRAGRAG\n\n2.2 \n2.2.1 \nRAGRAG\n\n2.2.2 \nRAGRAG\n\n2.3 \n2.3.1 \nRAG\n\n2.3.2 \nRAGRAG\n\nRAG\n4.1 RAG\n4.1.1 \nRAGRAG\n\n4.1.2 \nRAGRAG\n\n4.1.3 \nRAGRAG\n\n4.2 RAG\n4.2.1 \nRAG\n\nRAG\n\n4.2.2 \nRAG\n\nRAG\n\n\nRAGRAG\n","slug":"Spring AI Alibaba/Spring AI Agent","published":1,"updated":"2025-06-04T10:44:03.478Z","_id":"cmbhtdwy0000ao6fyadum0229","comments":1,"layout":"post","photos":[],"content":"<p>AIAI  Agent Spring AI  Agent</p>\n<h1 id=\"Spring-AI-Agent-\"><a href=\"#Spring-AI-Agent-\" class=\"headerlink\" title=\"Spring AI Agent \"></a>Spring AI Agent </h1><p><br>AIAI  Agent Spring AI  Agent</p>\n<p>Spring AI <br>Spring AI <br>Spring AI  Spring Spring AI  Java  AI  AI Spring AI </p>\n<p><br>Spring AI Spring AI </p>\n<p> Spring  Spring </p>\n<p>Agent <br>Agent <br>Agent  Spring AI Agent </p>\n<p><br>Agent  Agent </p>\n<p></p>\n<p> AI <br> AI Agent Agent  Spring AI Agent  AI  AI </p>\n<p>Spring AI  Agent<br><br> Spring AI Agent  Agent </p>\n<p><br>Agent  AI Agent </p>\n<p><br> Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent </p>\n<p>Spring AI Agent </p>\n<ol>\n<li> Agent<br>Agent </li>\n</ol>\n<p>Agent <br>Agent <br>Agent Agent <br>2.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>3.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>4.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>5.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>6.  Agent<br>Agent </p>\n<p>Agent Agent <br>Agent <br>Agent <br>7.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>8.  Agent<br>Agent </p>\n<p>Agent <br>Agent Agent <br>Agent <br>Spring AI Agent <br>Spring AI  Agent Agent </p>\n<p>Agent <br>Agent <br>Agent <br> Agent Agent <br><br>Spring AI  Agent  Spring AI  Agent  Spring AI  Agent</p>\n<p> Spring AI  Agent  Agent  Agent  Agent </p>\n<h1 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h1><p>RAG<br>1.1 RAG<br>RAGRetrieval-Augmented GenerationRAG (LLM)</p>\n<p>1.2 RAG<br>RAG2020RAGRAG</p>\n<p>1.3 RAG<br>RAGRAG</p>\n<p>RAG<br>2.1 <br>2.1.1 <br>RAGRAG</p>\n<p>2.1.2 <br>RAGRAGRAG</p>\n<p>2.2 <br>2.2.1 <br>RAGRAG</p>\n<p>2.2.2 <br>RAGRAG</p>\n<p>2.3 <br>2.3.1 <br>RAG</p>\n<p>2.3.2 <br>RAGRAG</p>\n<p>RAG<br>4.1 RAG<br>4.1.1 <br>RAGRAG</p>\n<p>4.1.2 <br>RAGRAG</p>\n<p>4.1.3 <br>RAGRAG</p>\n<p>4.2 RAG<br>4.2.1 <br>RAG</p>\n<p>RAG</p>\n<p>4.2.2 <br>RAG</p>\n<p>RAG</p>\n<p><br>RAGRAG</p>\n","excerpt":"","more":"<p>AIAI  Agent Spring AI  Agent</p>\n<h1 id=\"Spring-AI-Agent-\"><a href=\"#Spring-AI-Agent-\" class=\"headerlink\" title=\"Spring AI Agent \"></a>Spring AI Agent </h1><p><br>AIAI  Agent Spring AI  Agent</p>\n<p>Spring AI <br>Spring AI <br>Spring AI  Spring Spring AI  Java  AI  AI Spring AI </p>\n<p><br>Spring AI Spring AI </p>\n<p> Spring  Spring </p>\n<p>Agent <br>Agent <br>Agent  Spring AI Agent </p>\n<p><br>Agent  Agent </p>\n<p></p>\n<p> AI <br> AI Agent Agent  Spring AI Agent  AI  AI </p>\n<p>Spring AI  Agent<br><br> Spring AI Agent  Agent </p>\n<p><br>Agent  AI Agent </p>\n<p><br> Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent </p>\n<p>Spring AI Agent </p>\n<ol>\n<li> Agent<br>Agent </li>\n</ol>\n<p>Agent <br>Agent <br>Agent Agent <br>2.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>3.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>4.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>5.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>6.  Agent<br>Agent </p>\n<p>Agent Agent <br>Agent <br>Agent <br>7.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>8.  Agent<br>Agent </p>\n<p>Agent <br>Agent Agent <br>Agent <br>Spring AI Agent <br>Spring AI  Agent Agent </p>\n<p>Agent <br>Agent <br>Agent <br> Agent Agent <br><br>Spring AI  Agent  Spring AI  Agent  Spring AI  Agent</p>\n<p> Spring AI  Agent  Agent  Agent  Agent </p>\n<h1 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h1><p>RAG<br>1.1 RAG<br>RAGRetrieval-Augmented GenerationRAG (LLM)</p>\n<p>1.2 RAG<br>RAG2020RAGRAG</p>\n<p>1.3 RAG<br>RAGRAG</p>\n<p>RAG<br>2.1 <br>2.1.1 <br>RAGRAG</p>\n<p>2.1.2 <br>RAGRAGRAG</p>\n<p>2.2 <br>2.2.1 <br>RAGRAG</p>\n<p>2.2.2 <br>RAGRAG</p>\n<p>2.3 <br>2.3.1 <br>RAG</p>\n<p>2.3.2 <br>RAGRAG</p>\n<p>RAG<br>4.1 RAG<br>4.1.1 <br>RAGRAG</p>\n<p>4.1.2 <br>RAGRAG</p>\n<p>4.1.3 <br>RAGRAG</p>\n<p>4.2 RAG<br>4.2.1 <br>RAG</p>\n<p>RAG</p>\n<p>4.2.2 <br>RAG</p>\n<p>RAG</p>\n<p><br>RAGRAG</p>\n"},{"title":"Spring AI Alibaba-00-Spring Ai Alibaba","_content":"# Spring AI Alibaba-00-Spring Ai Alibaba\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.12`\n\n\n\n[toc]\n\n\n\n## \n\n[Spring AI](https://docs.spring.io/spring-ai/reference/index.html)  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models\n\n\n\n\n\n##  Spring AI Alibaba\n\n\n\nSpring AI Alibaba  Spring AI  Java AI  AI API  AI \n\n![img](../../typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png)\n\nSpring AI Alibaba  AI  API API \n\n-  AI  Fluent API  ChatClient\n- \n- \n-  API API \n-  Structured Output AI  POJOs\n- \n-  Function Calling\n-  AI Agent \n-  RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve \n\n AI     \n\n\n\n## \n\n### Model\n\nAI \n\nAI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion\n\n\n\n![spring-ai-concepts-model-types](../../typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg)\n\nSpring AI Embedding Text AI Spring AI  Embedding \n\nGPT  GPT PChat Generative Pre-trained Transformer AI \n\n\n\n### Prompt\n\nPrompt  AI  ChatGPT Prompt  API AI Prompt \n\nChatGPT  API \n\n Prompt ChatGPT  SQL AI \n\nPrompt  Prompt  Prompt \n\n Prompt  Prompt  ChatGPT 3.5\n\n### Prompt Template\n\n Prompt  Prompt Spring AI  StringTemplate \n\n Prompt \n\n>Tell me a {adjective} joke about {content}.\n\n Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt \n\n Prompt Prompt \n\n\n\n### Embedding\n\nEmbeddingEmbedding VectorEmbedding \n\n\n\n![spring-ai-embeddings](../../typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg)\n\n Java \n\nEmbedding RAG\n\n\n\n### Token\n\ntoken  AI  token token \n\n token  75% 90  120  token\n\n![spring-ai-concepts-tokens](../../typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png)\n\n\n\n token =  AI  token  token \n\n token  API \n\nChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token \n\n GPT4 Spring AI \n\n### Structured Output\n\n JSON AI  `java.lang.String`  JSON JSON  Prompt   JSON  100% \n\n Prompt \n\n![](../../typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg)\n\n\n\n[]\n\n\n\n###  API  AI \n\n\n\nGPT 3.5/4.0  2021  9  650GB\n\n AI \n\n- `Fine Tuning`  GPT \n- `Prompt Stuffing` Spring AI  [ (RAG)]()\n\n![prompt-stuffing](../../typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg)\n\n- Function Calling APISpring AI  [] \n\n\n\n\n\n### RAG\n\n (RAG)  AI \n\n ETL RAG \n\n\n\n1. \n2.  AI  token \n\nRAG  AI  AI \n\n![Spring AI RAG](../../typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg)\n\n\n\n\n\n- [ETL ](https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html)  AI \n- [ChatClient - RAG] `QuestionAnswerAdvisor` Advisor  RAG \n\n### Function Calling\n\n (LLM) \n\n[Function Calling](https://docs.spring.io/spring-ai/reference/api/functions.html) API LLM \n\nSpring AI `@Bean` bean \n\n![Spring AI Function Calling](../../typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg)\n\n- 1`name``description``input parameters`\n- 2\n- 3Spring AI \n- 4\n- 5\n\n[](https://docs.spring.io/spring-ai/reference/api/functions.html) AI \n\n### Evaluation\n\n\n\nEvaluation  AI \n\n\n\nVector Database","source":"_posts/Spring AI Alibaba/Spring AI Alibaba-00-Spring Ai Alibaba.md","raw":"---\ntitle: Spring AI Alibaba-00-Spring Ai Alibaba\n---\n# Spring AI Alibaba-00-Spring Ai Alibaba\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.12`\n\n\n\n[toc]\n\n\n\n## \n\n[Spring AI](https://docs.spring.io/spring-ai/reference/index.html)  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models\n\n\n\n\n\n##  Spring AI Alibaba\n\n\n\nSpring AI Alibaba  Spring AI  Java AI  AI API  AI \n\n![img](../../typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png)\n\nSpring AI Alibaba  AI  API API \n\n-  AI  Fluent API  ChatClient\n- \n- \n-  API API \n-  Structured Output AI  POJOs\n- \n-  Function Calling\n-  AI Agent \n-  RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve \n\n AI     \n\n\n\n## \n\n### Model\n\nAI \n\nAI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion\n\n\n\n![spring-ai-concepts-model-types](../../typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg)\n\nSpring AI Embedding Text AI Spring AI  Embedding \n\nGPT  GPT PChat Generative Pre-trained Transformer AI \n\n\n\n### Prompt\n\nPrompt  AI  ChatGPT Prompt  API AI Prompt \n\nChatGPT  API \n\n Prompt ChatGPT  SQL AI \n\nPrompt  Prompt  Prompt \n\n Prompt  Prompt  ChatGPT 3.5\n\n### Prompt Template\n\n Prompt  Prompt Spring AI  StringTemplate \n\n Prompt \n\n>Tell me a {adjective} joke about {content}.\n\n Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt \n\n Prompt Prompt \n\n\n\n### Embedding\n\nEmbeddingEmbedding VectorEmbedding \n\n\n\n![spring-ai-embeddings](../../typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg)\n\n Java \n\nEmbedding RAG\n\n\n\n### Token\n\ntoken  AI  token token \n\n token  75% 90  120  token\n\n![spring-ai-concepts-tokens](../../typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png)\n\n\n\n token =  AI  token  token \n\n token  API \n\nChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token \n\n GPT4 Spring AI \n\n### Structured Output\n\n JSON AI  `java.lang.String`  JSON JSON  Prompt   JSON  100% \n\n Prompt \n\n![](../../typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg)\n\n\n\n[]\n\n\n\n###  API  AI \n\n\n\nGPT 3.5/4.0  2021  9  650GB\n\n AI \n\n- `Fine Tuning`  GPT \n- `Prompt Stuffing` Spring AI  [ (RAG)]()\n\n![prompt-stuffing](../../typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg)\n\n- Function Calling APISpring AI  [] \n\n\n\n\n\n### RAG\n\n (RAG)  AI \n\n ETL RAG \n\n\n\n1. \n2.  AI  token \n\nRAG  AI  AI \n\n![Spring AI RAG](../../typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg)\n\n\n\n\n\n- [ETL ](https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html)  AI \n- [ChatClient - RAG] `QuestionAnswerAdvisor` Advisor  RAG \n\n### Function Calling\n\n (LLM) \n\n[Function Calling](https://docs.spring.io/spring-ai/reference/api/functions.html) API LLM \n\nSpring AI `@Bean` bean \n\n![Spring AI Function Calling](../../typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg)\n\n- 1`name``description``input parameters`\n- 2\n- 3Spring AI \n- 4\n- 5\n\n[](https://docs.spring.io/spring-ai/reference/api/functions.html) AI \n\n### Evaluation\n\n\n\nEvaluation  AI \n\n\n\nVector Database","slug":"Spring AI Alibaba/Spring AI Alibaba-00-Spring Ai Alibaba","published":1,"date":"2025-04-19T09:00:52.554Z","updated":"2025-06-04T10:49:56.785Z","_id":"cmbhtdwzu000bo6fyey077nfs","comments":1,"layout":"post","photos":[],"content":"<h1 id=\"Spring-AI-Alibaba-00-Spring-Ai-Alibaba\"><a href=\"#Spring-AI-Alibaba-00-Spring-Ai-Alibaba\" class=\"headerlink\" title=\"Spring AI Alibaba-00-Spring Ai Alibaba\"></a>Spring AI Alibaba-00-Spring Ai Alibaba</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.12</code></p>\n<p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://docs.spring.io/spring-ai/reference/index.html\">Spring AI</a>  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models</p>\n<h2 id=\"-Spring-AI-Alibaba\"><a href=\"#-Spring-AI-Alibaba\" class=\"headerlink\" title=\" Spring AI Alibaba\"></a> Spring AI Alibaba</h2><p>Spring AI Alibaba  Spring AI  Java AI  AI API  AI </p>\n<p><img src=\"/../../typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png\" alt=\"img\"></p>\n<p>Spring AI Alibaba  AI  API API </p>\n<ul>\n<li> AI  Fluent API  ChatClient</li>\n<li></li>\n<li></li>\n<li> API API </li>\n<li> Structured Output AI  POJOs</li>\n<li></li>\n<li> Function Calling</li>\n<li> AI Agent </li>\n<li> RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve </li>\n</ul>\n<p> AI     </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h3><p>AI </p>\n<p>AI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion</p>\n<p><img src=\"/../../typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg\" alt=\"spring-ai-concepts-model-types\"></p>\n<p>Spring AI Embedding Text AI Spring AI  Embedding </p>\n<p>GPT  GPT PChat Generative Pre-trained Transformer AI </p>\n<h3 id=\"Prompt\"><a href=\"#Prompt\" class=\"headerlink\" title=\"Prompt\"></a>Prompt</h3><p>Prompt  AI  ChatGPT Prompt  API AI Prompt </p>\n<p>ChatGPT  API </p>\n<p> Prompt ChatGPT  SQL AI </p>\n<p>Prompt  Prompt  Prompt </p>\n<p> Prompt  Prompt  ChatGPT 3.5</p>\n<h3 id=\"Prompt-Template\"><a href=\"#Prompt-Template\" class=\"headerlink\" title=\"Prompt Template\"></a>Prompt Template</h3><p> Prompt  Prompt Spring AI  StringTemplate </p>\n<p> Prompt </p>\n<blockquote>\n<p>Tell me a {adjective} joke about {content}.</p>\n</blockquote>\n<p> Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt </p>\n<p> Prompt Prompt </p>\n<h3 id=\"Embedding\"><a href=\"#Embedding\" class=\"headerlink\" title=\"Embedding\"></a>Embedding</h3><p>EmbeddingEmbedding VectorEmbedding </p>\n<p></p>\n<p><img src=\"/../../typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg\" alt=\"spring-ai-embeddings\"></p>\n<p> Java </p>\n<p>Embedding RAG</p>\n<p></p>\n<h3 id=\"Token\"><a href=\"#Token\" class=\"headerlink\" title=\"Token\"></a>Token</h3><p>token  AI  token token </p>\n<p> token  75% 90  120  token</p>\n<p><img src=\"/../../typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png\" alt=\"spring-ai-concepts-tokens\"></p>\n<p> token &#x3D;  AI  token  token </p>\n<p> token  API </p>\n<p>ChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token </p>\n<p> GPT4 Spring AI </p>\n<h3 id=\"Structured-Output\"><a href=\"#Structured-Output\" class=\"headerlink\" title=\"Structured Output\"></a>Structured Output</h3><p> JSON AI  <code>java.lang.String</code>  JSON JSON  Prompt   JSON  100% </p>\n<p> Prompt </p>\n<p><img src=\"/../../typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg\" alt=\"\"></p>\n<p>[]</p>\n<h3 id=\"-API--AI-\"><a href=\"#-API--AI-\" class=\"headerlink\" title=\" API  AI \"></a> API  AI </h3><p></p>\n<p>GPT 3.5&#x2F;4.0  2021  9  650GB</p>\n<p> AI </p>\n<ul>\n<li><code>Fine Tuning</code>  GPT </li>\n<li><code>Prompt Stuffing</code> Spring AI  <a href=\"\"> (RAG)</a></li>\n</ul>\n<p><img src=\"/../../typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg\" alt=\"prompt-stuffing\"></p>\n<ul>\n<li>Function Calling APISpring AI  [] </li>\n</ul>\n<h3 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h3><p> (RAG)  AI </p>\n<p> ETL RAG </p>\n<p></p>\n<ol>\n<li></li>\n<li> AI  token </li>\n</ol>\n<p>RAG  AI  AI </p>\n<p><img src=\"/../../typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg\" alt=\"Spring AI RAG\"></p>\n<ul>\n<li><a href=\"https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html\">ETL </a>  AI </li>\n<li>[ChatClient - RAG] <code>QuestionAnswerAdvisor</code> Advisor  RAG </li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a>Function Calling</h3><p> (LLM) </p>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\">Function Calling</a> API LLM </p>\n<p>Spring AI <code>@Bean</code> bean </p>\n<p><img src=\"/../../typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg\" alt=\"Spring AI Function Calling\"></p>\n<ul>\n<li>1<code>name</code><code>description</code><code>input parameters</code></li>\n<li>2</li>\n<li>3Spring AI </li>\n<li>4</li>\n<li>5</li>\n</ul>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\"></a> AI </p>\n<h3 id=\"Evaluation\"><a href=\"#Evaluation\" class=\"headerlink\" title=\"Evaluation\"></a>Evaluation</h3><p></p>\n<p>Evaluation  AI </p>\n<p></p>\n<p>Vector Database</p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-00-Spring-Ai-Alibaba\"><a href=\"#Spring-AI-Alibaba-00-Spring-Ai-Alibaba\" class=\"headerlink\" title=\"Spring AI Alibaba-00-Spring Ai Alibaba\"></a>Spring AI Alibaba-00-Spring Ai Alibaba</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.12</code></p>\n<p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://docs.spring.io/spring-ai/reference/index.html\">Spring AI</a>  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models</p>\n<h2 id=\"-Spring-AI-Alibaba\"><a href=\"#-Spring-AI-Alibaba\" class=\"headerlink\" title=\" Spring AI Alibaba\"></a> Spring AI Alibaba</h2><p>Spring AI Alibaba  Spring AI  Java AI  AI API  AI </p>\n<p><img src=\"/../../typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png\" alt=\"img\"></p>\n<p>Spring AI Alibaba  AI  API API </p>\n<ul>\n<li> AI  Fluent API  ChatClient</li>\n<li></li>\n<li></li>\n<li> API API </li>\n<li> Structured Output AI  POJOs</li>\n<li></li>\n<li> Function Calling</li>\n<li> AI Agent </li>\n<li> RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve </li>\n</ul>\n<p> AI     </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h3><p>AI </p>\n<p>AI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion</p>\n<p><img src=\"/../../typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg\" alt=\"spring-ai-concepts-model-types\"></p>\n<p>Spring AI Embedding Text AI Spring AI  Embedding </p>\n<p>GPT  GPT PChat Generative Pre-trained Transformer AI </p>\n<h3 id=\"Prompt\"><a href=\"#Prompt\" class=\"headerlink\" title=\"Prompt\"></a>Prompt</h3><p>Prompt  AI  ChatGPT Prompt  API AI Prompt </p>\n<p>ChatGPT  API </p>\n<p> Prompt ChatGPT  SQL AI </p>\n<p>Prompt  Prompt  Prompt </p>\n<p> Prompt  Prompt  ChatGPT 3.5</p>\n<h3 id=\"Prompt-Template\"><a href=\"#Prompt-Template\" class=\"headerlink\" title=\"Prompt Template\"></a>Prompt Template</h3><p> Prompt  Prompt Spring AI  StringTemplate </p>\n<p> Prompt </p>\n<blockquote>\n<p>Tell me a {adjective} joke about {content}.</p>\n</blockquote>\n<p> Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt </p>\n<p> Prompt Prompt </p>\n<h3 id=\"Embedding\"><a href=\"#Embedding\" class=\"headerlink\" title=\"Embedding\"></a>Embedding</h3><p>EmbeddingEmbedding VectorEmbedding </p>\n<p></p>\n<p><img src=\"/../../typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg\" alt=\"spring-ai-embeddings\"></p>\n<p> Java </p>\n<p>Embedding RAG</p>\n<p></p>\n<h3 id=\"Token\"><a href=\"#Token\" class=\"headerlink\" title=\"Token\"></a>Token</h3><p>token  AI  token token </p>\n<p> token  75% 90  120  token</p>\n<p><img src=\"/../../typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png\" alt=\"spring-ai-concepts-tokens\"></p>\n<p> token &#x3D;  AI  token  token </p>\n<p> token  API </p>\n<p>ChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token </p>\n<p> GPT4 Spring AI </p>\n<h3 id=\"Structured-Output\"><a href=\"#Structured-Output\" class=\"headerlink\" title=\"Structured Output\"></a>Structured Output</h3><p> JSON AI  <code>java.lang.String</code>  JSON JSON  Prompt   JSON  100% </p>\n<p> Prompt </p>\n<p><img src=\"/../../typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg\" alt=\"\"></p>\n<p>[]</p>\n<h3 id=\"-API--AI-\"><a href=\"#-API--AI-\" class=\"headerlink\" title=\" API  AI \"></a> API  AI </h3><p></p>\n<p>GPT 3.5&#x2F;4.0  2021  9  650GB</p>\n<p> AI </p>\n<ul>\n<li><code>Fine Tuning</code>  GPT </li>\n<li><code>Prompt Stuffing</code> Spring AI  <a href=\"\"> (RAG)</a></li>\n</ul>\n<p><img src=\"/../../typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg\" alt=\"prompt-stuffing\"></p>\n<ul>\n<li>Function Calling APISpring AI  [] </li>\n</ul>\n<h3 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h3><p> (RAG)  AI </p>\n<p> ETL RAG </p>\n<p></p>\n<ol>\n<li></li>\n<li> AI  token </li>\n</ol>\n<p>RAG  AI  AI </p>\n<p><img src=\"/../../typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg\" alt=\"Spring AI RAG\"></p>\n<ul>\n<li><a href=\"https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html\">ETL </a>  AI </li>\n<li>[ChatClient - RAG] <code>QuestionAnswerAdvisor</code> Advisor  RAG </li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a>Function Calling</h3><p> (LLM) </p>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\">Function Calling</a> API LLM </p>\n<p>Spring AI <code>@Bean</code> bean </p>\n<p><img src=\"/../../typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg\" alt=\"Spring AI Function Calling\"></p>\n<ul>\n<li>1<code>name</code><code>description</code><code>input parameters</code></li>\n<li>2</li>\n<li>3Spring AI </li>\n<li>4</li>\n<li>5</li>\n</ul>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\"></a> AI </p>\n<h3 id=\"Evaluation\"><a href=\"#Evaluation\" class=\"headerlink\" title=\"Evaluation\"></a>Evaluation</h3><p></p>\n<p>Evaluation  AI </p>\n<p></p>\n<p>Vector Database</p>\n"},{"title":"Spring AI Alibaba-01-SpringBootSpringAI Alibaba ","_content":"# Spring AI Alibaba-01-SpringBootSpringAI Alibaba \n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\nSpring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI \n\n## \n\n:IntelliJ IDEA\n\nJDK17+, idea\n\nhttps://bailian.console.aliyun.com/\n\n\n\n## \n\n### IDEA demo\n\n\n\n![image-20250419091747915](../../typora-user-images/image-20250419091747915.png)\n\nweblambokjava17springboot3.4\n\n![image-20250419092017527](../../typora-user-images/image-20250419092017527.png)\n\n\n\n\n\n###  Pom\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.4</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>1.0.0-M3.1</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n~~~\n\n### **ChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatController {\n\n\n    private final ChatClient chatClient;\n\n    public ChatController(ChatClient.Builder chatClientBuilder) {\n        this.chatClient = chatClientBuilder\n                //  Chat Memory  Advisor\n                //  Chat Memory  ID Spring AI \n                .defaultAdvisors(\n                        new MessageChatMemoryAdvisor(new InMemoryChatMemory())\n                )\n                //  Logger  Advisor\n                .defaultAdvisors(\n                        new SimpleLoggerAdvisor()\n                )\n                //  ChatClient  ChatModel  Options \n                .defaultOptions(\n                        DashScopeChatOptions.builder()\n                                .withTopP(0.7)\n                                .build()\n                )\n                .build();\n    }\n\n    @GetMapping(\"/simple/chat\")\n    public String simpleChat(String query) {\n        log.info(\"query: {}\",query );\n        String text =  chatClient.prompt(query).call().content();\n        log.info(\"text: {}\",text );\n        return text;\n    }\n\n    @GetMapping(\"/chat\")\n    public String chat(String message) {\n\n        return this.chatClient.prompt()\n                .user(message)\n                .call()\n                .content();\n    }\n\n\n    @GetMapping(\"/hello\")\n    public String hello(String message) {\n\n        return \"Hello \" + message;\n    }\n\n}\n\n~~~\n\nspring-ai chat memory`chatClient`\n\n~~~java\nprivate ChatMemory chatMemory = new InMemoryChatMemory();                                            \n\npublic ChatController(ChatClient.Builder builder) {\n                                                   \n    this.chatClient = builder                                                                        \n            .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory, UUID.randomUUID().toString(), 10))\n            .build();                                                                                \n}\n\n~~~\n\nUUID ChatMemory\n\ntokentoken\n\n\n\n\n\n1. Spring AI Alibaba  Spring Boot 3.x JDK  17 \n2. spring-ai  Maven \n\n~~~xml\n<repositories>\n  <repository>\n    <id>spring-milestones</id>\n    <name>Spring Milestones</name>\n    <url>https://repo.spring.io/milestone</url>\n    <snapshots>\n      <enabled>false</enabled>\n    </snapshots>\n  </repository>\n</repositories>\n\n~~~\n\n\n\napplication.yml\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n~~~\n\n\n\n\n\n### \n\n\n\n\n\n~~~html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <script src=\"js/marked.min.js\"></script>\n    <title></title>\n    <style>\n        body {\n\n            background-color: #f8f9fa;\n            font-family: Arial, sans-serif;\n        }\n\n        .container {\n\n            margin: 50px auto;\n            width: 800px;\n            background-color: #fff;\n            padding: 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n        }\n\n        h1 {\n\n            text-align: center;\n            margin-bottom: 30px;\n        }\n\n        label {\n\n            display: block;\n            margin-bottom: 10px;\n            color: #333;\n        }\n\n        input[type=\"text\"] {\n\n            width: 85%;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n        }\n\n        input[type=\"submit\"] {\n\n            background-color: #2ecc71;\n            color: #fff;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 3px;\n            cursor: pointer;\n            width: 10%;\n        }\n\n        .chat-box {\n\n            width: 100%;\n            height: 500px;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            overflow-y: scroll;\n        }\n\n        .message {\n\n            margin-bottom: 10px;\n            padding: 10px;\n            background-color: #f1f1f1;\n            border-radius: 3px;\n        }\n\n        .user-message {\n\n            background-color: #2ecc71;\n            color: #fff;\n        }\n\n        .bot-message {\n\n            background-color: #e6aa6b;\n            color: #fff;\n        }\n\n        .loader {\n\n            text-align: center;\n        }\n\n        .loader::after {\n\n            content: \"\";\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            border: 2px solid #ccc;\n            border-top-color: #2ecc71;\n            animation: spin 1s infinite linear;\n        }\n\n        @keyframes spin {\n\n            to {\n\n                transform: rotate(360deg);\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"container\">\n    <h1>AI </h1>\n    <form id=\"form\" style=\"width: 47%;position: absolute;bottom: 150px;margin-left:15px\">\n        <input type=\"text\" id=\"message\" name=\"message\" placeholder=\"\">\n        <input type=\"submit\" value=\"\">\n    </form>\n    <br>\n    <div id=\"loader\" class=\"loader\" style=\"display: none;\"></div>\n    <div id=\"chat-box\" class=\"chat-box\"></div>\n</div>\n\n<script>\n    var loader = document.getElementById(\"loader\");\n\n    document.getElementById(\"form\").addEventListener(\"submit\", function(event) {\n\n        event.preventDefault();\n\n        var messageInput = document.getElementById(\"message\");\n        var message = messageInput.value;\n        messageInput.value = \"\";\n\n        var chatBox = document.getElementById(\"chat-box\");\n\n        var userMessage = document.createElement(\"div\");\n        userMessage.className = \"message\";\n        userMessage.textContent = \": \" + message;\n        chatBox.appendChild(userMessage);\n        chatBox.scrollTop = chatBox.scrollHeight;\n\n        loader.style.display = \"block\";\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", \"http://localhost:8080/ai/v1/chat?message=\" + encodeURIComponent(message), true);\n        xhr.onreadystatechange = function() {\n\n            if (xhr.readyState === 4) {\n\n                loader.style.display = \"none\";\n\n                if (xhr.status === 200) {\n\n                    var response = xhr.responseText;\n\n                    var botMessage = document.createElement(\"div\");\n                    botMessage.className = \"message bot-message\";\n\n                    var botMessageText = document.createElement(\"span\");\n                    botMessageText.className = \"message-text\";\n                    botMessage.appendChild(botMessageText);\n                    botMessageText.innerHTML = marked.marked(response);\n\n                    chatBox.appendChild(botMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else if (xhr.status === 400) {\n\n                    var error = JSON.parse(xhr.responseText);\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: \" + error.message;\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else {\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: Failed to connect to the backend service. Please make sure the backend service is running.\";\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                }\n            }\n        };\n\n        xhr.onloadstart = function() {\n\n            loader.style.display = \"block\";\n        };\n\n        xhr.onloadend = function() {\n\n            loader.style.display = \"none\";\n        };\n\n        xhr.send();\n    });\n</script>\n</body>\n</html>\n\n~~~\n\njs  `marked.min.js`\n\n [GitHub](https://github.com/cundream/marked) \n\n### APi\n\n[](https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1)\n\n\n\n![image-20250419102848756](../../typora-user-images/image-20250419102848756.png)\n\n\n\nKey\n\n![image-20250419105704031](../../typora-user-images/image-20250419105704031.png)\n\n\n\n## \n\nhttp://localhost:8080/chat.html\n\n\n\n\n\n![image-20250419113622811](../../typora-user-images/image-20250419113622811.png)\n\n\n\nhttp://localhost:8080/ai/v1/simple/chat?query=\n\n![image-20250419112758947](../../typora-user-images/image-20250419112758947.png)\n\n\n\n## \n\n\n\nSpringBootJavaer Spring AI AI\n\n- AI AI AI\n- Prompt\n- Tokentoken AI tokentokenAItoken\n-  (RAG)\n\ntoken\n\n\n\n\n\n# \n\nSpring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI ","source":"_posts/Spring AI Alibaba/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .md","raw":"---\ntitle: Spring AI Alibaba-01-SpringBootSpringAI Alibaba \n---\n# Spring AI Alibaba-01-SpringBootSpringAI Alibaba \n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\nSpring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI \n\n## \n\n:IntelliJ IDEA\n\nJDK17+, idea\n\nhttps://bailian.console.aliyun.com/\n\n\n\n## \n\n### IDEA demo\n\n\n\n![image-20250419091747915](../../typora-user-images/image-20250419091747915.png)\n\nweblambokjava17springboot3.4\n\n![image-20250419092017527](../../typora-user-images/image-20250419092017527.png)\n\n\n\n\n\n###  Pom\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.4</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>1.0.0-M3.1</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n~~~\n\n### **ChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatController {\n\n\n    private final ChatClient chatClient;\n\n    public ChatController(ChatClient.Builder chatClientBuilder) {\n        this.chatClient = chatClientBuilder\n                //  Chat Memory  Advisor\n                //  Chat Memory  ID Spring AI \n                .defaultAdvisors(\n                        new MessageChatMemoryAdvisor(new InMemoryChatMemory())\n                )\n                //  Logger  Advisor\n                .defaultAdvisors(\n                        new SimpleLoggerAdvisor()\n                )\n                //  ChatClient  ChatModel  Options \n                .defaultOptions(\n                        DashScopeChatOptions.builder()\n                                .withTopP(0.7)\n                                .build()\n                )\n                .build();\n    }\n\n    @GetMapping(\"/simple/chat\")\n    public String simpleChat(String query) {\n        log.info(\"query: {}\",query );\n        String text =  chatClient.prompt(query).call().content();\n        log.info(\"text: {}\",text );\n        return text;\n    }\n\n    @GetMapping(\"/chat\")\n    public String chat(String message) {\n\n        return this.chatClient.prompt()\n                .user(message)\n                .call()\n                .content();\n    }\n\n\n    @GetMapping(\"/hello\")\n    public String hello(String message) {\n\n        return \"Hello \" + message;\n    }\n\n}\n\n~~~\n\nspring-ai chat memory`chatClient`\n\n~~~java\nprivate ChatMemory chatMemory = new InMemoryChatMemory();                                            \n\npublic ChatController(ChatClient.Builder builder) {\n                                                   \n    this.chatClient = builder                                                                        \n            .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory, UUID.randomUUID().toString(), 10))\n            .build();                                                                                \n}\n\n~~~\n\nUUID ChatMemory\n\ntokentoken\n\n\n\n\n\n1. Spring AI Alibaba  Spring Boot 3.x JDK  17 \n2. spring-ai  Maven \n\n~~~xml\n<repositories>\n  <repository>\n    <id>spring-milestones</id>\n    <name>Spring Milestones</name>\n    <url>https://repo.spring.io/milestone</url>\n    <snapshots>\n      <enabled>false</enabled>\n    </snapshots>\n  </repository>\n</repositories>\n\n~~~\n\n\n\napplication.yml\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n~~~\n\n\n\n\n\n### \n\n\n\n\n\n~~~html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <script src=\"js/marked.min.js\"></script>\n    <title></title>\n    <style>\n        body {\n\n            background-color: #f8f9fa;\n            font-family: Arial, sans-serif;\n        }\n\n        .container {\n\n            margin: 50px auto;\n            width: 800px;\n            background-color: #fff;\n            padding: 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n        }\n\n        h1 {\n\n            text-align: center;\n            margin-bottom: 30px;\n        }\n\n        label {\n\n            display: block;\n            margin-bottom: 10px;\n            color: #333;\n        }\n\n        input[type=\"text\"] {\n\n            width: 85%;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n        }\n\n        input[type=\"submit\"] {\n\n            background-color: #2ecc71;\n            color: #fff;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 3px;\n            cursor: pointer;\n            width: 10%;\n        }\n\n        .chat-box {\n\n            width: 100%;\n            height: 500px;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            overflow-y: scroll;\n        }\n\n        .message {\n\n            margin-bottom: 10px;\n            padding: 10px;\n            background-color: #f1f1f1;\n            border-radius: 3px;\n        }\n\n        .user-message {\n\n            background-color: #2ecc71;\n            color: #fff;\n        }\n\n        .bot-message {\n\n            background-color: #e6aa6b;\n            color: #fff;\n        }\n\n        .loader {\n\n            text-align: center;\n        }\n\n        .loader::after {\n\n            content: \"\";\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            border: 2px solid #ccc;\n            border-top-color: #2ecc71;\n            animation: spin 1s infinite linear;\n        }\n\n        @keyframes spin {\n\n            to {\n\n                transform: rotate(360deg);\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"container\">\n    <h1>AI </h1>\n    <form id=\"form\" style=\"width: 47%;position: absolute;bottom: 150px;margin-left:15px\">\n        <input type=\"text\" id=\"message\" name=\"message\" placeholder=\"\">\n        <input type=\"submit\" value=\"\">\n    </form>\n    <br>\n    <div id=\"loader\" class=\"loader\" style=\"display: none;\"></div>\n    <div id=\"chat-box\" class=\"chat-box\"></div>\n</div>\n\n<script>\n    var loader = document.getElementById(\"loader\");\n\n    document.getElementById(\"form\").addEventListener(\"submit\", function(event) {\n\n        event.preventDefault();\n\n        var messageInput = document.getElementById(\"message\");\n        var message = messageInput.value;\n        messageInput.value = \"\";\n\n        var chatBox = document.getElementById(\"chat-box\");\n\n        var userMessage = document.createElement(\"div\");\n        userMessage.className = \"message\";\n        userMessage.textContent = \": \" + message;\n        chatBox.appendChild(userMessage);\n        chatBox.scrollTop = chatBox.scrollHeight;\n\n        loader.style.display = \"block\";\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", \"http://localhost:8080/ai/v1/chat?message=\" + encodeURIComponent(message), true);\n        xhr.onreadystatechange = function() {\n\n            if (xhr.readyState === 4) {\n\n                loader.style.display = \"none\";\n\n                if (xhr.status === 200) {\n\n                    var response = xhr.responseText;\n\n                    var botMessage = document.createElement(\"div\");\n                    botMessage.className = \"message bot-message\";\n\n                    var botMessageText = document.createElement(\"span\");\n                    botMessageText.className = \"message-text\";\n                    botMessage.appendChild(botMessageText);\n                    botMessageText.innerHTML = marked.marked(response);\n\n                    chatBox.appendChild(botMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else if (xhr.status === 400) {\n\n                    var error = JSON.parse(xhr.responseText);\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: \" + error.message;\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else {\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: Failed to connect to the backend service. Please make sure the backend service is running.\";\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                }\n            }\n        };\n\n        xhr.onloadstart = function() {\n\n            loader.style.display = \"block\";\n        };\n\n        xhr.onloadend = function() {\n\n            loader.style.display = \"none\";\n        };\n\n        xhr.send();\n    });\n</script>\n</body>\n</html>\n\n~~~\n\njs  `marked.min.js`\n\n [GitHub](https://github.com/cundream/marked) \n\n### APi\n\n[](https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1)\n\n\n\n![image-20250419102848756](../../typora-user-images/image-20250419102848756.png)\n\n\n\nKey\n\n![image-20250419105704031](../../typora-user-images/image-20250419105704031.png)\n\n\n\n## \n\nhttp://localhost:8080/chat.html\n\n\n\n\n\n![image-20250419113622811](../../typora-user-images/image-20250419113622811.png)\n\n\n\nhttp://localhost:8080/ai/v1/simple/chat?query=\n\n![image-20250419112758947](../../typora-user-images/image-20250419112758947.png)\n\n\n\n## \n\n\n\nSpringBootJavaer Spring AI AI\n\n- AI AI AI\n- Prompt\n- Tokentoken AI tokentokenAItoken\n-  (RAG)\n\ntoken\n\n\n\n\n\n# \n\nSpring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI ","slug":"Spring AI Alibaba/Spring AI Alibaba-01-SpringBootSpringAI Alibaba ","published":1,"date":"2025-04-19T01:08:52.534Z","updated":"2025-06-04T10:49:56.775Z","_id":"cmbhtdwzu000co6fy7z2x03i7","comments":1,"layout":"post","photos":[],"content":"<h1 id=\"Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\"><a href=\"#Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\" class=\"headerlink\" title=\"Spring AI Alibaba-01-SpringBootSpringAI Alibaba \"></a>Spring AI Alibaba-01-SpringBootSpringAI Alibaba </h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p>Spring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:IntelliJ IDEA</p>\n<p>JDK17+, idea</p>\n<p><a href=\"https://bailian.console.aliyun.com/\">https://bailian.console.aliyun.com/</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"IDEA-demo\"><a href=\"#IDEA-demo\" class=\"headerlink\" title=\"IDEA demo\"></a>IDEA demo</h3><p><img src=\"/../../typora-user-images/image-20250419091747915.png\" alt=\"image-20250419091747915\"></p>\n<p>weblambokjava17springboot3.4</p>\n<p><img src=\"/../../typora-user-images/image-20250419092017527.png\" alt=\"image-20250419092017527\"></p>\n<h3 id=\"Pom\"><a href=\"#Pom\" class=\"headerlink\" title=\"Pom\"></a>Pom</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-M3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ChatController-java\"><a href=\"#ChatController-java\" class=\"headerlink\" title=\"ChatController.java\"></a><strong>ChatController.java</strong></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder chatClientBuilder)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = chatClientBuilder</span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  Advisor</span></span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  ID Spring AI </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>())</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  Logger  Advisor</span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleLoggerAdvisor</span>()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  ChatClient  ChatModel  Options </span></span><br><span class=\"line\">                .defaultOptions(</span><br><span class=\"line\">                        DashScopeChatOptions.builder()</span><br><span class=\"line\">                                .withTopP(<span class=\"number\">0.7</span>)</span><br><span class=\"line\">                                .build()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/simple/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">simpleChat</span><span class=\"params\">(String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query: &#123;&#125;&quot;</span>,query );</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span>  chatClient.prompt(query).call().content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text: &#123;&#125;&quot;</span>,text );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.chatClient.prompt()</span><br><span class=\"line\">                .user(message)</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">hello</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello &quot;</span> + message;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>spring-ai chat memory<code>chatClient</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">ChatMemory</span> <span class=\"variable\">chatMemory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();                                            </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder builder)</span> &#123;</span><br><span class=\"line\">                                                   </span><br><span class=\"line\">    <span class=\"built_in\">this</span>.chatClient = builder                                                                        </span><br><span class=\"line\">            .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, UUID.randomUUID().toString(), <span class=\"number\">10</span>))</span><br><span class=\"line\">            .build();                                                                                </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>UUID ChatMemory</p>\n<p>tokentoken</p>\n<p></p>\n<ol>\n<li>Spring AI Alibaba  Spring Boot 3.x JDK  17 </li>\n<li>spring-ai  Maven </li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/marked.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">body</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f8f9fa</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">font-family</span>: Arial, sans-serif;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.container</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">800px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">2px</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.1</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">h1</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">label</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;text&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">85%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;submit&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">cursor</span>: pointer;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">10%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.chat-box</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">500px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow-y</span>: scroll;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f1f1f1</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.user-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.bot-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#e6aa6b</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span><span class=\"selector-pseudo\">::after</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">content</span>: <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-top-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">animation</span>: spin <span class=\"number\">1s</span> infinite linear;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"keyword\">@keyframes</span> spin &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"selector-tag\">to</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">                <span class=\"attribute\">transform</span>: <span class=\"built_in\">rotate</span>(<span class=\"number\">360deg</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>AI <span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;form&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 47%;position: absolute;bottom: 150px;margin-left:15px&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: none;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;chat-box&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-box&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">var</span> loader = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;loader&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;form&quot;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;submit&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        event.<span class=\"title function_\">preventDefault</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> messageInput = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;message&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> message = messageInput.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        messageInput.<span class=\"property\">value</span> = <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> chatBox = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;chat-box&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> userMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;: &quot;</span> + message;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"title function_\">appendChild</span>(userMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;GET&quot;</span>, <span class=\"string\">&quot;http://localhost:8080/ai/v1/chat?message=&quot;</span> + <span class=\"built_in\">encodeURIComponent</span>(message), <span class=\"literal\">true</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> === <span class=\"number\">4</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">200</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> response = xhr.<span class=\"property\">responseText</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessageText = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;span&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">className</span> = <span class=\"string\">&quot;message-text&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"title function_\">appendChild</span>(botMessageText);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">innerHTML</span> = marked.<span class=\"title function_\">marked</span>(response);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(botMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">400</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> error = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(xhr.<span class=\"property\">responseText</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: &quot;</span> + error.<span class=\"property\">message</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: Failed to connect to the backend service. Please make sure the backend service is running.&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadstart</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadend</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">send</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>js  <code>marked.min.js</code></p>\n<p> <a href=\"https://github.com/cundream/marked\">GitHub</a> </p>\n<h3 id=\"APi\"><a href=\"#APi\" class=\"headerlink\" title=\"APi\"></a>APi</h3><p><a href=\"https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1\"></a></p>\n<p><img src=\"/../../typora-user-images/image-20250419102848756.png\" alt=\"image-20250419102848756\"></p>\n<p>Key</p>\n<p><img src=\"/../../typora-user-images/image-20250419105704031.png\" alt=\"image-20250419105704031\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"http://localhost:8080/chat.html\">http://localhost:8080/chat.html</a></p>\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250419113622811.png\" alt=\"image-20250419113622811\"></p>\n<p></p>\n<p><a href=\"http://localhost:8080/ai/v1/simple/chat?query=%E4%BD%A0%E6%98%AF%E8%B0%81\">http://localhost:8080/ai/v1/simple/chat?query=</a></p>\n<p><img src=\"/../../typora-user-images/image-20250419112758947.png\" alt=\"image-20250419112758947\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>SpringBootJavaer Spring AI AI</p>\n<ul>\n<li>AI AI AI</li>\n<li>Prompt</li>\n<li>Tokentoken AI tokentokenAItoken</li>\n<li> (RAG)</li>\n</ul>\n<p>token</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>Spring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI </p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\"><a href=\"#Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\" class=\"headerlink\" title=\"Spring AI Alibaba-01-SpringBootSpringAI Alibaba \"></a>Spring AI Alibaba-01-SpringBootSpringAI Alibaba </h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p>Spring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:IntelliJ IDEA</p>\n<p>JDK17+, idea</p>\n<p><a href=\"https://bailian.console.aliyun.com/\">https://bailian.console.aliyun.com/</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"IDEA-demo\"><a href=\"#IDEA-demo\" class=\"headerlink\" title=\"IDEA demo\"></a>IDEA demo</h3><p><img src=\"/../../typora-user-images/image-20250419091747915.png\" alt=\"image-20250419091747915\"></p>\n<p>weblambokjava17springboot3.4</p>\n<p><img src=\"/../../typora-user-images/image-20250419092017527.png\" alt=\"image-20250419092017527\"></p>\n<h3 id=\"Pom\"><a href=\"#Pom\" class=\"headerlink\" title=\"Pom\"></a>Pom</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-M3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ChatController-java\"><a href=\"#ChatController-java\" class=\"headerlink\" title=\"ChatController.java\"></a><strong>ChatController.java</strong></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder chatClientBuilder)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = chatClientBuilder</span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  Advisor</span></span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  ID Spring AI </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>())</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  Logger  Advisor</span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleLoggerAdvisor</span>()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  ChatClient  ChatModel  Options </span></span><br><span class=\"line\">                .defaultOptions(</span><br><span class=\"line\">                        DashScopeChatOptions.builder()</span><br><span class=\"line\">                                .withTopP(<span class=\"number\">0.7</span>)</span><br><span class=\"line\">                                .build()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/simple/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">simpleChat</span><span class=\"params\">(String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query: &#123;&#125;&quot;</span>,query );</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span>  chatClient.prompt(query).call().content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text: &#123;&#125;&quot;</span>,text );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.chatClient.prompt()</span><br><span class=\"line\">                .user(message)</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">hello</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello &quot;</span> + message;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>spring-ai chat memory<code>chatClient</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">ChatMemory</span> <span class=\"variable\">chatMemory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();                                            </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder builder)</span> &#123;</span><br><span class=\"line\">                                                   </span><br><span class=\"line\">    <span class=\"built_in\">this</span>.chatClient = builder                                                                        </span><br><span class=\"line\">            .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, UUID.randomUUID().toString(), <span class=\"number\">10</span>))</span><br><span class=\"line\">            .build();                                                                                </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>UUID ChatMemory</p>\n<p>tokentoken</p>\n<p></p>\n<ol>\n<li>Spring AI Alibaba  Spring Boot 3.x JDK  17 </li>\n<li>spring-ai  Maven </li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/marked.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">body</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f8f9fa</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">font-family</span>: Arial, sans-serif;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.container</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">800px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">2px</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.1</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">h1</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">label</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;text&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">85%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;submit&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">cursor</span>: pointer;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">10%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.chat-box</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">500px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow-y</span>: scroll;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f1f1f1</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.user-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.bot-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#e6aa6b</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span><span class=\"selector-pseudo\">::after</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">content</span>: <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-top-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">animation</span>: spin <span class=\"number\">1s</span> infinite linear;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"keyword\">@keyframes</span> spin &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"selector-tag\">to</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">                <span class=\"attribute\">transform</span>: <span class=\"built_in\">rotate</span>(<span class=\"number\">360deg</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>AI <span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;form&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 47%;position: absolute;bottom: 150px;margin-left:15px&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: none;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;chat-box&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-box&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">var</span> loader = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;loader&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;form&quot;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;submit&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        event.<span class=\"title function_\">preventDefault</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> messageInput = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;message&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> message = messageInput.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        messageInput.<span class=\"property\">value</span> = <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> chatBox = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;chat-box&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> userMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;: &quot;</span> + message;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"title function_\">appendChild</span>(userMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;GET&quot;</span>, <span class=\"string\">&quot;http://localhost:8080/ai/v1/chat?message=&quot;</span> + <span class=\"built_in\">encodeURIComponent</span>(message), <span class=\"literal\">true</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> === <span class=\"number\">4</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">200</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> response = xhr.<span class=\"property\">responseText</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessageText = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;span&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">className</span> = <span class=\"string\">&quot;message-text&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"title function_\">appendChild</span>(botMessageText);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">innerHTML</span> = marked.<span class=\"title function_\">marked</span>(response);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(botMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">400</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> error = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(xhr.<span class=\"property\">responseText</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: &quot;</span> + error.<span class=\"property\">message</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: Failed to connect to the backend service. Please make sure the backend service is running.&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadstart</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadend</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">send</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>js  <code>marked.min.js</code></p>\n<p> <a href=\"https://github.com/cundream/marked\">GitHub</a> </p>\n<h3 id=\"APi\"><a href=\"#APi\" class=\"headerlink\" title=\"APi\"></a>APi</h3><p><a href=\"https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1\"></a></p>\n<p><img src=\"/../../typora-user-images/image-20250419102848756.png\" alt=\"image-20250419102848756\"></p>\n<p>Key</p>\n<p><img src=\"/../../typora-user-images/image-20250419105704031.png\" alt=\"image-20250419105704031\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"http://localhost:8080/chat.html\">http://localhost:8080/chat.html</a></p>\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250419113622811.png\" alt=\"image-20250419113622811\"></p>\n<p></p>\n<p><a href=\"http://localhost:8080/ai/v1/simple/chat?query=%E4%BD%A0%E6%98%AF%E8%B0%81\">http://localhost:8080/ai/v1/simple/chat?query=</a></p>\n<p><img src=\"/../../typora-user-images/image-20250419112758947.png\" alt=\"image-20250419112758947\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>SpringBootJavaer Spring AI AI</p>\n<ul>\n<li>AI AI AI</li>\n<li>Prompt</li>\n<li>Tokentoken AI tokentokenAItoken</li>\n<li> (RAG)</li>\n</ul>\n<p>token</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>Spring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI </p>\n"},{"title":"Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES/Milvus + RAG ","_content":"\n# Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES/Milvus + RAG \n\n\n\n[]AIAPI**Spring AI**Spring[AI]AI\n\n[toc]\n\n\n\n\n\n## Spring AI  Function CallingTool Calling  Agent \n\n### Spring AI \n\n#### Spring AI\n\nSpring AI\n\n* 20245301.0.0 Milestone 1API\n* 20248231.0.0 Milestone 2\n* 20241081.0.0 Milestone 3AI\n* 202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon\n* 20252141.0.0 Milestone 6\n\n\n\n#### Spring AI\n\nSpring AIAI\n\n* LLM\n* AI\n* \n* \n* \n\n### **Function Calling**\n\n#### \n\nAIAPIAI\n\n#### \n\nSpring AI\n\n**1**`Function`Java\n\n~~~java\n@Component\npublic class WeatherFunction implements Function<WeatherFunction.WeatherRequest, String> {\n    @Override\n    public String apply(WeatherRequest request) {\n        return \"The weather in \" + request.getCity() + \" is sunny.\";\n    }\n    public static class WeatherRequest {\n        private String city;\n        public String getCity() { return city; }\n        public void setCity(String city) { this.city = city; }\n    }\n}\n\n~~~\n\n**2**Spring BeanSpring AI\n\n~~~java\n@Configuration\npublic class FunctionConfig {\n    @Bean\n    @Description(\"\")\n    public Function<WeatherFunction.WeatherRequest, String> weatherFunction() {\n        return new WeatherFunction();\n    }\n}\n~~~\n\n**3**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withFunction(\"weatherFunction\").build())\n                .build();\n    }\n}\n~~~\n\n**4**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        WeatherFunction.WeatherRequest request = new WeatherFunction.WeatherRequest();\n        request.setCity(input);\n        String response = chatClient.prompt().user(input).functions(\"weatherFunction\").call().content();\n        return response;\n    }\n}\n~~~\n\n****Spring AI****Tool Calling\n\n### **Tool Calling**\n\n#### ****\n\nAI\n\n#### \n\n\n\n**1**\n\n~~~java\npublic interface WeatherTool {\n    String getWeather(String city);\n}\n~~~\n\n**2**\n\n~~~java\n@Component\npublic class WeatherToolImpl implements WeatherTool {\n    @Override\n    public String getWeather(String city) {\n        return \"The weather in \" + city + \" is sunny.\";\n    }\n}\n~~~\n\n**3Spring Bean**Spring BeanSpring\n\n~~~java\n@Configuration\npublic class ToolConfig {\n    @Bean\n    public WeatherTool weatherTool() {\n        return new WeatherToolImpl();\n    }\n}\n~~~\n\n**4**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withTool(\"weatherTool\").build())\n                .build();\n    }\n}\n\n~~~\n\n**5**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        String response = chatClient.prompt().user(input).tools(\"weatherTool\").call().content();\n        return response;\n    }\n}\n\n~~~\n\n### Agent\n\n#### \n\nAgent\n\n#### \n\n\n\nMCPLLMMCP\n\nSpring AIAI\nSpring AI\n\n### FunctionCallbacToolCallback\n\nSpring AIFunction CallbackDeprecatedTool CallbackAI\n\n**FunctionCallbackToolCallback**\n\nSpring AIFunctionCallbackToolCallback\n\n* ToolCallbackFunctionCallback\n* ToolCallback\n* FunctionCallbackSpring AIToolCallback\n\n\n\nSpring AIFunctionCallbackToolCallback\n\n\n\n## Spring AI + DeepSeek-R1 + ES/Milvus + RAG + Tool Calling\n\n### \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n\n\n![image-20250425104935964](../../typora-user-images/image-20250425104935964-5549379.png)\n\n\n\n**Elasticsearch**\n\n\n\n~~~yaml\n# base \nversion: '3.8'\nservices:\n\telasticsearch1:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.13.4\n    hostname: \"elasticsearch1\"\n    environment:\n      - TZ=Asia/Shanghai\n      - \"ES_JAVA_OPTS=-Xms84m -Xmx512m\"\n    ports:\n      - 9200:9200\n      - 9300:9300\n    volumes:\n      - /Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data \n      - /Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins \n      - /Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config  \n      - /Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs  \n    privileged: true\n    #restart: always\n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.7\n\n  vsftpd:\n    image: \"fauria/vsftpd\"\n    hostname: \"rabbitmq1\"\n    environment:\n      - FTP_USER=admin \n      - FTP_PASS=123456 \n      - PASV_MIN_PORT=21100\n      - PASV_MAX_PORT=21110 \n      - PASV_ADDRESS=172.18.0.8\n    ports:\n      - 21:21\n      - 21100-21110:21100-21110\n    volumes:\n      - /Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd\n      - /Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd\n    privileged: true\n    #restart: always\n    networks:\n      - nt_dev\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n![image-20250425174252871](../../typora-user-images/image-20250425174252871.png)\n\n### \n\n1.  Spring AI Spring AI  AI \n2.  Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2\n3.  Redis  Redis  Redis  MySQL  Redis + MySQL \n4.  ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 \n5. Tool Calling Tool Calling \n   *  1 RAG \n   *  2\n   *  3\n\n\n\n Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  \n\n\n\n## \n\n**Maven **\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.3</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <spring-boot.version>3.4.3</spring-boot.version>\n        <spring-ai.version>1.0.0-M6</spring-ai.version>\n        <alibaba.ai.version>1.0.0-M6.1</alibaba.ai.version>\n        <spring.ai.ollama.version>1.0.0-M6</spring.ai.ollama.version>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>${alibaba.ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-elasticsearch-store-spring-boot-starter</artifactId>\n            <version>${spring-ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n            <version>${spring-boot.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <repositories>\n        <repository>\n            <id>alimaven</id>\n            <name>aliyun maven</name>\n            <url>https://maven.aliyun.com/repository/public</url>\n        </repository>\n        <repository>\n            <id>spring-milestones</id>\n            <name>Spring Milestones</name>\n            <url>https://repo.spring.io/milestone</url>\n            <snapshots>\n                <enabled>false</enabled>\n            </snapshots>\n        </repository>\n        <repository>\n            <id>spring-snapshots</id>\n            <name>Spring Snapshots</name>\n            <url>https://repo.spring.io/snapshot</url>\n            <releases>\n                <enabled>false</enabled>\n            </releases>\n        </repository>\n    </repositories>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                            <version>1.18.36</version>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n~~~\n\nSpring BootSpring AIAlibaba Cloud AIMaven\n\n** `application.yml`**\n\n `model: deepseek-r1`, `model: text-embedding-v2`\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      elasticsearch:\n        initialize-schema: true\n        index-name: spring-ai-tag\n        # 1536\n        dimensions: 1536\n        similarity: cosine\n        batching-strategy: TOKEN_COUNT\n\n\n~~~\n\nRedisElasticsearchAI \n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n       @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                // \n                .defaultSystem(\"\")\n                // \n                .defaultAdvisors(\n                        new QuestionAnswerAdvisor(\n                                vectorStore,\n                                SearchRequest.builder()\n                                        .similarityThreshold(0.1) // \n                                        .topK(10) //  10 \n                                        .build()\n                        )\n                )\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n\n\n**DeepseekChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.Message;\nimport org.springframework.ai.document.Document;\nimport org.springframework.ai.document.DocumentReader;\nimport org.springframework.ai.rag.Query;\nimport org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;\nimport org.springframework.ai.reader.TextReader;\nimport org.springframework.ai.vectorstore.SearchRequest;\nimport org.springframework.ai.vectorstore.VectorStore;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @ClassName DeepseekChatController  //\n * @Description:\n * @Author: 200900681 \n * @CreateDate: 2025/4/25\n * @Version: 1.0    //\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class DeepseekChatController {\n\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private VectorStore vectorStore;\n    @Autowired\n    private ChatMemory chatMemory;\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(\"/data/load\")\n    public String loadData() throws IOException {\n        // 1. \n        DocumentReader reader = new TextReader(\"static/hospitalInfo.txt\");\n        List<Document> documents = reader.get();\n\n        // 2.\n        List<Document> splitDocuments =  new ArrayList<>();\n        for (Document document : documents) {\n            // \n            String content = document.getText();\n            // \n            String[] parts = content.split(\"\\\\n\\\\s*\\\\n\");\n            //  Document \n            for (String part : parts) {\n                splitDocuments.add(new Document(part.trim()));\n            }\n        }\n\n        log.info(\" [{}]\", splitDocuments.size());\n\n        // 3.\n        vectorStore.add(splitDocuments);\n\n        return \"success\";\n    }\n\n    @GetMapping(\"/select\")\n    public String search(@RequestParam(\"query\") String query) {\n        log.info(\"query is  [{}]\", query);\n        List<Document> results = vectorStore.similaritySearch(\n//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n\n        );\n        log.info(\"results is [{}]\", results);\n        return results.toString();\n    }\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/rewrite/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByRewrite(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1\n        QueryTransformer queryTransformer = RewriteQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n        // 2\n        Query queryByTransform = queryTransformer.transform(new Query(inputMsg));\n        // 3\n        return queryByTransform.text();\n    }\n\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/history/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByHistory(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1. \n        List<Message> history = chatMemory.get(userId, CHAT_HISTORY_SIZE);\n        // 2. \n        Query query = Query.builder()\n                .text(inputMsg)\n                .history(history)\n                .build();\n\n        // 3.  CompressionQueryTransformer\n        CompressionQueryTransformer queryTransformerByHis = CompressionQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n\n        // 4\n        Query queryByHistory = queryTransformerByHis.transform(query);\n\n        // 5\n        return queryByHistory.text();\n    }\n    \n}\n\n~~~\n\n\n\n\n\n\n\n\n\n****\n\nkimi\n\n- ``\n- 3 ``,``,``\n- 20\n\n~~~\n1. \n2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM\n2. \n(1):\n\n(2):\n\n(3):\n\n\n3. \n(1) \n \n 19853\n \n \n \n \n\n(2) \n \n 19907\n \n \n \n \n\n(3) \n \n 198211\n \n \n \n \n\n(4) \n \n 19884\n \n \n \n \n\n(5) \n \n 19809\n \n \n \n \n\n(6) \n \n 19931\n \n \n \n \n\n(7) \n \n 19875\n \n \n \n \n\n(8) \n \n 19918\n \n \n \n \n\n(9) \n \n 197912\n \n \n \n \n\n(10) \n \n 19862\n \n \n \n \n\n(11) \n \n 19837\n \n \n \n \n\n(12) \n \n 19924\n \n \n \n \n\n(13) \n \n 198110\n \n \n \n \n\n(14) \n \n 19896\n \n \n \n \n\n(15) \n \n 198411\n \n \n \n \n\n(16) \n \n 19903\n \n \n \n \n\n(17) \n \n 19889\n \n \n \n \n\n(18) \n \n 19941\n \n \n \n \n\n(19) \n \n 19858\n \n \n \n \n\n(20) \n \n 19915\n \n \n \n \n~~~\n\n\n\n\n\n## \n\n\n\n~~~\n\nhttp://127.0.0.1:8080/ai/v1/data/load\n\nhttp://127.0.0.1:8080/ai/v1/select\n\nhttp://127.0.0.1:8080/ai/v1/rag/chat\n~~~\n\n\n\n****\n\n>\n>http://127.0.0.1:8080/ai/v1/data/load\n\n\n\n![image-20250429172724826](../../typora-user-images/image-20250429172724826.png)\n\n![image-20250429180401580](../../typora-user-images/image-20250429180401580.png)\n\n>\n>http://127.0.0.1:8080/ai/v1/select?query=\n\n![image-20250429174959408](../../typora-user-images/image-20250429174959408.png)\n\nelasticsearch deepseek\n\nRAG+\n\n>- \n>- \n>- \n>- \n>- \n\n\n\n![image-20250429174851066](../../typora-user-images/image-20250429174851066.png)\n\n\n\n\n\n![image-20250429175228086](../../typora-user-images/image-20250429175228086.png)\n\n\n\n![image-20250429175342611](../../typora-user-images/image-20250429175342611.png)\n\n\n\n![image-20250429175421998](../../typora-user-images/image-20250429175421998.png)\n\n\n\n\n\n![image-20250429175540574](../../typora-user-images/image-20250429175540574.png)\n\n\n\n\n\n## milvus \n\n\n\n### Milvus\n\n**Docker-compose **\n\n~~~yaml\n#  etcd \n  etcd:\n    container_name: milvus-etcd  # \n    image: quay.io/coreos/etcd:v3.5.16  # \n    environment:\n      - ETCD_AUTO_COMPACTION_MODE=revision  # \n      - ETCD_AUTO_COMPACTION_RETENTION=1000  # \n      - ETCD_QUOTA_BACKEND_BYTES=4294967296  # \n      - ETCD_SNAPSHOT_COUNT=50000  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/etcd:/etcd  # \n    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls=http://0.0.0.0:2379 --data-dir /etcd  # \n    healthcheck:\n      test: [\"CMD\", \"etcdctl\", \"endpoint\", \"health\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n\n  #  MinIO \n  minio:\n    container_name: milvus-minio  # \n    image: minio/minio:RELEASE.2023-03-20T20-16-18Z  # \n    environment:\n      MINIO_ACCESS_KEY: minioadmin  # MinIO \n      MINIO_SECRET_KEY: minioadmin  # MinIO \n    ports:\n      - \"9001:9001\"  # \n      - \"9000:9000\"  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/minio:/minio_data  # \n    command: minio server /minio_data --console-address \":9001\"  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9000/minio/health/live\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.8   \n\n  #  Milvus \n  standalone:\n    container_name: milvus-standalone  # \n    image: milvusdb/milvus:v2.5.4  # \n    command: [\"milvus\", \"run\", \"standalone\"]  # \n    security_opt:\n    - seccomp:unconfined  # \n    environment:\n      ETCD_ENDPOINTS: etcd:2379  # etcd \n      MINIO_ADDRESS: minio:9000  # MinIO \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/milvus:/var/lib/milvus  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9091/healthz\"]  # \n      interval: 30s  # \n      start_period: 90s  # \n      timeout: 20s  # \n      retries: 3  # \n    ports:\n      - \"19530:19530\"  # \n      - \"9091:9091\"  # \n    depends_on:\n      - \"etcd\"  #  etcd \n      - \"minio\"  #  MinIO \n\n  #  Milvus Dashboard \n  dashboard:\n    image: zilliz/attu:v2.5  # \n    container_name: milvus-dashboard  # \n    environment:\n      MILVUS_URL: http://standalone:19530  # Milvus \n    ports:\n      - \"8000:3000\"  # \n    depends_on:\n      - standalone  #  Milvus \n      - etcd  #  etcd \n      - minio  #  MinIO \n\n# \nnetworks:\n  nt_dev:\n      external: true\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n\n\n****  `http://localhost:8000/`\n\n\n\n\n![image-20250429181131778](../../typora-user-images/image-20250429181131778.png)\n\n\n\n![image-20250429181039571](../../typora-user-images/image-20250429181039571.png)\n\n\n\n``milvus`,  `milvus-4321` (spring) `admin`, \n\n\n\n\n\n![image-20250429181312813](../../typora-user-images/image-20250429181312813.png)\n\n\n\n\n\n\n\n~~~xml\n  <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-milvus-store-spring-boot-starter</artifactId>\n </dependency>\n~~~\n\n\n\n\n\n\n\n\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  elasticsearch:\n    uris: http://127.0.0.1:9200\n    username:\n    password:\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      milvus:\n        client:\n          host: \"localhost\"\n          port: 19530\n          username: \"milvus\"\n          password: \"milvus-4321\"\n        databaseName: \"default\"\n        collectionName: \"vector_store\"\n        embeddingDimension: 1536\n        indexType: IVF_FLAT\n        metricType: COSINE\n        initialize-schema: true\n\n\n\n\n~~~\n\nRedisMilvusAI\n\n\n\n\n\n![image-20250429183142516](../../typora-user-images/image-20250429183142516.png)\n","source":"_posts/Spring AI Alibaba/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .md","raw":"---\ntitle: Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES/Milvus + RAG \n---\n\n# Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES/Milvus + RAG \n\n\n\n[]AIAPI**Spring AI**Spring[AI]AI\n\n[toc]\n\n\n\n\n\n## Spring AI  Function CallingTool Calling  Agent \n\n### Spring AI \n\n#### Spring AI\n\nSpring AI\n\n* 20245301.0.0 Milestone 1API\n* 20248231.0.0 Milestone 2\n* 20241081.0.0 Milestone 3AI\n* 202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon\n* 20252141.0.0 Milestone 6\n\n\n\n#### Spring AI\n\nSpring AIAI\n\n* LLM\n* AI\n* \n* \n* \n\n### **Function Calling**\n\n#### \n\nAIAPIAI\n\n#### \n\nSpring AI\n\n**1**`Function`Java\n\n~~~java\n@Component\npublic class WeatherFunction implements Function<WeatherFunction.WeatherRequest, String> {\n    @Override\n    public String apply(WeatherRequest request) {\n        return \"The weather in \" + request.getCity() + \" is sunny.\";\n    }\n    public static class WeatherRequest {\n        private String city;\n        public String getCity() { return city; }\n        public void setCity(String city) { this.city = city; }\n    }\n}\n\n~~~\n\n**2**Spring BeanSpring AI\n\n~~~java\n@Configuration\npublic class FunctionConfig {\n    @Bean\n    @Description(\"\")\n    public Function<WeatherFunction.WeatherRequest, String> weatherFunction() {\n        return new WeatherFunction();\n    }\n}\n~~~\n\n**3**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withFunction(\"weatherFunction\").build())\n                .build();\n    }\n}\n~~~\n\n**4**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        WeatherFunction.WeatherRequest request = new WeatherFunction.WeatherRequest();\n        request.setCity(input);\n        String response = chatClient.prompt().user(input).functions(\"weatherFunction\").call().content();\n        return response;\n    }\n}\n~~~\n\n****Spring AI****Tool Calling\n\n### **Tool Calling**\n\n#### ****\n\nAI\n\n#### \n\n\n\n**1**\n\n~~~java\npublic interface WeatherTool {\n    String getWeather(String city);\n}\n~~~\n\n**2**\n\n~~~java\n@Component\npublic class WeatherToolImpl implements WeatherTool {\n    @Override\n    public String getWeather(String city) {\n        return \"The weather in \" + city + \" is sunny.\";\n    }\n}\n~~~\n\n**3Spring Bean**Spring BeanSpring\n\n~~~java\n@Configuration\npublic class ToolConfig {\n    @Bean\n    public WeatherTool weatherTool() {\n        return new WeatherToolImpl();\n    }\n}\n~~~\n\n**4**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withTool(\"weatherTool\").build())\n                .build();\n    }\n}\n\n~~~\n\n**5**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        String response = chatClient.prompt().user(input).tools(\"weatherTool\").call().content();\n        return response;\n    }\n}\n\n~~~\n\n### Agent\n\n#### \n\nAgent\n\n#### \n\n\n\nMCPLLMMCP\n\nSpring AIAI\nSpring AI\n\n### FunctionCallbacToolCallback\n\nSpring AIFunction CallbackDeprecatedTool CallbackAI\n\n**FunctionCallbackToolCallback**\n\nSpring AIFunctionCallbackToolCallback\n\n* ToolCallbackFunctionCallback\n* ToolCallback\n* FunctionCallbackSpring AIToolCallback\n\n\n\nSpring AIFunctionCallbackToolCallback\n\n\n\n## Spring AI + DeepSeek-R1 + ES/Milvus + RAG + Tool Calling\n\n### \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n\n\n![image-20250425104935964](../../typora-user-images/image-20250425104935964-5549379.png)\n\n\n\n**Elasticsearch**\n\n\n\n~~~yaml\n# base \nversion: '3.8'\nservices:\n\telasticsearch1:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.13.4\n    hostname: \"elasticsearch1\"\n    environment:\n      - TZ=Asia/Shanghai\n      - \"ES_JAVA_OPTS=-Xms84m -Xmx512m\"\n    ports:\n      - 9200:9200\n      - 9300:9300\n    volumes:\n      - /Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data \n      - /Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins \n      - /Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config  \n      - /Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs  \n    privileged: true\n    #restart: always\n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.7\n\n  vsftpd:\n    image: \"fauria/vsftpd\"\n    hostname: \"rabbitmq1\"\n    environment:\n      - FTP_USER=admin \n      - FTP_PASS=123456 \n      - PASV_MIN_PORT=21100\n      - PASV_MAX_PORT=21110 \n      - PASV_ADDRESS=172.18.0.8\n    ports:\n      - 21:21\n      - 21100-21110:21100-21110\n    volumes:\n      - /Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd\n      - /Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd\n    privileged: true\n    #restart: always\n    networks:\n      - nt_dev\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n![image-20250425174252871](../../typora-user-images/image-20250425174252871.png)\n\n### \n\n1.  Spring AI Spring AI  AI \n2.  Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2\n3.  Redis  Redis  Redis  MySQL  Redis + MySQL \n4.  ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 \n5. Tool Calling Tool Calling \n   *  1 RAG \n   *  2\n   *  3\n\n\n\n Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  \n\n\n\n## \n\n**Maven **\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.3</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <spring-boot.version>3.4.3</spring-boot.version>\n        <spring-ai.version>1.0.0-M6</spring-ai.version>\n        <alibaba.ai.version>1.0.0-M6.1</alibaba.ai.version>\n        <spring.ai.ollama.version>1.0.0-M6</spring.ai.ollama.version>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>${alibaba.ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-elasticsearch-store-spring-boot-starter</artifactId>\n            <version>${spring-ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n            <version>${spring-boot.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <repositories>\n        <repository>\n            <id>alimaven</id>\n            <name>aliyun maven</name>\n            <url>https://maven.aliyun.com/repository/public</url>\n        </repository>\n        <repository>\n            <id>spring-milestones</id>\n            <name>Spring Milestones</name>\n            <url>https://repo.spring.io/milestone</url>\n            <snapshots>\n                <enabled>false</enabled>\n            </snapshots>\n        </repository>\n        <repository>\n            <id>spring-snapshots</id>\n            <name>Spring Snapshots</name>\n            <url>https://repo.spring.io/snapshot</url>\n            <releases>\n                <enabled>false</enabled>\n            </releases>\n        </repository>\n    </repositories>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                            <version>1.18.36</version>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n~~~\n\nSpring BootSpring AIAlibaba Cloud AIMaven\n\n** `application.yml`**\n\n `model: deepseek-r1`, `model: text-embedding-v2`\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      elasticsearch:\n        initialize-schema: true\n        index-name: spring-ai-tag\n        # 1536\n        dimensions: 1536\n        similarity: cosine\n        batching-strategy: TOKEN_COUNT\n\n\n~~~\n\nRedisElasticsearchAI \n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n       @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                // \n                .defaultSystem(\"\")\n                // \n                .defaultAdvisors(\n                        new QuestionAnswerAdvisor(\n                                vectorStore,\n                                SearchRequest.builder()\n                                        .similarityThreshold(0.1) // \n                                        .topK(10) //  10 \n                                        .build()\n                        )\n                )\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n\n\n**DeepseekChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.Message;\nimport org.springframework.ai.document.Document;\nimport org.springframework.ai.document.DocumentReader;\nimport org.springframework.ai.rag.Query;\nimport org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;\nimport org.springframework.ai.reader.TextReader;\nimport org.springframework.ai.vectorstore.SearchRequest;\nimport org.springframework.ai.vectorstore.VectorStore;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @ClassName DeepseekChatController  //\n * @Description:\n * @Author: 200900681 \n * @CreateDate: 2025/4/25\n * @Version: 1.0    //\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class DeepseekChatController {\n\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private VectorStore vectorStore;\n    @Autowired\n    private ChatMemory chatMemory;\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(\"/data/load\")\n    public String loadData() throws IOException {\n        // 1. \n        DocumentReader reader = new TextReader(\"static/hospitalInfo.txt\");\n        List<Document> documents = reader.get();\n\n        // 2.\n        List<Document> splitDocuments =  new ArrayList<>();\n        for (Document document : documents) {\n            // \n            String content = document.getText();\n            // \n            String[] parts = content.split(\"\\\\n\\\\s*\\\\n\");\n            //  Document \n            for (String part : parts) {\n                splitDocuments.add(new Document(part.trim()));\n            }\n        }\n\n        log.info(\" [{}]\", splitDocuments.size());\n\n        // 3.\n        vectorStore.add(splitDocuments);\n\n        return \"success\";\n    }\n\n    @GetMapping(\"/select\")\n    public String search(@RequestParam(\"query\") String query) {\n        log.info(\"query is  [{}]\", query);\n        List<Document> results = vectorStore.similaritySearch(\n//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n\n        );\n        log.info(\"results is [{}]\", results);\n        return results.toString();\n    }\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/rewrite/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByRewrite(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1\n        QueryTransformer queryTransformer = RewriteQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n        // 2\n        Query queryByTransform = queryTransformer.transform(new Query(inputMsg));\n        // 3\n        return queryByTransform.text();\n    }\n\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/history/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByHistory(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1. \n        List<Message> history = chatMemory.get(userId, CHAT_HISTORY_SIZE);\n        // 2. \n        Query query = Query.builder()\n                .text(inputMsg)\n                .history(history)\n                .build();\n\n        // 3.  CompressionQueryTransformer\n        CompressionQueryTransformer queryTransformerByHis = CompressionQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n\n        // 4\n        Query queryByHistory = queryTransformerByHis.transform(query);\n\n        // 5\n        return queryByHistory.text();\n    }\n    \n}\n\n~~~\n\n\n\n\n\n\n\n\n\n****\n\nkimi\n\n- ``\n- 3 ``,``,``\n- 20\n\n~~~\n1. \n2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM\n2. \n(1):\n\n(2):\n\n(3):\n\n\n3. \n(1) \n \n 19853\n \n \n \n \n\n(2) \n \n 19907\n \n \n \n \n\n(3) \n \n 198211\n \n \n \n \n\n(4) \n \n 19884\n \n \n \n \n\n(5) \n \n 19809\n \n \n \n \n\n(6) \n \n 19931\n \n \n \n \n\n(7) \n \n 19875\n \n \n \n \n\n(8) \n \n 19918\n \n \n \n \n\n(9) \n \n 197912\n \n \n \n \n\n(10) \n \n 19862\n \n \n \n \n\n(11) \n \n 19837\n \n \n \n \n\n(12) \n \n 19924\n \n \n \n \n\n(13) \n \n 198110\n \n \n \n \n\n(14) \n \n 19896\n \n \n \n \n\n(15) \n \n 198411\n \n \n \n \n\n(16) \n \n 19903\n \n \n \n \n\n(17) \n \n 19889\n \n \n \n \n\n(18) \n \n 19941\n \n \n \n \n\n(19) \n \n 19858\n \n \n \n \n\n(20) \n \n 19915\n \n \n \n \n~~~\n\n\n\n\n\n## \n\n\n\n~~~\n\nhttp://127.0.0.1:8080/ai/v1/data/load\n\nhttp://127.0.0.1:8080/ai/v1/select\n\nhttp://127.0.0.1:8080/ai/v1/rag/chat\n~~~\n\n\n\n****\n\n>\n>http://127.0.0.1:8080/ai/v1/data/load\n\n\n\n![image-20250429172724826](../../typora-user-images/image-20250429172724826.png)\n\n![image-20250429180401580](../../typora-user-images/image-20250429180401580.png)\n\n>\n>http://127.0.0.1:8080/ai/v1/select?query=\n\n![image-20250429174959408](../../typora-user-images/image-20250429174959408.png)\n\nelasticsearch deepseek\n\nRAG+\n\n>- \n>- \n>- \n>- \n>- \n\n\n\n![image-20250429174851066](../../typora-user-images/image-20250429174851066.png)\n\n\n\n\n\n![image-20250429175228086](../../typora-user-images/image-20250429175228086.png)\n\n\n\n![image-20250429175342611](../../typora-user-images/image-20250429175342611.png)\n\n\n\n![image-20250429175421998](../../typora-user-images/image-20250429175421998.png)\n\n\n\n\n\n![image-20250429175540574](../../typora-user-images/image-20250429175540574.png)\n\n\n\n\n\n## milvus \n\n\n\n### Milvus\n\n**Docker-compose **\n\n~~~yaml\n#  etcd \n  etcd:\n    container_name: milvus-etcd  # \n    image: quay.io/coreos/etcd:v3.5.16  # \n    environment:\n      - ETCD_AUTO_COMPACTION_MODE=revision  # \n      - ETCD_AUTO_COMPACTION_RETENTION=1000  # \n      - ETCD_QUOTA_BACKEND_BYTES=4294967296  # \n      - ETCD_SNAPSHOT_COUNT=50000  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/etcd:/etcd  # \n    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls=http://0.0.0.0:2379 --data-dir /etcd  # \n    healthcheck:\n      test: [\"CMD\", \"etcdctl\", \"endpoint\", \"health\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n\n  #  MinIO \n  minio:\n    container_name: milvus-minio  # \n    image: minio/minio:RELEASE.2023-03-20T20-16-18Z  # \n    environment:\n      MINIO_ACCESS_KEY: minioadmin  # MinIO \n      MINIO_SECRET_KEY: minioadmin  # MinIO \n    ports:\n      - \"9001:9001\"  # \n      - \"9000:9000\"  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/minio:/minio_data  # \n    command: minio server /minio_data --console-address \":9001\"  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9000/minio/health/live\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.8   \n\n  #  Milvus \n  standalone:\n    container_name: milvus-standalone  # \n    image: milvusdb/milvus:v2.5.4  # \n    command: [\"milvus\", \"run\", \"standalone\"]  # \n    security_opt:\n    - seccomp:unconfined  # \n    environment:\n      ETCD_ENDPOINTS: etcd:2379  # etcd \n      MINIO_ADDRESS: minio:9000  # MinIO \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/milvus:/var/lib/milvus  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9091/healthz\"]  # \n      interval: 30s  # \n      start_period: 90s  # \n      timeout: 20s  # \n      retries: 3  # \n    ports:\n      - \"19530:19530\"  # \n      - \"9091:9091\"  # \n    depends_on:\n      - \"etcd\"  #  etcd \n      - \"minio\"  #  MinIO \n\n  #  Milvus Dashboard \n  dashboard:\n    image: zilliz/attu:v2.5  # \n    container_name: milvus-dashboard  # \n    environment:\n      MILVUS_URL: http://standalone:19530  # Milvus \n    ports:\n      - \"8000:3000\"  # \n    depends_on:\n      - standalone  #  Milvus \n      - etcd  #  etcd \n      - minio  #  MinIO \n\n# \nnetworks:\n  nt_dev:\n      external: true\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n\n\n****  `http://localhost:8000/`\n\n\n\n\n![image-20250429181131778](../../typora-user-images/image-20250429181131778.png)\n\n\n\n![image-20250429181039571](../../typora-user-images/image-20250429181039571.png)\n\n\n\n``milvus`,  `milvus-4321` (spring) `admin`, \n\n\n\n\n\n![image-20250429181312813](../../typora-user-images/image-20250429181312813.png)\n\n\n\n\n\n\n\n~~~xml\n  <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-milvus-store-spring-boot-starter</artifactId>\n </dependency>\n~~~\n\n\n\n\n\n\n\n\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  elasticsearch:\n    uris: http://127.0.0.1:9200\n    username:\n    password:\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      milvus:\n        client:\n          host: \"localhost\"\n          port: 19530\n          username: \"milvus\"\n          password: \"milvus-4321\"\n        databaseName: \"default\"\n        collectionName: \"vector_store\"\n        embeddingDimension: 1536\n        indexType: IVF_FLAT\n        metricType: COSINE\n        initialize-schema: true\n\n\n\n\n~~~\n\nRedisMilvusAI\n\n\n\n\n\n![image-20250429183142516](../../typora-user-images/image-20250429183142516.png)\n","slug":"Spring AI Alibaba/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG ","published":1,"date":"2025-04-24T04:08:24.860Z","updated":"2025-06-04T10:49:56.759Z","_id":"cmbhtdwzu000do6fyb22kb21b","comments":1,"layout":"post","photos":[],"content":"<h1 id=\"Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\"><a href=\"#Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\" class=\"headerlink\" title=\"Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG \"></a>Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG </h1><p>[]AIAPI<strong>Spring AI</strong>Spring[AI]AI</p>\n<p>[toc]</p>\n<h2 id=\"Spring-AI--Function-CallingTool-Calling--Agent-\"><a href=\"#Spring-AI--Function-CallingTool-Calling--Agent-\" class=\"headerlink\" title=\"Spring AI  Function CallingTool Calling  Agent \"></a>Spring AI  Function CallingTool Calling  Agent </h2><h3 id=\"Spring-AI-\"><a href=\"#Spring-AI-\" class=\"headerlink\" title=\"Spring AI \"></a>Spring AI </h3><h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AI</p>\n<ul>\n<li>20245301.0.0 Milestone 1API</li>\n<li>20248231.0.0 Milestone 2</li>\n<li>20241081.0.0 Milestone 3AI</li>\n<li>202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon</li>\n<li>20252141.0.0 Milestone 6</li>\n</ul>\n<h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AIAI</p>\n<ul>\n<li>LLM</li>\n<li>AI</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a><strong>Function Calling</strong></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>AIAPIAI</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Spring AI</p>\n<p><strong>1</strong><code>Function</code>Java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherFunction</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Function</span>&lt;WeatherFunction.WeatherRequest, String&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">apply</span><span class=\"params\">(WeatherRequest request)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + request.getCity() + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherRequest</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String city;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getCity</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> city; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setCity</span><span class=\"params\">(String city)</span> &#123; <span class=\"built_in\">this</span>.city = city; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong>Spring BeanSpring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FunctionConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Function&lt;WeatherFunction.WeatherRequest, String&gt; weatherFunction() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withFunction(<span class=\"string\">&quot;weatherFunction&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        WeatherFunction.<span class=\"type\">WeatherRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>.WeatherRequest();</span><br><span class=\"line\">        request.setCity(input);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).functions(<span class=\"string\">&quot;weatherFunction&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong>Spring AI<strong></strong>Tool Calling</p>\n<h3 id=\"Tool-Calling\"><a href=\"#Tool-Calling\" class=\"headerlink\" title=\"Tool Calling\"></a><strong>Tool Calling</strong></h3><h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p>AI</p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p><strong>1</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherToolImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + city + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3Spring Bean</strong>Spring BeanSpring</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ToolConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> WeatherTool <span class=\"title function_\">weatherTool</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherToolImpl</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withTool(<span class=\"string\">&quot;weatherTool&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>5</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).tools(<span class=\"string\">&quot;weatherTool&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Agent\"><a href=\"#Agent\" class=\"headerlink\" title=\"Agent\"></a>Agent</h3><h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p>Agent</p>\n<h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p>MCPLLMMCP<br><br>Spring AIAI<br>Spring AI</p>\n<h3 id=\"FunctionCallbacToolCallback\"><a href=\"#FunctionCallbacToolCallback\" class=\"headerlink\" title=\"FunctionCallbacToolCallback\"></a>FunctionCallbacToolCallback</h3><p>Spring AIFunction CallbackDeprecatedTool CallbackAI</p>\n<p><strong>FunctionCallbackToolCallback</strong></p>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<ul>\n<li>ToolCallbackFunctionCallback</li>\n<li>ToolCallback</li>\n<li>FunctionCallbackSpring AIToolCallback</li>\n</ul>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<h2 id=\"Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\"><a href=\"#Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\" class=\"headerlink\" title=\"Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling\"></a>Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p><img src=\"/../../typora-user-images/image-20250425104935964-5549379.png\" alt=\"image-20250425104935964\"></p>\n<p><strong>Elasticsearch</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># base </span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">\t<span class=\"attr\">elasticsearch1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/elasticsearch/elasticsearch:8.13.4</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;elasticsearch1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;ES_JAVA_OPTS=-Xms84m -Xmx512m&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9200</span><span class=\"string\">:9200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9300</span><span class=\"string\">:9300</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config</span>  </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs</span>  </span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.7</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">vsftpd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">&quot;fauria/vsftpd&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;rabbitmq1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_USER=admin</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_PASS=123456</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MIN_PORT=21100</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MAX_PORT=21110</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_ADDRESS=172.18.0.8</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21</span><span class=\"string\">:21</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21100</span><span class=\"number\">-21110</span><span class=\"string\">:21100-21110</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nt_dev</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../../typora-user-images/image-20250425174252871.png\" alt=\"image-20250425174252871\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> Spring AI Spring AI  AI </li>\n<li> Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2</li>\n<li> Redis  Redis  Redis  MySQL  Redis + MySQL </li>\n<li> ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 </li>\n<li>Tool Calling Tool Calling <ul>\n<li> 1 RAG </li>\n<li> 2</li>\n<li> 3</li>\n</ul>\n</li>\n</ol>\n<p> Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>Maven </strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-boot.version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">spring-boot.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-ai.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring-ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">alibaba.ai.version</span>&gt;</span>1.0.0-M6.1<span class=\"tag\">&lt;/<span class=\"name\">alibaba.ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.ai.ollama.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring.ai.ollama.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;alibaba.ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-elasticsearch-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Snapshots<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.18.36<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>Spring BootSpring AIAlibaba Cloud AIMaven</p>\n<p><strong> <code>application.yml</code></strong></p>\n<p> <code>model: deepseek-r1</code>, <code>model: text-embedding-v2</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">index-name:</span> <span class=\"string\">spring-ai-tag</span></span><br><span class=\"line\">        <span class=\"comment\"># 1536</span></span><br><span class=\"line\">        <span class=\"attr\">dimensions:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">similarity:</span> <span class=\"string\">cosine</span></span><br><span class=\"line\">        <span class=\"attr\">batching-strategy:</span> <span class=\"string\">TOKEN_COUNT</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisElasticsearchAI </p>\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultSystem(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">QuestionAnswerAdvisor</span>(</span><br><span class=\"line\">                                vectorStore,</span><br><span class=\"line\">                                SearchRequest.builder()</span><br><span class=\"line\">                                        .similarityThreshold(<span class=\"number\">0.1</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">                                        .topK(<span class=\"number\">10</span>) <span class=\"comment\">//  10 </span></span><br><span class=\"line\">                                        .build()</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>DeepseekChatController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.DocumentReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.Query;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.reader.TextReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.SearchRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.VectorStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@ClassName</span> DeepseekChatController  //</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span>: 200900681 </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@CreateDate</span>: 2025/4/25</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Version</span>: 1.0    //</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DeepseekChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> VectorStore vectorStore;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/data/load&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">loadData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        <span class=\"type\">DocumentReader</span> <span class=\"variable\">reader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TextReader</span>(<span class=\"string\">&quot;static/hospitalInfo.txt&quot;</span>);</span><br><span class=\"line\">        List&lt;Document&gt; documents = reader.get();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.</span></span><br><span class=\"line\">        List&lt;Document&gt; splitDocuments =  <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Document document : documents) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">content</span> <span class=\"operator\">=</span> document.getText();</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            String[] parts = content.split(<span class=\"string\">&quot;\\\\n\\\\s*\\\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//  Document </span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (String part : parts) &#123;</span><br><span class=\"line\">                splitDocuments.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>(part.trim()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot; [&#123;&#125;]&quot;</span>, splitDocuments.size());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.</span></span><br><span class=\"line\">        vectorStore.add(splitDocuments);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;success&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/select&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">search</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;query&quot;)</span> String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query is  [&#123;&#125;]&quot;</span>, query);</span><br><span class=\"line\">        List&lt;Document&gt; results = vectorStore.similaritySearch(</span><br><span class=\"line\"><span class=\"comment\">//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()</span></span><br><span class=\"line\">                SearchRequest.builder().query(query).similarityThreshold(<span class=\"number\">0.1</span>).topK(<span class=\"number\">10</span>).build()</span><br><span class=\"line\"></span><br><span class=\"line\">        );</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;results is [&#123;&#125;]&quot;</span>, results);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> results.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/rewrite/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByRewrite</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1</span></span><br><span class=\"line\">        <span class=\"type\">QueryTransformer</span> <span class=\"variable\">queryTransformer</span> <span class=\"operator\">=</span> RewriteQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"comment\">// 2</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByTransform</span> <span class=\"operator\">=</span> queryTransformer.transform(<span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(inputMsg));</span><br><span class=\"line\">        <span class=\"comment\">// 3</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByTransform.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/history/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByHistory</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        List&lt;Message&gt; history = chatMemory.get(userId, CHAT_HISTORY_SIZE);</span><br><span class=\"line\">        <span class=\"comment\">// 2. </span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> Query.builder()</span><br><span class=\"line\">                .text(inputMsg)</span><br><span class=\"line\">                .history(history)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.  CompressionQueryTransformer</span></span><br><span class=\"line\">        <span class=\"type\">CompressionQueryTransformer</span> <span class=\"variable\">queryTransformerByHis</span> <span class=\"operator\">=</span> CompressionQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByHistory</span> <span class=\"operator\">=</span> queryTransformerByHis.transform(query);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByHistory.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<p><strong></strong></p>\n<p>kimi</p>\n<ul>\n<li><code></code></li>\n<li>3 <code></code>,<code></code>,<code></code></li>\n<li>20</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. </span><br><span class=\"line\">2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM</span><br><span class=\"line\">2. </span><br><span class=\"line\">(1):</span><br><span class=\"line\"></span><br><span class=\"line\">(2):</span><br><span class=\"line\"></span><br><span class=\"line\">(3):</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">3. </span><br><span class=\"line\">(1) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19853</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(2) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19907</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(3) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198211</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(4) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19884</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(5) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19809</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(6) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19931</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(7) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19875</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(8) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19918</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(9) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 197912</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(10) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19862</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(11) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19837</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(12) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19924</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(13) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198110</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(14) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19896</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(15) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198411</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(16) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19903</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(17) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19889</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(18) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19941</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(19) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19858</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(20) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19915</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/data/load</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/select</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/rag/chat</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/data/load\">http://127.0.0.1:8080/ai/v1/data/load</a></p>\n</blockquote>\n<p><img src=\"/../../typora-user-images/image-20250429172724826.png\" alt=\"image-20250429172724826\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429180401580.png\" alt=\"image-20250429180401580\"></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/select?query=%E5%8C%BB%E9%99%A2%E4%BB%8B%E7%BB%8D\">http://127.0.0.1:8080/ai/v1/select?query=</a></p>\n</blockquote>\n<p><img src=\"/../../typora-user-images/image-20250429174959408.png\" alt=\"image-20250429174959408\"></p>\n<p>elasticsearch deepseek</p>\n<p>RAG+</p>\n<blockquote>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<p><img src=\"/../../typora-user-images/image-20250429174851066.png\" alt=\"image-20250429174851066\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429175228086.png\" alt=\"image-20250429175228086\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429175342611.png\" alt=\"image-20250429175342611\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429175421998.png\" alt=\"image-20250429175421998\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429175540574.png\" alt=\"image-20250429175540574\"></p>\n<h2 id=\"milvus-\"><a href=\"#milvus-\" class=\"headerlink\" title=\"milvus \"></a>milvus </h2><h3 id=\"Milvus\"><a href=\"#Milvus\" class=\"headerlink\" title=\"Milvus\"></a>Milvus</h3><p><strong>Docker-compose </strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  etcd </span></span><br><span class=\"line\">  <span class=\"attr\">etcd:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">quay.io/coreos/etcd:v3.5.16</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_MODE=revision</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_RETENTION=1000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_QUOTA_BACKEND_BYTES=4294967296</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_SNAPSHOT_COUNT=50000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/etcd:/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">etcd</span> <span class=\"string\">-advertise-client-urls=http://127.0.0.1:2379</span> <span class=\"string\">-listen-client-urls=http://0.0.0.0:2379</span> <span class=\"string\">--data-dir</span> <span class=\"string\">/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;etcdctl&quot;</span>, <span class=\"string\">&quot;endpoint&quot;</span>, <span class=\"string\">&quot;health&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\">  <span class=\"attr\">minio:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-minio</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">minio/minio:RELEASE.2023-03-20T20-16-18Z</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ACCESS_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_SECRET_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9001:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9000:9000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/minio:/minio_data</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">minio</span> <span class=\"string\">server</span> <span class=\"string\">/minio_data</span> <span class=\"string\">--console-address</span> <span class=\"string\">&quot;:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9000/minio/health/live&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.8</span>   </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">  <span class=\"attr\">standalone:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-standalone</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">milvusdb/milvus:v2.5.4</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;milvus&quot;</span>, <span class=\"string\">&quot;run&quot;</span>, <span class=\"string\">&quot;standalone&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">security_opt:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">seccomp:unconfined</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ETCD_ENDPOINTS:</span> <span class=\"string\">etcd:2379</span>  <span class=\"comment\"># etcd </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ADDRESS:</span> <span class=\"string\">minio:9000</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/milvus:/var/lib/milvus</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9091/healthz&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">start_period:</span> <span class=\"string\">90s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;19530:19530&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9091:9091&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;etcd&quot;</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;minio&quot;</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus Dashboard </span></span><br><span class=\"line\">  <span class=\"attr\">dashboard:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zilliz/attu:v2.5</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-dashboard</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MILVUS_URL:</span> <span class=\"string\">http://standalone:19530</span>  <span class=\"comment\"># Milvus </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;8000:3000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">standalone</span>  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">etcd</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">minio</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">      <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong>  <code>http://localhost:8000/</code><br></p>\n<p><img src=\"/../../typora-user-images/image-20250429181131778.png\" alt=\"image-20250429181131778\"></p>\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250429181039571.png\" alt=\"image-20250429181039571\"></p>\n<p>&#96;&#96;milvus<code>,  </code>milvus-4321<code>(spring)</code>admin&#96;, </p>\n<p><img src=\"/../../typora-user-images/image-20250429181312813.png\" alt=\"image-20250429181312813\"></p>\n<p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-milvus-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">    <span class=\"attr\">uris:</span> <span class=\"string\">http://127.0.0.1:9200</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">milvus:</span></span><br><span class=\"line\">        <span class=\"attr\">client:</span></span><br><span class=\"line\">          <span class=\"attr\">host:</span> <span class=\"string\">&quot;localhost&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">port:</span> <span class=\"number\">19530</span></span><br><span class=\"line\">          <span class=\"attr\">username:</span> <span class=\"string\">&quot;milvus&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"string\">&quot;milvus-4321&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">databaseName:</span> <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">collectionName:</span> <span class=\"string\">&quot;vector_store&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">embeddingDimension:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">indexType:</span> <span class=\"string\">IVF_FLAT</span></span><br><span class=\"line\">        <span class=\"attr\">metricType:</span> <span class=\"string\">COSINE</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisMilvusAI</p>\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250429183142516.png\" alt=\"image-20250429183142516\"></p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\"><a href=\"#Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\" class=\"headerlink\" title=\"Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG \"></a>Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG </h1><p>[]AIAPI<strong>Spring AI</strong>Spring[AI]AI</p>\n<p>[toc]</p>\n<h2 id=\"Spring-AI--Function-CallingTool-Calling--Agent-\"><a href=\"#Spring-AI--Function-CallingTool-Calling--Agent-\" class=\"headerlink\" title=\"Spring AI  Function CallingTool Calling  Agent \"></a>Spring AI  Function CallingTool Calling  Agent </h2><h3 id=\"Spring-AI-\"><a href=\"#Spring-AI-\" class=\"headerlink\" title=\"Spring AI \"></a>Spring AI </h3><h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AI</p>\n<ul>\n<li>20245301.0.0 Milestone 1API</li>\n<li>20248231.0.0 Milestone 2</li>\n<li>20241081.0.0 Milestone 3AI</li>\n<li>202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon</li>\n<li>20252141.0.0 Milestone 6</li>\n</ul>\n<h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AIAI</p>\n<ul>\n<li>LLM</li>\n<li>AI</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a><strong>Function Calling</strong></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>AIAPIAI</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Spring AI</p>\n<p><strong>1</strong><code>Function</code>Java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherFunction</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Function</span>&lt;WeatherFunction.WeatherRequest, String&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">apply</span><span class=\"params\">(WeatherRequest request)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + request.getCity() + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherRequest</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String city;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getCity</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> city; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setCity</span><span class=\"params\">(String city)</span> &#123; <span class=\"built_in\">this</span>.city = city; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong>Spring BeanSpring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FunctionConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Function&lt;WeatherFunction.WeatherRequest, String&gt; weatherFunction() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withFunction(<span class=\"string\">&quot;weatherFunction&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        WeatherFunction.<span class=\"type\">WeatherRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>.WeatherRequest();</span><br><span class=\"line\">        request.setCity(input);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).functions(<span class=\"string\">&quot;weatherFunction&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong>Spring AI<strong></strong>Tool Calling</p>\n<h3 id=\"Tool-Calling\"><a href=\"#Tool-Calling\" class=\"headerlink\" title=\"Tool Calling\"></a><strong>Tool Calling</strong></h3><h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p>AI</p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p><strong>1</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherToolImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + city + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3Spring Bean</strong>Spring BeanSpring</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ToolConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> WeatherTool <span class=\"title function_\">weatherTool</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherToolImpl</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withTool(<span class=\"string\">&quot;weatherTool&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>5</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).tools(<span class=\"string\">&quot;weatherTool&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Agent\"><a href=\"#Agent\" class=\"headerlink\" title=\"Agent\"></a>Agent</h3><h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p>Agent</p>\n<h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p>MCPLLMMCP<br><br>Spring AIAI<br>Spring AI</p>\n<h3 id=\"FunctionCallbacToolCallback\"><a href=\"#FunctionCallbacToolCallback\" class=\"headerlink\" title=\"FunctionCallbacToolCallback\"></a>FunctionCallbacToolCallback</h3><p>Spring AIFunction CallbackDeprecatedTool CallbackAI</p>\n<p><strong>FunctionCallbackToolCallback</strong></p>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<ul>\n<li>ToolCallbackFunctionCallback</li>\n<li>ToolCallback</li>\n<li>FunctionCallbackSpring AIToolCallback</li>\n</ul>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<h2 id=\"Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\"><a href=\"#Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\" class=\"headerlink\" title=\"Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling\"></a>Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p><img src=\"/../../typora-user-images/image-20250425104935964-5549379.png\" alt=\"image-20250425104935964\"></p>\n<p><strong>Elasticsearch</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># base </span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">\t<span class=\"attr\">elasticsearch1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/elasticsearch/elasticsearch:8.13.4</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;elasticsearch1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;ES_JAVA_OPTS=-Xms84m -Xmx512m&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9200</span><span class=\"string\">:9200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9300</span><span class=\"string\">:9300</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config</span>  </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs</span>  </span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.7</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">vsftpd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">&quot;fauria/vsftpd&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;rabbitmq1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_USER=admin</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_PASS=123456</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MIN_PORT=21100</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MAX_PORT=21110</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_ADDRESS=172.18.0.8</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21</span><span class=\"string\">:21</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21100</span><span class=\"number\">-21110</span><span class=\"string\">:21100-21110</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nt_dev</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/../../typora-user-images/image-20250425174252871.png\" alt=\"image-20250425174252871\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> Spring AI Spring AI  AI </li>\n<li> Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2</li>\n<li> Redis  Redis  Redis  MySQL  Redis + MySQL </li>\n<li> ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 </li>\n<li>Tool Calling Tool Calling <ul>\n<li> 1 RAG </li>\n<li> 2</li>\n<li> 3</li>\n</ul>\n</li>\n</ol>\n<p> Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>Maven </strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-boot.version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">spring-boot.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-ai.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring-ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">alibaba.ai.version</span>&gt;</span>1.0.0-M6.1<span class=\"tag\">&lt;/<span class=\"name\">alibaba.ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.ai.ollama.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring.ai.ollama.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;alibaba.ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-elasticsearch-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Snapshots<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.18.36<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>Spring BootSpring AIAlibaba Cloud AIMaven</p>\n<p><strong> <code>application.yml</code></strong></p>\n<p> <code>model: deepseek-r1</code>, <code>model: text-embedding-v2</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">index-name:</span> <span class=\"string\">spring-ai-tag</span></span><br><span class=\"line\">        <span class=\"comment\"># 1536</span></span><br><span class=\"line\">        <span class=\"attr\">dimensions:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">similarity:</span> <span class=\"string\">cosine</span></span><br><span class=\"line\">        <span class=\"attr\">batching-strategy:</span> <span class=\"string\">TOKEN_COUNT</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisElasticsearchAI </p>\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultSystem(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">QuestionAnswerAdvisor</span>(</span><br><span class=\"line\">                                vectorStore,</span><br><span class=\"line\">                                SearchRequest.builder()</span><br><span class=\"line\">                                        .similarityThreshold(<span class=\"number\">0.1</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">                                        .topK(<span class=\"number\">10</span>) <span class=\"comment\">//  10 </span></span><br><span class=\"line\">                                        .build()</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>DeepseekChatController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.DocumentReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.Query;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.reader.TextReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.SearchRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.VectorStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@ClassName</span> DeepseekChatController  //</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span>: 200900681 </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@CreateDate</span>: 2025/4/25</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Version</span>: 1.0    //</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DeepseekChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> VectorStore vectorStore;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/data/load&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">loadData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        <span class=\"type\">DocumentReader</span> <span class=\"variable\">reader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TextReader</span>(<span class=\"string\">&quot;static/hospitalInfo.txt&quot;</span>);</span><br><span class=\"line\">        List&lt;Document&gt; documents = reader.get();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.</span></span><br><span class=\"line\">        List&lt;Document&gt; splitDocuments =  <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Document document : documents) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">content</span> <span class=\"operator\">=</span> document.getText();</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            String[] parts = content.split(<span class=\"string\">&quot;\\\\n\\\\s*\\\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//  Document </span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (String part : parts) &#123;</span><br><span class=\"line\">                splitDocuments.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>(part.trim()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot; [&#123;&#125;]&quot;</span>, splitDocuments.size());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.</span></span><br><span class=\"line\">        vectorStore.add(splitDocuments);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;success&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/select&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">search</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;query&quot;)</span> String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query is  [&#123;&#125;]&quot;</span>, query);</span><br><span class=\"line\">        List&lt;Document&gt; results = vectorStore.similaritySearch(</span><br><span class=\"line\"><span class=\"comment\">//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()</span></span><br><span class=\"line\">                SearchRequest.builder().query(query).similarityThreshold(<span class=\"number\">0.1</span>).topK(<span class=\"number\">10</span>).build()</span><br><span class=\"line\"></span><br><span class=\"line\">        );</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;results is [&#123;&#125;]&quot;</span>, results);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> results.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/rewrite/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByRewrite</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1</span></span><br><span class=\"line\">        <span class=\"type\">QueryTransformer</span> <span class=\"variable\">queryTransformer</span> <span class=\"operator\">=</span> RewriteQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"comment\">// 2</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByTransform</span> <span class=\"operator\">=</span> queryTransformer.transform(<span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(inputMsg));</span><br><span class=\"line\">        <span class=\"comment\">// 3</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByTransform.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/history/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByHistory</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        List&lt;Message&gt; history = chatMemory.get(userId, CHAT_HISTORY_SIZE);</span><br><span class=\"line\">        <span class=\"comment\">// 2. </span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> Query.builder()</span><br><span class=\"line\">                .text(inputMsg)</span><br><span class=\"line\">                .history(history)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.  CompressionQueryTransformer</span></span><br><span class=\"line\">        <span class=\"type\">CompressionQueryTransformer</span> <span class=\"variable\">queryTransformerByHis</span> <span class=\"operator\">=</span> CompressionQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByHistory</span> <span class=\"operator\">=</span> queryTransformerByHis.transform(query);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByHistory.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<p><strong></strong></p>\n<p>kimi</p>\n<ul>\n<li><code></code></li>\n<li>3 <code></code>,<code></code>,<code></code></li>\n<li>20</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. </span><br><span class=\"line\">2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM</span><br><span class=\"line\">2. </span><br><span class=\"line\">(1):</span><br><span class=\"line\"></span><br><span class=\"line\">(2):</span><br><span class=\"line\"></span><br><span class=\"line\">(3):</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">3. </span><br><span class=\"line\">(1) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19853</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(2) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19907</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(3) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198211</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(4) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19884</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(5) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19809</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(6) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19931</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(7) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19875</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(8) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19918</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(9) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 197912</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(10) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19862</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(11) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19837</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(12) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19924</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(13) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198110</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(14) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19896</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(15) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198411</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(16) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19903</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(17) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19889</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(18) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19941</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(19) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19858</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(20) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19915</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/data/load</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/select</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/rag/chat</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/data/load\">http://127.0.0.1:8080/ai/v1/data/load</a></p>\n</blockquote>\n<p><img src=\"/../../typora-user-images/image-20250429172724826.png\" alt=\"image-20250429172724826\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429180401580.png\" alt=\"image-20250429180401580\"></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/select?query=%E5%8C%BB%E9%99%A2%E4%BB%8B%E7%BB%8D\">http://127.0.0.1:8080/ai/v1/select?query=</a></p>\n</blockquote>\n<p><img src=\"/../../typora-user-images/image-20250429174959408.png\" alt=\"image-20250429174959408\"></p>\n<p>elasticsearch deepseek</p>\n<p>RAG+</p>\n<blockquote>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<p><img src=\"/../../typora-user-images/image-20250429174851066.png\" alt=\"image-20250429174851066\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429175228086.png\" alt=\"image-20250429175228086\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429175342611.png\" alt=\"image-20250429175342611\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429175421998.png\" alt=\"image-20250429175421998\"></p>\n<p><img src=\"/../../typora-user-images/image-20250429175540574.png\" alt=\"image-20250429175540574\"></p>\n<h2 id=\"milvus-\"><a href=\"#milvus-\" class=\"headerlink\" title=\"milvus \"></a>milvus </h2><h3 id=\"Milvus\"><a href=\"#Milvus\" class=\"headerlink\" title=\"Milvus\"></a>Milvus</h3><p><strong>Docker-compose </strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  etcd </span></span><br><span class=\"line\">  <span class=\"attr\">etcd:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">quay.io/coreos/etcd:v3.5.16</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_MODE=revision</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_RETENTION=1000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_QUOTA_BACKEND_BYTES=4294967296</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_SNAPSHOT_COUNT=50000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/etcd:/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">etcd</span> <span class=\"string\">-advertise-client-urls=http://127.0.0.1:2379</span> <span class=\"string\">-listen-client-urls=http://0.0.0.0:2379</span> <span class=\"string\">--data-dir</span> <span class=\"string\">/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;etcdctl&quot;</span>, <span class=\"string\">&quot;endpoint&quot;</span>, <span class=\"string\">&quot;health&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\">  <span class=\"attr\">minio:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-minio</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">minio/minio:RELEASE.2023-03-20T20-16-18Z</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ACCESS_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_SECRET_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9001:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9000:9000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/minio:/minio_data</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">minio</span> <span class=\"string\">server</span> <span class=\"string\">/minio_data</span> <span class=\"string\">--console-address</span> <span class=\"string\">&quot;:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9000/minio/health/live&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.8</span>   </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">  <span class=\"attr\">standalone:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-standalone</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">milvusdb/milvus:v2.5.4</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;milvus&quot;</span>, <span class=\"string\">&quot;run&quot;</span>, <span class=\"string\">&quot;standalone&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">security_opt:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">seccomp:unconfined</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ETCD_ENDPOINTS:</span> <span class=\"string\">etcd:2379</span>  <span class=\"comment\"># etcd </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ADDRESS:</span> <span class=\"string\">minio:9000</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/milvus:/var/lib/milvus</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9091/healthz&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">start_period:</span> <span class=\"string\">90s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;19530:19530&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9091:9091&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;etcd&quot;</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;minio&quot;</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus Dashboard </span></span><br><span class=\"line\">  <span class=\"attr\">dashboard:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zilliz/attu:v2.5</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-dashboard</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MILVUS_URL:</span> <span class=\"string\">http://standalone:19530</span>  <span class=\"comment\"># Milvus </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;8000:3000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">standalone</span>  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">etcd</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">minio</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">      <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong>  <code>http://localhost:8000/</code><br></p>\n<p><img src=\"/../../typora-user-images/image-20250429181131778.png\" alt=\"image-20250429181131778\"></p>\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250429181039571.png\" alt=\"image-20250429181039571\"></p>\n<p>&#96;&#96;milvus<code>,  </code>milvus-4321<code>(spring)</code>admin&#96;, </p>\n<p><img src=\"/../../typora-user-images/image-20250429181312813.png\" alt=\"image-20250429181312813\"></p>\n<p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-milvus-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">    <span class=\"attr\">uris:</span> <span class=\"string\">http://127.0.0.1:9200</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">milvus:</span></span><br><span class=\"line\">        <span class=\"attr\">client:</span></span><br><span class=\"line\">          <span class=\"attr\">host:</span> <span class=\"string\">&quot;localhost&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">port:</span> <span class=\"number\">19530</span></span><br><span class=\"line\">          <span class=\"attr\">username:</span> <span class=\"string\">&quot;milvus&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"string\">&quot;milvus-4321&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">databaseName:</span> <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">collectionName:</span> <span class=\"string\">&quot;vector_store&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">embeddingDimension:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">indexType:</span> <span class=\"string\">IVF_FLAT</span></span><br><span class=\"line\">        <span class=\"attr\">metricType:</span> <span class=\"string\">COSINE</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisMilvusAI</p>\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250429183142516.png\" alt=\"image-20250429183142516\"></p>\n"},{"title":"Spring AI Alibaba-04- Spring AI + RAG + ToolCalling ","_content":"\n# Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \n\n[toc]\n\n\n\n## \n\n\n\n### **Tool Calling **\n\n HTTP \n\n\n Spring AI  Tool Calling  OA \n\n\n\n### \n\nSpring AI  Tool Calling \n\n1. ****\n2. ****\n\n\n\n\n\n\n\n-  API\n-  OA \n-  RAG \n- \n-  vs  Tool Calling \n\n\n\n## \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** API [](https://www.weatherapi.com/)\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n Spring  Redis  ChatClient \n\n**Tool calling **\n\n1. ****\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"\")\npublic class HospitalService {\n\n    @Tool(description = \"\")\n    String registeInHos (@ToolParam(description = \"\", required = true) String docName,\n                         @ToolParam(description = \"\", required = true) String time ,\n                         @ToolParam(description = \"\", required = false) String desc,\n                         @ToolParam(description = \"ID\") String userId) {\n\n\n        String rtn1 = \"\"+docName+\"\"+time+\"\"+desc+\"\";\n        String rtn2 = \"\"+docName+\"\";\n\n\n\n\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n\n}\n\n\n~~~\n\n2. OA\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.lang3.StringUtils;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"OA\")\npublic class OaService {\n\n    private static int LEFT_DAYS = 5;\n    @Tool(description = \"\")\n    public String getCurrentDateTime() {\n        return \" \"+LEFT_DAYS+\" \";\n    }\n\n    @Tool(description = \"id(userId), (days)\")\n    String askForLeave(@ToolParam(description = \"\") String userId ,@ToolParam(description = \"\") String days) {\n        if(!StringUtils.isNumeric(days)){\n            throw new IllegalArgumentException(\"days\");\n        }\n        int dayInt = Integer.parseInt(days);\n        String rtn1 = \"\"+userId+\",\"+days+\"\";\n        String rtn2 = \"\";\n        return dayInt>=LEFT_DAYS?rtn2:rtn1;\n    }\n}\n\n\n\n~~~\n\n\n\n3. \n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\nimport java.util.Set;\n\n@Slf4j\n@Description(\"\")\npublic class RestaurantService {\n\n    private static int LEFT_DAYS = 5;\n    private static Set<String> RESTAURANT_NAME = Set.of( \"\", \"\", \"\", \"\", \"\");\n\n    @Tool(description = \"\")\n    public String queryRestaurantName(@ToolParam(description = \"\", required = true) String location) {\n        //  RESTAURANT_NAME \n        String rtn = RESTAURANT_NAME.stream().skip((int) (Math.random() * RESTAURANT_NAME.size())).limit(3).reduce((a, b) -> a + \"\" + b).get();\n        return \"\" + location + \" restaurantName\" + rtn;\n    }\n\n    @Tool(description = \"\")\n    String bookRestaurant (@ToolParam(description = \"\", required = true) String restName,\n                           @ToolParam(description = \"\", required = true) String time ,\n                           @ToolParam(description = \"\", required = true) String userNumber) {\n        String rtn1 = \"\"+restName+\"\"+time+\"\"+userNumber+\"\";\n        String rtn2 = \"\"+restName+\"\";\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n}\n\n~~~\n\n\n\n **ToolCallController.java**\n\n~~~\n  @GetMapping(value = \"/rag/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChat(@RequestParam String userId, @RequestParam String message) {\n        log.info(\"userId -> [{}], message --> [{}]\", userId, message);\n        String text = chatClient.prompt()\n                .user(message)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))\n                .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))\n                .call().content();\n        return text;\n    }\n~~~\n\n\n\n\n\n\n\n## \n\n1\n\n~~~\nhttp://localhost:8080/ai/v1/rag/simpleChat?message=\n~~~\n\n\n\n![image-20250508161105090](../../typora-user-images/image-20250508161105090.png)\n\n****\n\n- \n- \n\n\n\n2\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=\n~~~\n\n\n\n![image-20250508161546610](../../typora-user-images/image-20250508161546610.png)\n\n\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=2\n~~~\n\n\n\n![image-20250508162115569](../../typora-user-images/image-20250508162115569.png)\n\n\n\n****\n\n-  OA \n- \n\n","source":"_posts/Spring AI Alibaba/Spring AI Alibaba-04- Spring AI + + ToolCalling .md","raw":"---\ntitle: Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \n---\n\n# Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \n\n[toc]\n\n\n\n## \n\n\n\n### **Tool Calling **\n\n HTTP \n\n\n Spring AI  Tool Calling  OA \n\n\n\n### \n\nSpring AI  Tool Calling \n\n1. ****\n2. ****\n\n\n\n\n\n\n\n-  API\n-  OA \n-  RAG \n- \n-  vs  Tool Calling \n\n\n\n## \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** API [](https://www.weatherapi.com/)\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n Spring  Redis  ChatClient \n\n**Tool calling **\n\n1. ****\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"\")\npublic class HospitalService {\n\n    @Tool(description = \"\")\n    String registeInHos (@ToolParam(description = \"\", required = true) String docName,\n                         @ToolParam(description = \"\", required = true) String time ,\n                         @ToolParam(description = \"\", required = false) String desc,\n                         @ToolParam(description = \"ID\") String userId) {\n\n\n        String rtn1 = \"\"+docName+\"\"+time+\"\"+desc+\"\";\n        String rtn2 = \"\"+docName+\"\";\n\n\n\n\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n\n}\n\n\n~~~\n\n2. OA\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.lang3.StringUtils;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"OA\")\npublic class OaService {\n\n    private static int LEFT_DAYS = 5;\n    @Tool(description = \"\")\n    public String getCurrentDateTime() {\n        return \" \"+LEFT_DAYS+\" \";\n    }\n\n    @Tool(description = \"id(userId), (days)\")\n    String askForLeave(@ToolParam(description = \"\") String userId ,@ToolParam(description = \"\") String days) {\n        if(!StringUtils.isNumeric(days)){\n            throw new IllegalArgumentException(\"days\");\n        }\n        int dayInt = Integer.parseInt(days);\n        String rtn1 = \"\"+userId+\",\"+days+\"\";\n        String rtn2 = \"\";\n        return dayInt>=LEFT_DAYS?rtn2:rtn1;\n    }\n}\n\n\n\n~~~\n\n\n\n3. \n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\nimport java.util.Set;\n\n@Slf4j\n@Description(\"\")\npublic class RestaurantService {\n\n    private static int LEFT_DAYS = 5;\n    private static Set<String> RESTAURANT_NAME = Set.of( \"\", \"\", \"\", \"\", \"\");\n\n    @Tool(description = \"\")\n    public String queryRestaurantName(@ToolParam(description = \"\", required = true) String location) {\n        //  RESTAURANT_NAME \n        String rtn = RESTAURANT_NAME.stream().skip((int) (Math.random() * RESTAURANT_NAME.size())).limit(3).reduce((a, b) -> a + \"\" + b).get();\n        return \"\" + location + \" restaurantName\" + rtn;\n    }\n\n    @Tool(description = \"\")\n    String bookRestaurant (@ToolParam(description = \"\", required = true) String restName,\n                           @ToolParam(description = \"\", required = true) String time ,\n                           @ToolParam(description = \"\", required = true) String userNumber) {\n        String rtn1 = \"\"+restName+\"\"+time+\"\"+userNumber+\"\";\n        String rtn2 = \"\"+restName+\"\";\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n}\n\n~~~\n\n\n\n **ToolCallController.java**\n\n~~~\n  @GetMapping(value = \"/rag/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChat(@RequestParam String userId, @RequestParam String message) {\n        log.info(\"userId -> [{}], message --> [{}]\", userId, message);\n        String text = chatClient.prompt()\n                .user(message)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))\n                .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))\n                .call().content();\n        return text;\n    }\n~~~\n\n\n\n\n\n\n\n## \n\n1\n\n~~~\nhttp://localhost:8080/ai/v1/rag/simpleChat?message=\n~~~\n\n\n\n![image-20250508161105090](../../typora-user-images/image-20250508161105090.png)\n\n****\n\n- \n- \n\n\n\n2\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=\n~~~\n\n\n\n![image-20250508161546610](../../typora-user-images/image-20250508161546610.png)\n\n\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=2\n~~~\n\n\n\n![image-20250508162115569](../../typora-user-images/image-20250508162115569.png)\n\n\n\n****\n\n-  OA \n- \n\n","slug":"Spring AI Alibaba/Spring AI Alibaba-04- Spring AI + + ToolCalling ","published":1,"date":"2025-04-29T10:08:12.945Z","updated":"2025-06-04T10:49:56.730Z","_id":"cmbhtdwzv000eo6fy34oa1vqb","comments":1,"layout":"post","photos":[],"content":"<h1 id=\"Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\"><a href=\"#Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\" class=\"headerlink\" title=\"Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \"></a>Spring AI Alibaba-04- Spring AI + RAG + ToolCalling </h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Tool-Calling-\"><a href=\"#Tool-Calling-\" class=\"headerlink\" title=\"Tool Calling \"></a><strong>Tool Calling </strong></h3><p> HTTP <br><br><br> Spring AI  Tool Calling  OA </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Spring AI  Tool Calling </p>\n<ol>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ol>\n<p></p>\n<ul>\n<li> API</li>\n<li> OA </li>\n<li> RAG </li>\n<li></li>\n<li> vs  Tool Calling </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> API <a href=\"https://www.weatherapi.com/\"></a></li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p> Spring  Redis  ChatClient </p>\n<p><strong>Tool calling </strong></p>\n<ol>\n<li><strong></strong></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HospitalService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">registeInHos</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String docName,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = false)</span> String desc,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;ID&quot;)</span> String userId)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+desc+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>OA</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;OA&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OaService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getCurrentDateTime</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot; &quot;</span>+LEFT_DAYS+<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;id(userId), (days)&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">askForLeave</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String userId ,<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String days)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!StringUtils.isNumeric(days))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;days&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">dayInt</span> <span class=\"operator\">=</span> Integer.parseInt(days);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+userId+<span class=\"string\">&quot;,&quot;</span>+days+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dayInt&gt;=LEFT_DAYS?rtn2:rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RestaurantService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Set&lt;String&gt; RESTAURANT_NAME = Set.of( <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">queryRestaurantName</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String location)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  RESTAURANT_NAME </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn</span> <span class=\"operator\">=</span> RESTAURANT_NAME.stream().skip((<span class=\"type\">int</span>) (Math.random() * RESTAURANT_NAME.size())).limit(<span class=\"number\">3</span>).reduce((a, b) -&gt; a + <span class=\"string\">&quot;&quot;</span> + b).get();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span> + location + <span class=\"string\">&quot; restaurantName&quot;</span> + rtn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">bookRestaurant</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String restName,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String userNumber)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+userNumber+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> <strong>ToolCallController.java</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GetMapping(value = &quot;/rag/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span><br><span class=\"line\">  public String ragChat(@RequestParam String userId, @RequestParam String message) &#123;</span><br><span class=\"line\">      log.info(&quot;userId -&gt; [&#123;&#125;], message --&gt; [&#123;&#125;]&quot;, userId, message);</span><br><span class=\"line\">      String text = chatClient.prompt()</span><br><span class=\"line\">              .user(message)</span><br><span class=\"line\">              .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))</span><br><span class=\"line\">              .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))</span><br><span class=\"line\">              .call().content();</span><br><span class=\"line\">      return text;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/simpleChat?message=</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250508161105090.png\" alt=\"image-20250508161105090\"></p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/../../typora-user-images/image-20250508161546610.png\" alt=\"image-20250508161546610\"></p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=2</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/../../typora-user-images/image-20250508162115569.png\" alt=\"image-20250508162115569\"></p>\n<p><strong></strong></p>\n<ul>\n<li> OA </li>\n<li></li>\n</ul>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\"><a href=\"#Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\" class=\"headerlink\" title=\"Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \"></a>Spring AI Alibaba-04- Spring AI + RAG + ToolCalling </h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Tool-Calling-\"><a href=\"#Tool-Calling-\" class=\"headerlink\" title=\"Tool Calling \"></a><strong>Tool Calling </strong></h3><p> HTTP <br><br><br> Spring AI  Tool Calling  OA </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Spring AI  Tool Calling </p>\n<ol>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ol>\n<p></p>\n<ul>\n<li> API</li>\n<li> OA </li>\n<li> RAG </li>\n<li></li>\n<li> vs  Tool Calling </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> API <a href=\"https://www.weatherapi.com/\"></a></li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p> Spring  Redis  ChatClient </p>\n<p><strong>Tool calling </strong></p>\n<ol>\n<li><strong></strong></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HospitalService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">registeInHos</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String docName,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = false)</span> String desc,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;ID&quot;)</span> String userId)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+desc+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>OA</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;OA&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OaService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getCurrentDateTime</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot; &quot;</span>+LEFT_DAYS+<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;id(userId), (days)&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">askForLeave</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String userId ,<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String days)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!StringUtils.isNumeric(days))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;days&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">dayInt</span> <span class=\"operator\">=</span> Integer.parseInt(days);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+userId+<span class=\"string\">&quot;,&quot;</span>+days+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dayInt&gt;=LEFT_DAYS?rtn2:rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RestaurantService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Set&lt;String&gt; RESTAURANT_NAME = Set.of( <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">queryRestaurantName</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String location)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  RESTAURANT_NAME </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn</span> <span class=\"operator\">=</span> RESTAURANT_NAME.stream().skip((<span class=\"type\">int</span>) (Math.random() * RESTAURANT_NAME.size())).limit(<span class=\"number\">3</span>).reduce((a, b) -&gt; a + <span class=\"string\">&quot;&quot;</span> + b).get();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span> + location + <span class=\"string\">&quot; restaurantName&quot;</span> + rtn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">bookRestaurant</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String restName,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String userNumber)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+userNumber+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> <strong>ToolCallController.java</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GetMapping(value = &quot;/rag/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span><br><span class=\"line\">  public String ragChat(@RequestParam String userId, @RequestParam String message) &#123;</span><br><span class=\"line\">      log.info(&quot;userId -&gt; [&#123;&#125;], message --&gt; [&#123;&#125;]&quot;, userId, message);</span><br><span class=\"line\">      String text = chatClient.prompt()</span><br><span class=\"line\">              .user(message)</span><br><span class=\"line\">              .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))</span><br><span class=\"line\">              .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))</span><br><span class=\"line\">              .call().content();</span><br><span class=\"line\">      return text;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/simpleChat?message=</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250508161105090.png\" alt=\"image-20250508161105090\"></p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/../../typora-user-images/image-20250508161546610.png\" alt=\"image-20250508161546610\"></p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=2</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/../../typora-user-images/image-20250508162115569.png\" alt=\"image-20250508162115569\"></p>\n<p><strong></strong></p>\n<ul>\n<li> OA </li>\n<li></li>\n</ul>\n"},{"title":"Spring AI Alibaba-02-","_content":"Spring AI Alibaba-02-\n\n# Spring AI Alibaba-02-\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\n\n\n- ****IntelliJ IDEA\n- **JDK**17  IDEA  JDK\n- ****[](https://bailian.console.aliyun.com/) AI \n\n## \n\n\n\n**1ChatMemory** \n\n```java\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    /**\n     * \n     */\n    @Bean\n    public ChatMemory chatMemory() {\n        return new InMemoryChatMemory();\n    }\n}\n```\n\n**2ChatMemoryController**\n\nIDIDIDID\n\n~~~java\n//  chatClient.prompt() \nChatClient.CallResponseSpec response = chatClient.prompt()\n        //  .user(input) \n        .user(input)\n        //  .advisors  Lambda \n        .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                //  Lambda  .param  100\n                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n        //  .call() \n        .call();\n\n~~~\n\n\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatMemoryController {\n    private final ChatClient chatClient;\n\n    //  ChatModel AI  ChatMemory\n    public ChatMemoryController(ChatModel chatModel, ChatMemory chatMemory) {\n        //  ChatClient.Builder  ChatClient Advisor\n        this.chatClient = ChatClient.builder(chatModel)\n                .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory))\n                .build();\n    }\n\n    /**\n     * \n     * \n     */\n    @GetMapping(\"/multi/chat\")\n    public String chat(@RequestParam(value = \"userId\",defaultValue = \"10001\") String userId,\n                       @RequestParam(\"input\") String input) {\n        log.info(\"/multi/chat   input:  [{}]\", input);\n        //  chatClient.prompt() \n        ChatClient.CallResponseSpec response = chatClient.prompt()\n                //  .user(input) \n                .user(input)\n                //  .advisors  Lambda \n                .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                        //  Lambda  .param  100\n                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n                //  .call() \n                .call();\n        return response.content();\n    }\n}\n\n\n~~~\n\n\n\n\n\nhttp://127.0.0.1:8080/ai/v1/multi/chat\n\nuserId ID ID  ID \ninput\n\n\n\n\n\n![image-20250419181524113](../../typora-user-images/image-20250419181524113.png)\n\n\n\n![image-20250419181631076](../../typora-user-images/image-20250419181631076.png)\n\n\n\n**ID**\n\nID  lison002\n\n\n\n![image-20250419181745960](../../typora-user-images/image-20250419181745960.png)\n\nAI \n\n\n\n\n\n## -Redis\n\n\n\n****\n\n```\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n```\n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n    @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n Spring  Redis  ChatClient \n\n**ChatStorageMemoryController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatStorageMemoryController {\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private ChatMemory chatMemory;\n\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(value = \"/storage/chat\")\n    public String chat(@RequestParam String userId, @RequestParam String inputMsg) {\n\n        log.info(\"/redis/chat  userId: [{}],  input:  [{}]\", userId, inputMsg);\n\n        String text = chatClient.prompt()\n                .user(inputMsg)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory, userId, CHAT_HISTORY_SIZE))\n                .call()\n                .content();\n        log.info(\"text --> [{}]\", text);\n        return text;\n    }\n}\n\n~~~\n\n\n\n**application.yml**\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      password: xxxx\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n\n\n\n~~~\n\n\n\n****\n\nhttp://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=3\n\n****3\n\n![image-20250422114322913](../../typora-user-images/image-20250422114322913.png)\n\n****\n\n\n\n![image-20250422114422258](../../typora-user-images/image-20250422114422258.png)\n\n****\n\n![image-20250422114555482](../../typora-user-images/image-20250422114555482.png)\n\n\n\n **Redis **\n\n![image-20250422114642336](../../typora-user-images/image-20250422114642336.png)\n\n Redis ","source":"_posts/Spring AI Alibaba/Spring AI Alibaba-02-.md","raw":"---\ntitle: Spring AI Alibaba-02-\n---\nSpring AI Alibaba-02-\n\n# Spring AI Alibaba-02-\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\n\n\n- ****IntelliJ IDEA\n- **JDK**17  IDEA  JDK\n- ****[](https://bailian.console.aliyun.com/) AI \n\n## \n\n\n\n**1ChatMemory** \n\n```java\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    /**\n     * \n     */\n    @Bean\n    public ChatMemory chatMemory() {\n        return new InMemoryChatMemory();\n    }\n}\n```\n\n**2ChatMemoryController**\n\nIDIDIDID\n\n~~~java\n//  chatClient.prompt() \nChatClient.CallResponseSpec response = chatClient.prompt()\n        //  .user(input) \n        .user(input)\n        //  .advisors  Lambda \n        .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                //  Lambda  .param  100\n                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n        //  .call() \n        .call();\n\n~~~\n\n\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatMemoryController {\n    private final ChatClient chatClient;\n\n    //  ChatModel AI  ChatMemory\n    public ChatMemoryController(ChatModel chatModel, ChatMemory chatMemory) {\n        //  ChatClient.Builder  ChatClient Advisor\n        this.chatClient = ChatClient.builder(chatModel)\n                .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory))\n                .build();\n    }\n\n    /**\n     * \n     * \n     */\n    @GetMapping(\"/multi/chat\")\n    public String chat(@RequestParam(value = \"userId\",defaultValue = \"10001\") String userId,\n                       @RequestParam(\"input\") String input) {\n        log.info(\"/multi/chat   input:  [{}]\", input);\n        //  chatClient.prompt() \n        ChatClient.CallResponseSpec response = chatClient.prompt()\n                //  .user(input) \n                .user(input)\n                //  .advisors  Lambda \n                .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                        //  Lambda  .param  100\n                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n                //  .call() \n                .call();\n        return response.content();\n    }\n}\n\n\n~~~\n\n\n\n\n\nhttp://127.0.0.1:8080/ai/v1/multi/chat\n\nuserId ID ID  ID \ninput\n\n\n\n\n\n![image-20250419181524113](../../typora-user-images/image-20250419181524113.png)\n\n\n\n![image-20250419181631076](../../typora-user-images/image-20250419181631076.png)\n\n\n\n**ID**\n\nID  lison002\n\n\n\n![image-20250419181745960](../../typora-user-images/image-20250419181745960.png)\n\nAI \n\n\n\n\n\n## -Redis\n\n\n\n****\n\n```\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n```\n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n    @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n Spring  Redis  ChatClient \n\n**ChatStorageMemoryController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatStorageMemoryController {\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private ChatMemory chatMemory;\n\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(value = \"/storage/chat\")\n    public String chat(@RequestParam String userId, @RequestParam String inputMsg) {\n\n        log.info(\"/redis/chat  userId: [{}],  input:  [{}]\", userId, inputMsg);\n\n        String text = chatClient.prompt()\n                .user(inputMsg)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory, userId, CHAT_HISTORY_SIZE))\n                .call()\n                .content();\n        log.info(\"text --> [{}]\", text);\n        return text;\n    }\n}\n\n~~~\n\n\n\n**application.yml**\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      password: xxxx\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n\n\n\n~~~\n\n\n\n****\n\nhttp://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=3\n\n****3\n\n![image-20250422114322913](../../typora-user-images/image-20250422114322913.png)\n\n****\n\n\n\n![image-20250422114422258](../../typora-user-images/image-20250422114422258.png)\n\n****\n\n![image-20250422114555482](../../typora-user-images/image-20250422114555482.png)\n\n\n\n **Redis **\n\n![image-20250422114642336](../../typora-user-images/image-20250422114642336.png)\n\n Redis ","slug":"Spring AI Alibaba/Spring AI Alibaba-02-","published":1,"date":"2025-04-19T06:41:23.324Z","updated":"2025-06-04T10:49:56.741Z","_id":"cmbhtdwzw000fo6fyehjz8b1y","comments":1,"layout":"post","photos":[],"content":"<p>Spring AI Alibaba-02-</p>\n<h1 id=\"Spring-AI-Alibaba-02-\"><a href=\"#Spring-AI-Alibaba-02-\" class=\"headerlink\" title=\"Spring AI Alibaba-02-\"></a>Spring AI Alibaba-02-</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p></p>\n<p></p>\n<ul>\n<li><strong></strong>IntelliJ IDEA</li>\n<li><strong>JDK</strong>17  IDEA  JDK</li>\n<li><strong></strong><a href=\"https://bailian.console.aliyun.com/\"></a> AI </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>1ChatMemory</strong> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2ChatMemoryController</strong></p>\n<p>IDIDIDID</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">        <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">        .user(input)</span><br><span class=\"line\">        <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">        .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">        <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">        .call();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  ChatModel AI  ChatMemory</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatMemoryController</span><span class=\"params\">(ChatModel chatModel, ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  ChatClient.Builder  ChatClient Advisor</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = ChatClient.builder(chatModel)</span><br><span class=\"line\">                .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory))</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/multi/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam(value = &quot;userId&quot;,defaultValue = &quot;10001&quot;)</span> String userId,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"meta\">@RequestParam(&quot;input&quot;)</span> String input)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/multi/chat   input:  [&#123;&#125;]&quot;</span>, input);</span><br><span class=\"line\">        <span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">        ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">                .user(input)</span><br><span class=\"line\">                <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">                .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                        <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">                <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">                .call();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response.content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><a href=\"http://127.0.0.1:8080/ai/v1/multi/chat%E3%80%82%E8%AF%A5%E6%8E%A5%E5%8F%A3%E6%8E%A5%E5%8F%97%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%9A\">http://127.0.0.1:8080/ai/v1/multi/chat</a></p>\n<p>userId ID ID  ID <br>input</p>\n<p><img src=\"/../../typora-user-images/image-20250419181524113.png\" alt=\"image-20250419181524113\"></p>\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250419181631076.png\" alt=\"image-20250419181631076\"></p>\n<p><strong>ID</strong></p>\n<p>ID  lison002</p>\n<p><img src=\"/../../typora-user-images/image-20250419181745960.png\" alt=\"image-20250419181745960\"></p>\n<p>AI </p>\n<h2 id=\"-Redis\"><a href=\"#-Redis\" class=\"headerlink\" title=\"-Redis\"></a>-Redis</h2><p><strong></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Spring  Redis  ChatClient </p>\n<p><strong>ChatStorageMemoryController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/storage/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/redis/chat  userId: [&#123;&#125;],  input:  [&#123;&#125;]&quot;</span>, userId, inputMsg);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                .user(inputMsg)</span><br><span class=\"line\">                .advisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, userId, CHAT_HISTORY_SIZE))</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text --&gt; [&#123;&#125;]&quot;</span>, text);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>application.yml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<p><a href=\"http://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=%E4%B8%AD%E5%9B%BD%E8%BF%91%E4%BB%A33%E4%B8%AA%E5%90%8D%E4%BA%BA\">http://localhost:8080/ai/v1/storage/chat?userId=lison001&amp;inputMsg=3</a></p>\n<p>****3</p>\n<p><img src=\"/../../typora-user-images/image-20250422114322913.png\" alt=\"image-20250422114322913\"></p>\n<p><strong></strong></p>\n<p><img src=\"/../../typora-user-images/image-20250422114422258.png\" alt=\"image-20250422114422258\"></p>\n<p><strong></strong></p>\n<p><img src=\"/../../typora-user-images/image-20250422114555482.png\" alt=\"image-20250422114555482\"></p>\n<p> <strong>Redis </strong></p>\n<p><img src=\"/../../typora-user-images/image-20250422114642336.png\" alt=\"image-20250422114642336\"></p>\n<p> Redis </p>\n","excerpt":"","more":"<p>Spring AI Alibaba-02-</p>\n<h1 id=\"Spring-AI-Alibaba-02-\"><a href=\"#Spring-AI-Alibaba-02-\" class=\"headerlink\" title=\"Spring AI Alibaba-02-\"></a>Spring AI Alibaba-02-</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p></p>\n<p></p>\n<ul>\n<li><strong></strong>IntelliJ IDEA</li>\n<li><strong>JDK</strong>17  IDEA  JDK</li>\n<li><strong></strong><a href=\"https://bailian.console.aliyun.com/\"></a> AI </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>1ChatMemory</strong> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2ChatMemoryController</strong></p>\n<p>IDIDIDID</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">        <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">        .user(input)</span><br><span class=\"line\">        <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">        .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">        <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">        .call();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  ChatModel AI  ChatMemory</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatMemoryController</span><span class=\"params\">(ChatModel chatModel, ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  ChatClient.Builder  ChatClient Advisor</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = ChatClient.builder(chatModel)</span><br><span class=\"line\">                .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory))</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/multi/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam(value = &quot;userId&quot;,defaultValue = &quot;10001&quot;)</span> String userId,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"meta\">@RequestParam(&quot;input&quot;)</span> String input)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/multi/chat   input:  [&#123;&#125;]&quot;</span>, input);</span><br><span class=\"line\">        <span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">        ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">                .user(input)</span><br><span class=\"line\">                <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">                .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                        <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">                <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">                .call();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response.content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><a href=\"http://127.0.0.1:8080/ai/v1/multi/chat%E3%80%82%E8%AF%A5%E6%8E%A5%E5%8F%A3%E6%8E%A5%E5%8F%97%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%9A\">http://127.0.0.1:8080/ai/v1/multi/chat</a></p>\n<p>userId ID ID  ID <br>input</p>\n<p><img src=\"/../../typora-user-images/image-20250419181524113.png\" alt=\"image-20250419181524113\"></p>\n<p></p>\n<p><img src=\"/../../typora-user-images/image-20250419181631076.png\" alt=\"image-20250419181631076\"></p>\n<p><strong>ID</strong></p>\n<p>ID  lison002</p>\n<p><img src=\"/../../typora-user-images/image-20250419181745960.png\" alt=\"image-20250419181745960\"></p>\n<p>AI </p>\n<h2 id=\"-Redis\"><a href=\"#-Redis\" class=\"headerlink\" title=\"-Redis\"></a>-Redis</h2><p><strong></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Spring  Redis  ChatClient </p>\n<p><strong>ChatStorageMemoryController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/storage/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/redis/chat  userId: [&#123;&#125;],  input:  [&#123;&#125;]&quot;</span>, userId, inputMsg);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                .user(inputMsg)</span><br><span class=\"line\">                .advisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, userId, CHAT_HISTORY_SIZE))</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text --&gt; [&#123;&#125;]&quot;</span>, text);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>application.yml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<p><a href=\"http://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=%E4%B8%AD%E5%9B%BD%E8%BF%91%E4%BB%A33%E4%B8%AA%E5%90%8D%E4%BA%BA\">http://localhost:8080/ai/v1/storage/chat?userId=lison001&amp;inputMsg=3</a></p>\n<p>****3</p>\n<p><img src=\"/../../typora-user-images/image-20250422114322913.png\" alt=\"image-20250422114322913\"></p>\n<p><strong></strong></p>\n<p><img src=\"/../../typora-user-images/image-20250422114422258.png\" alt=\"image-20250422114422258\"></p>\n<p><strong></strong></p>\n<p><img src=\"/../../typora-user-images/image-20250422114555482.png\" alt=\"image-20250422114555482\"></p>\n<p> <strong>Redis </strong></p>\n<p><img src=\"/../../typora-user-images/image-20250422114642336.png\" alt=\"image-20250422114642336\"></p>\n<p> Redis </p>\n"},{"_content":"\n\n\n\nhttps://blog.csdn.net/ruipeng250/category_10277351.html\n\n\n\n\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.05.07`\n\n# Spring Cloud Alibaba-01-\n\n[toc]\n\n\n\n## \n\n### ****\n\n\n\n****\nwebtomcat\n\n![image-20230923144124237](typora-user-images/image-20230923144124237.png)\n\n* \n* \n\n****\nCMS\n\n![image-20230923144238782](typora-user-images/image-20230923144238782.png)\n\n* \n* \n\n****\n\n\n\n![image-20230923144315232](typora-user-images/image-20230923144315232.png)\n\n* \n* \n\n**SOA**\n\nSOAService Oriented Architecture\n\n![image-20230923144347556](typora-user-images/image-20230923144347556.png)\n\n- ESB\\dubbo\n- \n\n****\n\nSOA\n\n![image-20230923144414595](typora-user-images/image-20230923144414595.png)\n\n- \n- \n\n\n\n### SOA\n\n1. SOA\n2. \n3. SOA\n4. SOA\n\n### \n\n:\n\n?( [  ])\n?(restful rpc)\n?()\n?()\n? ()\n\n\n![image-20230923144526897](typora-user-images/image-20230923144526897.png)\n\n\n\n### \n\n#### \n\n\n\n:\n\n:\n\n:\n\n![image-20230923144634136](typora-user-images/image-20230923144634136.png)\n\n#### \n\n\nHTTPRESTfulTCPRPC\n\n* **REST(Representational State Transfer)**\n  HTTPhttp\n\n* **RPC(Remote Promote Call)**\n  RPC RPC \n  \n\n|    | RESTful    | RPC         |\n| -------- | ---------- | ----------- |\n|  | HTTP       | TCP |\n|      |        |         |\n|    |          |           |\n|      |  | SOA     |\n\n#### \n\n:\n\n* url\n* \n* \n\n\n\nAPI\n\nAPIAPIAPI : APIAPI \n\n![image-20230923144953818](typora-user-images/image-20230923144953818.png)\n\n#### \n\n.\n\n:\n\n- \n- \n- \n\n\n\n![image-20230923145029314](typora-user-images/image-20230923145029314.png)\n\n\n\n#### \n\n\n\n\n\n### \n\n#### ServiceComb\n\nhttps://servicecomb.apache.org/cn/\n\n![image-20230923145717673](typora-user-images/image-20230923145717673.png)\n\nApache ServiceComb CSE (Cloud Service Engine) Apache  \n\n\n\n#### SpringCloud\n\nhttps://spring.io/projects/spring-cloud/\n\n![image-20230923145922760](typora-user-images/image-20230923145922760.png)\n\n\n\nSpring CloudSpring Boot Spring Boot\n\nSpring CloudSpring Boot\n\n\n\n#### SpringCloud Alibaba\n\n\n\n https://spring.io/projects/spring-cloud-alibaba\n\n![image-20230923150103329](typora-user-images/image-20230923150103329.png)\n\nSpring Cloud Alibaba  Spring Cloud \n\n## Spring Cloud Alibaba \n\nSpring Cloud Alibaba  Spring Cloud \n\n Spring Cloud Alibaba Spring Cloud \n\n![image-20230923145122020](typora-user-images/image-20230923145122020.png)\n\n### ****\n\n*   WebServletWebFlux, OpenFeignRestTemplateSpring Cloud Gateway, Zuul, Dubbo  RocketMQ  Metrics \n*   Spring Cloud  Ribbon \n*  \n*   Spring Cloud Stream \n*   @GlobalTransactional  \n*  \n*   Cron  Workerschedulerx-client\n*  \n\n### \n\n**[Sentinel] **\n\n**[Nacos] **\n\n**[RocketMQ] **\n\n**[Dubbo] **Apache Dubbo  Java RPC \n\n**[Seata] **\n\n**[Alibaba Cloud OSS] :** Object Storage Service OSS\n\n**[Alibaba Cloud SchedulerX]**:  Cron \n\n**[Alibaba Cloud SMS] :** \n\n\n\n\n\n![img](typora-user-images/32fe9b12c9192392c3a50b5f04759eec.png)\n\n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-01-.md","raw":"\n\n\n\nhttps://blog.csdn.net/ruipeng250/category_10277351.html\n\n\n\n\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.05.07`\n\n# Spring Cloud Alibaba-01-\n\n[toc]\n\n\n\n## \n\n### ****\n\n\n\n****\nwebtomcat\n\n![image-20230923144124237](typora-user-images/image-20230923144124237.png)\n\n* \n* \n\n****\nCMS\n\n![image-20230923144238782](typora-user-images/image-20230923144238782.png)\n\n* \n* \n\n****\n\n\n\n![image-20230923144315232](typora-user-images/image-20230923144315232.png)\n\n* \n* \n\n**SOA**\n\nSOAService Oriented Architecture\n\n![image-20230923144347556](typora-user-images/image-20230923144347556.png)\n\n- ESB\\dubbo\n- \n\n****\n\nSOA\n\n![image-20230923144414595](typora-user-images/image-20230923144414595.png)\n\n- \n- \n\n\n\n### SOA\n\n1. SOA\n2. \n3. SOA\n4. SOA\n\n### \n\n:\n\n?( [  ])\n?(restful rpc)\n?()\n?()\n? ()\n\n\n![image-20230923144526897](typora-user-images/image-20230923144526897.png)\n\n\n\n### \n\n#### \n\n\n\n:\n\n:\n\n:\n\n![image-20230923144634136](typora-user-images/image-20230923144634136.png)\n\n#### \n\n\nHTTPRESTfulTCPRPC\n\n* **REST(Representational State Transfer)**\n  HTTPhttp\n\n* **RPC(Remote Promote Call)**\n  RPC RPC \n  \n\n|    | RESTful    | RPC         |\n| -------- | ---------- | ----------- |\n|  | HTTP       | TCP |\n|      |        |         |\n|    |          |           |\n|      |  | SOA     |\n\n#### \n\n:\n\n* url\n* \n* \n\n\n\nAPI\n\nAPIAPIAPI : APIAPI \n\n![image-20230923144953818](typora-user-images/image-20230923144953818.png)\n\n#### \n\n.\n\n:\n\n- \n- \n- \n\n\n\n![image-20230923145029314](typora-user-images/image-20230923145029314.png)\n\n\n\n#### \n\n\n\n\n\n### \n\n#### ServiceComb\n\nhttps://servicecomb.apache.org/cn/\n\n![image-20230923145717673](typora-user-images/image-20230923145717673.png)\n\nApache ServiceComb CSE (Cloud Service Engine) Apache  \n\n\n\n#### SpringCloud\n\nhttps://spring.io/projects/spring-cloud/\n\n![image-20230923145922760](typora-user-images/image-20230923145922760.png)\n\n\n\nSpring CloudSpring Boot Spring Boot\n\nSpring CloudSpring Boot\n\n\n\n#### SpringCloud Alibaba\n\n\n\n https://spring.io/projects/spring-cloud-alibaba\n\n![image-20230923150103329](typora-user-images/image-20230923150103329.png)\n\nSpring Cloud Alibaba  Spring Cloud \n\n## Spring Cloud Alibaba \n\nSpring Cloud Alibaba  Spring Cloud \n\n Spring Cloud Alibaba Spring Cloud \n\n![image-20230923145122020](typora-user-images/image-20230923145122020.png)\n\n### ****\n\n*   WebServletWebFlux, OpenFeignRestTemplateSpring Cloud Gateway, Zuul, Dubbo  RocketMQ  Metrics \n*   Spring Cloud  Ribbon \n*  \n*   Spring Cloud Stream \n*   @GlobalTransactional  \n*  \n*   Cron  Workerschedulerx-client\n*  \n\n### \n\n**[Sentinel] **\n\n**[Nacos] **\n\n**[RocketMQ] **\n\n**[Dubbo] **Apache Dubbo  Java RPC \n\n**[Seata] **\n\n**[Alibaba Cloud OSS] :** Object Storage Service OSS\n\n**[Alibaba Cloud SchedulerX]**:  Cron \n\n**[Alibaba Cloud SMS] :** \n\n\n\n\n\n![img](typora-user-images/32fe9b12c9192392c3a50b5f04759eec.png)\n\n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-01-","published":1,"date":"2023-09-11T07:28:58.346Z","updated":"2024-05-31T09:36:44.224Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhe0000ecfye9gxbz7n","content":"<p><a href=\"https://blog.csdn.net/ruipeng250/category_10277351.html\">https://blog.csdn.net/ruipeng250/category_10277351.html</a></p>\n<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.05.07</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-01-\"><a href=\"#Spring-Cloud-Alibaba-01-\" class=\"headerlink\" title=\"Spring Cloud Alibaba-01-\"></a>Spring Cloud Alibaba-01-</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><p></p>\n<p><strong></strong><br>webtomcat</p>\n<p><img src=\"/typora-user-images/image-20230923144124237.png\" alt=\"image-20230923144124237\"></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p><strong></strong><br>CMS</p>\n<p><img src=\"/typora-user-images/image-20230923144238782.png\" alt=\"image-20230923144238782\"></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p><strong></strong></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20230923144315232.png\" alt=\"image-20230923144315232\"></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p><strong>SOA</strong></p>\n<p>SOAService Oriented Architecture</p>\n<p><img src=\"/typora-user-images/image-20230923144347556.png\" alt=\"image-20230923144347556\"></p>\n<ul>\n<li>ESB\\dubbo</li>\n<li></li>\n</ul>\n<p><strong></strong></p>\n<p>SOA</p>\n<p><img src=\"/typora-user-images/image-20230923144414595.png\" alt=\"image-20230923144414595\"></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"SOA\"><a href=\"#SOA\" class=\"headerlink\" title=\"SOA\"></a>SOA</h3><ol>\n<li>SOA</li>\n<li></li>\n<li>SOA</li>\n<li>SOA</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>:</p>\n<p>?( [  ])<br>?(restful rpc)<br>?()<br>?()<br>? ()<br></p>\n<p><img src=\"/typora-user-images/image-20230923144526897.png\" alt=\"image-20230923144526897\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p>:</p>\n<p>:</p>\n<p>:</p>\n<p><img src=\"/typora-user-images/image-20230923144634136.png\" alt=\"image-20230923144634136\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br>HTTPRESTfulTCPRPC</p>\n<ul>\n<li><p><strong>REST(Representational State Transfer)</strong><br>HTTPhttp</p>\n</li>\n<li><p><strong>RPC(Remote Promote Call)</strong><br>RPC RPC <br></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>RESTful</th>\n<th>RPC</th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td>HTTP</td>\n<td>TCP</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>SOA</td>\n</tr>\n</tbody></table>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>:</p>\n<ul>\n<li>url</li>\n<li></li>\n<li></li>\n</ul>\n<p>API</p>\n<p>APIAPIAPI : APIAPI </p>\n<p><img src=\"/typora-user-images/image-20230923144953818.png\" alt=\"image-20230923144953818\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>.</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><img src=\"/typora-user-images/image-20230923145029314.png\" alt=\"image-20230923145029314\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"ServiceComb\"><a href=\"#ServiceComb\" class=\"headerlink\" title=\"ServiceComb\"></a>ServiceComb</h4><p><a href=\"https://servicecomb.apache.org/cn/\">https://servicecomb.apache.org/cn/</a></p>\n<p><img src=\"/typora-user-images/image-20230923145717673.png\" alt=\"image-20230923145717673\"></p>\n<p>Apache ServiceComb CSE (Cloud Service Engine) Apache  </p>\n<h4 id=\"SpringCloud\"><a href=\"#SpringCloud\" class=\"headerlink\" title=\"SpringCloud\"></a>SpringCloud</h4><p><a href=\"https://spring.io/projects/spring-cloud/\">https://spring.io/projects/spring-cloud/</a></p>\n<p><img src=\"/typora-user-images/image-20230923145922760.png\" alt=\"image-20230923145922760\"></p>\n<p>Spring CloudSpring Boot Spring Boot</p>\n<p>Spring CloudSpring Boot</p>\n<h4 id=\"SpringCloud-Alibaba\"><a href=\"#SpringCloud-Alibaba\" class=\"headerlink\" title=\"SpringCloud Alibaba\"></a>SpringCloud Alibaba</h4><p> <a href=\"https://spring.io/projects/spring-cloud-alibaba\">https://spring.io/projects/spring-cloud-alibaba</a></p>\n<p><img src=\"/typora-user-images/image-20230923150103329.png\" alt=\"image-20230923150103329\"></p>\n<p>Spring Cloud Alibaba  Spring Cloud </p>\n<h2 id=\"Spring-Cloud-Alibaba-\"><a href=\"#Spring-Cloud-Alibaba-\" class=\"headerlink\" title=\"Spring Cloud Alibaba \"></a>Spring Cloud Alibaba </h2><p>Spring Cloud Alibaba  Spring Cloud </p>\n<p> Spring Cloud Alibaba Spring Cloud </p>\n<p><img src=\"/typora-user-images/image-20230923145122020.png\" alt=\"image-20230923145122020\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><ul>\n<li>  WebServletWebFlux, OpenFeignRestTemplateSpring Cloud Gateway, Zuul, Dubbo  RocketMQ  Metrics </li>\n<li>  Spring Cloud  Ribbon </li>\n<li> </li>\n<li>  Spring Cloud Stream </li>\n<li>  @GlobalTransactional  </li>\n<li> </li>\n<li>  Cron  Workerschedulerx-client</li>\n<li> </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>**[Sentinel] **</p>\n<p>**[Nacos] **</p>\n<p>**[RocketMQ] **</p>\n<p>**[Dubbo] **Apache Dubbo  Java RPC </p>\n<p>**[Seata] **</p>\n<p><strong>[Alibaba Cloud OSS] :</strong> Object Storage Service OSS</p>\n<p><strong>[Alibaba Cloud SchedulerX]</strong>:  Cron </p>\n<p><strong>[Alibaba Cloud SMS] :</strong> </p>\n<p><img src=\"/typora-user-images/32fe9b12c9192392c3a50b5f04759eec.png\" alt=\"img\"></p>\n","excerpt":"","more":"<p><a href=\"https://blog.csdn.net/ruipeng250/category_10277351.html\">https://blog.csdn.net/ruipeng250/category_10277351.html</a></p>\n<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.05.07</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-01-\"><a href=\"#Spring-Cloud-Alibaba-01-\" class=\"headerlink\" title=\"Spring Cloud Alibaba-01-\"></a>Spring Cloud Alibaba-01-</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><p></p>\n<p><strong></strong><br>webtomcat</p>\n<p><img src=\"/typora-user-images/image-20230923144124237.png\" alt=\"image-20230923144124237\"></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p><strong></strong><br>CMS</p>\n<p><img src=\"/typora-user-images/image-20230923144238782.png\" alt=\"image-20230923144238782\"></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p><strong></strong></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20230923144315232.png\" alt=\"image-20230923144315232\"></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p><strong>SOA</strong></p>\n<p>SOAService Oriented Architecture</p>\n<p><img src=\"/typora-user-images/image-20230923144347556.png\" alt=\"image-20230923144347556\"></p>\n<ul>\n<li>ESB\\dubbo</li>\n<li></li>\n</ul>\n<p><strong></strong></p>\n<p>SOA</p>\n<p><img src=\"/typora-user-images/image-20230923144414595.png\" alt=\"image-20230923144414595\"></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"SOA\"><a href=\"#SOA\" class=\"headerlink\" title=\"SOA\"></a>SOA</h3><ol>\n<li>SOA</li>\n<li></li>\n<li>SOA</li>\n<li>SOA</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>:</p>\n<p>?( [  ])<br>?(restful rpc)<br>?()<br>?()<br>? ()<br></p>\n<p><img src=\"/typora-user-images/image-20230923144526897.png\" alt=\"image-20230923144526897\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p>:</p>\n<p>:</p>\n<p>:</p>\n<p><img src=\"/typora-user-images/image-20230923144634136.png\" alt=\"image-20230923144634136\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br>HTTPRESTfulTCPRPC</p>\n<ul>\n<li><p><strong>REST(Representational State Transfer)</strong><br>HTTPhttp</p>\n</li>\n<li><p><strong>RPC(Remote Promote Call)</strong><br>RPC RPC <br></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>RESTful</th>\n<th>RPC</th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td>HTTP</td>\n<td>TCP</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>SOA</td>\n</tr>\n</tbody></table>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>:</p>\n<ul>\n<li>url</li>\n<li></li>\n<li></li>\n</ul>\n<p>API</p>\n<p>APIAPIAPI : APIAPI </p>\n<p><img src=\"/typora-user-images/image-20230923144953818.png\" alt=\"image-20230923144953818\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>.</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><img src=\"/typora-user-images/image-20230923145029314.png\" alt=\"image-20230923145029314\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"ServiceComb\"><a href=\"#ServiceComb\" class=\"headerlink\" title=\"ServiceComb\"></a>ServiceComb</h4><p><a href=\"https://servicecomb.apache.org/cn/\">https://servicecomb.apache.org/cn/</a></p>\n<p><img src=\"/typora-user-images/image-20230923145717673.png\" alt=\"image-20230923145717673\"></p>\n<p>Apache ServiceComb CSE (Cloud Service Engine) Apache  </p>\n<h4 id=\"SpringCloud\"><a href=\"#SpringCloud\" class=\"headerlink\" title=\"SpringCloud\"></a>SpringCloud</h4><p><a href=\"https://spring.io/projects/spring-cloud/\">https://spring.io/projects/spring-cloud/</a></p>\n<p><img src=\"/typora-user-images/image-20230923145922760.png\" alt=\"image-20230923145922760\"></p>\n<p>Spring CloudSpring Boot Spring Boot</p>\n<p>Spring CloudSpring Boot</p>\n<h4 id=\"SpringCloud-Alibaba\"><a href=\"#SpringCloud-Alibaba\" class=\"headerlink\" title=\"SpringCloud Alibaba\"></a>SpringCloud Alibaba</h4><p> <a href=\"https://spring.io/projects/spring-cloud-alibaba\">https://spring.io/projects/spring-cloud-alibaba</a></p>\n<p><img src=\"/typora-user-images/image-20230923150103329.png\" alt=\"image-20230923150103329\"></p>\n<p>Spring Cloud Alibaba  Spring Cloud </p>\n<h2 id=\"Spring-Cloud-Alibaba-\"><a href=\"#Spring-Cloud-Alibaba-\" class=\"headerlink\" title=\"Spring Cloud Alibaba \"></a>Spring Cloud Alibaba </h2><p>Spring Cloud Alibaba  Spring Cloud </p>\n<p> Spring Cloud Alibaba Spring Cloud </p>\n<p><img src=\"/typora-user-images/image-20230923145122020.png\" alt=\"image-20230923145122020\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><ul>\n<li>  WebServletWebFlux, OpenFeignRestTemplateSpring Cloud Gateway, Zuul, Dubbo  RocketMQ  Metrics </li>\n<li>  Spring Cloud  Ribbon </li>\n<li> </li>\n<li>  Spring Cloud Stream </li>\n<li>  @GlobalTransactional  </li>\n<li> </li>\n<li>  Cron  Workerschedulerx-client</li>\n<li> </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>**[Sentinel] **</p>\n<p>**[Nacos] **</p>\n<p>**[RocketMQ] **</p>\n<p>**[Dubbo] **Apache Dubbo  Java RPC </p>\n<p>**[Seata] **</p>\n<p><strong>[Alibaba Cloud OSS] :</strong> Object Storage Service OSS</p>\n<p><strong>[Alibaba Cloud SchedulerX]</strong>:  Cron </p>\n<p><strong>[Alibaba Cloud SMS] :</strong> </p>\n<p><img src=\"/typora-user-images/32fe9b12c9192392c3a50b5f04759eec.png\" alt=\"img\"></p>\n"},{"_content":"o`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.08.03`\n\n# Spring Cloud Alibaba-03-NacosDataID\n\n[toc]\n\n\n\n\n\n## \n\n,:\n\n1.  \n2. :  \n3.  \n\n :\n\n* \n* \n\n\n\n\n\n|                              |                                                          |\n| ------------------------------------ | ------------------------------------------------------------ |\n| **Apollo**                           | Apollo: API  |\n| **Disconf**                          | DisconfZookeeper  |\n| **SpringCloud Config              ** | Spring CloudSpring Git |\n| **Nacos**                            | SpingCloud alibaba  |\n\n\n\n## Nacos Config\n\nNacosnacos\nnacosnacos\n\n\n\n1 nacosnacos\n2 nacos\n\n\n\n~~~xml\n<dependency>\n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>\n</dependency>\n\n~~~\n\n3nacos config\n\n> :application.ymlbootstrap.yml\n\n():\n\n> bootstrap.properties -> bootstrap.yml -> application.properties -> application.yml\n\n\n\n~~~yaml\nspring:\n  application:\n    name: spring-cloud-service\n\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n        file-extension: yaml #  \n        \n  profiles: \n\t  active: dev #       \n~~~\n\n\n\nnacos +:\n\n>1)Data ID\n>2)YAMLProperties\n>3)\n\n![image-20231008103734081](typora-user-images/image-20231008103734081.png)\n\napplication.yam \n\nnacos\n\n\n\n## Nacos Config\n\n\n\n### \n\n\n\n\n\nnacos spring-cloud-service-dev.yaml:\n\n~~~yaml\nconfig:\n    appName: service\n~~~\n\n\n\n\n\n****: \n\n~~~java\n@RestController\npublic class TestController {\n    @Autowired\n    private ConfigurableApplicationContext applicationContext;\n  \n  \n\t @GetMapping(value = \"/getConfigName\")\n    public String getConfigName(){\n        return applicationContext.getEnvironment().getProperty(\"config.appName\");\n    }\n}\n~~~\n\n\n\n****: ()\n\n~~~java\n\n@RestController\n@RefreshScope//\npublic class TestController {\n\n    @Value(\"${config.appName}\")\n    private String configName;\n    \n\t//2  \n\t   @GetMapping(value = \"/getConfigNames\")\n    public String getConfigNames(){\n        return configName;\n    }\n}\n~~~\n\n\n\n\n\n### \n\n ?\n\n****\n\n\n spring.application.name  \n\n\n\n1spring-cloud-service.yaml\n\n![image-20231024095726856](typora-user-images/image-20231024095726856.png)\n\n2 spring-cloud-service-test.yaml\n\n![image-20231024095816182](typora-user-images/image-20231024095816182.png)\n\n3 spring-cloud-service-dev.yaml![image-20231024095843156](typora-user-images/image-20231024095843156.png)\n\n\n\n\n\n\n\n~~~java\n\n@RestController\n@RefreshScope//\npublic class TestController {\n\n    @Value(\"${config.appName}\")\n    private String configName;\n    @Value(\"${config.env}\")\n    private String env;\n\n\n    @GetMapping(value = \"/getConfigNames\")\n    public String getConfigNames(){\n        return configName+\"\"+env;\n    }\n~~~\n\n\n\n\n\n4\n\n\n\n![image-20231024094558547](typora-user-images/image-20231024094558547.png)\n\nactivetest\n\n~~~yaml\nspring:\n  profiles:\n     active: test # \n\n~~~\n\n\n\n\n\n### ****\n\n\n\n\n\n\n~~~yaml\nspring:\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://spring_cloud_service?serverTimezone=UTC&useUnicode=true&characterEncoding=utf-8&useSSL=true\n    username: root\n    password: root\n  jpa:\n    properties:\n      hibernate:\n        hbm2ddl:\n          auto: update\n        dialect: org.hibernate.dialect.MySQL5InnoDBDialect\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n\n\n~~~\n\n\n\nbootstrap.yaml\n\n~~~yam\nspring:\n  application:\n    name: service-product\n  cloud:\n    nacos:\n      config:\n\t\tserver-addr: 127.0.0.1:8848 #nacos\n\t\tfile-extension: yaml # \n\t\tshared-dataids: spring-cloud-all.yaml #  refreshable-dataids: spring-cloud-all.yaml #  \n  profiles:\n\tactive: dev #  \n\n~~~\n\n\n\n\n\n## Nacos\n\n\n\n**(Namespace)**\n\n\n\n**(Group)**\n\n\n\n**(Data ID)**\n\n\n\n![image-20231024101307177](typora-user-images/image-20231024101307177.png)\n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-03-NacosDataID.md","raw":"o`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.08.03`\n\n# Spring Cloud Alibaba-03-NacosDataID\n\n[toc]\n\n\n\n\n\n## \n\n,:\n\n1.  \n2. :  \n3.  \n\n :\n\n* \n* \n\n\n\n\n\n|                              |                                                          |\n| ------------------------------------ | ------------------------------------------------------------ |\n| **Apollo**                           | Apollo: API  |\n| **Disconf**                          | DisconfZookeeper  |\n| **SpringCloud Config              ** | Spring CloudSpring Git |\n| **Nacos**                            | SpingCloud alibaba  |\n\n\n\n## Nacos Config\n\nNacosnacos\nnacosnacos\n\n\n\n1 nacosnacos\n2 nacos\n\n\n\n~~~xml\n<dependency>\n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>\n</dependency>\n\n~~~\n\n3nacos config\n\n> :application.ymlbootstrap.yml\n\n():\n\n> bootstrap.properties -> bootstrap.yml -> application.properties -> application.yml\n\n\n\n~~~yaml\nspring:\n  application:\n    name: spring-cloud-service\n\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n        file-extension: yaml #  \n        \n  profiles: \n\t  active: dev #       \n~~~\n\n\n\nnacos +:\n\n>1)Data ID\n>2)YAMLProperties\n>3)\n\n![image-20231008103734081](typora-user-images/image-20231008103734081.png)\n\napplication.yam \n\nnacos\n\n\n\n## Nacos Config\n\n\n\n### \n\n\n\n\n\nnacos spring-cloud-service-dev.yaml:\n\n~~~yaml\nconfig:\n    appName: service\n~~~\n\n\n\n\n\n****: \n\n~~~java\n@RestController\npublic class TestController {\n    @Autowired\n    private ConfigurableApplicationContext applicationContext;\n  \n  \n\t @GetMapping(value = \"/getConfigName\")\n    public String getConfigName(){\n        return applicationContext.getEnvironment().getProperty(\"config.appName\");\n    }\n}\n~~~\n\n\n\n****: ()\n\n~~~java\n\n@RestController\n@RefreshScope//\npublic class TestController {\n\n    @Value(\"${config.appName}\")\n    private String configName;\n    \n\t//2  \n\t   @GetMapping(value = \"/getConfigNames\")\n    public String getConfigNames(){\n        return configName;\n    }\n}\n~~~\n\n\n\n\n\n### \n\n ?\n\n****\n\n\n spring.application.name  \n\n\n\n1spring-cloud-service.yaml\n\n![image-20231024095726856](typora-user-images/image-20231024095726856.png)\n\n2 spring-cloud-service-test.yaml\n\n![image-20231024095816182](typora-user-images/image-20231024095816182.png)\n\n3 spring-cloud-service-dev.yaml![image-20231024095843156](typora-user-images/image-20231024095843156.png)\n\n\n\n\n\n\n\n~~~java\n\n@RestController\n@RefreshScope//\npublic class TestController {\n\n    @Value(\"${config.appName}\")\n    private String configName;\n    @Value(\"${config.env}\")\n    private String env;\n\n\n    @GetMapping(value = \"/getConfigNames\")\n    public String getConfigNames(){\n        return configName+\"\"+env;\n    }\n~~~\n\n\n\n\n\n4\n\n\n\n![image-20231024094558547](typora-user-images/image-20231024094558547.png)\n\nactivetest\n\n~~~yaml\nspring:\n  profiles:\n     active: test # \n\n~~~\n\n\n\n\n\n### ****\n\n\n\n\n\n\n~~~yaml\nspring:\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://spring_cloud_service?serverTimezone=UTC&useUnicode=true&characterEncoding=utf-8&useSSL=true\n    username: root\n    password: root\n  jpa:\n    properties:\n      hibernate:\n        hbm2ddl:\n          auto: update\n        dialect: org.hibernate.dialect.MySQL5InnoDBDialect\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n\n\n~~~\n\n\n\nbootstrap.yaml\n\n~~~yam\nspring:\n  application:\n    name: service-product\n  cloud:\n    nacos:\n      config:\n\t\tserver-addr: 127.0.0.1:8848 #nacos\n\t\tfile-extension: yaml # \n\t\tshared-dataids: spring-cloud-all.yaml #  refreshable-dataids: spring-cloud-all.yaml #  \n  profiles:\n\tactive: dev #  \n\n~~~\n\n\n\n\n\n## Nacos\n\n\n\n**(Namespace)**\n\n\n\n**(Group)**\n\n\n\n**(Data ID)**\n\n\n\n![image-20231024101307177](typora-user-images/image-20231024101307177.png)\n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-03-NacosDataID","published":1,"date":"2023-09-23T04:11:52.300Z","updated":"2024-06-07T02:28:37.208Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhf0001ecfyf1o7fq7n","content":"<p>o<code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.08.03</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-03-NacosDataID\"><a href=\"#Spring-Cloud-Alibaba-03-NacosDataID\" class=\"headerlink\" title=\"Spring Cloud Alibaba-03-NacosDataID\"></a>Spring Cloud Alibaba-03-NacosDataID</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>,:</p>\n<ol>\n<li> </li>\n<li>:  </li>\n<li> </li>\n</ol>\n<p> :</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Apollo</strong></td>\n<td>Apollo: API </td>\n</tr>\n<tr>\n<td><strong>Disconf</strong></td>\n<td>DisconfZookeeper </td>\n</tr>\n<tr>\n<td>**SpringCloud Config              **</td>\n<td>Spring CloudSpring Git</td>\n</tr>\n<tr>\n<td><strong>Nacos</strong></td>\n<td>SpingCloud alibaba </td>\n</tr>\n</tbody></table>\n<h2 id=\"Nacos-Config\"><a href=\"#Nacos-Config\" class=\"headerlink\" title=\"Nacos Config\"></a>Nacos Config</h2><p>Nacosnacos<br>nacosnacos</p>\n<p>1 nacosnacos<br>2 nacos</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>3nacos config</p>\n<blockquote>\n<p>:application.ymlbootstrap.yml</p>\n</blockquote>\n<p>():</p>\n<blockquote>\n<p>bootstrap.properties -&gt; bootstrap.yml -&gt; application.properties -&gt; application.yml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-cloud-service</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\">        <span class=\"attr\">file-extension:</span> <span class=\"string\">yaml</span> <span class=\"comment\">#  </span></span><br><span class=\"line\">        </span><br><span class=\"line\">  <span class=\"attr\">profiles:</span> </span><br><span class=\"line\">\t  <span class=\"attr\">active:</span> <span class=\"string\">dev</span> <span class=\"comment\">#       </span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>nacos +:</p>\n<blockquote>\n<p>1)Data ID<br>2)YAMLProperties<br>3)</p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20231008103734081.png\" alt=\"image-20231008103734081\"></p>\n<p>application.yam </p>\n<p>nacos</p>\n<h2 id=\"Nacos-Config\"><a href=\"#Nacos-Config\" class=\"headerlink\" title=\"Nacos Config\"></a>Nacos Config</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p>nacos spring-cloud-service-dev.yaml:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">config:</span></span><br><span class=\"line\">    <span class=\"attr\">appName:</span> <span class=\"string\">service</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><strong></strong>: </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigurableApplicationContext applicationContext;</span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">\t <span class=\"meta\">@GetMapping(value = &quot;/getConfigName&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getConfigName</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> applicationContext.getEnvironment().getProperty(<span class=\"string\">&quot;config.appName&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong>: ()</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RefreshScope</span><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;config.appName&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String configName;</span><br><span class=\"line\">    </span><br><span class=\"line\">\t<span class=\"comment\">//2  </span></span><br><span class=\"line\">\t   <span class=\"meta\">@GetMapping(value = &quot;/getConfigNames&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getConfigNames</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> configName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> ?</p>\n<p><strong></strong></p>\n<p><br> spring.application.name  </p>\n<p>1spring-cloud-service.yaml</p>\n<p><img src=\"/typora-user-images/image-20231024095726856.png\" alt=\"image-20231024095726856\"></p>\n<p>2 spring-cloud-service-test.yaml</p>\n<p><img src=\"/typora-user-images/image-20231024095816182.png\" alt=\"image-20231024095816182\"></p>\n<p>3 spring-cloud-service-dev.yaml<img src=\"/typora-user-images/image-20231024095843156.png\" alt=\"image-20231024095843156\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RefreshScope</span><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;config.appName&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String configName;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;config.env&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String env;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/getConfigNames&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getConfigNames</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> configName+<span class=\"string\">&quot;&quot;</span>+env;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>4</p>\n<p><img src=\"/typora-user-images/image-20231024094558547.png\" alt=\"image-20231024094558547\"></p>\n<p>activetest</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">     <span class=\"attr\">active:</span> <span class=\"string\">test</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><p><br></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://spring_cloud_service?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">root</span></span><br><span class=\"line\">  <span class=\"attr\">jpa:</span></span><br><span class=\"line\">    <span class=\"attr\">properties:</span></span><br><span class=\"line\">      <span class=\"attr\">hibernate:</span></span><br><span class=\"line\">        <span class=\"attr\">hbm2ddl:</span></span><br><span class=\"line\">          <span class=\"attr\">auto:</span> <span class=\"string\">update</span></span><br><span class=\"line\">        <span class=\"attr\">dialect:</span> <span class=\"string\">org.hibernate.dialect.MySQL5InnoDBDialect</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>bootstrap.yaml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  application:</span><br><span class=\"line\">    name: service-product</span><br><span class=\"line\">  cloud:</span><br><span class=\"line\">    nacos:</span><br><span class=\"line\">      config:</span><br><span class=\"line\">\t\tserver-addr: 127.0.0.1:8848 #nacos</span><br><span class=\"line\">\t\tfile-extension: yaml # </span><br><span class=\"line\">\t\tshared-dataids: spring-cloud-all.yaml #  refreshable-dataids: spring-cloud-all.yaml #  </span><br><span class=\"line\">  profiles:</span><br><span class=\"line\">\tactive: dev #  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<h2 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h2><p><strong>(Namespace)</strong></p>\n<p></p>\n<p><strong>(Group)</strong></p>\n<p></p>\n<p><strong>(Data ID)</strong></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20231024101307177.png\" alt=\"image-20231024101307177\"></p>\n","excerpt":"","more":"<p>o<code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.08.03</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-03-NacosDataID\"><a href=\"#Spring-Cloud-Alibaba-03-NacosDataID\" class=\"headerlink\" title=\"Spring Cloud Alibaba-03-NacosDataID\"></a>Spring Cloud Alibaba-03-NacosDataID</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>,:</p>\n<ol>\n<li> </li>\n<li>:  </li>\n<li> </li>\n</ol>\n<p> :</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Apollo</strong></td>\n<td>Apollo: API </td>\n</tr>\n<tr>\n<td><strong>Disconf</strong></td>\n<td>DisconfZookeeper </td>\n</tr>\n<tr>\n<td>**SpringCloud Config              **</td>\n<td>Spring CloudSpring Git</td>\n</tr>\n<tr>\n<td><strong>Nacos</strong></td>\n<td>SpingCloud alibaba </td>\n</tr>\n</tbody></table>\n<h2 id=\"Nacos-Config\"><a href=\"#Nacos-Config\" class=\"headerlink\" title=\"Nacos Config\"></a>Nacos Config</h2><p>Nacosnacos<br>nacosnacos</p>\n<p>1 nacosnacos<br>2 nacos</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>3nacos config</p>\n<blockquote>\n<p>:application.ymlbootstrap.yml</p>\n</blockquote>\n<p>():</p>\n<blockquote>\n<p>bootstrap.properties -&gt; bootstrap.yml -&gt; application.properties -&gt; application.yml</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-cloud-service</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\">        <span class=\"attr\">file-extension:</span> <span class=\"string\">yaml</span> <span class=\"comment\">#  </span></span><br><span class=\"line\">        </span><br><span class=\"line\">  <span class=\"attr\">profiles:</span> </span><br><span class=\"line\">\t  <span class=\"attr\">active:</span> <span class=\"string\">dev</span> <span class=\"comment\">#       </span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>nacos +:</p>\n<blockquote>\n<p>1)Data ID<br>2)YAMLProperties<br>3)</p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20231008103734081.png\" alt=\"image-20231008103734081\"></p>\n<p>application.yam </p>\n<p>nacos</p>\n<h2 id=\"Nacos-Config\"><a href=\"#Nacos-Config\" class=\"headerlink\" title=\"Nacos Config\"></a>Nacos Config</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p>nacos spring-cloud-service-dev.yaml:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">config:</span></span><br><span class=\"line\">    <span class=\"attr\">appName:</span> <span class=\"string\">service</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><strong></strong>: </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigurableApplicationContext applicationContext;</span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">\t <span class=\"meta\">@GetMapping(value = &quot;/getConfigName&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getConfigName</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> applicationContext.getEnvironment().getProperty(<span class=\"string\">&quot;config.appName&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong>: ()</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RefreshScope</span><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;config.appName&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String configName;</span><br><span class=\"line\">    </span><br><span class=\"line\">\t<span class=\"comment\">//2  </span></span><br><span class=\"line\">\t   <span class=\"meta\">@GetMapping(value = &quot;/getConfigNames&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getConfigNames</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> configName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> ?</p>\n<p><strong></strong></p>\n<p><br> spring.application.name  </p>\n<p>1spring-cloud-service.yaml</p>\n<p><img src=\"/typora-user-images/image-20231024095726856.png\" alt=\"image-20231024095726856\"></p>\n<p>2 spring-cloud-service-test.yaml</p>\n<p><img src=\"/typora-user-images/image-20231024095816182.png\" alt=\"image-20231024095816182\"></p>\n<p>3 spring-cloud-service-dev.yaml<img src=\"/typora-user-images/image-20231024095843156.png\" alt=\"image-20231024095843156\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RefreshScope</span><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;config.appName&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String configName;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;config.env&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String env;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/getConfigNames&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getConfigNames</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> configName+<span class=\"string\">&quot;&quot;</span>+env;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>4</p>\n<p><img src=\"/typora-user-images/image-20231024094558547.png\" alt=\"image-20231024094558547\"></p>\n<p>activetest</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">     <span class=\"attr\">active:</span> <span class=\"string\">test</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><p><br></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://spring_cloud_service?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">root</span></span><br><span class=\"line\">  <span class=\"attr\">jpa:</span></span><br><span class=\"line\">    <span class=\"attr\">properties:</span></span><br><span class=\"line\">      <span class=\"attr\">hibernate:</span></span><br><span class=\"line\">        <span class=\"attr\">hbm2ddl:</span></span><br><span class=\"line\">          <span class=\"attr\">auto:</span> <span class=\"string\">update</span></span><br><span class=\"line\">        <span class=\"attr\">dialect:</span> <span class=\"string\">org.hibernate.dialect.MySQL5InnoDBDialect</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>bootstrap.yaml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  application:</span><br><span class=\"line\">    name: service-product</span><br><span class=\"line\">  cloud:</span><br><span class=\"line\">    nacos:</span><br><span class=\"line\">      config:</span><br><span class=\"line\">\t\tserver-addr: 127.0.0.1:8848 #nacos</span><br><span class=\"line\">\t\tfile-extension: yaml # </span><br><span class=\"line\">\t\tshared-dataids: spring-cloud-all.yaml #  refreshable-dataids: spring-cloud-all.yaml #  </span><br><span class=\"line\">  profiles:</span><br><span class=\"line\">\tactive: dev #  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<h2 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h2><p><strong>(Namespace)</strong></p>\n<p></p>\n<p><strong>(Group)</strong></p>\n<p></p>\n<p><strong>(Data ID)</strong></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20231024101307177.png\" alt=\"image-20231024101307177\"></p>\n"},{"_content":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.10.03`\n\n# Spring Cloud Alibaba-04-SentinelNacos-\n\n[toc]\n\n\n\n\n\n## Sentinel-Dashboard Nacos\n\n****https://sentinelguard.io/zh-cn/docs/quick-start.html\n\n\nNacosDataSource\nSentinel-Dashboarddashboardhttp\n\n\n\n~~~java\npublishRules(entity.getApp(), entity.getIp(), entity.getPort()).get(5000, TimeUnit.MILLISECONDS);\n\n   List<FlowRuleEntity> rules = repository.findAllByMachine(MachineInfo.of(app, ip, port));\n        return sentinelApiClient.setFlowRuleOfMachineAsync(app, ip, port, rules);\n\n~~~\n\ndashboardnacosNacosDataSource\n\ndashboardControllerControllerrepository\n\n\n\n~~~java\n    @Autowired\n    private RuleRepository<DegradeRuleEntity, Long> repository;\n~~~\n\nInMemDegradeRuleStore \n\n~~~java\npublic class InMemDegradeRuleStore extends InMemoryRuleRepositoryAdapter<DegradeRuleEntity>\n~~~\n\n\n\nrespositorynacos\n\n\n\n## \n\n### test\n\n~~~xml\n        <dependency>\n            <groupId>com.alibaba.csp</groupId>\n            <artifactId>sentinel-datasource-nacos</artifactId>\n<!--            <scope>test</scope>-->\n        </dependency>\n\n~~~\n\n\n\n###  NacosConfig\n\n\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.config;\n\n\nimport com.alibaba.nacos.api.NacosFactory;\nimport com.alibaba.nacos.api.PropertyKeyConst;\nimport com.alibaba.nacos.api.config.ConfigService;\nimport com.alibaba.nacos.api.exception.NacosException;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.util.StringUtils;\n\nimport java.util.Properties;\n\n/**\n * @className: com.alibaba.csp.sentinel.dashboard.config-> NacosConfig\n * @description:\n * @author: Lison\n * @createDate: 2023-10-03\n */\n@Configuration\n@EnableConfigurationProperties(NacosConfig.NacosProperties.class)\npublic class NacosConfig {\n\n    @ConfigurationProperties(prefix = \"nacos.config\")\n    public static class NacosProperties{\n        private String group = \"DEFAULT_GROUP\";\n        private String namespace;\n        private String authDataId = \"sentinel-dashboard-auth\";\n\n        private String username;\n\n\n        private String password;\n        private Long timeout = 3000L;\n\n        private String serverAddr;\n\n        public String getGroup() {\n            return group;\n        }\n\n        public void setGroup(String group) {\n            this.group = group;\n        }\n\n        public String getNamespace() {\n            return namespace;\n        }\n\n        public void setNamespace(String namespace) {\n            this.namespace = namespace;\n        }\n\n        public Long getTimeout() {\n            return timeout;\n        }\n\n        public void setTimeout(Long timeout) {\n            this.timeout = timeout;\n        }\n\n        public String getServerAddr() {\n            return serverAddr;\n        }\n\n        public void setServerAddr(String serverAddr) {\n            this.serverAddr = serverAddr;\n        }\n\n        public String getAuthDataId() {\n            return authDataId;\n        }\n\n        public void setAuthDataId(String authDataId) {\n            this.authDataId = authDataId;\n        }\n\n        public String getUsername() { return username;}\n\n        public void setUsername(String username) { this.username = username;}\n\n        public String getPassword() {return password;}\n\n        public void setPassword(String password) { this.password = password;}\n    }\n\n    @Bean\n    public ConfigService configService(NacosProperties nacosProperties) throws NacosException {\n        Properties properties = new Properties();\n        properties.setProperty(PropertyKeyConst.SERVER_ADDR, nacosProperties.getServerAddr());\n        if (!StringUtils.isEmpty(nacosProperties.getNamespace())) {\n            properties.setProperty(PropertyKeyConst.NAMESPACE, nacosProperties.getNamespace());\n        }\n\n        if (!StringUtils.isEmpty(nacosProperties.getUsername())) {\n            properties.setProperty(PropertyKeyConst.USERNAME, nacosProperties.getUsername());\n        }\n\n        if (!StringUtils.isEmpty(nacosProperties.getPassword())) {\n            properties.setProperty(PropertyKeyConst.PASSWORD, nacosProperties.getPassword());\n        }\n\n        return NacosFactory.createConfigService(properties);\n    }\n\n}\n\n\n~~~\n\n### Repository\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.config;\n\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.gateway.ApiDefinitionEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.gateway.GatewayFlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.AuthorityRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.DegradeRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.ParamFlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.SystemRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.repository.gateway.InMemApiDefinitionStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.gateway.InMemGatewayFlowRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemAuthorityRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemDegradeRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemFlowRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemParamFlowRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemSystemRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemoryRuleRepositoryAdapter;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.NacosRepository;\nimport com.alibaba.nacos.api.config.ConfigService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Primary;\n\n/**\n * @className: com.alibaba.csp.sentinel.dashboard.config-> NacosRepositoryConfig\n * @description:\n * @author: Lison\n * @createDate: 2023-10-03\n */\n@Configuration\npublic class NacosRepositoryConfig {\n    @Autowired\n    private ConfigService configService;\n    @Autowired\n    private NacosConfig.NacosProperties nacosProperties;\n\n    @Bean\n    public NacosRepository<ApiDefinitionEntity> apiDefinitionEntityNacosRepository(InMemApiDefinitionStore inMemApiDefinitionStore){\n        return buildNacosRepository(\"gateway-api-definition\",inMemApiDefinitionStore);\n    };\n\n    @Bean\n    public NacosRepository<GatewayFlowRuleEntity> gatewayFlowRuleEntityNacosRepository(InMemGatewayFlowRuleStore inMemGatewayFlowRuleStore){\n        return buildNacosRepository(\"gateway-flow-rule\",inMemGatewayFlowRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<AuthorityRuleEntity> authorityRuleEntityNacosRepository(InMemAuthorityRuleStore inMemAuthorityRuleStore){\n        return buildNacosRepository(\"authority-rule\",inMemAuthorityRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<DegradeRuleEntity> degradeRuleEntityNacosRepository(InMemDegradeRuleStore inMemDegradeRuleStore){\n        return buildNacosRepository(\"degrade-rule\",inMemDegradeRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<FlowRuleEntity> flowRuleEntityNacosRepository(InMemFlowRuleStore inMemFlowRuleStore){\n        return buildNacosRepository(\"flow-rule\",inMemFlowRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<ParamFlowRuleEntity> paramFlowRuleEntityNacosRepository(InMemParamFlowRuleStore inMemParamFlowRuleStore){\n        return buildNacosRepository(\"param-flow-rule\",inMemParamFlowRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<SystemRuleEntity> systemRuleEntityNacosRepository(InMemSystemRuleStore inMemSystemRuleStore){\n        return buildNacosRepository(\"system-rule\",inMemSystemRuleStore);\n    };\n\n    private <T extends RuleEntity> NacosRepository<T> buildNacosRepository(String suffix, InMemoryRuleRepositoryAdapter<T> ruleRepositoryAdapter){\n        NacosRepository<T> nacosRepository = new NacosRepository<>(suffix);\n        nacosRepository.setNacosProperties(nacosProperties);\n        nacosRepository.setRuleRepositoryAdapter(ruleRepositoryAdapter);\n        nacosRepository.setConfigService(configService);\n        return nacosRepository;\n    }\n\n}\n\n~~~\n\n\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.datasource.entity;\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;\nimport com.fasterxml.jackson.databind.ObjectMapper;\n\nimport java.util.Map;\n\n/**\n * @className: com.alibaba.csp.sentinel.dashboard.datasource.entity-> NacosEntity\n * @description:\n * @author: Lison\n * @createDate: 2023-10-03\n */public class NacosEntity<T extends RuleEntity> {\n\n    private T rule;\n\n    public NacosEntity(T sentinelRule) {\n        this.rule = sentinelRule;\n    }\n\n    // Getter\n    public T getRule() {\n        return rule;\n    }\n\n}\n\n~~~\n\n\n\n### Repository\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.repository.rule;\n\n\nimport com.alibaba.csp.sentinel.dashboard.config.NacosConfig;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.NacosEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.discovery.MachineInfo;\nimport com.alibaba.fastjson.JSON;\nimport com.alibaba.nacos.api.config.ConfigService;\nimport com.alibaba.nacos.api.config.ConfigType;\n\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n/**\n * @className: com.alibaba.csp.sentinel.dashboard.repository.rule-> NacosRepository\n * @description:\n * @author: Lison\n * @createDate: 2023-10-03\n */\n\npublic class NacosRepository<T extends RuleEntity> implements RuleRepository<T, Long> {\n\n    private ConfigService configService;\n\n    private NacosConfig.NacosProperties nacosProperties;\n\n    private InMemoryRuleRepositoryAdapter<T> ruleRepositoryAdapter;\n\n    private final String suffix;\n\n    public NacosRepository(String suffix){\n        this.suffix = suffix;\n    }\n\n    public ConfigService getConfigService() {\n        return configService;\n    }\n\n    public void setConfigService(ConfigService configService) {\n        this.configService = configService;\n    }\n\n    public NacosConfig.NacosProperties getNacosProperties() {\n        return nacosProperties;\n    }\n\n    public void setNacosProperties(NacosConfig.NacosProperties nacosProperties) {\n        this.nacosProperties = nacosProperties;\n    }\n\n    public InMemoryRuleRepositoryAdapter<T> getRuleRepositoryAdapter() {\n        return ruleRepositoryAdapter;\n    }\n\n    public void setRuleRepositoryAdapter(InMemoryRuleRepositoryAdapter<T> ruleRepositoryAdapter) {\n        this.ruleRepositoryAdapter = ruleRepositoryAdapter;\n    }\n\n    @Override\n    public T save(T entity) {\n        T save = ruleRepositoryAdapter.save(entity);\n        publishConfig(entity.getApp());\n        return save;\n    }\n\n    @Override\n    public List<T> saveAll(List<T> rules) {\n        List<T> ts = ruleRepositoryAdapter.saveAll(rules);\n        if(ts!=null && !ts.isEmpty()){\n            publishConfig(ts.get(0).getApp());\n        }\n        return ts;\n    }\n\n    @Override\n    public T delete(Long id) {\n        T delete = ruleRepositoryAdapter.delete(id);\n        publishConfig(delete.getApp());\n        return delete;\n    }\n\n    @Override\n    public T findById(Long id) {\n        return ruleRepositoryAdapter.findById(id);\n    }\n\n    @Override\n    public List<T> findAllByMachine(MachineInfo machineInfo) {\n        return ruleRepositoryAdapter.findAllByMachine(machineInfo);\n    }\n\n    @Override\n    public List<T> findAllByApp(String appName) {\n        return ruleRepositoryAdapter.findAllByApp(appName);\n    }\n\n    private void publishConfig(String app) {\n        try {\n            List<T> allByApp = ruleRepositoryAdapter.findAllByApp(app);\n            List<Object> rules = allByApp.stream().map(NacosEntity::new).map(NacosEntity::getRule).collect(Collectors.toList());\n            configService.publishConfig(app + \"-\" + suffix, nacosProperties.getGroup(), JSON.toJSONString(rules), ConfigType.JSON.getType());\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n\n}\n\n\n~~~\n\n\n\n\n\n### Controllerrepository\n\n~~~java\n@RestController\n@RequestMapping(value = \"/v1/flow\")\npublic class FlowControllerV1 {\n\n    private final Logger logger = LoggerFactory.getLogger(FlowControllerV1.class);\n\n    @Autowired\n    private NacosRepository<FlowRuleEntity> repository;\n}\n~~~\n\n### \n\n~~~properties\n\nnacos.config.group=DEFAULT_GROUP;\nnacos.config.namespace=sentinelId;\nnacos.config.password=nacos;\nnacos.config.serverAddr=http://127.0.0.1:8848;\nnacos.config.username=nacos\n\n~~~\n\npom\n\n~~~xml\n        <dependency>\n            <groupId>com.alibaba.csp</groupId>\n            <artifactId>sentinel-datasource-nacos</artifactId>\n            <version>xxxx</version>\n        </dependency>\n\n~~~\n\n\n\n![image-20240221155333042](typora-user-images/image-20240221155333042.png)","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-04-SentinelNacos.md","raw":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.10.03`\n\n# Spring Cloud Alibaba-04-SentinelNacos-\n\n[toc]\n\n\n\n\n\n## Sentinel-Dashboard Nacos\n\n****https://sentinelguard.io/zh-cn/docs/quick-start.html\n\n\nNacosDataSource\nSentinel-Dashboarddashboardhttp\n\n\n\n~~~java\npublishRules(entity.getApp(), entity.getIp(), entity.getPort()).get(5000, TimeUnit.MILLISECONDS);\n\n   List<FlowRuleEntity> rules = repository.findAllByMachine(MachineInfo.of(app, ip, port));\n        return sentinelApiClient.setFlowRuleOfMachineAsync(app, ip, port, rules);\n\n~~~\n\ndashboardnacosNacosDataSource\n\ndashboardControllerControllerrepository\n\n\n\n~~~java\n    @Autowired\n    private RuleRepository<DegradeRuleEntity, Long> repository;\n~~~\n\nInMemDegradeRuleStore \n\n~~~java\npublic class InMemDegradeRuleStore extends InMemoryRuleRepositoryAdapter<DegradeRuleEntity>\n~~~\n\n\n\nrespositorynacos\n\n\n\n## \n\n### test\n\n~~~xml\n        <dependency>\n            <groupId>com.alibaba.csp</groupId>\n            <artifactId>sentinel-datasource-nacos</artifactId>\n<!--            <scope>test</scope>-->\n        </dependency>\n\n~~~\n\n\n\n###  NacosConfig\n\n\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.config;\n\n\nimport com.alibaba.nacos.api.NacosFactory;\nimport com.alibaba.nacos.api.PropertyKeyConst;\nimport com.alibaba.nacos.api.config.ConfigService;\nimport com.alibaba.nacos.api.exception.NacosException;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.util.StringUtils;\n\nimport java.util.Properties;\n\n/**\n * @className: com.alibaba.csp.sentinel.dashboard.config-> NacosConfig\n * @description:\n * @author: Lison\n * @createDate: 2023-10-03\n */\n@Configuration\n@EnableConfigurationProperties(NacosConfig.NacosProperties.class)\npublic class NacosConfig {\n\n    @ConfigurationProperties(prefix = \"nacos.config\")\n    public static class NacosProperties{\n        private String group = \"DEFAULT_GROUP\";\n        private String namespace;\n        private String authDataId = \"sentinel-dashboard-auth\";\n\n        private String username;\n\n\n        private String password;\n        private Long timeout = 3000L;\n\n        private String serverAddr;\n\n        public String getGroup() {\n            return group;\n        }\n\n        public void setGroup(String group) {\n            this.group = group;\n        }\n\n        public String getNamespace() {\n            return namespace;\n        }\n\n        public void setNamespace(String namespace) {\n            this.namespace = namespace;\n        }\n\n        public Long getTimeout() {\n            return timeout;\n        }\n\n        public void setTimeout(Long timeout) {\n            this.timeout = timeout;\n        }\n\n        public String getServerAddr() {\n            return serverAddr;\n        }\n\n        public void setServerAddr(String serverAddr) {\n            this.serverAddr = serverAddr;\n        }\n\n        public String getAuthDataId() {\n            return authDataId;\n        }\n\n        public void setAuthDataId(String authDataId) {\n            this.authDataId = authDataId;\n        }\n\n        public String getUsername() { return username;}\n\n        public void setUsername(String username) { this.username = username;}\n\n        public String getPassword() {return password;}\n\n        public void setPassword(String password) { this.password = password;}\n    }\n\n    @Bean\n    public ConfigService configService(NacosProperties nacosProperties) throws NacosException {\n        Properties properties = new Properties();\n        properties.setProperty(PropertyKeyConst.SERVER_ADDR, nacosProperties.getServerAddr());\n        if (!StringUtils.isEmpty(nacosProperties.getNamespace())) {\n            properties.setProperty(PropertyKeyConst.NAMESPACE, nacosProperties.getNamespace());\n        }\n\n        if (!StringUtils.isEmpty(nacosProperties.getUsername())) {\n            properties.setProperty(PropertyKeyConst.USERNAME, nacosProperties.getUsername());\n        }\n\n        if (!StringUtils.isEmpty(nacosProperties.getPassword())) {\n            properties.setProperty(PropertyKeyConst.PASSWORD, nacosProperties.getPassword());\n        }\n\n        return NacosFactory.createConfigService(properties);\n    }\n\n}\n\n\n~~~\n\n### Repository\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.config;\n\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.gateway.ApiDefinitionEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.gateway.GatewayFlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.AuthorityRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.DegradeRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.ParamFlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.SystemRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.repository.gateway.InMemApiDefinitionStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.gateway.InMemGatewayFlowRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemAuthorityRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemDegradeRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemFlowRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemParamFlowRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemSystemRuleStore;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.InMemoryRuleRepositoryAdapter;\nimport com.alibaba.csp.sentinel.dashboard.repository.rule.NacosRepository;\nimport com.alibaba.nacos.api.config.ConfigService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Primary;\n\n/**\n * @className: com.alibaba.csp.sentinel.dashboard.config-> NacosRepositoryConfig\n * @description:\n * @author: Lison\n * @createDate: 2023-10-03\n */\n@Configuration\npublic class NacosRepositoryConfig {\n    @Autowired\n    private ConfigService configService;\n    @Autowired\n    private NacosConfig.NacosProperties nacosProperties;\n\n    @Bean\n    public NacosRepository<ApiDefinitionEntity> apiDefinitionEntityNacosRepository(InMemApiDefinitionStore inMemApiDefinitionStore){\n        return buildNacosRepository(\"gateway-api-definition\",inMemApiDefinitionStore);\n    };\n\n    @Bean\n    public NacosRepository<GatewayFlowRuleEntity> gatewayFlowRuleEntityNacosRepository(InMemGatewayFlowRuleStore inMemGatewayFlowRuleStore){\n        return buildNacosRepository(\"gateway-flow-rule\",inMemGatewayFlowRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<AuthorityRuleEntity> authorityRuleEntityNacosRepository(InMemAuthorityRuleStore inMemAuthorityRuleStore){\n        return buildNacosRepository(\"authority-rule\",inMemAuthorityRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<DegradeRuleEntity> degradeRuleEntityNacosRepository(InMemDegradeRuleStore inMemDegradeRuleStore){\n        return buildNacosRepository(\"degrade-rule\",inMemDegradeRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<FlowRuleEntity> flowRuleEntityNacosRepository(InMemFlowRuleStore inMemFlowRuleStore){\n        return buildNacosRepository(\"flow-rule\",inMemFlowRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<ParamFlowRuleEntity> paramFlowRuleEntityNacosRepository(InMemParamFlowRuleStore inMemParamFlowRuleStore){\n        return buildNacosRepository(\"param-flow-rule\",inMemParamFlowRuleStore);\n    };\n\n    @Bean\n    @Primary\n    public NacosRepository<SystemRuleEntity> systemRuleEntityNacosRepository(InMemSystemRuleStore inMemSystemRuleStore){\n        return buildNacosRepository(\"system-rule\",inMemSystemRuleStore);\n    };\n\n    private <T extends RuleEntity> NacosRepository<T> buildNacosRepository(String suffix, InMemoryRuleRepositoryAdapter<T> ruleRepositoryAdapter){\n        NacosRepository<T> nacosRepository = new NacosRepository<>(suffix);\n        nacosRepository.setNacosProperties(nacosProperties);\n        nacosRepository.setRuleRepositoryAdapter(ruleRepositoryAdapter);\n        nacosRepository.setConfigService(configService);\n        return nacosRepository;\n    }\n\n}\n\n~~~\n\n\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.datasource.entity;\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;\nimport com.fasterxml.jackson.databind.ObjectMapper;\n\nimport java.util.Map;\n\n/**\n * @className: com.alibaba.csp.sentinel.dashboard.datasource.entity-> NacosEntity\n * @description:\n * @author: Lison\n * @createDate: 2023-10-03\n */public class NacosEntity<T extends RuleEntity> {\n\n    private T rule;\n\n    public NacosEntity(T sentinelRule) {\n        this.rule = sentinelRule;\n    }\n\n    // Getter\n    public T getRule() {\n        return rule;\n    }\n\n}\n\n~~~\n\n\n\n### Repository\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.repository.rule;\n\n\nimport com.alibaba.csp.sentinel.dashboard.config.NacosConfig;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.NacosEntity;\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.discovery.MachineInfo;\nimport com.alibaba.fastjson.JSON;\nimport com.alibaba.nacos.api.config.ConfigService;\nimport com.alibaba.nacos.api.config.ConfigType;\n\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n/**\n * @className: com.alibaba.csp.sentinel.dashboard.repository.rule-> NacosRepository\n * @description:\n * @author: Lison\n * @createDate: 2023-10-03\n */\n\npublic class NacosRepository<T extends RuleEntity> implements RuleRepository<T, Long> {\n\n    private ConfigService configService;\n\n    private NacosConfig.NacosProperties nacosProperties;\n\n    private InMemoryRuleRepositoryAdapter<T> ruleRepositoryAdapter;\n\n    private final String suffix;\n\n    public NacosRepository(String suffix){\n        this.suffix = suffix;\n    }\n\n    public ConfigService getConfigService() {\n        return configService;\n    }\n\n    public void setConfigService(ConfigService configService) {\n        this.configService = configService;\n    }\n\n    public NacosConfig.NacosProperties getNacosProperties() {\n        return nacosProperties;\n    }\n\n    public void setNacosProperties(NacosConfig.NacosProperties nacosProperties) {\n        this.nacosProperties = nacosProperties;\n    }\n\n    public InMemoryRuleRepositoryAdapter<T> getRuleRepositoryAdapter() {\n        return ruleRepositoryAdapter;\n    }\n\n    public void setRuleRepositoryAdapter(InMemoryRuleRepositoryAdapter<T> ruleRepositoryAdapter) {\n        this.ruleRepositoryAdapter = ruleRepositoryAdapter;\n    }\n\n    @Override\n    public T save(T entity) {\n        T save = ruleRepositoryAdapter.save(entity);\n        publishConfig(entity.getApp());\n        return save;\n    }\n\n    @Override\n    public List<T> saveAll(List<T> rules) {\n        List<T> ts = ruleRepositoryAdapter.saveAll(rules);\n        if(ts!=null && !ts.isEmpty()){\n            publishConfig(ts.get(0).getApp());\n        }\n        return ts;\n    }\n\n    @Override\n    public T delete(Long id) {\n        T delete = ruleRepositoryAdapter.delete(id);\n        publishConfig(delete.getApp());\n        return delete;\n    }\n\n    @Override\n    public T findById(Long id) {\n        return ruleRepositoryAdapter.findById(id);\n    }\n\n    @Override\n    public List<T> findAllByMachine(MachineInfo machineInfo) {\n        return ruleRepositoryAdapter.findAllByMachine(machineInfo);\n    }\n\n    @Override\n    public List<T> findAllByApp(String appName) {\n        return ruleRepositoryAdapter.findAllByApp(appName);\n    }\n\n    private void publishConfig(String app) {\n        try {\n            List<T> allByApp = ruleRepositoryAdapter.findAllByApp(app);\n            List<Object> rules = allByApp.stream().map(NacosEntity::new).map(NacosEntity::getRule).collect(Collectors.toList());\n            configService.publishConfig(app + \"-\" + suffix, nacosProperties.getGroup(), JSON.toJSONString(rules), ConfigType.JSON.getType());\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n\n}\n\n\n~~~\n\n\n\n\n\n### Controllerrepository\n\n~~~java\n@RestController\n@RequestMapping(value = \"/v1/flow\")\npublic class FlowControllerV1 {\n\n    private final Logger logger = LoggerFactory.getLogger(FlowControllerV1.class);\n\n    @Autowired\n    private NacosRepository<FlowRuleEntity> repository;\n}\n~~~\n\n### \n\n~~~properties\n\nnacos.config.group=DEFAULT_GROUP;\nnacos.config.namespace=sentinelId;\nnacos.config.password=nacos;\nnacos.config.serverAddr=http://127.0.0.1:8848;\nnacos.config.username=nacos\n\n~~~\n\npom\n\n~~~xml\n        <dependency>\n            <groupId>com.alibaba.csp</groupId>\n            <artifactId>sentinel-datasource-nacos</artifactId>\n            <version>xxxx</version>\n        </dependency>\n\n~~~\n\n\n\n![image-20240221155333042](typora-user-images/image-20240221155333042.png)","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-04-SentinelNacos","published":1,"date":"2024-02-21T02:16:49.053Z","updated":"2024-02-21T07:55:28.076Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhg0002ecfyhfup6r11","content":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.10.03</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-04-SentinelNacos-\"><a href=\"#Spring-Cloud-Alibaba-04-SentinelNacos-\" class=\"headerlink\" title=\"Spring Cloud Alibaba-04-SentinelNacos-\"></a>Spring Cloud Alibaba-04-SentinelNacos-</h1><p>[toc]</p>\n<h2 id=\"Sentinel-Dashboard-Nacos\"><a href=\"#Sentinel-Dashboard-Nacos\" class=\"headerlink\" title=\"Sentinel-Dashboard Nacos\"></a>Sentinel-Dashboard Nacos</h2><p><strong></strong><a href=\"https://sentinelguard.io/zh-cn/docs/quick-start.html\">https://sentinelguard.io/zh-cn/docs/quick-start.html</a></p>\n<p><br>NacosDataSource<br>Sentinel-Dashboarddashboardhttp</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">publishRules(entity.getApp(), entity.getIp(), entity.getPort()).get(<span class=\"number\">5000</span>, TimeUnit.MILLISECONDS);</span><br><span class=\"line\"></span><br><span class=\"line\">   List&lt;FlowRuleEntity&gt; rules = repository.findAllByMachine(MachineInfo.of(app, ip, port));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sentinelApiClient.setFlowRuleOfMachineAsync(app, ip, port, rules);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>dashboardnacosNacosDataSource</p>\n<p>dashboardControllerControllerrepository</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> RuleRepository&lt;DegradeRuleEntity, Long&gt; repository;</span><br></pre></td></tr></table></figure>\n\n<p>InMemDegradeRuleStore </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">InMemDegradeRuleStore</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">InMemoryRuleRepositoryAdapter</span>&lt;DegradeRuleEntity&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>respositorynacos</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"test\"><a href=\"#test\" class=\"headerlink\" title=\"test\"></a>test</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;scope&gt;test&lt;/scope&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"-NacosConfig\"><a href=\"#-NacosConfig\" class=\"headerlink\" title=\" NacosConfig\"></a> NacosConfig</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.NacosFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.PropertyKeyConst;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.exception.NacosException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.util.StringUtils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.alibaba.csp.sentinel.dashboard.config-&gt; NacosConfig</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-03</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableConfigurationProperties(NacosConfig.NacosProperties.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ConfigurationProperties(prefix = &quot;nacos.config&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosProperties</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">String</span> <span class=\"variable\">group</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;DEFAULT_GROUP&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String namespace;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">String</span> <span class=\"variable\">authDataId</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;sentinel-dashboard-auth&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">Long</span> <span class=\"variable\">timeout</span> <span class=\"operator\">=</span> <span class=\"number\">3000L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> String serverAddr;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getGroup</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> group;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setGroup</span><span class=\"params\">(String group)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.group = group;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getNamespace</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> namespace;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setNamespace</span><span class=\"params\">(String namespace)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.namespace = namespace;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Long <span class=\"title function_\">getTimeout</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> timeout;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setTimeout</span><span class=\"params\">(Long timeout)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.timeout = timeout;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getServerAddr</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> serverAddr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setServerAddr</span><span class=\"params\">(String serverAddr)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.serverAddr = serverAddr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getAuthDataId</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> authDataId;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setAuthDataId</span><span class=\"params\">(String authDataId)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.authDataId = authDataId;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getUsername</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> username;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setUsername</span><span class=\"params\">(String username)</span> &#123; <span class=\"built_in\">this</span>.username = username;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getPassword</span><span class=\"params\">()</span> &#123;<span class=\"keyword\">return</span> password;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setPassword</span><span class=\"params\">(String password)</span> &#123; <span class=\"built_in\">this</span>.password = password;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ConfigService <span class=\"title function_\">configService</span><span class=\"params\">(NacosProperties nacosProperties)</span> <span class=\"keyword\">throws</span> NacosException &#123;</span><br><span class=\"line\">        <span class=\"type\">Properties</span> <span class=\"variable\">properties</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Properties</span>();</span><br><span class=\"line\">        properties.setProperty(PropertyKeyConst.SERVER_ADDR, nacosProperties.getServerAddr());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!StringUtils.isEmpty(nacosProperties.getNamespace())) &#123;</span><br><span class=\"line\">            properties.setProperty(PropertyKeyConst.NAMESPACE, nacosProperties.getNamespace());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!StringUtils.isEmpty(nacosProperties.getUsername())) &#123;</span><br><span class=\"line\">            properties.setProperty(PropertyKeyConst.USERNAME, nacosProperties.getUsername());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!StringUtils.isEmpty(nacosProperties.getPassword())) &#123;</span><br><span class=\"line\">            properties.setProperty(PropertyKeyConst.PASSWORD, nacosProperties.getPassword());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> NacosFactory.createConfigService(properties);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Repository\"><a href=\"#Repository\" class=\"headerlink\" title=\"Repository\"></a>Repository</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.gateway.ApiDefinitionEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.gateway.GatewayFlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.AuthorityRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.DegradeRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.ParamFlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.SystemRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.gateway.InMemApiDefinitionStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.gateway.InMemGatewayFlowRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemAuthorityRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemDegradeRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemFlowRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemParamFlowRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemSystemRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemoryRuleRepositoryAdapter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.NacosRepository;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Primary;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.alibaba.csp.sentinel.dashboard.config-&gt; NacosRepositoryConfig</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-03</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosRepositoryConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigService configService;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> NacosConfig.NacosProperties nacosProperties;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;ApiDefinitionEntity&gt; <span class=\"title function_\">apiDefinitionEntityNacosRepository</span><span class=\"params\">(InMemApiDefinitionStore inMemApiDefinitionStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;gateway-api-definition&quot;</span>,inMemApiDefinitionStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;GatewayFlowRuleEntity&gt; <span class=\"title function_\">gatewayFlowRuleEntityNacosRepository</span><span class=\"params\">(InMemGatewayFlowRuleStore inMemGatewayFlowRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;gateway-flow-rule&quot;</span>,inMemGatewayFlowRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;AuthorityRuleEntity&gt; <span class=\"title function_\">authorityRuleEntityNacosRepository</span><span class=\"params\">(InMemAuthorityRuleStore inMemAuthorityRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;authority-rule&quot;</span>,inMemAuthorityRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;DegradeRuleEntity&gt; <span class=\"title function_\">degradeRuleEntityNacosRepository</span><span class=\"params\">(InMemDegradeRuleStore inMemDegradeRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;degrade-rule&quot;</span>,inMemDegradeRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;FlowRuleEntity&gt; <span class=\"title function_\">flowRuleEntityNacosRepository</span><span class=\"params\">(InMemFlowRuleStore inMemFlowRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;flow-rule&quot;</span>,inMemFlowRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;ParamFlowRuleEntity&gt; <span class=\"title function_\">paramFlowRuleEntityNacosRepository</span><span class=\"params\">(InMemParamFlowRuleStore inMemParamFlowRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;param-flow-rule&quot;</span>,inMemParamFlowRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;SystemRuleEntity&gt; <span class=\"title function_\">systemRuleEntityNacosRepository</span><span class=\"params\">(InMemSystemRuleStore inMemSystemRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;system-rule&quot;</span>,inMemSystemRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> &lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">RuleEntity</span>&gt; NacosRepository&lt;T&gt; <span class=\"title function_\">buildNacosRepository</span><span class=\"params\">(String suffix, InMemoryRuleRepositoryAdapter&lt;T&gt; ruleRepositoryAdapter)</span>&#123;</span><br><span class=\"line\">        NacosRepository&lt;T&gt; nacosRepository = <span class=\"keyword\">new</span> <span class=\"title class_\">NacosRepository</span>&lt;&gt;(suffix);</span><br><span class=\"line\">        nacosRepository.setNacosProperties(nacosProperties);</span><br><span class=\"line\">        nacosRepository.setRuleRepositoryAdapter(ruleRepositoryAdapter);</span><br><span class=\"line\">        nacosRepository.setConfigService(configService);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> nacosRepository;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.datasource.entity;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.alibaba.csp.sentinel.dashboard.datasource.entity-&gt; NacosEntity</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-03</span></span><br><span class=\"line\"><span class=\"comment\"> */</span><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosEntity</span>&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">RuleEntity</span>&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> T rule;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">NacosEntity</span><span class=\"params\">(T sentinelRule)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.rule = sentinelRule;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Getter</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">getRule</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> rule;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Repository\"><a href=\"#Repository\" class=\"headerlink\" title=\"Repository\"></a>Repository</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.repository.rule;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.config.NacosConfig;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.NacosEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.discovery.MachineInfo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSON;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigType;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.stream.Collectors;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.alibaba.csp.sentinel.dashboard.repository.rule-&gt; NacosRepository</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-03</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosRepository</span>&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">RuleEntity</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">RuleRepository</span>&lt;T, Long&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigService configService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> NacosConfig.NacosProperties nacosProperties;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> InMemoryRuleRepositoryAdapter&lt;T&gt; ruleRepositoryAdapter;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String suffix;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">NacosRepository</span><span class=\"params\">(String suffix)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.suffix = suffix;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ConfigService <span class=\"title function_\">getConfigService</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> configService;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setConfigService</span><span class=\"params\">(ConfigService configService)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.configService = configService;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosConfig.NacosProperties <span class=\"title function_\">getNacosProperties</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> nacosProperties;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setNacosProperties</span><span class=\"params\">(NacosConfig.NacosProperties nacosProperties)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.nacosProperties = nacosProperties;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> InMemoryRuleRepositoryAdapter&lt;T&gt; <span class=\"title function_\">getRuleRepositoryAdapter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ruleRepositoryAdapter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setRuleRepositoryAdapter</span><span class=\"params\">(InMemoryRuleRepositoryAdapter&lt;T&gt; ruleRepositoryAdapter)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.ruleRepositoryAdapter = ruleRepositoryAdapter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">save</span><span class=\"params\">(T entity)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">T</span> <span class=\"variable\">save</span> <span class=\"operator\">=</span> ruleRepositoryAdapter.save(entity);</span><br><span class=\"line\">        publishConfig(entity.getApp());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> save;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;T&gt; <span class=\"title function_\">saveAll</span><span class=\"params\">(List&lt;T&gt; rules)</span> &#123;</span><br><span class=\"line\">        List&lt;T&gt; ts = ruleRepositoryAdapter.saveAll(rules);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(ts!=<span class=\"literal\">null</span> &amp;&amp; !ts.isEmpty())&#123;</span><br><span class=\"line\">            publishConfig(ts.get(<span class=\"number\">0</span>).getApp());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ts;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">delete</span><span class=\"params\">(Long id)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">T</span> <span class=\"variable\">delete</span> <span class=\"operator\">=</span> ruleRepositoryAdapter.delete(id);</span><br><span class=\"line\">        publishConfig(delete.getApp());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> delete;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">findById</span><span class=\"params\">(Long id)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ruleRepositoryAdapter.findById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;T&gt; <span class=\"title function_\">findAllByMachine</span><span class=\"params\">(MachineInfo machineInfo)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ruleRepositoryAdapter.findAllByMachine(machineInfo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;T&gt; <span class=\"title function_\">findAllByApp</span><span class=\"params\">(String appName)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ruleRepositoryAdapter.findAllByApp(appName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">publishConfig</span><span class=\"params\">(String app)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            List&lt;T&gt; allByApp = ruleRepositoryAdapter.findAllByApp(app);</span><br><span class=\"line\">            List&lt;Object&gt; rules = allByApp.stream().map(NacosEntity::<span class=\"keyword\">new</span>).map(NacosEntity::getRule).collect(Collectors.toList());</span><br><span class=\"line\">            configService.publishConfig(app + <span class=\"string\">&quot;-&quot;</span> + suffix, nacosProperties.getGroup(), JSON.toJSONString(rules), ConfigType.JSON.getType());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"Controllerrepository\"><a href=\"#Controllerrepository\" class=\"headerlink\" title=\"Controllerrepository\"></a>Controllerrepository</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(value = &quot;/v1/flow&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FlowControllerV1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Logger</span> <span class=\"variable\">logger</span> <span class=\"operator\">=</span> LoggerFactory.getLogger(FlowControllerV1.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> NacosRepository&lt;FlowRuleEntity&gt; repository;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">nacos.config.group</span>=<span class=\"string\">DEFAULT_GROUP;</span></span><br><span class=\"line\"><span class=\"attr\">nacos.config.namespace</span>=<span class=\"string\">sentinelId;</span></span><br><span class=\"line\"><span class=\"attr\">nacos.config.password</span>=<span class=\"string\">nacos;</span></span><br><span class=\"line\"><span class=\"attr\">nacos.config.serverAddr</span>=<span class=\"string\">http://127.0.0.1:8848;</span></span><br><span class=\"line\"><span class=\"attr\">nacos.config.username</span>=<span class=\"string\">nacos</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>pom</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>xxxx<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240221155333042.png\" alt=\"image-20240221155333042\"></p>\n","excerpt":"","more":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.10.03</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-04-SentinelNacos-\"><a href=\"#Spring-Cloud-Alibaba-04-SentinelNacos-\" class=\"headerlink\" title=\"Spring Cloud Alibaba-04-SentinelNacos-\"></a>Spring Cloud Alibaba-04-SentinelNacos-</h1><p>[toc]</p>\n<h2 id=\"Sentinel-Dashboard-Nacos\"><a href=\"#Sentinel-Dashboard-Nacos\" class=\"headerlink\" title=\"Sentinel-Dashboard Nacos\"></a>Sentinel-Dashboard Nacos</h2><p><strong></strong><a href=\"https://sentinelguard.io/zh-cn/docs/quick-start.html\">https://sentinelguard.io/zh-cn/docs/quick-start.html</a></p>\n<p><br>NacosDataSource<br>Sentinel-Dashboarddashboardhttp</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">publishRules(entity.getApp(), entity.getIp(), entity.getPort()).get(<span class=\"number\">5000</span>, TimeUnit.MILLISECONDS);</span><br><span class=\"line\"></span><br><span class=\"line\">   List&lt;FlowRuleEntity&gt; rules = repository.findAllByMachine(MachineInfo.of(app, ip, port));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sentinelApiClient.setFlowRuleOfMachineAsync(app, ip, port, rules);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>dashboardnacosNacosDataSource</p>\n<p>dashboardControllerControllerrepository</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> RuleRepository&lt;DegradeRuleEntity, Long&gt; repository;</span><br></pre></td></tr></table></figure>\n\n<p>InMemDegradeRuleStore </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">InMemDegradeRuleStore</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">InMemoryRuleRepositoryAdapter</span>&lt;DegradeRuleEntity&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>respositorynacos</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"test\"><a href=\"#test\" class=\"headerlink\" title=\"test\"></a>test</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--            &lt;scope&gt;test&lt;/scope&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"-NacosConfig\"><a href=\"#-NacosConfig\" class=\"headerlink\" title=\" NacosConfig\"></a> NacosConfig</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.NacosFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.PropertyKeyConst;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.exception.NacosException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.util.StringUtils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.alibaba.csp.sentinel.dashboard.config-&gt; NacosConfig</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-03</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableConfigurationProperties(NacosConfig.NacosProperties.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ConfigurationProperties(prefix = &quot;nacos.config&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosProperties</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">String</span> <span class=\"variable\">group</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;DEFAULT_GROUP&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String namespace;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">String</span> <span class=\"variable\">authDataId</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;sentinel-dashboard-auth&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">Long</span> <span class=\"variable\">timeout</span> <span class=\"operator\">=</span> <span class=\"number\">3000L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> String serverAddr;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getGroup</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> group;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setGroup</span><span class=\"params\">(String group)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.group = group;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getNamespace</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> namespace;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setNamespace</span><span class=\"params\">(String namespace)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.namespace = namespace;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Long <span class=\"title function_\">getTimeout</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> timeout;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setTimeout</span><span class=\"params\">(Long timeout)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.timeout = timeout;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getServerAddr</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> serverAddr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setServerAddr</span><span class=\"params\">(String serverAddr)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.serverAddr = serverAddr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getAuthDataId</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> authDataId;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setAuthDataId</span><span class=\"params\">(String authDataId)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.authDataId = authDataId;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getUsername</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> username;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setUsername</span><span class=\"params\">(String username)</span> &#123; <span class=\"built_in\">this</span>.username = username;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getPassword</span><span class=\"params\">()</span> &#123;<span class=\"keyword\">return</span> password;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setPassword</span><span class=\"params\">(String password)</span> &#123; <span class=\"built_in\">this</span>.password = password;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ConfigService <span class=\"title function_\">configService</span><span class=\"params\">(NacosProperties nacosProperties)</span> <span class=\"keyword\">throws</span> NacosException &#123;</span><br><span class=\"line\">        <span class=\"type\">Properties</span> <span class=\"variable\">properties</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Properties</span>();</span><br><span class=\"line\">        properties.setProperty(PropertyKeyConst.SERVER_ADDR, nacosProperties.getServerAddr());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!StringUtils.isEmpty(nacosProperties.getNamespace())) &#123;</span><br><span class=\"line\">            properties.setProperty(PropertyKeyConst.NAMESPACE, nacosProperties.getNamespace());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!StringUtils.isEmpty(nacosProperties.getUsername())) &#123;</span><br><span class=\"line\">            properties.setProperty(PropertyKeyConst.USERNAME, nacosProperties.getUsername());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!StringUtils.isEmpty(nacosProperties.getPassword())) &#123;</span><br><span class=\"line\">            properties.setProperty(PropertyKeyConst.PASSWORD, nacosProperties.getPassword());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> NacosFactory.createConfigService(properties);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Repository\"><a href=\"#Repository\" class=\"headerlink\" title=\"Repository\"></a>Repository</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.gateway.ApiDefinitionEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.gateway.GatewayFlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.AuthorityRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.DegradeRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.ParamFlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.SystemRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.gateway.InMemApiDefinitionStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.gateway.InMemGatewayFlowRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemAuthorityRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemDegradeRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemFlowRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemParamFlowRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemSystemRuleStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.InMemoryRuleRepositoryAdapter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.repository.rule.NacosRepository;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Primary;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.alibaba.csp.sentinel.dashboard.config-&gt; NacosRepositoryConfig</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-03</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosRepositoryConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigService configService;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> NacosConfig.NacosProperties nacosProperties;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;ApiDefinitionEntity&gt; <span class=\"title function_\">apiDefinitionEntityNacosRepository</span><span class=\"params\">(InMemApiDefinitionStore inMemApiDefinitionStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;gateway-api-definition&quot;</span>,inMemApiDefinitionStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;GatewayFlowRuleEntity&gt; <span class=\"title function_\">gatewayFlowRuleEntityNacosRepository</span><span class=\"params\">(InMemGatewayFlowRuleStore inMemGatewayFlowRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;gateway-flow-rule&quot;</span>,inMemGatewayFlowRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;AuthorityRuleEntity&gt; <span class=\"title function_\">authorityRuleEntityNacosRepository</span><span class=\"params\">(InMemAuthorityRuleStore inMemAuthorityRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;authority-rule&quot;</span>,inMemAuthorityRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;DegradeRuleEntity&gt; <span class=\"title function_\">degradeRuleEntityNacosRepository</span><span class=\"params\">(InMemDegradeRuleStore inMemDegradeRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;degrade-rule&quot;</span>,inMemDegradeRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;FlowRuleEntity&gt; <span class=\"title function_\">flowRuleEntityNacosRepository</span><span class=\"params\">(InMemFlowRuleStore inMemFlowRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;flow-rule&quot;</span>,inMemFlowRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;ParamFlowRuleEntity&gt; <span class=\"title function_\">paramFlowRuleEntityNacosRepository</span><span class=\"params\">(InMemParamFlowRuleStore inMemParamFlowRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;param-flow-rule&quot;</span>,inMemParamFlowRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosRepository&lt;SystemRuleEntity&gt; <span class=\"title function_\">systemRuleEntityNacosRepository</span><span class=\"params\">(InMemSystemRuleStore inMemSystemRuleStore)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buildNacosRepository(<span class=\"string\">&quot;system-rule&quot;</span>,inMemSystemRuleStore);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> &lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">RuleEntity</span>&gt; NacosRepository&lt;T&gt; <span class=\"title function_\">buildNacosRepository</span><span class=\"params\">(String suffix, InMemoryRuleRepositoryAdapter&lt;T&gt; ruleRepositoryAdapter)</span>&#123;</span><br><span class=\"line\">        NacosRepository&lt;T&gt; nacosRepository = <span class=\"keyword\">new</span> <span class=\"title class_\">NacosRepository</span>&lt;&gt;(suffix);</span><br><span class=\"line\">        nacosRepository.setNacosProperties(nacosProperties);</span><br><span class=\"line\">        nacosRepository.setRuleRepositoryAdapter(ruleRepositoryAdapter);</span><br><span class=\"line\">        nacosRepository.setConfigService(configService);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> nacosRepository;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.datasource.entity;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.alibaba.csp.sentinel.dashboard.datasource.entity-&gt; NacosEntity</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-03</span></span><br><span class=\"line\"><span class=\"comment\"> */</span><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosEntity</span>&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">RuleEntity</span>&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> T rule;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">NacosEntity</span><span class=\"params\">(T sentinelRule)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.rule = sentinelRule;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Getter</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">getRule</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> rule;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Repository\"><a href=\"#Repository\" class=\"headerlink\" title=\"Repository\"></a>Repository</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.repository.rule;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.config.NacosConfig;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.NacosEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.RuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.discovery.MachineInfo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSON;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigType;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.stream.Collectors;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.alibaba.csp.sentinel.dashboard.repository.rule-&gt; NacosRepository</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-03</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosRepository</span>&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">RuleEntity</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">RuleRepository</span>&lt;T, Long&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigService configService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> NacosConfig.NacosProperties nacosProperties;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> InMemoryRuleRepositoryAdapter&lt;T&gt; ruleRepositoryAdapter;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String suffix;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">NacosRepository</span><span class=\"params\">(String suffix)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.suffix = suffix;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ConfigService <span class=\"title function_\">getConfigService</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> configService;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setConfigService</span><span class=\"params\">(ConfigService configService)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.configService = configService;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> NacosConfig.NacosProperties <span class=\"title function_\">getNacosProperties</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> nacosProperties;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setNacosProperties</span><span class=\"params\">(NacosConfig.NacosProperties nacosProperties)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.nacosProperties = nacosProperties;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> InMemoryRuleRepositoryAdapter&lt;T&gt; <span class=\"title function_\">getRuleRepositoryAdapter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ruleRepositoryAdapter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setRuleRepositoryAdapter</span><span class=\"params\">(InMemoryRuleRepositoryAdapter&lt;T&gt; ruleRepositoryAdapter)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.ruleRepositoryAdapter = ruleRepositoryAdapter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">save</span><span class=\"params\">(T entity)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">T</span> <span class=\"variable\">save</span> <span class=\"operator\">=</span> ruleRepositoryAdapter.save(entity);</span><br><span class=\"line\">        publishConfig(entity.getApp());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> save;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;T&gt; <span class=\"title function_\">saveAll</span><span class=\"params\">(List&lt;T&gt; rules)</span> &#123;</span><br><span class=\"line\">        List&lt;T&gt; ts = ruleRepositoryAdapter.saveAll(rules);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(ts!=<span class=\"literal\">null</span> &amp;&amp; !ts.isEmpty())&#123;</span><br><span class=\"line\">            publishConfig(ts.get(<span class=\"number\">0</span>).getApp());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ts;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">delete</span><span class=\"params\">(Long id)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">T</span> <span class=\"variable\">delete</span> <span class=\"operator\">=</span> ruleRepositoryAdapter.delete(id);</span><br><span class=\"line\">        publishConfig(delete.getApp());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> delete;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">findById</span><span class=\"params\">(Long id)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ruleRepositoryAdapter.findById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;T&gt; <span class=\"title function_\">findAllByMachine</span><span class=\"params\">(MachineInfo machineInfo)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ruleRepositoryAdapter.findAllByMachine(machineInfo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;T&gt; <span class=\"title function_\">findAllByApp</span><span class=\"params\">(String appName)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ruleRepositoryAdapter.findAllByApp(appName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">publishConfig</span><span class=\"params\">(String app)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            List&lt;T&gt; allByApp = ruleRepositoryAdapter.findAllByApp(app);</span><br><span class=\"line\">            List&lt;Object&gt; rules = allByApp.stream().map(NacosEntity::<span class=\"keyword\">new</span>).map(NacosEntity::getRule).collect(Collectors.toList());</span><br><span class=\"line\">            configService.publishConfig(app + <span class=\"string\">&quot;-&quot;</span> + suffix, nacosProperties.getGroup(), JSON.toJSONString(rules), ConfigType.JSON.getType());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"Controllerrepository\"><a href=\"#Controllerrepository\" class=\"headerlink\" title=\"Controllerrepository\"></a>Controllerrepository</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(value = &quot;/v1/flow&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FlowControllerV1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Logger</span> <span class=\"variable\">logger</span> <span class=\"operator\">=</span> LoggerFactory.getLogger(FlowControllerV1.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> NacosRepository&lt;FlowRuleEntity&gt; repository;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">nacos.config.group</span>=<span class=\"string\">DEFAULT_GROUP;</span></span><br><span class=\"line\"><span class=\"attr\">nacos.config.namespace</span>=<span class=\"string\">sentinelId;</span></span><br><span class=\"line\"><span class=\"attr\">nacos.config.password</span>=<span class=\"string\">nacos;</span></span><br><span class=\"line\"><span class=\"attr\">nacos.config.serverAddr</span>=<span class=\"string\">http://127.0.0.1:8848;</span></span><br><span class=\"line\"><span class=\"attr\">nacos.config.username</span>=<span class=\"string\">nacos</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>pom</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>xxxx<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240221155333042.png\" alt=\"image-20240221155333042\"></p>\n"},{"_content":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.10.16`\n\n# Spring Cloud Alibaba-05-Gateway-01-Naocs\n\n[toc]\n\n\n\n## \n\nAPI GatewayAPIGW / API  API  IT API \n\nAPI WebAPI\n\nAPI API  APIAPI  API  API \n\n\n\n:\n\n**Ngnix+lua**\n\nnginxapi\nlua,, nginxlua\n\n**Kong**\n\nNginx+Lua() : Http;;API\n\n**Zuul**\n\nNetflixJAVA : ;;HttpWebNginx\n\n**Spring Cloud Gateway**\n\nSpringZuul\n\n> SpringCloud alibabaSpring Cloud Gateway \n\n\n\n## Gateway\n\n### spring cloud gateway\n\n\n\nSpring Cloud Gateway  Spring  API Spring 5Spring Boot 2  Project ReactorSpring Cloud Gateway  API/ Spring 5.0  NettyHttp2 Spring Boot 2.0  Spring 5.0 Spring Cloud Gateway  Netty  Http2 \n\n Spring Cloud Gateway  Web \n\n pre  post \n\n**spring cloud gateway**\n\n1spring Framework5Project Reactorspring boot 2.0\n\n2\n\n3\n\n4spring cloudnacos\n\n5sentinel\n\n6PredicateFilter\n\n\n\n**:**\n\n:Zuul1.6\n\n:\n\n\n\n**:**\n\nNettyWebFluxServlet\n\nTomcatJettyServletjar\n\nSpring Boot 2.0\n\n### \n\n\n// IP  URL\n\n\n\n\n\n\n\n\n\n### Gateway\n\n ****\n(Route)  gateway :\n\n* **id** Route\n* uri uri\n* order Route \n* **predicate**\n* **filter**\n\n\n\n****\n\n![img](typora-user-images/u=641752398,1880469199&fm=253&fmt=auto&app=138&f=PNG.png)\n\n**:**\n\n1. Gateway ClientGateway Server\n2. HttpWebHandlerAdapter\n3. DispatcherHandler RoutePredicateHandlerMapping\n4. RoutePredicateHandlerMapping\n5. FilteringWebHandler\n6. PreFilterPostFilter\n\n\n\n## Gateway\n\n\n\n###  spring-cloud-gateway,\n\n\n\n~~~java\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>com.lison</groupId>\n        <artifactId>spring-cloud-alibaba-building</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n    </parent>\n    <groupId>com.lison</groupId>\n    <artifactId>spring-cloud-gateway</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring-cloud-gateway</name>\n    <description>spring-cloud-gateway</description>\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-gateway</artifactId>\n         </dependency>\n    </dependencies>\n\n</project>\n~~~\n\n\n\n\n\n### \n\n~~~java\n@SpringBootApplication\npublic class SpringCloudGateWayApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(SpringCloudGateWayApplication.class, args);\n    }\n\n}\n~~~\n\n\n\n### \n\n~~~yaml\nserver:\n  port: 18003\nspring:\n  application:\n    name: spring-cloud-gateway\n  cloud:\n    gateway:\n      routes: # [ ]\n        - id: spring_service # , \n          uri: http://localhost:18001 # \n          order: 1 # ,\n          predicates: # ()\n            - Path=/spring_service/** # Path,\n          filters: # ,\n            - StripPrefix=1 # 1\n\n\nmanagement:\n  endpoint:\n    web:\n      exposure:\n        include:'*'\n\n~~~\n\n\n http://localhost:18003/spring_service/  A http://localhost:18001/\n\n\n\n\n\n\n\n### , \n\nhttp://localhost:18003/spring_service/gateway/test\n\n![image-20240222152145318](typora-user-images/image-20240222152145318.png)\n\n## GatewayNacos \n\n\n\n, ,  \n\n\n\n### Ncaos\n\n~~~java\n<!--nacos-->\n <dependency> \n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n</dependency>\n\n~~~\n\n\n\n### \n\n~~~java\n@SpringBootApplication\n@EnableDiscoveryClient\npublic class SpringCloudGateWayApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(SpringCloudGateWayApplication.class, args);\n    }\n\n}\n~~~\n\n\n\n### \n\n~~~yaml\nserver:\n  port: 18003\nspring:\n  application:\n    name: spring-cloud-gateway\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n    gateway:\n      discovery:\n        locator:\n          enabled: true # gatewaynacos\n      routes: # [ ]\n        - id: spring_service # , \n          uri: lb://spring-cloud-service # lbnacos,\n          predicates: # ()\n            - Path=/spring_service/** # Path,\n          filters: # ,\n            - StripPrefix=1 # 1\n\n~~~\n\n\n\n### \n\n\n\n service\n\n![image-20240222164404555](typora-user-images/image-20240222164404555.png)\n\n![image-20240222164433038](typora-user-images/image-20240222164433038.png)\n\nhttp://localhost:18003/spring_service/getServerProd\n\n**18001**\n\n![image-20240222164533515](typora-user-images/image-20240222164533515.png)\n\n**18011**\n\n![image-20240222164517003](typora-user-images/image-20240222164517003.png)\n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-05-Gateway-01-Naocs.md","raw":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.10.16`\n\n# Spring Cloud Alibaba-05-Gateway-01-Naocs\n\n[toc]\n\n\n\n## \n\nAPI GatewayAPIGW / API  API  IT API \n\nAPI WebAPI\n\nAPI API  APIAPI  API  API \n\n\n\n:\n\n**Ngnix+lua**\n\nnginxapi\nlua,, nginxlua\n\n**Kong**\n\nNginx+Lua() : Http;;API\n\n**Zuul**\n\nNetflixJAVA : ;;HttpWebNginx\n\n**Spring Cloud Gateway**\n\nSpringZuul\n\n> SpringCloud alibabaSpring Cloud Gateway \n\n\n\n## Gateway\n\n### spring cloud gateway\n\n\n\nSpring Cloud Gateway  Spring  API Spring 5Spring Boot 2  Project ReactorSpring Cloud Gateway  API/ Spring 5.0  NettyHttp2 Spring Boot 2.0  Spring 5.0 Spring Cloud Gateway  Netty  Http2 \n\n Spring Cloud Gateway  Web \n\n pre  post \n\n**spring cloud gateway**\n\n1spring Framework5Project Reactorspring boot 2.0\n\n2\n\n3\n\n4spring cloudnacos\n\n5sentinel\n\n6PredicateFilter\n\n\n\n**:**\n\n:Zuul1.6\n\n:\n\n\n\n**:**\n\nNettyWebFluxServlet\n\nTomcatJettyServletjar\n\nSpring Boot 2.0\n\n### \n\n\n// IP  URL\n\n\n\n\n\n\n\n\n\n### Gateway\n\n ****\n(Route)  gateway :\n\n* **id** Route\n* uri uri\n* order Route \n* **predicate**\n* **filter**\n\n\n\n****\n\n![img](typora-user-images/u=641752398,1880469199&fm=253&fmt=auto&app=138&f=PNG.png)\n\n**:**\n\n1. Gateway ClientGateway Server\n2. HttpWebHandlerAdapter\n3. DispatcherHandler RoutePredicateHandlerMapping\n4. RoutePredicateHandlerMapping\n5. FilteringWebHandler\n6. PreFilterPostFilter\n\n\n\n## Gateway\n\n\n\n###  spring-cloud-gateway,\n\n\n\n~~~java\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>com.lison</groupId>\n        <artifactId>spring-cloud-alibaba-building</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n    </parent>\n    <groupId>com.lison</groupId>\n    <artifactId>spring-cloud-gateway</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring-cloud-gateway</name>\n    <description>spring-cloud-gateway</description>\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-gateway</artifactId>\n         </dependency>\n    </dependencies>\n\n</project>\n~~~\n\n\n\n\n\n### \n\n~~~java\n@SpringBootApplication\npublic class SpringCloudGateWayApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(SpringCloudGateWayApplication.class, args);\n    }\n\n}\n~~~\n\n\n\n### \n\n~~~yaml\nserver:\n  port: 18003\nspring:\n  application:\n    name: spring-cloud-gateway\n  cloud:\n    gateway:\n      routes: # [ ]\n        - id: spring_service # , \n          uri: http://localhost:18001 # \n          order: 1 # ,\n          predicates: # ()\n            - Path=/spring_service/** # Path,\n          filters: # ,\n            - StripPrefix=1 # 1\n\n\nmanagement:\n  endpoint:\n    web:\n      exposure:\n        include:'*'\n\n~~~\n\n\n http://localhost:18003/spring_service/  A http://localhost:18001/\n\n\n\n\n\n\n\n### , \n\nhttp://localhost:18003/spring_service/gateway/test\n\n![image-20240222152145318](typora-user-images/image-20240222152145318.png)\n\n## GatewayNacos \n\n\n\n, ,  \n\n\n\n### Ncaos\n\n~~~java\n<!--nacos-->\n <dependency> \n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n</dependency>\n\n~~~\n\n\n\n### \n\n~~~java\n@SpringBootApplication\n@EnableDiscoveryClient\npublic class SpringCloudGateWayApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(SpringCloudGateWayApplication.class, args);\n    }\n\n}\n~~~\n\n\n\n### \n\n~~~yaml\nserver:\n  port: 18003\nspring:\n  application:\n    name: spring-cloud-gateway\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n    gateway:\n      discovery:\n        locator:\n          enabled: true # gatewaynacos\n      routes: # [ ]\n        - id: spring_service # , \n          uri: lb://spring-cloud-service # lbnacos,\n          predicates: # ()\n            - Path=/spring_service/** # Path,\n          filters: # ,\n            - StripPrefix=1 # 1\n\n~~~\n\n\n\n### \n\n\n\n service\n\n![image-20240222164404555](typora-user-images/image-20240222164404555.png)\n\n![image-20240222164433038](typora-user-images/image-20240222164433038.png)\n\nhttp://localhost:18003/spring_service/getServerProd\n\n**18001**\n\n![image-20240222164533515](typora-user-images/image-20240222164533515.png)\n\n**18011**\n\n![image-20240222164517003](typora-user-images/image-20240222164517003.png)\n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-05-Gateway-01-Naocs","published":1,"date":"2024-02-20T07:20:10.329Z","updated":"2024-02-23T03:52:41.497Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhh0003ecfy3e6xah1v","content":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.10.16</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-05-Gateway-01-Naocs\"><a href=\"#Spring-Cloud-Alibaba-05-Gateway-01-Naocs\" class=\"headerlink\" title=\"Spring Cloud Alibaba-05-Gateway-01-Naocs\"></a>Spring Cloud Alibaba-05-Gateway-01-Naocs</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>API GatewayAPIGW &#x2F; API  API  IT API </p>\n<p>API WebAPI</p>\n<p>API API  APIAPI  API  API </p>\n<p>:</p>\n<p><strong>Ngnix+lua</strong></p>\n<p>nginxapi<br>lua,, nginxlua</p>\n<p><strong>Kong</strong></p>\n<p>Nginx+Lua() : Http;;API</p>\n<p><strong>Zuul</strong></p>\n<p>NetflixJAVA : ;;HttpWebNginx</p>\n<p><strong>Spring Cloud Gateway</strong></p>\n<p>SpringZuul</p>\n<blockquote>\n<p>SpringCloud alibabaSpring Cloud Gateway </p>\n</blockquote>\n<h2 id=\"Gateway\"><a href=\"#Gateway\" class=\"headerlink\" title=\"Gateway\"></a>Gateway</h2><h3 id=\"spring-cloud-gateway\"><a href=\"#spring-cloud-gateway\" class=\"headerlink\" title=\"spring cloud gateway\"></a>spring cloud gateway</h3><p></p>\n<p>Spring Cloud Gateway  Spring  API Spring 5Spring Boot 2  Project ReactorSpring Cloud Gateway  API&#x2F; Spring 5.0  NettyHttp2 Spring Boot 2.0  Spring 5.0 Spring Cloud Gateway  Netty  Http2 </p>\n<p> Spring Cloud Gateway  Web </p>\n<p> pre  post </p>\n<p><strong>spring cloud gateway</strong></p>\n<p>1spring Framework5Project Reactorspring boot 2.0</p>\n<p>2</p>\n<p>3</p>\n<p>4spring cloudnacos</p>\n<p>5sentinel</p>\n<p>6PredicateFilter</p>\n<p><strong>:</strong></p>\n<p>:Zuul1.6</p>\n<p>:</p>\n<p></p>\n<p><strong>:</strong></p>\n<p>NettyWebFluxServlet</p>\n<p>TomcatJettyServletjar</p>\n<p>Spring Boot 2.0</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br>&#x2F;&#x2F; IP  URL</p>\n<p></p>\n<p><br><br></p>\n<h3 id=\"Gateway\"><a href=\"#Gateway\" class=\"headerlink\" title=\"Gateway\"></a>Gateway</h3><p> <strong></strong><br>(Route)  gateway :</p>\n<ul>\n<li><strong>id</strong> Route</li>\n<li>uri uri</li>\n<li>order Route </li>\n<li><strong>predicate</strong></li>\n<li><strong>filter</strong></li>\n</ul>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/u=641752398,1880469199&fm=253&fmt=auto&app=138&f=PNG.png\" alt=\"img\"></p>\n<p><strong>:</strong></p>\n<ol>\n<li>Gateway ClientGateway Server</li>\n<li>HttpWebHandlerAdapter</li>\n<li>DispatcherHandler RoutePredicateHandlerMapping</li>\n<li>RoutePredicateHandlerMapping</li>\n<li>FilteringWebHandler</li>\n<li>PreFilterPostFilter</li>\n</ol>\n<h2 id=\"Gateway\"><a href=\"#Gateway\" class=\"headerlink\" title=\"Gateway\"></a>Gateway</h2><h3 id=\"-spring-cloud-gateway-\"><a href=\"#-spring-cloud-gateway-\" class=\"headerlink\" title=\" spring-cloud-gateway,\"></a> spring-cloud-gateway,</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;project xmlns=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class=\"line\">         xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">         xsi:schemaLocation=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;modelVersion&gt;<span class=\"number\">4.0</span><span class=\"number\">.0</span>&lt;/modelVersion&gt;</span><br><span class=\"line\">    &lt;parent&gt;</span><br><span class=\"line\">        &lt;groupId&gt;com.lison&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-cloud-alibaba-building&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;<span class=\"number\">1.0</span><span class=\"number\">.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class=\"line\">    &lt;/parent&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.lison&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-cloud-gateway&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;<span class=\"number\">0.0</span><span class=\"number\">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class=\"line\">    &lt;name&gt;spring-cloud-gateway&lt;/name&gt;</span><br><span class=\"line\">    &lt;description&gt;spring-cloud-gateway&lt;/description&gt;</span><br><span class=\"line\">    &lt;properties&gt;</span><br><span class=\"line\">        &lt;java.version&gt;<span class=\"number\">1.8</span>&lt;/java.version&gt;</span><br><span class=\"line\">    &lt;/properties&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;</span><br><span class=\"line\">         &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/project&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringCloudGateWayApplication</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringCloudGateWayApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">18003</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-cloud-gateway</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span> <span class=\"comment\"># [ ]</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span> <span class=\"comment\"># , </span></span><br><span class=\"line\">          <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span> <span class=\"comment\"># </span></span><br><span class=\"line\">          <span class=\"attr\">order:</span> <span class=\"number\">1</span> <span class=\"comment\"># ,</span></span><br><span class=\"line\">          <span class=\"attr\">predicates:</span> <span class=\"comment\"># ()</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">Path=/spring_service/**</span> <span class=\"comment\"># Path,</span></span><br><span class=\"line\">          <span class=\"attr\">filters:</span> <span class=\"comment\"># ,</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">StripPrefix=1</span> <span class=\"comment\"># 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoint:</span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"string\">include:&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p> <a href=\"http://localhost:18003/spring_service/\">http://localhost:18003/spring_service/</a>  A <a href=\"http://localhost:18001/\">http://localhost:18001/</a></p>\n<h3 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\", \"></a>, </h3><p><a href=\"http://localhost:18003/spring_service/gateway/test\">http://localhost:18003/spring_service/gateway/test</a></p>\n<p><img src=\"/typora-user-images/image-20240222152145318.png\" alt=\"image-20240222152145318\"></p>\n<h2 id=\"GatewayNacos-\"><a href=\"#GatewayNacos-\" class=\"headerlink\" title=\"GatewayNacos \"></a>GatewayNacos </h2><p>, ,  </p>\n<h3 id=\"Ncaos\"><a href=\"#Ncaos\" class=\"headerlink\" title=\"Ncaos\"></a>Ncaos</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--nacos--&gt;</span><br><span class=\"line\"> &lt;dependency&gt; </span><br><span class=\"line\">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDiscoveryClient</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringCloudGateWayApplication</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringCloudGateWayApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">18003</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-cloud-gateway</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">locator:</span></span><br><span class=\"line\">          <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># gatewaynacos</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span> <span class=\"comment\"># [ ]</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span> <span class=\"comment\"># , </span></span><br><span class=\"line\">          <span class=\"attr\">uri:</span> <span class=\"string\">lb://spring-cloud-service</span> <span class=\"comment\"># lbnacos,</span></span><br><span class=\"line\">          <span class=\"attr\">predicates:</span> <span class=\"comment\"># ()</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">Path=/spring_service/**</span> <span class=\"comment\"># Path,</span></span><br><span class=\"line\">          <span class=\"attr\">filters:</span> <span class=\"comment\"># ,</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">StripPrefix=1</span> <span class=\"comment\"># 1</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> service</p>\n<p><img src=\"/typora-user-images/image-20240222164404555.png\" alt=\"image-20240222164404555\"></p>\n<p><img src=\"/typora-user-images/image-20240222164433038.png\" alt=\"image-20240222164433038\"></p>\n<p><a href=\"http://localhost:18003/spring_service/getServerProd\">http://localhost:18003/spring_service/getServerProd</a></p>\n<p><strong>18001</strong></p>\n<p><img src=\"/typora-user-images/image-20240222164533515.png\" alt=\"image-20240222164533515\"></p>\n<p><strong>18011</strong></p>\n<p><img src=\"/typora-user-images/image-20240222164517003.png\" alt=\"image-20240222164517003\"></p>\n","excerpt":"","more":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.10.16</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-05-Gateway-01-Naocs\"><a href=\"#Spring-Cloud-Alibaba-05-Gateway-01-Naocs\" class=\"headerlink\" title=\"Spring Cloud Alibaba-05-Gateway-01-Naocs\"></a>Spring Cloud Alibaba-05-Gateway-01-Naocs</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>API GatewayAPIGW &#x2F; API  API  IT API </p>\n<p>API WebAPI</p>\n<p>API API  APIAPI  API  API </p>\n<p>:</p>\n<p><strong>Ngnix+lua</strong></p>\n<p>nginxapi<br>lua,, nginxlua</p>\n<p><strong>Kong</strong></p>\n<p>Nginx+Lua() : Http;;API</p>\n<p><strong>Zuul</strong></p>\n<p>NetflixJAVA : ;;HttpWebNginx</p>\n<p><strong>Spring Cloud Gateway</strong></p>\n<p>SpringZuul</p>\n<blockquote>\n<p>SpringCloud alibabaSpring Cloud Gateway </p>\n</blockquote>\n<h2 id=\"Gateway\"><a href=\"#Gateway\" class=\"headerlink\" title=\"Gateway\"></a>Gateway</h2><h3 id=\"spring-cloud-gateway\"><a href=\"#spring-cloud-gateway\" class=\"headerlink\" title=\"spring cloud gateway\"></a>spring cloud gateway</h3><p></p>\n<p>Spring Cloud Gateway  Spring  API Spring 5Spring Boot 2  Project ReactorSpring Cloud Gateway  API&#x2F; Spring 5.0  NettyHttp2 Spring Boot 2.0  Spring 5.0 Spring Cloud Gateway  Netty  Http2 </p>\n<p> Spring Cloud Gateway  Web </p>\n<p> pre  post </p>\n<p><strong>spring cloud gateway</strong></p>\n<p>1spring Framework5Project Reactorspring boot 2.0</p>\n<p>2</p>\n<p>3</p>\n<p>4spring cloudnacos</p>\n<p>5sentinel</p>\n<p>6PredicateFilter</p>\n<p><strong>:</strong></p>\n<p>:Zuul1.6</p>\n<p>:</p>\n<p></p>\n<p><strong>:</strong></p>\n<p>NettyWebFluxServlet</p>\n<p>TomcatJettyServletjar</p>\n<p>Spring Boot 2.0</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br>&#x2F;&#x2F; IP  URL</p>\n<p></p>\n<p><br><br></p>\n<h3 id=\"Gateway\"><a href=\"#Gateway\" class=\"headerlink\" title=\"Gateway\"></a>Gateway</h3><p> <strong></strong><br>(Route)  gateway :</p>\n<ul>\n<li><strong>id</strong> Route</li>\n<li>uri uri</li>\n<li>order Route </li>\n<li><strong>predicate</strong></li>\n<li><strong>filter</strong></li>\n</ul>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/u=641752398,1880469199&fm=253&fmt=auto&app=138&f=PNG.png\" alt=\"img\"></p>\n<p><strong>:</strong></p>\n<ol>\n<li>Gateway ClientGateway Server</li>\n<li>HttpWebHandlerAdapter</li>\n<li>DispatcherHandler RoutePredicateHandlerMapping</li>\n<li>RoutePredicateHandlerMapping</li>\n<li>FilteringWebHandler</li>\n<li>PreFilterPostFilter</li>\n</ol>\n<h2 id=\"Gateway\"><a href=\"#Gateway\" class=\"headerlink\" title=\"Gateway\"></a>Gateway</h2><h3 id=\"-spring-cloud-gateway-\"><a href=\"#-spring-cloud-gateway-\" class=\"headerlink\" title=\" spring-cloud-gateway,\"></a> spring-cloud-gateway,</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;project xmlns=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class=\"line\">         xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">         xsi:schemaLocation=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;modelVersion&gt;<span class=\"number\">4.0</span><span class=\"number\">.0</span>&lt;/modelVersion&gt;</span><br><span class=\"line\">    &lt;parent&gt;</span><br><span class=\"line\">        &lt;groupId&gt;com.lison&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-cloud-alibaba-building&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;<span class=\"number\">1.0</span><span class=\"number\">.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class=\"line\">    &lt;/parent&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.lison&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-cloud-gateway&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;<span class=\"number\">0.0</span><span class=\"number\">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class=\"line\">    &lt;name&gt;spring-cloud-gateway&lt;/name&gt;</span><br><span class=\"line\">    &lt;description&gt;spring-cloud-gateway&lt;/description&gt;</span><br><span class=\"line\">    &lt;properties&gt;</span><br><span class=\"line\">        &lt;java.version&gt;<span class=\"number\">1.8</span>&lt;/java.version&gt;</span><br><span class=\"line\">    &lt;/properties&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;</span><br><span class=\"line\">         &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/project&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringCloudGateWayApplication</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringCloudGateWayApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">18003</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-cloud-gateway</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span> <span class=\"comment\"># [ ]</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span> <span class=\"comment\"># , </span></span><br><span class=\"line\">          <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span> <span class=\"comment\"># </span></span><br><span class=\"line\">          <span class=\"attr\">order:</span> <span class=\"number\">1</span> <span class=\"comment\"># ,</span></span><br><span class=\"line\">          <span class=\"attr\">predicates:</span> <span class=\"comment\"># ()</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">Path=/spring_service/**</span> <span class=\"comment\"># Path,</span></span><br><span class=\"line\">          <span class=\"attr\">filters:</span> <span class=\"comment\"># ,</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">StripPrefix=1</span> <span class=\"comment\"># 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoint:</span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"string\">include:&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p> <a href=\"http://localhost:18003/spring_service/\">http://localhost:18003/spring_service/</a>  A <a href=\"http://localhost:18001/\">http://localhost:18001/</a></p>\n<h3 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\", \"></a>, </h3><p><a href=\"http://localhost:18003/spring_service/gateway/test\">http://localhost:18003/spring_service/gateway/test</a></p>\n<p><img src=\"/typora-user-images/image-20240222152145318.png\" alt=\"image-20240222152145318\"></p>\n<h2 id=\"GatewayNacos-\"><a href=\"#GatewayNacos-\" class=\"headerlink\" title=\"GatewayNacos \"></a>GatewayNacos </h2><p>, ,  </p>\n<h3 id=\"Ncaos\"><a href=\"#Ncaos\" class=\"headerlink\" title=\"Ncaos\"></a>Ncaos</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--nacos--&gt;</span><br><span class=\"line\"> &lt;dependency&gt; </span><br><span class=\"line\">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDiscoveryClient</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringCloudGateWayApplication</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringCloudGateWayApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">18003</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-cloud-gateway</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">locator:</span></span><br><span class=\"line\">          <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># gatewaynacos</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span> <span class=\"comment\"># [ ]</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span> <span class=\"comment\"># , </span></span><br><span class=\"line\">          <span class=\"attr\">uri:</span> <span class=\"string\">lb://spring-cloud-service</span> <span class=\"comment\"># lbnacos,</span></span><br><span class=\"line\">          <span class=\"attr\">predicates:</span> <span class=\"comment\"># ()</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">Path=/spring_service/**</span> <span class=\"comment\"># Path,</span></span><br><span class=\"line\">          <span class=\"attr\">filters:</span> <span class=\"comment\"># ,</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">StripPrefix=1</span> <span class=\"comment\"># 1</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> service</p>\n<p><img src=\"/typora-user-images/image-20240222164404555.png\" alt=\"image-20240222164404555\"></p>\n<p><img src=\"/typora-user-images/image-20240222164433038.png\" alt=\"image-20240222164433038\"></p>\n<p><a href=\"http://localhost:18003/spring_service/getServerProd\">http://localhost:18003/spring_service/getServerProd</a></p>\n<p><strong>18001</strong></p>\n<p><img src=\"/typora-user-images/image-20240222164533515.png\" alt=\"image-20240222164533515\"></p>\n<p><strong>18011</strong></p>\n<p><img src=\"/typora-user-images/image-20240222164517003.png\" alt=\"image-20240222164517003\"></p>\n"},{"_content":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.10.20`\n\n# Spring Cloud Alibaba-05-Gateway-02-(Predicate)\n\n\n\n[toc]\n\n\n\nPredicate \n\n\n\n## \n\nPredicate  2023 10  20 \n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - After=2023-10-20T08:30:00+08:00[Asia/Shanghai]\n \n \n~~~\n\nSpring  ZonedDateTime ZonedDateTime  Java 8 ZonedDateTime Asia/Shanghai\n\nAfter Route Predicate  2023  10  20  08  30  0 http://localhost:18001+08:00 UTC Asia/Shanghai\n\nhttp://localhost:18001/spring_service http://localhost:18001\n\nBefore Route Predicate  After  Before:\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Before=2023-10-20T08:30:00+08:00[Asia/Shanghai]\n \n \n~~~\n\n\n\n`http://localhost:18001/spring_service ` 404 \n\nGateway  Between Route Predicate \n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Between=2023-10-20T08:30:00+08:00[Asia/Shanghai],2024-10-20T08:30:00+08:00[Asia/Shanghai]\n \n \n~~~\n\n\n\n##  Cookie \n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Cookie=token,lison\n \n \n~~~\n\n\n\n![image-20240222175326047](typora-user-images/image-20240222175326047.png)\n\n![image-20240222175403127](typora-user-images/image-20240222175403127.png)\n\n**CookieCookie, 404 Cookie**\n\n\n\n\n\n##  Header \n\nHeader Route Predicate  Cookie Route Predicate  2  header \n\n\n\n~~~java\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Header=X-Request-Id, \\d+\n \n \n~~~\n\n\n\n![image-20240222180227522](typora-user-images/image-20240222180227522.png)\n\n![image-20240222180306582](typora-user-images/image-20240222180306582.png)\n\n![image-20240222180325402](typora-user-images/image-20240222180325402.png)\n\n**HeaderHeader, 404 Header**\n\n\n\n\n\n##  Host \n\n\n\nHost Route Predicate  ant `.`\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Host=**.lison.com\n \n \n~~~\n\n\n\n![image-20240222181235735](typora-user-images/image-20240222181235735.png)\n\n host  host_route  host  404 \n\n\n\n## \n\n POSTGETPUTDELETE \n\n\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Method=GET\n \n \n~~~\n\n POST  404 \n\n## \n\nPath Route Predicate \n\n\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Path=/spring_service/{segment} # - Path=/spring_service/**\n \n \n~~~\n\n/spring_service/1  /spring_service/bar\n\n\n\n\n\n~~~\nhttp://localhost:18003/spring_service/1\nhttp://localhost:18003/spring_service/2\nhttp://localhost:18003/spring_xxx/2\n~~~\n\n\n\n 404\n\n## \n\nQuery Route Predicate \n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Query=token\n \n \n~~~\n\n token \n\n\n\n~~~\nhttp://localhost:18003/spring_service/getServerProd?token=dfasdfas&id=xxx\n~~~\n\n\n\n smile  token \n\n Query \n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Query=token,lison.\n \n \n~~~\n\n\n\n keep  lison \n\n~~~\nhttp://localhost:18003/spring_service/getServerProd?token=lison6&id=xxx\n~~~\n\n token  pubx  lison66, \n\n\n\n##  ip \n\nPredicate  ip RemoteAddr Route Predicate  cidr  (IPv4  IPv6) ( 1) 192.168.0.1/16 ( 192.168.0.1  IP 16 )\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - RemoteAddr=192.168.1.1/24\n \n \n~~~\n\n\n\n ip \n\n 192.168.1.10\n\n## \n\n### \n\nBetweenRoutePredicateFactory\n\n~~~java\n\n//XXXXRoutePredicateFactory    AbstractRoutePredicateFactory\n\npublic class BetweenRoutePredicateFactory extends AbstractRoutePredicateFactory<Config> {\n    public static final String DATETIME1_KEY = \"datetime1\";\n    public static final String DATETIME2_KEY = \"datetime2\";\n\n    public BetweenRoutePredicateFactory() {\n        super(Config.class);\n    }\n\n    public List<String> shortcutFieldOrder() {\n        return Arrays.asList(\"datetime1\", \"datetime2\"); //\n    }\n\n  \n  //\n    public Predicate<ServerWebExchange> apply(final Config config) {\n        Assert.isTrue(config.getDatetime1().isBefore(config.getDatetime2()), config.getDatetime1() + \" must be before \" + config.getDatetime2());\n        return new GatewayPredicate() {\n          //\n            public boolean test(ServerWebExchange serverWebExchange) {\n                ZonedDateTime now = ZonedDateTime.now();\n                return now.isAfter(config.getDatetime1()) && now.isBefore(config.getDatetime2());\n            }\n\n            public String toString() {\n                return String.format(\"Between: %s and %s\", config.getDatetime1(), config.getDatetime2());\n            }\n        };\n    }\n\n  //\n    @Validated\n    public static class Config {\n        private @NotNull ZonedDateTime datetime1;\n        private @NotNull ZonedDateTime datetime2;\n\n        public Config() {\n        }\n\n        public ZonedDateTime getDatetime1() {\n            return this.datetime1;\n        }\n\n        public Config setDatetime1(ZonedDateTime datetime1) {\n            this.datetime1 = datetime1;\n            return this;\n        }\n\n        public ZonedDateTime getDatetime2() {\n            return this.datetime2;\n        }\n\n        public Config setDatetime2(ZonedDateTime datetime2) {\n            this.datetime2 = datetime2;\n            return this;\n        }\n    }\n}\n~~~\n\n\n\n### \n\n1860\n\n1\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Age=18,60 #1860\n \n \n~~~\n\n\n\n2AgeAgeRoutePredicateFactory\n\n~~~java\npackage com.lison.springcloudservice.config.predicates;\n\n/**\n * @className: com.lison.springcloudservice.config.predicates-> AgeRoutePredicateFactory\n * @description:    1.+RoutePredicateFactory 2.AbstractRoutePredicateFactory<>\n * @author: Lison\n * @createDate: 2023-10-20\n */\nimport org.apache.commons.lang.StringUtils;\nimport org.springframework.cloud.gateway.handler.predicate.AbstractRoutePredicateFactory;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.server.ServerWebExchange;\n\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.function.Predicate;\n\n\n@Component\npublic class AgeRoutePredicateFactory extends AbstractRoutePredicateFactory<AgeRoutePredicateFactory.Config> {\n\n    public AgeRoutePredicateFactory() {\n        super(AgeRoutePredicateFactory.Config.class);\n    }\n\n    //\n    @Override\n    public List<String> shortcutFieldOrder() {\n        //yml\n        return Arrays.asList(\"minAge\", \"maxAge\");\n    }\n\n    @Override\n    public Predicate<ServerWebExchange> apply(AgeRoutePredicateFactory.Config config) {\n        return new Predicate<ServerWebExchange>() {\n            @Override\n            public boolean test(ServerWebExchange serverWebExchange) {\n                //serverWebExchange\n                String ageStr = serverWebExchange.getRequest().getQueryParams().getFirst(\"age\");\n                if (StringUtils.isNotEmpty(ageStr)) {\n                    int age = Integer.parseInt(ageStr);\n                    return age > config.getMinAge() && age < config.getMaxAge();\n                }\n                return false;\n            }\n        };\n    }\n\n    //\n    public static class Config {\n        private int minAge;\n        private int maxAge;\n\n        public int getMinAge() {\n            return minAge;\n        }\n\n        public void setMinAge(int minAge) {\n            this.minAge = minAge;\n        }\n\n        @Override\n        public String toString() {\n            return \"Config{\" +\n                    \"minAge=\" + minAge +\n                    \", maxAge=\" + maxAge +\n                    '}';\n        }\n\n        public int getMaxAge() {\n            return maxAge;\n        }\n\n        public void setMaxAge(int maxAge) {\n            this.maxAge = maxAge;\n        }\n    }\n}\n\n\n~~~\n\n3age=20age=15\n\n\n\n\n\n\n\n## \n\n Predicate  Predicate \n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Host=**.lison.com\n         - Path=/spring_service/** # Path,\n         - Cookie=token,lison\n         - After=2023-10-20T08:30:00+08:00[Asia/Shanghai]\n         - Before=2023-10-20T08:30:00+08:00[Asia/Shanghai]\n         - Between=2023-10-20T08:30:00+08:00[Asia/Shanghai],2024-10-20T08:30:00+08:00[Asia/Shanghai]\n         - Header=X-Request-Id, \\d+\n         - Host=**.lison.com\n         - Method=GET,POST\n         - Query=token,lison.\n         - RemoteAddr=192.168.1.1/24\n         - Age=18,60 \n \n \n~~~\n\n Predicates \n\n> \n\n\n\n\n\n\n\n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-05-Gateway-02-(Predicate).md","raw":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.10.20`\n\n# Spring Cloud Alibaba-05-Gateway-02-(Predicate)\n\n\n\n[toc]\n\n\n\nPredicate \n\n\n\n## \n\nPredicate  2023 10  20 \n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - After=2023-10-20T08:30:00+08:00[Asia/Shanghai]\n \n \n~~~\n\nSpring  ZonedDateTime ZonedDateTime  Java 8 ZonedDateTime Asia/Shanghai\n\nAfter Route Predicate  2023  10  20  08  30  0 http://localhost:18001+08:00 UTC Asia/Shanghai\n\nhttp://localhost:18001/spring_service http://localhost:18001\n\nBefore Route Predicate  After  Before:\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Before=2023-10-20T08:30:00+08:00[Asia/Shanghai]\n \n \n~~~\n\n\n\n`http://localhost:18001/spring_service ` 404 \n\nGateway  Between Route Predicate \n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Between=2023-10-20T08:30:00+08:00[Asia/Shanghai],2024-10-20T08:30:00+08:00[Asia/Shanghai]\n \n \n~~~\n\n\n\n##  Cookie \n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Cookie=token,lison\n \n \n~~~\n\n\n\n![image-20240222175326047](typora-user-images/image-20240222175326047.png)\n\n![image-20240222175403127](typora-user-images/image-20240222175403127.png)\n\n**CookieCookie, 404 Cookie**\n\n\n\n\n\n##  Header \n\nHeader Route Predicate  Cookie Route Predicate  2  header \n\n\n\n~~~java\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Header=X-Request-Id, \\d+\n \n \n~~~\n\n\n\n![image-20240222180227522](typora-user-images/image-20240222180227522.png)\n\n![image-20240222180306582](typora-user-images/image-20240222180306582.png)\n\n![image-20240222180325402](typora-user-images/image-20240222180325402.png)\n\n**HeaderHeader, 404 Header**\n\n\n\n\n\n##  Host \n\n\n\nHost Route Predicate  ant `.`\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Host=**.lison.com\n \n \n~~~\n\n\n\n![image-20240222181235735](typora-user-images/image-20240222181235735.png)\n\n host  host_route  host  404 \n\n\n\n## \n\n POSTGETPUTDELETE \n\n\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Method=GET\n \n \n~~~\n\n POST  404 \n\n## \n\nPath Route Predicate \n\n\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Path=/spring_service/{segment} # - Path=/spring_service/**\n \n \n~~~\n\n/spring_service/1  /spring_service/bar\n\n\n\n\n\n~~~\nhttp://localhost:18003/spring_service/1\nhttp://localhost:18003/spring_service/2\nhttp://localhost:18003/spring_xxx/2\n~~~\n\n\n\n 404\n\n## \n\nQuery Route Predicate \n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Query=token\n \n \n~~~\n\n token \n\n\n\n~~~\nhttp://localhost:18003/spring_service/getServerProd?token=dfasdfas&id=xxx\n~~~\n\n\n\n smile  token \n\n Query \n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Query=token,lison.\n \n \n~~~\n\n\n\n keep  lison \n\n~~~\nhttp://localhost:18003/spring_service/getServerProd?token=lison6&id=xxx\n~~~\n\n token  pubx  lison66, \n\n\n\n##  ip \n\nPredicate  ip RemoteAddr Route Predicate  cidr  (IPv4  IPv6) ( 1) 192.168.0.1/16 ( 192.168.0.1  IP 16 )\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - RemoteAddr=192.168.1.1/24\n \n \n~~~\n\n\n\n ip \n\n 192.168.1.10\n\n## \n\n### \n\nBetweenRoutePredicateFactory\n\n~~~java\n\n//XXXXRoutePredicateFactory    AbstractRoutePredicateFactory\n\npublic class BetweenRoutePredicateFactory extends AbstractRoutePredicateFactory<Config> {\n    public static final String DATETIME1_KEY = \"datetime1\";\n    public static final String DATETIME2_KEY = \"datetime2\";\n\n    public BetweenRoutePredicateFactory() {\n        super(Config.class);\n    }\n\n    public List<String> shortcutFieldOrder() {\n        return Arrays.asList(\"datetime1\", \"datetime2\"); //\n    }\n\n  \n  //\n    public Predicate<ServerWebExchange> apply(final Config config) {\n        Assert.isTrue(config.getDatetime1().isBefore(config.getDatetime2()), config.getDatetime1() + \" must be before \" + config.getDatetime2());\n        return new GatewayPredicate() {\n          //\n            public boolean test(ServerWebExchange serverWebExchange) {\n                ZonedDateTime now = ZonedDateTime.now();\n                return now.isAfter(config.getDatetime1()) && now.isBefore(config.getDatetime2());\n            }\n\n            public String toString() {\n                return String.format(\"Between: %s and %s\", config.getDatetime1(), config.getDatetime2());\n            }\n        };\n    }\n\n  //\n    @Validated\n    public static class Config {\n        private @NotNull ZonedDateTime datetime1;\n        private @NotNull ZonedDateTime datetime2;\n\n        public Config() {\n        }\n\n        public ZonedDateTime getDatetime1() {\n            return this.datetime1;\n        }\n\n        public Config setDatetime1(ZonedDateTime datetime1) {\n            this.datetime1 = datetime1;\n            return this;\n        }\n\n        public ZonedDateTime getDatetime2() {\n            return this.datetime2;\n        }\n\n        public Config setDatetime2(ZonedDateTime datetime2) {\n            this.datetime2 = datetime2;\n            return this;\n        }\n    }\n}\n~~~\n\n\n\n### \n\n1860\n\n1\n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Age=18,60 #1860\n \n \n~~~\n\n\n\n2AgeAgeRoutePredicateFactory\n\n~~~java\npackage com.lison.springcloudservice.config.predicates;\n\n/**\n * @className: com.lison.springcloudservice.config.predicates-> AgeRoutePredicateFactory\n * @description:    1.+RoutePredicateFactory 2.AbstractRoutePredicateFactory<>\n * @author: Lison\n * @createDate: 2023-10-20\n */\nimport org.apache.commons.lang.StringUtils;\nimport org.springframework.cloud.gateway.handler.predicate.AbstractRoutePredicateFactory;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.server.ServerWebExchange;\n\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.function.Predicate;\n\n\n@Component\npublic class AgeRoutePredicateFactory extends AbstractRoutePredicateFactory<AgeRoutePredicateFactory.Config> {\n\n    public AgeRoutePredicateFactory() {\n        super(AgeRoutePredicateFactory.Config.class);\n    }\n\n    //\n    @Override\n    public List<String> shortcutFieldOrder() {\n        //yml\n        return Arrays.asList(\"minAge\", \"maxAge\");\n    }\n\n    @Override\n    public Predicate<ServerWebExchange> apply(AgeRoutePredicateFactory.Config config) {\n        return new Predicate<ServerWebExchange>() {\n            @Override\n            public boolean test(ServerWebExchange serverWebExchange) {\n                //serverWebExchange\n                String ageStr = serverWebExchange.getRequest().getQueryParams().getFirst(\"age\");\n                if (StringUtils.isNotEmpty(ageStr)) {\n                    int age = Integer.parseInt(ageStr);\n                    return age > config.getMinAge() && age < config.getMaxAge();\n                }\n                return false;\n            }\n        };\n    }\n\n    //\n    public static class Config {\n        private int minAge;\n        private int maxAge;\n\n        public int getMinAge() {\n            return minAge;\n        }\n\n        public void setMinAge(int minAge) {\n            this.minAge = minAge;\n        }\n\n        @Override\n        public String toString() {\n            return \"Config{\" +\n                    \"minAge=\" + minAge +\n                    \", maxAge=\" + maxAge +\n                    '}';\n        }\n\n        public int getMaxAge() {\n            return maxAge;\n        }\n\n        public void setMaxAge(int maxAge) {\n            this.maxAge = maxAge;\n        }\n    }\n}\n\n\n~~~\n\n3age=20age=15\n\n\n\n\n\n\n\n## \n\n Predicate  Predicate \n\n\n\n~~~yaml\nspring:\n  cloud:\n    gateway:\n      routes:\n       - id: spring_service\n        uri: http://localhost:18001\n        predicates:\n         - Host=**.lison.com\n         - Path=/spring_service/** # Path,\n         - Cookie=token,lison\n         - After=2023-10-20T08:30:00+08:00[Asia/Shanghai]\n         - Before=2023-10-20T08:30:00+08:00[Asia/Shanghai]\n         - Between=2023-10-20T08:30:00+08:00[Asia/Shanghai],2024-10-20T08:30:00+08:00[Asia/Shanghai]\n         - Header=X-Request-Id, \\d+\n         - Host=**.lison.com\n         - Method=GET,POST\n         - Query=token,lison.\n         - RemoteAddr=192.168.1.1/24\n         - Age=18,60 \n \n \n~~~\n\n Predicates \n\n> \n\n\n\n\n\n\n\n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-05-Gateway-02-(Predicate)","published":1,"date":"2024-02-22T08:58:58.394Z","updated":"2024-02-23T03:00:00.466Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhi0004ecfy5cerfh5z","content":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.10.20</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-05-Gateway-02--Predicate-\"><a href=\"#Spring-Cloud-Alibaba-05-Gateway-02--Predicate-\" class=\"headerlink\" title=\"Spring Cloud Alibaba-05-Gateway-02-(Predicate)\"></a>Spring Cloud Alibaba-05-Gateway-02-(Predicate)</h1><p>[toc]</p>\n<p>Predicate </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Predicate  2023 10  20 </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">After=2023-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p>Spring  ZonedDateTime ZonedDateTime  Java 8 ZonedDateTime Asia&#x2F;Shanghai</p>\n<p>After Route Predicate  2023  10  20  08  30  0 <a href=\"http://localhost:18001+08:00\">http://localhost:18001+08:00</a> UTC Asia&#x2F;Shanghai</p>\n<p><a href=\"http://localhost:18001/spring_service\">http://localhost:18001/spring_service</a> <a href=\"http://localhost:18001\">http://localhost:18001</a></p>\n<p>Before Route Predicate  After  Before:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Before=2023-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p><code>http://localhost:18001/spring_service </code> 404 </p>\n<p>Gateway  Between Route Predicate </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Between=2023-10-20T08:30:00+08:00[Asia/Shanghai],2024-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"-Cookie-\"><a href=\"#-Cookie-\" class=\"headerlink\" title=\" Cookie \"></a> Cookie </h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Cookie=token,lison</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240222175326047.png\" alt=\"image-20240222175326047\"></p>\n<p><img src=\"/typora-user-images/image-20240222175403127.png\" alt=\"image-20240222175403127\"></p>\n<p><strong>CookieCookie, 404 Cookie</strong></p>\n<h2 id=\"-Header-\"><a href=\"#-Header-\" class=\"headerlink\" title=\" Header \"></a> Header </h2><p>Header Route Predicate  Cookie Route Predicate  2  header </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  cloud:</span><br><span class=\"line\">    gateway:</span><br><span class=\"line\">      routes:</span><br><span class=\"line\">       - id: spring_service</span><br><span class=\"line\">        uri: http:<span class=\"comment\">//localhost:18001</span></span><br><span class=\"line\">        predicates:</span><br><span class=\"line\">         - Header=X-Request-Id, \\d+</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240222180227522.png\" alt=\"image-20240222180227522\"></p>\n<p><img src=\"/typora-user-images/image-20240222180306582.png\" alt=\"image-20240222180306582\"></p>\n<p><img src=\"/typora-user-images/image-20240222180325402.png\" alt=\"image-20240222180325402\"></p>\n<p><strong>HeaderHeader, 404 Header</strong></p>\n<h2 id=\"-Host-\"><a href=\"#-Host-\" class=\"headerlink\" title=\" Host \"></a> Host </h2><p>Host Route Predicate  ant <code>.</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Host=**.lison.com</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240222181235735.png\" alt=\"image-20240222181235735\"></p>\n<p> host  host_route  host  404 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> POSTGETPUTDELETE </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Method=GET</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p> POST  404 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Path Route Predicate </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Path=/spring_service/&#123;segment&#125;</span> <span class=\"comment\"># - Path=/spring_service/**</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;spring_service&#x2F;1  &#x2F;spring_service&#x2F;bar</p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:18003/spring_service/1</span><br><span class=\"line\">http://localhost:18003/spring_service/2</span><br><span class=\"line\">http://localhost:18003/spring_xxx/2</span><br></pre></td></tr></table></figure>\n\n\n\n<p> 404</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Query Route Predicate </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Query=token</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p> token </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:18003/spring_service/getServerProd?token=dfasdfas&amp;id=xxx</span><br></pre></td></tr></table></figure>\n\n\n\n<p> smile  token </p>\n<p> Query </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Query=token,lison.</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p> keep  lison </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:18003/spring_service/getServerProd?token=lison6&amp;id=xxx</span><br></pre></td></tr></table></figure>\n\n<p> token  pubx  lison66, </p>\n<h2 id=\"-ip-\"><a href=\"#-ip-\" class=\"headerlink\" title=\" ip \"></a> ip </h2><p>Predicate  ip RemoteAddr Route Predicate  cidr  (IPv4  IPv6) ( 1) 192.168.0.1&#x2F;16 ( 192.168.0.1  IP 16 )</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">RemoteAddr=192.168.1.1/24</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p> ip </p>\n<p> 192.168.1.10</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>BetweenRoutePredicateFactory</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//XXXXRoutePredicateFactory    AbstractRoutePredicateFactory</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">BetweenRoutePredicateFactory</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractRoutePredicateFactory</span>&lt;Config&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">DATETIME1_KEY</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;datetime1&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">DATETIME2_KEY</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;datetime2&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">BetweenRoutePredicateFactory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(Config.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title function_\">shortcutFieldOrder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Arrays.asList(<span class=\"string\">&quot;datetime1&quot;</span>, <span class=\"string\">&quot;datetime2&quot;</span>); <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Predicate&lt;ServerWebExchange&gt; <span class=\"title function_\">apply</span><span class=\"params\">(<span class=\"keyword\">final</span> Config config)</span> &#123;</span><br><span class=\"line\">        Assert.isTrue(config.getDatetime1().isBefore(config.getDatetime2()), config.getDatetime1() + <span class=\"string\">&quot; must be before &quot;</span> + config.getDatetime2());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GatewayPredicate</span>() &#123;</span><br><span class=\"line\">          <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">test</span><span class=\"params\">(ServerWebExchange serverWebExchange)</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">ZonedDateTime</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> ZonedDateTime.now();</span><br><span class=\"line\">                <span class=\"keyword\">return</span> now.isAfter(config.getDatetime1()) &amp;&amp; now.isBefore(config.getDatetime2());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;Between: %s and %s&quot;</span>, config.getDatetime1(), config.getDatetime2());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Validated</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Config</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"meta\">@NotNull</span> ZonedDateTime datetime1;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"meta\">@NotNull</span> ZonedDateTime datetime2;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Config</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> ZonedDateTime <span class=\"title function_\">getDatetime1</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.datetime1;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Config <span class=\"title function_\">setDatetime1</span><span class=\"params\">(ZonedDateTime datetime1)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.datetime1 = datetime1;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> ZonedDateTime <span class=\"title function_\">getDatetime2</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.datetime2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Config <span class=\"title function_\">setDatetime2</span><span class=\"params\">(ZonedDateTime datetime2)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.datetime2 = datetime2;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>1860</p>\n<p>1</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Age=18,60</span> <span class=\"comment\">#1860</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p>2AgeAgeRoutePredicateFactory</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.config.predicates;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.config.predicates-&gt; AgeRoutePredicateFactory</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:    1.+RoutePredicateFactory 2.AbstractRoutePredicateFactory&lt;&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-20</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cloud.gateway.handler.predicate.AbstractRoutePredicateFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.function.Predicate;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AgeRoutePredicateFactory</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractRoutePredicateFactory</span>&lt;AgeRoutePredicateFactory.Config&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">AgeRoutePredicateFactory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(AgeRoutePredicateFactory.Config.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title function_\">shortcutFieldOrder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//yml</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> Arrays.asList(<span class=\"string\">&quot;minAge&quot;</span>, <span class=\"string\">&quot;maxAge&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Predicate&lt;ServerWebExchange&gt; <span class=\"title function_\">apply</span><span class=\"params\">(AgeRoutePredicateFactory.Config config)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Predicate</span>&lt;ServerWebExchange&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">test</span><span class=\"params\">(ServerWebExchange serverWebExchange)</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//serverWebExchange</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">ageStr</span> <span class=\"operator\">=</span> serverWebExchange.getRequest().getQueryParams().getFirst(<span class=\"string\">&quot;age&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (StringUtils.isNotEmpty(ageStr)) &#123;</span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">age</span> <span class=\"operator\">=</span> Integer.parseInt(ageStr);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> age &gt; config.getMinAge() &amp;&amp; age &lt; config.getMaxAge();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Config</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> minAge;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> maxAge;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getMinAge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> minAge;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setMinAge</span><span class=\"params\">(<span class=\"type\">int</span> minAge)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.minAge = minAge;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;Config&#123;&quot;</span> +</span><br><span class=\"line\">                    <span class=\"string\">&quot;minAge=&quot;</span> + minAge +</span><br><span class=\"line\">                    <span class=\"string\">&quot;, maxAge=&quot;</span> + maxAge +</span><br><span class=\"line\">                    <span class=\"string\">&#x27;&#125;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getMaxAge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> maxAge;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setMaxAge</span><span class=\"params\">(<span class=\"type\">int</span> maxAge)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxAge = maxAge;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>3age&#x3D;20age&#x3D;15</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Predicate  Predicate </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Host=**.lison.com</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Path=/spring_service/**</span> <span class=\"comment\"># Path,</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Cookie=token,lison</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">After=2023-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Before=2023-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Between=2023-10-20T08:30:00+08:00[Asia/Shanghai],2024-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Header=X-Request-Id,</span> <span class=\"string\">\\d+</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Host=**.lison.com</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Method=GET,POST</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Query=token,lison.</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">RemoteAddr=192.168.1.1/24</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Age=18,60</span> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p> Predicates </p>\n<blockquote>\n<p></p>\n</blockquote>\n","excerpt":"","more":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.10.20</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-05-Gateway-02--Predicate-\"><a href=\"#Spring-Cloud-Alibaba-05-Gateway-02--Predicate-\" class=\"headerlink\" title=\"Spring Cloud Alibaba-05-Gateway-02-(Predicate)\"></a>Spring Cloud Alibaba-05-Gateway-02-(Predicate)</h1><p>[toc]</p>\n<p>Predicate </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Predicate  2023 10  20 </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">After=2023-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p>Spring  ZonedDateTime ZonedDateTime  Java 8 ZonedDateTime Asia&#x2F;Shanghai</p>\n<p>After Route Predicate  2023  10  20  08  30  0 <a href=\"http://localhost:18001+08:00\">http://localhost:18001+08:00</a> UTC Asia&#x2F;Shanghai</p>\n<p><a href=\"http://localhost:18001/spring_service\">http://localhost:18001/spring_service</a> <a href=\"http://localhost:18001\">http://localhost:18001</a></p>\n<p>Before Route Predicate  After  Before:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Before=2023-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p><code>http://localhost:18001/spring_service </code> 404 </p>\n<p>Gateway  Between Route Predicate </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Between=2023-10-20T08:30:00+08:00[Asia/Shanghai],2024-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"-Cookie-\"><a href=\"#-Cookie-\" class=\"headerlink\" title=\" Cookie \"></a> Cookie </h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Cookie=token,lison</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240222175326047.png\" alt=\"image-20240222175326047\"></p>\n<p><img src=\"/typora-user-images/image-20240222175403127.png\" alt=\"image-20240222175403127\"></p>\n<p><strong>CookieCookie, 404 Cookie</strong></p>\n<h2 id=\"-Header-\"><a href=\"#-Header-\" class=\"headerlink\" title=\" Header \"></a> Header </h2><p>Header Route Predicate  Cookie Route Predicate  2  header </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  cloud:</span><br><span class=\"line\">    gateway:</span><br><span class=\"line\">      routes:</span><br><span class=\"line\">       - id: spring_service</span><br><span class=\"line\">        uri: http:<span class=\"comment\">//localhost:18001</span></span><br><span class=\"line\">        predicates:</span><br><span class=\"line\">         - Header=X-Request-Id, \\d+</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240222180227522.png\" alt=\"image-20240222180227522\"></p>\n<p><img src=\"/typora-user-images/image-20240222180306582.png\" alt=\"image-20240222180306582\"></p>\n<p><img src=\"/typora-user-images/image-20240222180325402.png\" alt=\"image-20240222180325402\"></p>\n<p><strong>HeaderHeader, 404 Header</strong></p>\n<h2 id=\"-Host-\"><a href=\"#-Host-\" class=\"headerlink\" title=\" Host \"></a> Host </h2><p>Host Route Predicate  ant <code>.</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Host=**.lison.com</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240222181235735.png\" alt=\"image-20240222181235735\"></p>\n<p> host  host_route  host  404 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> POSTGETPUTDELETE </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Method=GET</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p> POST  404 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Path Route Predicate </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Path=/spring_service/&#123;segment&#125;</span> <span class=\"comment\"># - Path=/spring_service/**</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;spring_service&#x2F;1  &#x2F;spring_service&#x2F;bar</p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:18003/spring_service/1</span><br><span class=\"line\">http://localhost:18003/spring_service/2</span><br><span class=\"line\">http://localhost:18003/spring_xxx/2</span><br></pre></td></tr></table></figure>\n\n\n\n<p> 404</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Query Route Predicate </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Query=token</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p> token </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:18003/spring_service/getServerProd?token=dfasdfas&amp;id=xxx</span><br></pre></td></tr></table></figure>\n\n\n\n<p> smile  token </p>\n<p> Query </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Query=token,lison.</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p> keep  lison </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:18003/spring_service/getServerProd?token=lison6&amp;id=xxx</span><br></pre></td></tr></table></figure>\n\n<p> token  pubx  lison66, </p>\n<h2 id=\"-ip-\"><a href=\"#-ip-\" class=\"headerlink\" title=\" ip \"></a> ip </h2><p>Predicate  ip RemoteAddr Route Predicate  cidr  (IPv4  IPv6) ( 1) 192.168.0.1&#x2F;16 ( 192.168.0.1  IP 16 )</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">RemoteAddr=192.168.1.1/24</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p> ip </p>\n<p> 192.168.1.10</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>BetweenRoutePredicateFactory</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//XXXXRoutePredicateFactory    AbstractRoutePredicateFactory</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">BetweenRoutePredicateFactory</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractRoutePredicateFactory</span>&lt;Config&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">DATETIME1_KEY</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;datetime1&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">DATETIME2_KEY</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;datetime2&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">BetweenRoutePredicateFactory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(Config.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title function_\">shortcutFieldOrder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Arrays.asList(<span class=\"string\">&quot;datetime1&quot;</span>, <span class=\"string\">&quot;datetime2&quot;</span>); <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Predicate&lt;ServerWebExchange&gt; <span class=\"title function_\">apply</span><span class=\"params\">(<span class=\"keyword\">final</span> Config config)</span> &#123;</span><br><span class=\"line\">        Assert.isTrue(config.getDatetime1().isBefore(config.getDatetime2()), config.getDatetime1() + <span class=\"string\">&quot; must be before &quot;</span> + config.getDatetime2());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GatewayPredicate</span>() &#123;</span><br><span class=\"line\">          <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">test</span><span class=\"params\">(ServerWebExchange serverWebExchange)</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">ZonedDateTime</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> ZonedDateTime.now();</span><br><span class=\"line\">                <span class=\"keyword\">return</span> now.isAfter(config.getDatetime1()) &amp;&amp; now.isBefore(config.getDatetime2());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;Between: %s and %s&quot;</span>, config.getDatetime1(), config.getDatetime2());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Validated</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Config</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"meta\">@NotNull</span> ZonedDateTime datetime1;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"meta\">@NotNull</span> ZonedDateTime datetime2;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Config</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> ZonedDateTime <span class=\"title function_\">getDatetime1</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.datetime1;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Config <span class=\"title function_\">setDatetime1</span><span class=\"params\">(ZonedDateTime datetime1)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.datetime1 = datetime1;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> ZonedDateTime <span class=\"title function_\">getDatetime2</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.datetime2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Config <span class=\"title function_\">setDatetime2</span><span class=\"params\">(ZonedDateTime datetime2)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.datetime2 = datetime2;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>1860</p>\n<p>1</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Age=18,60</span> <span class=\"comment\">#1860</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p>2AgeAgeRoutePredicateFactory</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.config.predicates;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.config.predicates-&gt; AgeRoutePredicateFactory</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:    1.+RoutePredicateFactory 2.AbstractRoutePredicateFactory&lt;&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2023-10-20</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cloud.gateway.handler.predicate.AbstractRoutePredicateFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.function.Predicate;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AgeRoutePredicateFactory</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractRoutePredicateFactory</span>&lt;AgeRoutePredicateFactory.Config&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">AgeRoutePredicateFactory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(AgeRoutePredicateFactory.Config.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title function_\">shortcutFieldOrder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//yml</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> Arrays.asList(<span class=\"string\">&quot;minAge&quot;</span>, <span class=\"string\">&quot;maxAge&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Predicate&lt;ServerWebExchange&gt; <span class=\"title function_\">apply</span><span class=\"params\">(AgeRoutePredicateFactory.Config config)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Predicate</span>&lt;ServerWebExchange&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">test</span><span class=\"params\">(ServerWebExchange serverWebExchange)</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//serverWebExchange</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">ageStr</span> <span class=\"operator\">=</span> serverWebExchange.getRequest().getQueryParams().getFirst(<span class=\"string\">&quot;age&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (StringUtils.isNotEmpty(ageStr)) &#123;</span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">age</span> <span class=\"operator\">=</span> Integer.parseInt(ageStr);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> age &gt; config.getMinAge() &amp;&amp; age &lt; config.getMaxAge();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Config</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> minAge;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> maxAge;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getMinAge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> minAge;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setMinAge</span><span class=\"params\">(<span class=\"type\">int</span> minAge)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.minAge = minAge;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;Config&#123;&quot;</span> +</span><br><span class=\"line\">                    <span class=\"string\">&quot;minAge=&quot;</span> + minAge +</span><br><span class=\"line\">                    <span class=\"string\">&quot;, maxAge=&quot;</span> + maxAge +</span><br><span class=\"line\">                    <span class=\"string\">&#x27;&#125;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getMaxAge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> maxAge;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setMaxAge</span><span class=\"params\">(<span class=\"type\">int</span> maxAge)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.maxAge = maxAge;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>3age&#x3D;20age&#x3D;15</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Predicate  Predicate </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">gateway:</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"attr\">id:</span> <span class=\"string\">spring_service</span></span><br><span class=\"line\">        <span class=\"attr\">uri:</span> <span class=\"string\">http://localhost:18001</span></span><br><span class=\"line\">        <span class=\"attr\">predicates:</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Host=**.lison.com</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Path=/spring_service/**</span> <span class=\"comment\"># Path,</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Cookie=token,lison</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">After=2023-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Before=2023-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Between=2023-10-20T08:30:00+08:00[Asia/Shanghai],2024-10-20T08:30:00+08:00[Asia/Shanghai]</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Header=X-Request-Id,</span> <span class=\"string\">\\d+</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Host=**.lison.com</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Method=GET,POST</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Query=token,lison.</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">RemoteAddr=192.168.1.1/24</span></span><br><span class=\"line\">         <span class=\"bullet\">-</span> <span class=\"string\">Age=18,60</span> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n<p> Predicates </p>\n<blockquote>\n<p></p>\n</blockquote>\n"},{"_content":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2024.5.1`\n\n# Spring Cloud Alibaba-08-SMS\n\n## \n\n> (Short Message Service)\n>\n> :\n> :\n> :\n\n![image-20240510121326830](typora-user-images/image-20240510121326830.png)\n\n\n\n## \n\n\n\n\n\n1\n\n![image-20240510121854650](typora-user-images/image-20240510121854650.png)\n\n\n\n2\n\n![image-20240510121631586](typora-user-images/image-20240510121631586.png)\n\n\n\n\n\n## SMS\n\n- Short Message Service\n\n  API\n\n- TemplateId\n\n  \n\n- SignName\n\n  \n\n- RegionId\n\n  SMS\n\n- AccessKey\n\n  AccessKeyAKAccessKey IDAccessKey SecretSMSAccessKey IDAccessKey SecretAccessKey IDAccessKey SecretSMSAccessKey\n\n\n\n\n\n\n\nBladeXblade-starter-smssmssmssmssmssms\n\n\n\n## \n\n:\n\n~~~xml\n<!---->\n <dependency> \n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-alicloud-sms</artifactId>\n</dependency>\n\n~~~\n\n~~~yaml\nsms:\n  enabled: true\n  name: aliyun\n  template-id: SMS_xxxx\n  sign-name: xxxxx\n  access-key: xxxxxxx\n  secret-key: xxxxxxx\n  region-id: cn-hangzhou\n~~~\n\n\n\n\n\nDemo\n\n~~~java\npublic class SmsUtil {\n    //accessKeyId\n    private static String accessKeyId = \"xxx\"; //accessKeySecret\n    private static String accessKeySecret = \"xxxxx\";\n    static final String product = \"Dysmsapi\";\n    static final String domain = \"dysmsapi.aliyuncs.com\";\n\n    /**\n     * \n     *\n     * @param phoneNumbers \n     * @param signName     []\n     * @param templateCode ID[]\n     * @param param        ${code}\n     */\n    public static void sendSms(String phoneNumbers, String signName, String templateCode, String param) {\n        try {\n            System.setProperty(\"sun.net.client.defaultConnectTimeout\", \"10000\");\n            System.setProperty(\"sun.net.client.defaultReadTimeout\", \"10000\");\n            //acsClient,region\n            IClientProfile profile = DefaultProfile.getProfile(\"cn-hangzhou\", accessKeyId, accessKeySecret);\n\n            DefaultProfile.addEndpoint(\"cn-hangzhou\", \"cn-hangzhou\", product, domain);\n            IAcsClient acsClient = new DefaultAcsClient(profile);\n            SendSmsRequest request = new SendSmsRequest();\n            request.setPhoneNumbers(phoneNumbers);\n            request.setSignName(signName);\n            request.setTemplateCode(templateCode);\n            request.setTemplateParam(param);\n            request.setOutId(\"yourOutId\");\n            SendSmsResponse sendSmsResponse = acsClient.getAcsResponse(request);\n            if (!\"OK\".\n\n                    equals(sendSmsResponse.getCode())) {\n                throw new RuntimeException(sendSmsResponse.getMessage());\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n            throw new RuntimeException(\"\");\n        }\n    }\n}\n\n\n~~~\n\n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-08- SMS.md","raw":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2024.5.1`\n\n# Spring Cloud Alibaba-08-SMS\n\n## \n\n> (Short Message Service)\n>\n> :\n> :\n> :\n\n![image-20240510121326830](typora-user-images/image-20240510121326830.png)\n\n\n\n## \n\n\n\n\n\n1\n\n![image-20240510121854650](typora-user-images/image-20240510121854650.png)\n\n\n\n2\n\n![image-20240510121631586](typora-user-images/image-20240510121631586.png)\n\n\n\n\n\n## SMS\n\n- Short Message Service\n\n  API\n\n- TemplateId\n\n  \n\n- SignName\n\n  \n\n- RegionId\n\n  SMS\n\n- AccessKey\n\n  AccessKeyAKAccessKey IDAccessKey SecretSMSAccessKey IDAccessKey SecretAccessKey IDAccessKey SecretSMSAccessKey\n\n\n\n\n\n\n\nBladeXblade-starter-smssmssmssmssmssms\n\n\n\n## \n\n:\n\n~~~xml\n<!---->\n <dependency> \n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-alicloud-sms</artifactId>\n</dependency>\n\n~~~\n\n~~~yaml\nsms:\n  enabled: true\n  name: aliyun\n  template-id: SMS_xxxx\n  sign-name: xxxxx\n  access-key: xxxxxxx\n  secret-key: xxxxxxx\n  region-id: cn-hangzhou\n~~~\n\n\n\n\n\nDemo\n\n~~~java\npublic class SmsUtil {\n    //accessKeyId\n    private static String accessKeyId = \"xxx\"; //accessKeySecret\n    private static String accessKeySecret = \"xxxxx\";\n    static final String product = \"Dysmsapi\";\n    static final String domain = \"dysmsapi.aliyuncs.com\";\n\n    /**\n     * \n     *\n     * @param phoneNumbers \n     * @param signName     []\n     * @param templateCode ID[]\n     * @param param        ${code}\n     */\n    public static void sendSms(String phoneNumbers, String signName, String templateCode, String param) {\n        try {\n            System.setProperty(\"sun.net.client.defaultConnectTimeout\", \"10000\");\n            System.setProperty(\"sun.net.client.defaultReadTimeout\", \"10000\");\n            //acsClient,region\n            IClientProfile profile = DefaultProfile.getProfile(\"cn-hangzhou\", accessKeyId, accessKeySecret);\n\n            DefaultProfile.addEndpoint(\"cn-hangzhou\", \"cn-hangzhou\", product, domain);\n            IAcsClient acsClient = new DefaultAcsClient(profile);\n            SendSmsRequest request = new SendSmsRequest();\n            request.setPhoneNumbers(phoneNumbers);\n            request.setSignName(signName);\n            request.setTemplateCode(templateCode);\n            request.setTemplateParam(param);\n            request.setOutId(\"yourOutId\");\n            SendSmsResponse sendSmsResponse = acsClient.getAcsResponse(request);\n            if (!\"OK\".\n\n                    equals(sendSmsResponse.getCode())) {\n                throw new RuntimeException(sendSmsResponse.getMessage());\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n            throw new RuntimeException(\"\");\n        }\n    }\n}\n\n\n~~~\n\n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-08- SMS","published":1,"date":"2024-04-08T01:28:51.543Z","updated":"2024-05-14T01:46:04.726Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhk0005ecfy1jvlfqfj","content":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2024.5.1</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-08-SMS\"><a href=\"#Spring-Cloud-Alibaba-08-SMS\" class=\"headerlink\" title=\"Spring Cloud Alibaba-08-SMS\"></a>Spring Cloud Alibaba-08-SMS</h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><blockquote>\n<p>(Short Message Service)</p>\n<p>:<br>:<br>:</p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20240510121326830.png\" alt=\"image-20240510121326830\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1</p>\n<p><img src=\"/typora-user-images/image-20240510121854650.png\" alt=\"image-20240510121854650\"></p>\n<p>2</p>\n<p><img src=\"/typora-user-images/image-20240510121631586.png\" alt=\"image-20240510121631586\"></p>\n<h2 id=\"SMS\"><a href=\"#SMS\" class=\"headerlink\" title=\"SMS\"></a>SMS</h2><ul>\n<li><p>Short Message Service</p>\n<p>API</p>\n</li>\n<li><p>TemplateId</p>\n<p></p>\n</li>\n<li><p>SignName</p>\n<p></p>\n</li>\n<li><p>RegionId</p>\n<p>SMS</p>\n</li>\n<li><p>AccessKey</p>\n<p>AccessKeyAKAccessKey IDAccessKey SecretSMSAccessKey IDAccessKey SecretAccessKey IDAccessKey SecretSMSAccessKey</p>\n</li>\n</ul>\n<p>BladeXblade-starter-smssmssmssmssmssms</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alicloud-sms<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">sms:</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">aliyun</span></span><br><span class=\"line\">  <span class=\"attr\">template-id:</span> <span class=\"string\">SMS_xxxx</span></span><br><span class=\"line\">  <span class=\"attr\">sign-name:</span> <span class=\"string\">xxxxx</span></span><br><span class=\"line\">  <span class=\"attr\">access-key:</span> <span class=\"string\">xxxxxxx</span></span><br><span class=\"line\">  <span class=\"attr\">secret-key:</span> <span class=\"string\">xxxxxxx</span></span><br><span class=\"line\">  <span class=\"attr\">region-id:</span> <span class=\"string\">cn-hangzhou</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>Demo</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SmsUtil</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//accessKeyId</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">accessKeyId</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;xxx&quot;</span>; <span class=\"comment\">//accessKeySecret</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">accessKeySecret</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;xxxxx&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">product</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;Dysmsapi&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">domain</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;dysmsapi.aliyuncs.com&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> phoneNumbers </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> signName     []</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> templateCode ID[]</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> param        $&#123;code&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sendSms</span><span class=\"params\">(String phoneNumbers, String signName, String templateCode, String param)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            System.setProperty(<span class=\"string\">&quot;sun.net.client.defaultConnectTimeout&quot;</span>, <span class=\"string\">&quot;10000&quot;</span>);</span><br><span class=\"line\">            System.setProperty(<span class=\"string\">&quot;sun.net.client.defaultReadTimeout&quot;</span>, <span class=\"string\">&quot;10000&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//acsClient,region</span></span><br><span class=\"line\">            <span class=\"type\">IClientProfile</span> <span class=\"variable\">profile</span> <span class=\"operator\">=</span> DefaultProfile.getProfile(<span class=\"string\">&quot;cn-hangzhou&quot;</span>, accessKeyId, accessKeySecret);</span><br><span class=\"line\"></span><br><span class=\"line\">            DefaultProfile.addEndpoint(<span class=\"string\">&quot;cn-hangzhou&quot;</span>, <span class=\"string\">&quot;cn-hangzhou&quot;</span>, product, domain);</span><br><span class=\"line\">            <span class=\"type\">IAcsClient</span> <span class=\"variable\">acsClient</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultAcsClient</span>(profile);</span><br><span class=\"line\">            <span class=\"type\">SendSmsRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SendSmsRequest</span>();</span><br><span class=\"line\">            request.setPhoneNumbers(phoneNumbers);</span><br><span class=\"line\">            request.setSignName(signName);</span><br><span class=\"line\">            request.setTemplateCode(templateCode);</span><br><span class=\"line\">            request.setTemplateParam(param);</span><br><span class=\"line\">            request.setOutId(<span class=\"string\">&quot;yourOutId&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">SendSmsResponse</span> <span class=\"variable\">sendSmsResponse</span> <span class=\"operator\">=</span> acsClient.getAcsResponse(request);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!<span class=\"string\">&quot;OK&quot;</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">                    equals(sendSmsResponse.getCode())) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(sendSmsResponse.getMessage());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","excerpt":"","more":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2024.5.1</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-08-SMS\"><a href=\"#Spring-Cloud-Alibaba-08-SMS\" class=\"headerlink\" title=\"Spring Cloud Alibaba-08-SMS\"></a>Spring Cloud Alibaba-08-SMS</h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><blockquote>\n<p>(Short Message Service)</p>\n<p>:<br>:<br>:</p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20240510121326830.png\" alt=\"image-20240510121326830\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1</p>\n<p><img src=\"/typora-user-images/image-20240510121854650.png\" alt=\"image-20240510121854650\"></p>\n<p>2</p>\n<p><img src=\"/typora-user-images/image-20240510121631586.png\" alt=\"image-20240510121631586\"></p>\n<h2 id=\"SMS\"><a href=\"#SMS\" class=\"headerlink\" title=\"SMS\"></a>SMS</h2><ul>\n<li><p>Short Message Service</p>\n<p>API</p>\n</li>\n<li><p>TemplateId</p>\n<p></p>\n</li>\n<li><p>SignName</p>\n<p></p>\n</li>\n<li><p>RegionId</p>\n<p>SMS</p>\n</li>\n<li><p>AccessKey</p>\n<p>AccessKeyAKAccessKey IDAccessKey SecretSMSAccessKey IDAccessKey SecretAccessKey IDAccessKey SecretSMSAccessKey</p>\n</li>\n</ul>\n<p>BladeXblade-starter-smssmssmssmssmssms</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alicloud-sms<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">sms:</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">aliyun</span></span><br><span class=\"line\">  <span class=\"attr\">template-id:</span> <span class=\"string\">SMS_xxxx</span></span><br><span class=\"line\">  <span class=\"attr\">sign-name:</span> <span class=\"string\">xxxxx</span></span><br><span class=\"line\">  <span class=\"attr\">access-key:</span> <span class=\"string\">xxxxxxx</span></span><br><span class=\"line\">  <span class=\"attr\">secret-key:</span> <span class=\"string\">xxxxxxx</span></span><br><span class=\"line\">  <span class=\"attr\">region-id:</span> <span class=\"string\">cn-hangzhou</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>Demo</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SmsUtil</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//accessKeyId</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">accessKeyId</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;xxx&quot;</span>; <span class=\"comment\">//accessKeySecret</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">accessKeySecret</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;xxxxx&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">product</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;Dysmsapi&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">domain</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;dysmsapi.aliyuncs.com&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> phoneNumbers </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> signName     []</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> templateCode ID[]</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> param        $&#123;code&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sendSms</span><span class=\"params\">(String phoneNumbers, String signName, String templateCode, String param)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            System.setProperty(<span class=\"string\">&quot;sun.net.client.defaultConnectTimeout&quot;</span>, <span class=\"string\">&quot;10000&quot;</span>);</span><br><span class=\"line\">            System.setProperty(<span class=\"string\">&quot;sun.net.client.defaultReadTimeout&quot;</span>, <span class=\"string\">&quot;10000&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//acsClient,region</span></span><br><span class=\"line\">            <span class=\"type\">IClientProfile</span> <span class=\"variable\">profile</span> <span class=\"operator\">=</span> DefaultProfile.getProfile(<span class=\"string\">&quot;cn-hangzhou&quot;</span>, accessKeyId, accessKeySecret);</span><br><span class=\"line\"></span><br><span class=\"line\">            DefaultProfile.addEndpoint(<span class=\"string\">&quot;cn-hangzhou&quot;</span>, <span class=\"string\">&quot;cn-hangzhou&quot;</span>, product, domain);</span><br><span class=\"line\">            <span class=\"type\">IAcsClient</span> <span class=\"variable\">acsClient</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultAcsClient</span>(profile);</span><br><span class=\"line\">            <span class=\"type\">SendSmsRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SendSmsRequest</span>();</span><br><span class=\"line\">            request.setPhoneNumbers(phoneNumbers);</span><br><span class=\"line\">            request.setSignName(signName);</span><br><span class=\"line\">            request.setTemplateCode(templateCode);</span><br><span class=\"line\">            request.setTemplateParam(param);</span><br><span class=\"line\">            request.setOutId(<span class=\"string\">&quot;yourOutId&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">SendSmsResponse</span> <span class=\"variable\">sendSmsResponse</span> <span class=\"operator\">=</span> acsClient.getAcsResponse(request);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!<span class=\"string\">&quot;OK&quot;</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">                    equals(sendSmsResponse.getCode())) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(sendSmsResponse.getMessage());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n"},{"_content":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.05.10`\n\n# Spring Cloud Alibaba-02-Nacos Discovery\n\n[toc]\n\n\n\n## \n\n\n\n\n\n (ip):\n\n\n\n\n\n\n\n \n\n### \n\n\n\n:\n\n:\n\n![image-20230923151411555](typora-user-images/image-20230923151411555.png)\n\n\n\n**** :\n\n1. :\n   :\n   :\n2. :\n   :\n   :\n3. \n   \n\n### \n\n**Zookeeper**\n\nzookeeperApache Hadoop  : \n\n**Eureka**\n\nEurekaSpringcloud Netflix \n\n**Consul**\n\nConsulGO Consul:/Key/Value Consul \n\n**Nacos**\n\nNacos Spring Cloud Alibaba nacos=eureka+config\n\n\n\n\n\n## Nacos\n\n\n\n* NacosSpringCloudAlibaba\n* Nacos  DNS SpringcloudSpringDubbo\n* nacoseureka\n\n|      | Nacos | Eureka |                                                      |\n| ------------ | ----- | ------ | ------------------------------------------------------------ |\n|      |      |       |                                      |\n|      |      |       | eurekaspringcloud config                         |\n|  |      |       | nacosnettytcpeurekamq |\n| az     |      |       |    |\n|          |      |       | nacosnamespace,group       |\n|        |      |       |                            |\n|          |      |       | nacos                          |\n|      |      |       | nacoseureka |\n|      |      |       | eurekaribbon                         |\n\n* nacosapcpap, eurekaapzookeeperc\n\n\n\n## nacos\n\n\n\n* NacosDNSRPCSDKApiDNSHttpNacosEurekaNacos\n* DNSDNS\n* SpringCloudconfigNacosConfigNacos\n* Nacos  SLA  metrics prometheusNacos metricsgrafanametrics\n\n\n\n\n\n## Nacos\n\n****https://nacos.io/zh-cn/index.html\n\n![image-20230921165730484](typora-user-images/image-20230921165730484.png)\n\n\n\n****https://nacos.io/zh-cn/docs/quick-start.html\n\n****https://github.com/alibaba/nacos/releases\n\n\n\n![image-20230921170222187](typora-user-images/image-20230921170222187.png)\n\n### ****\n\n\n\n**Linux/Unix/Mac**\n\n(standalone):\n\n```\nsh startup.sh -m standalone\n```\n\n\n\n**Windows**\n\n(standalone):\n\n```\nstartup.cmd -m standalone\n```\n\n\n\n### ****\n\n\n\n![image-20230921171251668](typora-user-images/image-20230921171251668.png)\n\n\n\n\n\n\n\n### \n\nNacoshttp://localhost:8848/nacos\n\n![image-20230921170734063](typora-user-images/image-20230921170734063.png)\n\nNacosnacos/nacos\n\n![image-20230921171005578](typora-user-images/image-20230921171005578.png)\n\n\n\n\n\n## Nacos Discovery/\n\nNacos Discovery  Nacos Nacos Nacos Discovery  URL Nacos\n\n https://spring.io/projects/spring-cloud-alibaba#learn\n\n\n\n### \n\nSpringBootSpringBootSpring Cloud Alibaba\n\n**pom**\n\n\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.2.13.RELEASE</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n\n    <groupId>com.lison</groupId>\n    <artifactId>spring-cloud-alibaba-building</artifactId>\n    <version>1.0.0-SNAPSHOT</version>\n    <packaging>pom</packaging>\n\n\n    <properties>\n        <java.version>17</java.version>\n        <lison.project.version>1.0.0-SNAPSHOT</lison.project.version>\n        <maven.plugin.version>3.8.1</maven.plugin.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <spring-cloud-alibaba-version>2.2.5.RELEASE</spring-cloud-alibaba-version>\n    </properties>\n\n    <modules>\n        <module>spring-boot-building</module>\n    </modules>\n\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>com.alibaba.cloud</groupId>\n                <artifactId>spring-cloud-alibaba-dependencies</artifactId>\n                <version>${spring-cloud-alibaba-version}</version>\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n\n</project>\n\n~~~\n\n\n\n**pom**\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>com.lison</groupId>\n        <artifactId>spring-cloud-alibaba-building</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison</groupId>\n    <artifactId>spring-boot-building</artifactId>\n    <version>${lison.project.version}</version>\n    <name>${project.artifactId}</name>\n    <packaging>jar</packaging>\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <!-- Nacos -->\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n        </dependency>\n    </dependencies>\n\n</project>\n\n~~~\n\n**yml**\n\n\n\n~~~yaml\nserver:\n  port: 18000\nspring:\n  application:\n    name: spring-boot-building\n\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n\nmanagement:\n  endpoint:\n    web:\n      exposure:\n        include:'*'\n\n~~~\n\n\n\n****\n\n~~~java\npackage com.lison.springbootbuilding;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@SpringBootApplication\n@EnableDiscoveryClient\npublic class SpringBootBuildingApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringBootBuildingApplication.class, args);\n    }\n\n}\n\n~~~\n\n\n\n### \n\n**Nacos**\n\n![image-20230923154459874](typora-user-images/image-20230923154459874.png)\n\n\n\n\n\n\n\n\n\n## Nacos\n\n\n\n### \n\n ()(,)\n, ,nginx\n\n\n\n![image-20230923152344429](typora-user-images/image-20230923152344429.png)\n\n\n\n\n\n### \n\nspring-cloud-service \n\n pom.xml\n\n\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>com.lison</groupId>\n        <artifactId>spring-cloud-alibaba-building</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison</groupId>\n    <artifactId>spring-cloud-service</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring-cloud-service</name>\n    <description>spring-cloud-service</description>\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <!-- Nacos -->\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n        </dependency>\n    </dependencies>\n\n\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-antrun-plugin</artifactId>\n                <executions>\n                    <execution>\n                        <phase>package</phase>\n                        <goals>\n                            <goal>run</goal>\n                        </goals>\n                        <configuration>\n                            <tasks>\n                                <!--suppress UnresolvedMavenProperty -->\n                                <copy overwrite=\"true\"\n                                      tofile=\"${session.executionRootDirectory}/target/${project.artifactId}.jar\"\n                                      file=\"${project.build.directory}/${project.artifactId}.jar\" />\n                            </tasks>\n                        </configuration>\n                    </execution>\n                </executions>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n~~~\n\n**yml**\n\n~~~java\nserver:\n  port: 18001\nspring:\n  application:\n    name: spring-cloud-service\n\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n\nmanagement:\n  endpoint:\n    web:\n      exposure:\n        include:'*'\n\n~~~\n\n\n\n****\n\n~~~java\npackage com.lison.springcloudservice;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@SpringBootApplication\n@EnableDiscoveryClient\npublic class SpringCloudServiceApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringCloudServiceApplication.class, args);\n    }\n\n}\n\n~~~\n\n\n\n spring-cloud-service nacos\n\n![image-20230923154644281](typora-user-images/image-20230923154644281.png)\n\n#### Ribbon\n\nRibbonSpring Cloud \n\n1RestTemplate @LoadBalanced\n\n~~~java\n@Bean\n@LoadBalanced\npublic RestTemplate restTemplate() {\n    return new RestTemplate();\n}\n\n~~~\n\n\n\n2\n\n~~~java\n@RestController\npublic class TestController {\n    @Autowired\n    private RestTemplate restTemplate;\n\n    @GetMapping(value = \"/naocs/consumer\")\n    public String getServerPort(){\n\n        return restTemplate.getForObject( \"http://spring-cloud-service/getServerProd\",String.class);\n\n    }\n}\n~~~\n\n\n\n\n\n3idea spring-cloud-service 18011\n\n![image-20230923162506692](typora-user-images/image-20230923162506692.png)\n\n\n\n4nacos\n\n\n\n![image-20230923162555344](typora-user-images/image-20230923162555344.png)\n\n\n\n\n\nRibbon\n\nRibbon, com.netflix.loadbalancer.IRule , :\n\n\n\n|                     |                                                      | ****                                                 |\n| ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| BestAvailableRule         |  server                              | ServerServer tripped ActiveRequestsCountserve |\n| AvailabilityFilteringRule |   circuit tripped server  server(active connections  ) | AvailabilityPredicate server statusserver |\n| WeightedResponseTimeRule  |  weight weight   | status server weightWeight responsetime server responsetimeserver statas roubineserver |\n| RetryRule                 |                            | server subRule server |\n| RoundRobinRule            |  server                                      | indexindex server                        |\n| RandomRule                | server                                           | indexindex server                    |\n| ZoneAvoidanceRule         | server server server     | ZoneAvoidancePredicate AvailabilityPredicate server zone zone(server) AvailabilityPredicate Server |\n\nRibbon\n\n~~~yaml\nspring-cloud-service: #  \n\tribbon: \n   \t\tNFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule\n\n\n~~~\n\n\n\n\n\n### Feign\n\n#### Feign\n\nFeignSpring CloudHttp   \n\nNacosFeign Feign Ribbon NacosFegin \n\n#### Feign\n\n1Feign\n\n~~~xml\n<!--fegin--> \n<dependency> \n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n\n~~~\n\n\n\n2Fegin\n\n~~~java\n\n@SpringBootApplication \n@EnableDiscoveryClient \n@EnableFeignClients\n//Fegin\n~~~\n\n\n\n\n\n3service Fegin\n\n\n\n~~~java\n@FeignClient(\"spring-cloud-service\")\npublic interface ITestService {\n    //\n    @GetMapping(value = \"/getServerProd\")\n    String getServerPort();\n}\n~~~\n\n\n\n4controller\n\n\n\n~~~java\n@RestController\npublic class TestController {\n    @Autowired\n    private RestTemplate restTemplate;\n\n    @Autowired\n    private ITestService iTestService;\n\n    @GetMapping(value = \"/naocs/consumer\")\n    public String getServerPort(){\n\n        return iTestService.getServerPort();\n\n    }\n}\n\n~~~\n\n\n\n5buding,http://127.0.0.1:18000/naocs/consumer \n\n\n\n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-02-Nacos Discovery.md","raw":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.05.10`\n\n# Spring Cloud Alibaba-02-Nacos Discovery\n\n[toc]\n\n\n\n## \n\n\n\n\n\n (ip):\n\n\n\n\n\n\n\n \n\n### \n\n\n\n:\n\n:\n\n![image-20230923151411555](typora-user-images/image-20230923151411555.png)\n\n\n\n**** :\n\n1. :\n   :\n   :\n2. :\n   :\n   :\n3. \n   \n\n### \n\n**Zookeeper**\n\nzookeeperApache Hadoop  : \n\n**Eureka**\n\nEurekaSpringcloud Netflix \n\n**Consul**\n\nConsulGO Consul:/Key/Value Consul \n\n**Nacos**\n\nNacos Spring Cloud Alibaba nacos=eureka+config\n\n\n\n\n\n## Nacos\n\n\n\n* NacosSpringCloudAlibaba\n* Nacos  DNS SpringcloudSpringDubbo\n* nacoseureka\n\n|      | Nacos | Eureka |                                                      |\n| ------------ | ----- | ------ | ------------------------------------------------------------ |\n|      |      |       |                                      |\n|      |      |       | eurekaspringcloud config                         |\n|  |      |       | nacosnettytcpeurekamq |\n| az     |      |       |    |\n|          |      |       | nacosnamespace,group       |\n|        |      |       |                            |\n|          |      |       | nacos                          |\n|      |      |       | nacoseureka |\n|      |      |       | eurekaribbon                         |\n\n* nacosapcpap, eurekaapzookeeperc\n\n\n\n## nacos\n\n\n\n* NacosDNSRPCSDKApiDNSHttpNacosEurekaNacos\n* DNSDNS\n* SpringCloudconfigNacosConfigNacos\n* Nacos  SLA  metrics prometheusNacos metricsgrafanametrics\n\n\n\n\n\n## Nacos\n\n****https://nacos.io/zh-cn/index.html\n\n![image-20230921165730484](typora-user-images/image-20230921165730484.png)\n\n\n\n****https://nacos.io/zh-cn/docs/quick-start.html\n\n****https://github.com/alibaba/nacos/releases\n\n\n\n![image-20230921170222187](typora-user-images/image-20230921170222187.png)\n\n### ****\n\n\n\n**Linux/Unix/Mac**\n\n(standalone):\n\n```\nsh startup.sh -m standalone\n```\n\n\n\n**Windows**\n\n(standalone):\n\n```\nstartup.cmd -m standalone\n```\n\n\n\n### ****\n\n\n\n![image-20230921171251668](typora-user-images/image-20230921171251668.png)\n\n\n\n\n\n\n\n### \n\nNacoshttp://localhost:8848/nacos\n\n![image-20230921170734063](typora-user-images/image-20230921170734063.png)\n\nNacosnacos/nacos\n\n![image-20230921171005578](typora-user-images/image-20230921171005578.png)\n\n\n\n\n\n## Nacos Discovery/\n\nNacos Discovery  Nacos Nacos Nacos Discovery  URL Nacos\n\n https://spring.io/projects/spring-cloud-alibaba#learn\n\n\n\n### \n\nSpringBootSpringBootSpring Cloud Alibaba\n\n**pom**\n\n\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.2.13.RELEASE</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n\n    <groupId>com.lison</groupId>\n    <artifactId>spring-cloud-alibaba-building</artifactId>\n    <version>1.0.0-SNAPSHOT</version>\n    <packaging>pom</packaging>\n\n\n    <properties>\n        <java.version>17</java.version>\n        <lison.project.version>1.0.0-SNAPSHOT</lison.project.version>\n        <maven.plugin.version>3.8.1</maven.plugin.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <spring-cloud-alibaba-version>2.2.5.RELEASE</spring-cloud-alibaba-version>\n    </properties>\n\n    <modules>\n        <module>spring-boot-building</module>\n    </modules>\n\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>com.alibaba.cloud</groupId>\n                <artifactId>spring-cloud-alibaba-dependencies</artifactId>\n                <version>${spring-cloud-alibaba-version}</version>\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n\n</project>\n\n~~~\n\n\n\n**pom**\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>com.lison</groupId>\n        <artifactId>spring-cloud-alibaba-building</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison</groupId>\n    <artifactId>spring-boot-building</artifactId>\n    <version>${lison.project.version}</version>\n    <name>${project.artifactId}</name>\n    <packaging>jar</packaging>\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <!-- Nacos -->\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n        </dependency>\n    </dependencies>\n\n</project>\n\n~~~\n\n**yml**\n\n\n\n~~~yaml\nserver:\n  port: 18000\nspring:\n  application:\n    name: spring-boot-building\n\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n\nmanagement:\n  endpoint:\n    web:\n      exposure:\n        include:'*'\n\n~~~\n\n\n\n****\n\n~~~java\npackage com.lison.springbootbuilding;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@SpringBootApplication\n@EnableDiscoveryClient\npublic class SpringBootBuildingApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringBootBuildingApplication.class, args);\n    }\n\n}\n\n~~~\n\n\n\n### \n\n**Nacos**\n\n![image-20230923154459874](typora-user-images/image-20230923154459874.png)\n\n\n\n\n\n\n\n\n\n## Nacos\n\n\n\n### \n\n ()(,)\n, ,nginx\n\n\n\n![image-20230923152344429](typora-user-images/image-20230923152344429.png)\n\n\n\n\n\n### \n\nspring-cloud-service \n\n pom.xml\n\n\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>com.lison</groupId>\n        <artifactId>spring-cloud-alibaba-building</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison</groupId>\n    <artifactId>spring-cloud-service</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring-cloud-service</name>\n    <description>spring-cloud-service</description>\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <!-- Nacos -->\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n        </dependency>\n    </dependencies>\n\n\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-antrun-plugin</artifactId>\n                <executions>\n                    <execution>\n                        <phase>package</phase>\n                        <goals>\n                            <goal>run</goal>\n                        </goals>\n                        <configuration>\n                            <tasks>\n                                <!--suppress UnresolvedMavenProperty -->\n                                <copy overwrite=\"true\"\n                                      tofile=\"${session.executionRootDirectory}/target/${project.artifactId}.jar\"\n                                      file=\"${project.build.directory}/${project.artifactId}.jar\" />\n                            </tasks>\n                        </configuration>\n                    </execution>\n                </executions>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n~~~\n\n**yml**\n\n~~~java\nserver:\n  port: 18001\nspring:\n  application:\n    name: spring-cloud-service\n\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n\nmanagement:\n  endpoint:\n    web:\n      exposure:\n        include:'*'\n\n~~~\n\n\n\n****\n\n~~~java\npackage com.lison.springcloudservice;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@SpringBootApplication\n@EnableDiscoveryClient\npublic class SpringCloudServiceApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringCloudServiceApplication.class, args);\n    }\n\n}\n\n~~~\n\n\n\n spring-cloud-service nacos\n\n![image-20230923154644281](typora-user-images/image-20230923154644281.png)\n\n#### Ribbon\n\nRibbonSpring Cloud \n\n1RestTemplate @LoadBalanced\n\n~~~java\n@Bean\n@LoadBalanced\npublic RestTemplate restTemplate() {\n    return new RestTemplate();\n}\n\n~~~\n\n\n\n2\n\n~~~java\n@RestController\npublic class TestController {\n    @Autowired\n    private RestTemplate restTemplate;\n\n    @GetMapping(value = \"/naocs/consumer\")\n    public String getServerPort(){\n\n        return restTemplate.getForObject( \"http://spring-cloud-service/getServerProd\",String.class);\n\n    }\n}\n~~~\n\n\n\n\n\n3idea spring-cloud-service 18011\n\n![image-20230923162506692](typora-user-images/image-20230923162506692.png)\n\n\n\n4nacos\n\n\n\n![image-20230923162555344](typora-user-images/image-20230923162555344.png)\n\n\n\n\n\nRibbon\n\nRibbon, com.netflix.loadbalancer.IRule , :\n\n\n\n|                     |                                                      | ****                                                 |\n| ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| BestAvailableRule         |  server                              | ServerServer tripped ActiveRequestsCountserve |\n| AvailabilityFilteringRule |   circuit tripped server  server(active connections  ) | AvailabilityPredicate server statusserver |\n| WeightedResponseTimeRule  |  weight weight   | status server weightWeight responsetime server responsetimeserver statas roubineserver |\n| RetryRule                 |                            | server subRule server |\n| RoundRobinRule            |  server                                      | indexindex server                        |\n| RandomRule                | server                                           | indexindex server                    |\n| ZoneAvoidanceRule         | server server server     | ZoneAvoidancePredicate AvailabilityPredicate server zone zone(server) AvailabilityPredicate Server |\n\nRibbon\n\n~~~yaml\nspring-cloud-service: #  \n\tribbon: \n   \t\tNFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule\n\n\n~~~\n\n\n\n\n\n### Feign\n\n#### Feign\n\nFeignSpring CloudHttp   \n\nNacosFeign Feign Ribbon NacosFegin \n\n#### Feign\n\n1Feign\n\n~~~xml\n<!--fegin--> \n<dependency> \n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n\n~~~\n\n\n\n2Fegin\n\n~~~java\n\n@SpringBootApplication \n@EnableDiscoveryClient \n@EnableFeignClients\n//Fegin\n~~~\n\n\n\n\n\n3service Fegin\n\n\n\n~~~java\n@FeignClient(\"spring-cloud-service\")\npublic interface ITestService {\n    //\n    @GetMapping(value = \"/getServerProd\")\n    String getServerPort();\n}\n~~~\n\n\n\n4controller\n\n\n\n~~~java\n@RestController\npublic class TestController {\n    @Autowired\n    private RestTemplate restTemplate;\n\n    @Autowired\n    private ITestService iTestService;\n\n    @GetMapping(value = \"/naocs/consumer\")\n    public String getServerPort(){\n\n        return iTestService.getServerPort();\n\n    }\n}\n\n~~~\n\n\n\n5buding,http://127.0.0.1:18000/naocs/consumer \n\n\n\n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-02-Nacos Discovery","published":1,"date":"2023-09-11T07:29:59.561Z","updated":"2023-10-24T02:19:52.216Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhm0006ecfyf46ibd7o","content":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.05.10</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-02-Nacos-Discovery\"><a href=\"#Spring-Cloud-Alibaba-02-Nacos-Discovery\" class=\"headerlink\" title=\"Spring Cloud Alibaba-02-Nacos Discovery\"></a>Spring Cloud Alibaba-02-Nacos Discovery</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> (ip):</p>\n<p></p>\n<p></p>\n<p></p>\n<p> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p>:</p>\n<p>:</p>\n<p><img src=\"/typora-user-images/image-20230923151411555.png\" alt=\"image-20230923151411555\"></p>\n<p><strong></strong> :</p>\n<ol>\n<li>:<br>:<br>:</li>\n<li>:<br>:<br>:</li>\n<li><br></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>Zookeeper</strong></p>\n<p>zookeeperApache Hadoop  : </p>\n<p><strong>Eureka</strong></p>\n<p>EurekaSpringcloud Netflix </p>\n<p><strong>Consul</strong></p>\n<p>ConsulGO Consul:&#x2F;Key&#x2F;Value Consul </p>\n<p><strong>Nacos</strong></p>\n<p>Nacos Spring Cloud Alibaba nacos&#x3D;eureka+config</p>\n<h2 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h2><ul>\n<li>NacosSpringCloudAlibaba</li>\n<li>Nacos  DNS SpringcloudSpringDubbo</li>\n<li>nacoseureka</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Nacos</th>\n<th>Eureka</th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>eurekaspringcloud config</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>nacosnettytcpeurekamq</td>\n</tr>\n<tr>\n<td>az</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>nacosnamespace,group</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>nacos</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>nacoseureka</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>eurekaribbon</td>\n</tr>\n</tbody></table>\n<ul>\n<li>nacosapcpap, eurekaapzookeeperc</li>\n</ul>\n<h2 id=\"nacos\"><a href=\"#nacos\" class=\"headerlink\" title=\"nacos\"></a>nacos</h2><ul>\n<li>NacosDNSRPCSDKApiDNSHttpNacosEurekaNacos</li>\n<li>DNSDNS</li>\n<li>SpringCloudconfigNacosConfigNacos</li>\n<li>Nacos  SLA  metrics prometheusNacos metricsgrafanametrics</li>\n</ul>\n<h2 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h2><p>****<a href=\"https://nacos.io/zh-cn/index.html\">https://nacos.io/zh-cn/index.html</a></p>\n<p><img src=\"/typora-user-images/image-20230921165730484.png\" alt=\"image-20230921165730484\"></p>\n<p><strong></strong><a href=\"https://nacos.io/zh-cn/docs/quick-start.html\">https://nacos.io/zh-cn/docs/quick-start.html</a></p>\n<p>****<a href=\"https://github.com/alibaba/nacos/releases\">https://github.com/alibaba/nacos/releases</a></p>\n<p><img src=\"/typora-user-images/image-20230921170222187.png\" alt=\"image-20230921170222187\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><p><strong>Linux&#x2F;Unix&#x2F;Mac</strong></p>\n<p>(standalone):</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh startup.sh -m standalone</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>Windows</strong></p>\n<p>(standalone):</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startup.cmd -m standalone</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><p><img src=\"/typora-user-images/image-20230921171251668.png\" alt=\"image-20230921171251668\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Nacos<a href=\"http://localhost:8848/nacos\">http://localhost:8848/nacos</a></p>\n<p><img src=\"/typora-user-images/image-20230921170734063.png\" alt=\"image-20230921170734063\"></p>\n<p>Nacosnacos&#x2F;nacos</p>\n<p><img src=\"/typora-user-images/image-20230921171005578.png\" alt=\"image-20230921171005578\"></p>\n<h2 id=\"Nacos-Discovery-\"><a href=\"#Nacos-Discovery-\" class=\"headerlink\" title=\"Nacos Discovery&#x2F;\"></a>Nacos Discovery&#x2F;</h2><p>Nacos Discovery  Nacos Nacos Nacos Discovery  URL Nacos</p>\n<p> <a href=\"https://spring.io/projects/spring-cloud-alibaba#learn\">https://spring.io/projects/spring-cloud-alibaba#learn</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>SpringBootSpringBootSpring Cloud Alibaba</p>\n<p><strong>pom</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2.13.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-building<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>17<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">lison.project.version</span>&gt;</span>1.0.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">lison.project.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.plugin.version</span>&gt;</span>3.8.1<span class=\"tag\">&lt;/<span class=\"name\">maven.plugin.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-cloud-alibaba-version</span>&gt;</span>2.2.5.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring-cloud-alibaba-version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>spring-boot-building<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-cloud-alibaba-version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>pom</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-building<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-building<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;lison.project.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>$&#123;project.artifactId&#125;<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Nacos --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>yml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">18000</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-boot-building</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoint:</span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"string\">include:&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springbootbuilding;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDiscoveryClient</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringBootBuildingApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringBootBuildingApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>Nacos</strong></p>\n<p><img src=\"/typora-user-images/image-20230923154459874.png\" alt=\"image-20230923154459874\"></p>\n<h2 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> ()(,)<br>, ,nginx</p>\n<p><img src=\"/typora-user-images/image-20230923152344429.png\" alt=\"image-20230923152344429\"></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>spring-cloud-service </p>\n<p> pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-building<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-service<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring-cloud-service<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>spring-cloud-service<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Nacos --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-antrun-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>package<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>run<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">tasks</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"comment\">&lt;!--suppress UnresolvedMavenProperty --&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">copy</span> <span class=\"attr\">overwrite</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                                      <span class=\"attr\">tofile</span>=<span class=\"string\">&quot;$&#123;session.executionRootDirectory&#125;/target/$&#123;project.artifactId&#125;.jar&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                                      <span class=\"attr\">file</span>=<span class=\"string\">&quot;$&#123;project.build.directory&#125;/$&#123;project.artifactId&#125;.jar&quot;</span> /&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">tasks</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>yml</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server:</span><br><span class=\"line\">  port: <span class=\"number\">18001</span></span><br><span class=\"line\">spring:</span><br><span class=\"line\">  application:</span><br><span class=\"line\">    name: spring-cloud-service</span><br><span class=\"line\"></span><br><span class=\"line\">  cloud:</span><br><span class=\"line\">    nacos:</span><br><span class=\"line\">      discovery:</span><br><span class=\"line\">        server-addr: <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8848</span></span><br><span class=\"line\"></span><br><span class=\"line\">management:</span><br><span class=\"line\">  endpoint:</span><br><span class=\"line\">    web:</span><br><span class=\"line\">      exposure:</span><br><span class=\"line\">        include:<span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDiscoveryClient</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringCloudServiceApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringCloudServiceApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> spring-cloud-service nacos</p>\n<p><img src=\"/typora-user-images/image-20230923154644281.png\" alt=\"image-20230923154644281\"></p>\n<h4 id=\"Ribbon\"><a href=\"#Ribbon\" class=\"headerlink\" title=\"Ribbon\"></a>Ribbon</h4><p>RibbonSpring Cloud </p>\n<p>1RestTemplate @LoadBalanced</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@LoadBalanced</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> RestTemplate <span class=\"title function_\">restTemplate</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RestTemplate</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>2</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RestTemplate restTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/naocs/consumer&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getServerPort</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> restTemplate.getForObject( <span class=\"string\">&quot;http://spring-cloud-service/getServerProd&quot;</span>,String.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>3idea spring-cloud-service 18011</p>\n<p><img src=\"/typora-user-images/image-20230923162506692.png\" alt=\"image-20230923162506692\"></p>\n<p>4nacos</p>\n<p><img src=\"/typora-user-images/image-20230923162555344.png\" alt=\"image-20230923162555344\"></p>\n<p>Ribbon</p>\n<p>Ribbon, com.netflix.loadbalancer.IRule , :</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th><strong></strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>BestAvailableRule</td>\n<td> server</td>\n<td>ServerServer tripped ActiveRequestsCountserve</td>\n</tr>\n<tr>\n<td>AvailabilityFilteringRule</td>\n<td>  circuit tripped server  server(active connections  )</td>\n<td>AvailabilityPredicate server statusserver</td>\n</tr>\n<tr>\n<td>WeightedResponseTimeRule</td>\n<td> weight weight  </td>\n<td>status server weightWeight responsetime server responsetimeserver statas roubineserver</td>\n</tr>\n<tr>\n<td>RetryRule</td>\n<td></td>\n<td>server subRule server</td>\n</tr>\n<tr>\n<td>RoundRobinRule</td>\n<td> server</td>\n<td>indexindex server</td>\n</tr>\n<tr>\n<td>RandomRule</td>\n<td>server</td>\n<td>indexindex server</td>\n</tr>\n<tr>\n<td>ZoneAvoidanceRule</td>\n<td>server server server</td>\n<td>ZoneAvoidancePredicate AvailabilityPredicate server zone zone(server) AvailabilityPredicate Server</td>\n</tr>\n</tbody></table>\n<p>Ribbon</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring-cloud-service:</span> <span class=\"comment\">#  </span></span><br><span class=\"line\">\t<span class=\"attr\">ribbon:</span> </span><br><span class=\"line\">   \t\t<span class=\"attr\">NFLoadBalancerRuleClassName:</span> <span class=\"string\">com.netflix.loadbalancer.RandomRule</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"Feign\"><a href=\"#Feign\" class=\"headerlink\" title=\"Feign\"></a>Feign</h3><h4 id=\"Feign\"><a href=\"#Feign\" class=\"headerlink\" title=\"Feign\"></a>Feign</h4><p>FeignSpring CloudHttp   </p>\n<p>NacosFeign Feign Ribbon NacosFegin </p>\n<h4 id=\"Feign\"><a href=\"#Feign\" class=\"headerlink\" title=\"Feign\"></a>Feign</h4><p>1Feign</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--fegin--&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>2Fegin</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span> </span><br><span class=\"line\"><span class=\"meta\">@EnableDiscoveryClient</span> </span><br><span class=\"line\"><span class=\"meta\">@EnableFeignClients</span></span><br><span class=\"line\"><span class=\"comment\">//Fegin</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>3service Fegin</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@FeignClient(&quot;spring-cloud-service&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ITestService</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/getServerProd&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">getServerPort</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>4controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RestTemplate restTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ITestService iTestService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/naocs/consumer&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getServerPort</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> iTestService.getServerPort();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>5buding,<a href=\"http://127.0.0.1:18000/naocs/consumer\">http://127.0.0.1:18000/naocs/consumer</a> </p>\n","excerpt":"","more":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.05.10</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-02-Nacos-Discovery\"><a href=\"#Spring-Cloud-Alibaba-02-Nacos-Discovery\" class=\"headerlink\" title=\"Spring Cloud Alibaba-02-Nacos Discovery\"></a>Spring Cloud Alibaba-02-Nacos Discovery</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> (ip):</p>\n<p></p>\n<p></p>\n<p></p>\n<p> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p>:</p>\n<p>:</p>\n<p><img src=\"/typora-user-images/image-20230923151411555.png\" alt=\"image-20230923151411555\"></p>\n<p><strong></strong> :</p>\n<ol>\n<li>:<br>:<br>:</li>\n<li>:<br>:<br>:</li>\n<li><br></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>Zookeeper</strong></p>\n<p>zookeeperApache Hadoop  : </p>\n<p><strong>Eureka</strong></p>\n<p>EurekaSpringcloud Netflix </p>\n<p><strong>Consul</strong></p>\n<p>ConsulGO Consul:&#x2F;Key&#x2F;Value Consul </p>\n<p><strong>Nacos</strong></p>\n<p>Nacos Spring Cloud Alibaba nacos&#x3D;eureka+config</p>\n<h2 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h2><ul>\n<li>NacosSpringCloudAlibaba</li>\n<li>Nacos  DNS SpringcloudSpringDubbo</li>\n<li>nacoseureka</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Nacos</th>\n<th>Eureka</th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>eurekaspringcloud config</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>nacosnettytcpeurekamq</td>\n</tr>\n<tr>\n<td>az</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>nacosnamespace,group</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>nacos</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>nacoseureka</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>eurekaribbon</td>\n</tr>\n</tbody></table>\n<ul>\n<li>nacosapcpap, eurekaapzookeeperc</li>\n</ul>\n<h2 id=\"nacos\"><a href=\"#nacos\" class=\"headerlink\" title=\"nacos\"></a>nacos</h2><ul>\n<li>NacosDNSRPCSDKApiDNSHttpNacosEurekaNacos</li>\n<li>DNSDNS</li>\n<li>SpringCloudconfigNacosConfigNacos</li>\n<li>Nacos  SLA  metrics prometheusNacos metricsgrafanametrics</li>\n</ul>\n<h2 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h2><p>****<a href=\"https://nacos.io/zh-cn/index.html\">https://nacos.io/zh-cn/index.html</a></p>\n<p><img src=\"/typora-user-images/image-20230921165730484.png\" alt=\"image-20230921165730484\"></p>\n<p><strong></strong><a href=\"https://nacos.io/zh-cn/docs/quick-start.html\">https://nacos.io/zh-cn/docs/quick-start.html</a></p>\n<p>****<a href=\"https://github.com/alibaba/nacos/releases\">https://github.com/alibaba/nacos/releases</a></p>\n<p><img src=\"/typora-user-images/image-20230921170222187.png\" alt=\"image-20230921170222187\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><p><strong>Linux&#x2F;Unix&#x2F;Mac</strong></p>\n<p>(standalone):</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh startup.sh -m standalone</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>Windows</strong></p>\n<p>(standalone):</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">startup.cmd -m standalone</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h3><p><img src=\"/typora-user-images/image-20230921171251668.png\" alt=\"image-20230921171251668\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Nacos<a href=\"http://localhost:8848/nacos\">http://localhost:8848/nacos</a></p>\n<p><img src=\"/typora-user-images/image-20230921170734063.png\" alt=\"image-20230921170734063\"></p>\n<p>Nacosnacos&#x2F;nacos</p>\n<p><img src=\"/typora-user-images/image-20230921171005578.png\" alt=\"image-20230921171005578\"></p>\n<h2 id=\"Nacos-Discovery-\"><a href=\"#Nacos-Discovery-\" class=\"headerlink\" title=\"Nacos Discovery&#x2F;\"></a>Nacos Discovery&#x2F;</h2><p>Nacos Discovery  Nacos Nacos Nacos Discovery  URL Nacos</p>\n<p> <a href=\"https://spring.io/projects/spring-cloud-alibaba#learn\">https://spring.io/projects/spring-cloud-alibaba#learn</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>SpringBootSpringBootSpring Cloud Alibaba</p>\n<p><strong>pom</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2.13.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-building<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>17<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">lison.project.version</span>&gt;</span>1.0.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">lison.project.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.plugin.version</span>&gt;</span>3.8.1<span class=\"tag\">&lt;/<span class=\"name\">maven.plugin.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-cloud-alibaba-version</span>&gt;</span>2.2.5.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring-cloud-alibaba-version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>spring-boot-building<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-cloud-alibaba-version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>pom</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-building<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-building<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;lison.project.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>$&#123;project.artifactId&#125;<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Nacos --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>yml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">18000</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-boot-building</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">discovery:</span></span><br><span class=\"line\">        <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoint:</span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"string\">include:&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springbootbuilding;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDiscoveryClient</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringBootBuildingApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringBootBuildingApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>Nacos</strong></p>\n<p><img src=\"/typora-user-images/image-20230923154459874.png\" alt=\"image-20230923154459874\"></p>\n<h2 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> ()(,)<br>, ,nginx</p>\n<p><img src=\"/typora-user-images/image-20230923152344429.png\" alt=\"image-20230923152344429\"></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>spring-cloud-service </p>\n<p> pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-alibaba-building<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-service<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring-cloud-service<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>spring-cloud-service<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Nacos --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-antrun-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>package<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>run<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">tasks</span>&gt;</span></span><br><span class=\"line\">                                <span class=\"comment\">&lt;!--suppress UnresolvedMavenProperty --&gt;</span></span><br><span class=\"line\">                                <span class=\"tag\">&lt;<span class=\"name\">copy</span> <span class=\"attr\">overwrite</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                                      <span class=\"attr\">tofile</span>=<span class=\"string\">&quot;$&#123;session.executionRootDirectory&#125;/target/$&#123;project.artifactId&#125;.jar&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                                      <span class=\"attr\">file</span>=<span class=\"string\">&quot;$&#123;project.build.directory&#125;/$&#123;project.artifactId&#125;.jar&quot;</span> /&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">tasks</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>yml</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server:</span><br><span class=\"line\">  port: <span class=\"number\">18001</span></span><br><span class=\"line\">spring:</span><br><span class=\"line\">  application:</span><br><span class=\"line\">    name: spring-cloud-service</span><br><span class=\"line\"></span><br><span class=\"line\">  cloud:</span><br><span class=\"line\">    nacos:</span><br><span class=\"line\">      discovery:</span><br><span class=\"line\">        server-addr: <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8848</span></span><br><span class=\"line\"></span><br><span class=\"line\">management:</span><br><span class=\"line\">  endpoint:</span><br><span class=\"line\">    web:</span><br><span class=\"line\">      exposure:</span><br><span class=\"line\">        include:<span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDiscoveryClient</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringCloudServiceApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringCloudServiceApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> spring-cloud-service nacos</p>\n<p><img src=\"/typora-user-images/image-20230923154644281.png\" alt=\"image-20230923154644281\"></p>\n<h4 id=\"Ribbon\"><a href=\"#Ribbon\" class=\"headerlink\" title=\"Ribbon\"></a>Ribbon</h4><p>RibbonSpring Cloud </p>\n<p>1RestTemplate @LoadBalanced</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@LoadBalanced</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> RestTemplate <span class=\"title function_\">restTemplate</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RestTemplate</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>2</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RestTemplate restTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/naocs/consumer&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getServerPort</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> restTemplate.getForObject( <span class=\"string\">&quot;http://spring-cloud-service/getServerProd&quot;</span>,String.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>3idea spring-cloud-service 18011</p>\n<p><img src=\"/typora-user-images/image-20230923162506692.png\" alt=\"image-20230923162506692\"></p>\n<p>4nacos</p>\n<p><img src=\"/typora-user-images/image-20230923162555344.png\" alt=\"image-20230923162555344\"></p>\n<p>Ribbon</p>\n<p>Ribbon, com.netflix.loadbalancer.IRule , :</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th><strong></strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>BestAvailableRule</td>\n<td> server</td>\n<td>ServerServer tripped ActiveRequestsCountserve</td>\n</tr>\n<tr>\n<td>AvailabilityFilteringRule</td>\n<td>  circuit tripped server  server(active connections  )</td>\n<td>AvailabilityPredicate server statusserver</td>\n</tr>\n<tr>\n<td>WeightedResponseTimeRule</td>\n<td> weight weight  </td>\n<td>status server weightWeight responsetime server responsetimeserver statas roubineserver</td>\n</tr>\n<tr>\n<td>RetryRule</td>\n<td></td>\n<td>server subRule server</td>\n</tr>\n<tr>\n<td>RoundRobinRule</td>\n<td> server</td>\n<td>indexindex server</td>\n</tr>\n<tr>\n<td>RandomRule</td>\n<td>server</td>\n<td>indexindex server</td>\n</tr>\n<tr>\n<td>ZoneAvoidanceRule</td>\n<td>server server server</td>\n<td>ZoneAvoidancePredicate AvailabilityPredicate server zone zone(server) AvailabilityPredicate Server</td>\n</tr>\n</tbody></table>\n<p>Ribbon</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring-cloud-service:</span> <span class=\"comment\">#  </span></span><br><span class=\"line\">\t<span class=\"attr\">ribbon:</span> </span><br><span class=\"line\">   \t\t<span class=\"attr\">NFLoadBalancerRuleClassName:</span> <span class=\"string\">com.netflix.loadbalancer.RandomRule</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"Feign\"><a href=\"#Feign\" class=\"headerlink\" title=\"Feign\"></a>Feign</h3><h4 id=\"Feign\"><a href=\"#Feign\" class=\"headerlink\" title=\"Feign\"></a>Feign</h4><p>FeignSpring CloudHttp   </p>\n<p>NacosFeign Feign Ribbon NacosFegin </p>\n<h4 id=\"Feign\"><a href=\"#Feign\" class=\"headerlink\" title=\"Feign\"></a>Feign</h4><p>1Feign</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--fegin--&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>2Fegin</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span> </span><br><span class=\"line\"><span class=\"meta\">@EnableDiscoveryClient</span> </span><br><span class=\"line\"><span class=\"meta\">@EnableFeignClients</span></span><br><span class=\"line\"><span class=\"comment\">//Fegin</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>3service Fegin</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@FeignClient(&quot;spring-cloud-service&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ITestService</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/getServerProd&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">getServerPort</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>4controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RestTemplate restTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ITestService iTestService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/naocs/consumer&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getServerPort</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> iTestService.getServerPort();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>5buding,<a href=\"http://127.0.0.1:18000/naocs/consumer\">http://127.0.0.1:18000/naocs/consumer</a> </p>\n"},{"_content":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2024.4.03`\n\n# Spring Cloud Alibaba-06-Sleuth\n\n[toc]\n\n\n\n## \n\n\n\n>\n>\n>1\n>\n>2\n\n![img](typora-user-images/fe3e2f4ebbbc4a28b707459e2e9fa511.png)\n\n(Distributed Tracing)  \n\n\n\n## \n\n> SpringCloudSleuth + Zipkin\n\n**Zipkin**\n\nTwitterspringcloud sleuth\n\n**Pinpoint**\n\nU\n\n**SkyWalking**\n\nUIApache\n\n**CAT**\n\n\n\n\n\n## Sleuth\n\n\n\n### \n\n>sleuth\n\nsleuthrxjavafeignquartzRestTemplatezuulhystrixgrpckafkaOpentracingredisReatorcircuitbreakerspringScheduleddubbosleuth\n\n\n\n### Sleuth\n\n>APIAPISpanSpanTraceAnnotation(cssrsscr)\n\n\n\n![img](typora-user-images/u=3986274733,3849268543&fm=253&fmt=auto&app=138&f=PNG.png)\n\n\n\n- **Span**\n\n  SpanSpanSpanIDIDSpanId\n\n- **Trace**\n\n  TraceIdspan\n\n- **Annotation**\n\n  4\n\n  - **cs** Client Sent \n  - **sr** Server Received sr - cs = \n  - **ss**Server Sent ss - sr = \n  - **cr** Client Received cr - cs = \n\n\n\n## Sleuth + Zipkin \n\n### Sleuth\n\n![image.png](typora-user-images/20220315-2c2a053e-ddb6-4656-bc61-9a94d8b14598.png)\n\n\n\n>AOP\n>\n>SleuthTraceFilterheaderspanSpanspan idtrace idTraceHttp HeadersheaderheaderSpanspan idtrace idsl4jMDCspan\n\nsleuthsleuthhttphttpIPSpanzipkin\n\n\n\n### Zipkin \n\nZipkin  Twitter Google Dapper \n\nREST API  \n\n API UI :\n\nZipkin :In-MemoryMySqlCassandra  Elasticsearch\n\n\n\n\n\n\n\n![image.png](typora-user-images/20220314-b46efe3c-5ede-471f-a116-ce05fcccd7c6.png)\n\n Zipkin  4 :\n\n\n\n**Collector**: Zipkin Span \n\n**Storage**: \n\n**RESTful API**:API  \n\n**Web UI**:UI  APIUI \n\nZipkin Zipkin Zipkin   URL  Sleuth   Trace  Span \n\n\n\n![image.png](typora-user-images/20220315-917e43b8-7523-4f2f-804c-49855963dbb5.png)\n\n\n\n1SleuthBravetrancertracespan\n\n2ZipkinCollectorZipkin\n\n3zipkinStorage/es\n\n3ZipkinAPIUI\n\n\n\n## Sleuth\n\n**1**\n\n~~~xml\n<dependency>\n  <groupId>org.springframework.cloud</groupId>\n  <artifactId>spring-cloud-starter-sleuth</artifactId>\n</dependency>\n~~~\n\n**2**\n\n~~~yaml\nsleuth: \n\tsampler:\n\t\trate: 100 # 10%\n~~~\n\n\n\n**3**\n\n~~~java\n  @RequestMapping(\"/sentinel/message1\")\n    public String message1() {\n        testSentinelMessage3Service.message();\n        log.info(\"message1\");\n        return \"message1\";\n    }\n~~~\n\n\n\n\n\n\n\n~~~\n2024-01-01 20:23:39.527  INFO [spring-cloud-service,9d701f5350d96c82,9d701f5350d96c82,true] 85218 --- [io-18001-exec-1] c.l.s.controller.TestSentinelController  : message1\n\n~~~\n\n[spring-cloud-service,9d701f5350d96c82,9d701f5350d96c82,true]Spring Cloud Sleuth\n\n4\n\n1spring-cloud-service `spring.application.name`\n29d701f5350d96c82 **Trace ID**\n39d701f5350d96c82 **Span ID**\n4trueZipkin\n\n\n\n\n\n## Zipkin\n\n**Trace ID**ZipkinZipkinTwitter\n\nZipKinSleuth\n\n### ZipkinDockermysqlES\n\n#### MySql\n\n**1**\n\nzipkin\n\n **2**\n\n[https://github.com/openzipkin/zipkin/blob/master/zipkin-storage/mysql-v1/src/main/resources/mysql.sql](https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fgithub.com%2Fopenzipkin%2Fzipkin%2Fblob%2Fmaster%2Fzipkin-storage%2Fmysql-v1%2Fsrc%2Fmain%2Fresources%2Fmysql.sql&source=article&objectId=2318336)\n\n\n\n\n\n~~~sql\n--\n-- Copyright The OpenZipkin Authors\n-- SPDX-License-Identifier: Apache-2.0\n--\n\nCREATE TABLE IF NOT EXISTS zipkin_spans (\n  `trace_id_high` BIGINT NOT NULL DEFAULT 0 COMMENT 'If non zero, this means the trace uses 128 bit traceIds instead of 64 bit',\n  `trace_id` BIGINT NOT NULL,\n  `id` BIGINT NOT NULL,\n  `name` VARCHAR(255) NOT NULL,\n  `remote_service_name` VARCHAR(255),\n  `parent_id` BIGINT,\n  `debug` BIT(1),\n  `start_ts` BIGINT COMMENT 'Span.timestamp(): epoch micros used for endTs query and to implement TTL',\n  `duration` BIGINT COMMENT 'Span.duration(): micros used for minDuration and maxDuration query',\n  PRIMARY KEY (`trace_id_high`, `trace_id`, `id`)\n) ENGINE=InnoDB ROW_FORMAT=COMPRESSED CHARACTER SET=utf8 COLLATE utf8_general_ci;\n\nALTER TABLE zipkin_spans ADD INDEX(`trace_id_high`, `trace_id`) COMMENT 'for getTracesByIds';\nALTER TABLE zipkin_spans ADD INDEX(`name`) COMMENT 'for getTraces and getSpanNames';\nALTER TABLE zipkin_spans ADD INDEX(`remote_service_name`) COMMENT 'for getTraces and getRemoteServiceNames';\nALTER TABLE zipkin_spans ADD INDEX(`start_ts`) COMMENT 'for getTraces ordering and range';\n\nCREATE TABLE IF NOT EXISTS zipkin_annotations (\n  `trace_id_high` BIGINT NOT NULL DEFAULT 0 COMMENT 'If non zero, this means the trace uses 128 bit traceIds instead of 64 bit',\n  `trace_id` BIGINT NOT NULL COMMENT 'coincides with zipkin_spans.trace_id',\n  `span_id` BIGINT NOT NULL COMMENT 'coincides with zipkin_spans.id',\n  `a_key` VARCHAR(255) NOT NULL COMMENT 'BinaryAnnotation.key or Annotation.value if type == -1',\n  `a_value` BLOB COMMENT 'BinaryAnnotation.value(), which must be smaller than 64KB',\n  `a_type` INT NOT NULL COMMENT 'BinaryAnnotation.type() or -1 if Annotation',\n  `a_timestamp` BIGINT COMMENT 'Used to implement TTL; Annotation.timestamp or zipkin_spans.timestamp',\n  `endpoint_ipv4` INT COMMENT 'Null when Binary/Annotation.endpoint is null',\n  `endpoint_ipv6` BINARY(16) COMMENT 'Null when Binary/Annotation.endpoint is null, or no IPv6 address',\n  `endpoint_port` SMALLINT COMMENT 'Null when Binary/Annotation.endpoint is null',\n  `endpoint_service_name` VARCHAR(255) COMMENT 'Null when Binary/Annotation.endpoint is null'\n) ENGINE=InnoDB ROW_FORMAT=COMPRESSED CHARACTER SET=utf8 COLLATE utf8_general_ci;\n\nALTER TABLE zipkin_annotations ADD UNIQUE KEY(`trace_id_high`, `trace_id`, `span_id`, `a_key`, `a_timestamp`) COMMENT 'Ignore insert on duplicate';\nALTER TABLE zipkin_annotations ADD INDEX(`trace_id_high`, `trace_id`, `span_id`) COMMENT 'for joining with zipkin_spans';\nALTER TABLE zipkin_annotations ADD INDEX(`trace_id_high`, `trace_id`) COMMENT 'for getTraces/ByIds';\nALTER TABLE zipkin_annotations ADD INDEX(`endpoint_service_name`) COMMENT 'for getTraces and getServiceNames';\nALTER TABLE zipkin_annotations ADD INDEX(`a_type`) COMMENT 'for getTraces and autocomplete values';\nALTER TABLE zipkin_annotations ADD INDEX(`a_key`) COMMENT 'for getTraces and autocomplete values';\nALTER TABLE zipkin_annotations ADD INDEX(`trace_id`, `span_id`, `a_key`) COMMENT 'for dependencies job';\n\nCREATE TABLE IF NOT EXISTS zipkin_dependencies (\n  `day` DATE NOT NULL,\n  `parent` VARCHAR(255) NOT NULL,\n  `child` VARCHAR(255) NOT NULL,\n  `call_count` BIGINT,\n  `error_count` BIGINT,\n  PRIMARY KEY (`day`, `parent`, `child`)\n) ENGINE=InnoDB ROW_FORMAT=COMPRESSED CHARACTER SET=utf8 COLLATE utf8_general_ci;\n~~~\n\n\n\n\n\n\n\n\n\n**3**\n\nZipkin9411\n\n~~~shell\ndocker run \\\n--name zipkin-server -d \\\n--restart=always \\\n-p 9411:9411 \\\n-e MYSQL_USER=root \\\n-e MYSQL_PASS=123456 \\\n-e MYSQL_HOST=127.0.0.1 \\\n-e STORAGE_TYPE=mysql \\\n-e MYSQL_DB=zipkin \\\n-e MYSQL_TCP_PORT=3306 \\\nopenzipkin/zipkin:2.21.7\n~~~\n\n#### ES\n\nES--ES_HOSTS--ES_HOSTS=[http://192.168.0.1:9200,http://192.168.0.2:9200]\n\n~~~\ndocker run \\\n--name zipkin-server -d \\\n-p 9411:9411 \\\n--restart=always \\\n-e STORAGE_TYPE=elasticsearch \\\n-e ES_HOSTS=localhost:9200\nopenzipkin/zipkin:2.21.7\n~~~\n\nES\n\n|                 |                                                     |\n| :---------------------- | :------------------------------------------------------ |\n| ES_HOSTS                | EShttp://localhost:9200 |\n| ES_PIPELINE             | spanpipeline                            |\n| ES_TIMEOUT              | ESms10000(10S)              |\n| ES_INDEX                | Zipkinzipkin                  |\n| ES_DATE_SEPARATOR       | Zipkin-                     |\n| ES_INDEX_SHARDS         | (shard)5                              |\n| ES_INDEX_REPLICAS       | (replica)1                            |\n| ES_HTTP_LOGGING         | ESBASIC, HEADERS, BODY              |\n| ES_USERNAME/ES_PASSWORD | ES                                    |\n\n\n\n![image-20240318202804603](typora-user-images/image-20240318202804603.png)\n\n\n\n### \n\n**1**\n\n~~~xml\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-zipkin</artifactId>\n</dependency>\n\n~~~\n\n\n\n**2**\n\n~~~yaml\nspring:\n  zipkin:\n\t\tbase-url: http://127.0.0.1:9411/ #zipkin server \n\t\tdiscoveryClientEnabled: false #nacosURL \n\tsleuth: \n\t\tsampler:\n\t\t\tprobability: 1.0 # \n\n~~~\n\n\n\n3****\n\n>http://127.0.0.1:18003/spring_building/naocs/consumer\n\n\n\n**4zipkinUI**\n\n\n\n![image-20240412121048381](typora-user-images/image-20240412121048381.png)\n\n\n\n\n\n##  SkyWalking \n\n\n\n Sleuth+Zipkin  Sleuth  Zipkin \n\n SkyWalking SkyWalking \n\n\n\n### APM  SkyWalking\n\n Spring Cloud SluethZipkin CatSkyWalkingAPMApplication Performance ManagementSkyWalking  APM  Zipkin  Sleuth+Zipkin SkyWalking \n\nSkyWalking APMJava Apache Apache  SkyWalking  Apache http://skywalking.apache.org/\n\n![image-20240415090937231](typora-user-images/image-20240415090937231.png)\n\n\n\n\n\nSkyWalking  GitHub  SkyWaking  23.3K Star9.7.0\n\n****\n\n\n\n\n\n****\n\n\n\n### Sleuth+Zipkin  SkyWalking \n\n\n\n|                 | Sleuth+Zipkin           | SkyWalking                       |\n| --------------- | ----------------------- | -------------------------------- |\n|   |                       |                                |\n|         |                     |                              |\n|       |           |                          |\n|     |     | Java Agent |\n| Java VM |                   |                              |\n|         |                   |            |\n|         | MySQL,ES...       | ESMysqlH2...                 |\n|         |       | Apache     |\n|         | ... | ...          |\n\nSkyWalking  Zipkin\n\n\n\n###  SkyWalking \n\n\n\nskyWalkIng \n\n\n\n![image-20240415091018922](typora-user-images/image-20240415091018922.png)\n\nSkyWalking SkyWalking  Java Agent  SkyWalking UI SkyWalking  gRPC  HTTP  gRPC  11800 HTTP  12800  SKyWalking UI  8080 SkyWalking  ElasticSearch MySQLH2 ElasticSearch \n\n\n\nDocker\n\n~~~yaml\nversion: '3.8'\nservices:\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.6\n    container_name: elasticsearch\n    restart: always\n    ports:\n      - 9200:9200\n      - 9300:9300\n    environment:\n      - discovery.type=single-node\n      - TZ=Asia/Shanghai\n      - bootstrap.memory_lock=true\n      - \"ES_JAVA_OPTS=-Xms1024m -Xmx1024m\"\n    volumes:\n      - /opt/data/dockerData/skywalking/elasticsearch/data:/usr/share/elasticsearch/data\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n  oap:\n    image: docker.io/apache/skywalking-oap-server:9.4.0\n    container_name: oap\n    depends_on:\n      - elasticsearch\n    restart: always\n    ports:\n      - 11800:11800\n      - 12800:12800\n    environment:\n      SW_CORE_RECORD_DATA_TTL: 15\n      SW_CORE_METRICS_DATA_TTL: 15\n      SW_STORAGE: elasticsearch\n      SW_STORAGE_ES_CLUSTER_NODES: elasticsearch:9200\n      SW_ENABLE_UPDATE_UI_TEMPLATE: true\n      TZ: Asia/Shanghai\n      JAVA_OPTS: \"-Xms2048m -Xmx2048m\"\n  ui:\n    image: docker.io/apache/skywalking-ui:9.4.0\n    container_name: ui\n    depends_on:\n      - oap\n    links:\n      - oap\n    restart: always\n    ports:\n      - 8080:8080\n    environment:\n      SW_OAP_ADDRESS: http://oap:12800\n      SW_ZIPKIN_ADDRESS: http://oap:9412\n\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n\n\n\n\n\n\n Java \n\n- Skywalking-Collector  11800gRPC 12800HTTP \n- Skywalking-Webapp  SkyWalking UI 8080 ,8038\n\n\n\n\n\nSkywalking \n\n[http://127.0.0.1:8088/] SkyWalking UI \n\n\n\n![image-20240416113821316](typora-user-images/image-20240416113821316.png)\n\n\n\n###  SkyWalking Java Agent\n\n\n\nSkyWalking  JVM  Java1.5 Java Agent  Java Java Agent \n\nJava Agent  Java  javaagent \n\nJava Agent  premain  main  Java Agent \n\n\n\n~~~java\npublic class SimpleAgent {\n    public static void premain(String agentArgs, Instrumentation inst) {\n        System.out.println(\"=========premain============\");\n    }\n}\n~~~\n\n Java Agent MANIFEST.MF JVM  META-INF  MANIFEST.MF \n\n~~~\nManifest-Version: 1.0\nPremain-Class: com.lison.agent.SimpleAgent\n~~~\n\n\n\n agent.jar test-agent.jar test-agent.jar  javaagent \n\n~~~\njava -javaagent:agent.jar -jar test-agent.jar\n~~~\n\n Java \n\n~~~\n========= premain============\n Agent...\n....\n~~~\n\n\n\nSkyWalking  Java Agent  premain  SkyWalking \n\nSkyWalking Java Agent Java Agent \n\n![image-20240415094839642](typora-user-images/image-20240415094839642.png)\n\n\n\n\n\n a  a a  OpenFeign  b  b b  OpenFeign  c  c  c  JDBC  MySQL \n\n\n\n#### skywalking\n\n**1 agent**\n\n```\nagentoapagent\n```\n\n**** https://skywalking.apache.org/downloads/\n\n**skywalking9.4.0v9.1.0client**\n\n\n\n![image-20240416114024941](typora-user-images/image-20240416114024941.png)\n\n\n\n\n\nskywalking-agentconfig/agent.config\n\n~~~\nagent.service_name=${SW_AGENT_NAME:HS}\ncollector.backend_service=${SW_AGENT_COLLECTOR_BACKEND_SERVICES:192.168.54.53:11800}\n\n~~~\n\n\n\n\n\n\n\n**2**\n\n\n\nskywalkingUIskywalking\n\n~~~\n<!--skywalkingTraceId-->\n        <dependency>\n            <groupId>org.apache.skywalking</groupId>\n            <artifactId>apm-toolkit-logback-1.x</artifactId>\n            <version>9.1.0</version>\n        </dependency>\n\n\n        <dependency>\n            <groupId>org.apache.skywalking</groupId>\n            <artifactId>apm-toolkit-trace</artifactId>\n            <version>9.1.0</version>\n        </dependency>\n~~~\n\n\n\nlogback-spring.xmlresource\n\n~~~xml\n<configuration debug=\"false\" scan=\"false\">\n    <springProperty scop=\"context\" name=\"spring.application.name\" source=\"spring.application.name\" defaultValue=\"\"/>\n    <property name=\"log.path\" value=\"logs/${spring.application.name}\"/>\n    <!--  -->\n    <property name=\"CONSOLE_LOG_PATTERN\"\n              value=\"${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}\"/>\n    <!--  -->\n    <conversionRule conversionWord=\"clr\" converterClass=\"org.springframework.boot.logging.logback.ColorConverter\"/>\n    <conversionRule conversionWord=\"wex\"\n                    converterClass=\"org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter\"/>\n    <conversionRule conversionWord=\"wEx\"\n                    converterClass=\"org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter\"/>\n    <!-- Console log output -->\n    <appender name=\"console\" class=\"ch.qos.logback.core.ConsoleAppender\">\n        <encoder>\n            <pattern>${CONSOLE_LOG_PATTERN}</pattern>\n        </encoder>\n    </appender>\n\n    <!-- Log file debug output -->\n    <appender name=\"debug\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n        <file>${log.path}/debug.log</file>\n        <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n            <fileNamePattern>${log.path}/%d{yyyy-MM, aux}/debug.%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n            <maxFileSize>50MB</maxFileSize>\n            <maxHistory>30</maxHistory>\n        </rollingPolicy>\n        <encoder>\n            <pattern>%date [%thread] %-5level [%logger{50}] %file:%line - %msg%n</pattern>\n        </encoder>\n    </appender>\n\n    <!-- Log file error output -->\n    <appender name=\"error\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n        <file>${log.path}/error.log</file>\n        <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n            <fileNamePattern>${log.path}/%d{yyyy-MM}/error.%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n            <maxFileSize>50MB</maxFileSize>\n            <maxHistory>30</maxHistory>\n        </rollingPolicy>\n        <encoder>\n            <pattern>%date [%thread] %-5level [%logger{50}] %file:%line - %msg%n</pattern>\n        </encoder>\n        <filter class=\"ch.qos.logback.classic.filter.ThresholdFilter\">\n            <level>ERROR</level>\n        </filter>\n    </appender>\n    <appender name=\"stdout\" class=\"ch.qos.logback.core.ConsoleAppender\">\n        <encoder class=\"ch.qos.logback.core.encoder.LayoutWrappingEncoder\">\n            <layout class=\"org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout\">\n                <Pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%tid] [%thread] %-5level %logger{36} -%msg%n</Pattern>\n            </layout>\n        </encoder>\n    </appender>\n\n    <appender name=\"grpc\" class=\"org.apache.skywalking.apm.toolkit.log.logback.v1.x.log.GRPCLogClientAppender\">\n        <encoder class=\"ch.qos.logback.core.encoder.LayoutWrappingEncoder\">\n            <layout class=\"org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout\">\n                <Pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%X{tid}] [%thread] %-5level %logger{36} -%msg%n</Pattern>\n            </layout>\n        </encoder>\n    </appender>\n    <!--nacos  INFO -->\n    <logger name=\"com.alibaba.nacos\" level=\"OFF\">\n        <appender-ref ref=\"error\"/>\n    </logger>\n\n    <!-- Level: FATAL 0  ERROR 3  WARN 4  INFO 6  DEBUG 7 -->\n    <root level=\"INFO\">\n        <!-- <appender-ref ref=\"console\"/>-->\n        <appender-ref ref=\"debug\"/>\n        <appender-ref ref=\"error\"/>\n        <appender-ref ref=\"stdout\"/>\n        <appender-ref ref=\"grpc\"/>\n    </root>\n</configuration>\n\n~~~\n\n\n\n**3**\n\n~~~\n  @RequestMapping(\"/fegin/test\")\n    public String feginTest() {\n        iTestService.getServerPort();\n        log.info(\"message1\");\n        return \"message1\";\n    }\n~~~\n\n\n\n#### \n\n**1idea**\n\n VM options\n\n![image-20240416114808884](typora-user-images/image-20240416114808884.png)\n\njavaagentskywalking-agent\n\n~~~\n-Dskywalking.agent.service_name=\"spring-cloud-service\"\n-Dskywalking.collector.backend_service=\"opaip:11800\"\n-javaagent:/Users/lison/work/workspace/project/skywalking-agent/skywalking-agent.jar\n~~~\n\n\n\n\n\n![image-20240416114924463](typora-user-images/image-20240416114924463.png)\n\n\n\n\n\n![image-20240416120116317](typora-user-images/image-20240416120116317.png)\n\n\n\n API  SkyWalking \n\n\n\n![image-20240417091316659](typora-user-images/image-20240417091316659.png)\n\n\n\n\n\n\n\n\n\n![image-20240417092003988](typora-user-images/image-20240417092003988.png)\n\n\n\n\n\n**JVM**\n\n![image-20240417092118543](typora-user-images/image-20240417092118543.png)\n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-06-Sleuth.md","raw":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2024.4.03`\n\n# Spring Cloud Alibaba-06-Sleuth\n\n[toc]\n\n\n\n## \n\n\n\n>\n>\n>1\n>\n>2\n\n![img](typora-user-images/fe3e2f4ebbbc4a28b707459e2e9fa511.png)\n\n(Distributed Tracing)  \n\n\n\n## \n\n> SpringCloudSleuth + Zipkin\n\n**Zipkin**\n\nTwitterspringcloud sleuth\n\n**Pinpoint**\n\nU\n\n**SkyWalking**\n\nUIApache\n\n**CAT**\n\n\n\n\n\n## Sleuth\n\n\n\n### \n\n>sleuth\n\nsleuthrxjavafeignquartzRestTemplatezuulhystrixgrpckafkaOpentracingredisReatorcircuitbreakerspringScheduleddubbosleuth\n\n\n\n### Sleuth\n\n>APIAPISpanSpanTraceAnnotation(cssrsscr)\n\n\n\n![img](typora-user-images/u=3986274733,3849268543&fm=253&fmt=auto&app=138&f=PNG.png)\n\n\n\n- **Span**\n\n  SpanSpanSpanIDIDSpanId\n\n- **Trace**\n\n  TraceIdspan\n\n- **Annotation**\n\n  4\n\n  - **cs** Client Sent \n  - **sr** Server Received sr - cs = \n  - **ss**Server Sent ss - sr = \n  - **cr** Client Received cr - cs = \n\n\n\n## Sleuth + Zipkin \n\n### Sleuth\n\n![image.png](typora-user-images/20220315-2c2a053e-ddb6-4656-bc61-9a94d8b14598.png)\n\n\n\n>AOP\n>\n>SleuthTraceFilterheaderspanSpanspan idtrace idTraceHttp HeadersheaderheaderSpanspan idtrace idsl4jMDCspan\n\nsleuthsleuthhttphttpIPSpanzipkin\n\n\n\n### Zipkin \n\nZipkin  Twitter Google Dapper \n\nREST API  \n\n API UI :\n\nZipkin :In-MemoryMySqlCassandra  Elasticsearch\n\n\n\n\n\n\n\n![image.png](typora-user-images/20220314-b46efe3c-5ede-471f-a116-ce05fcccd7c6.png)\n\n Zipkin  4 :\n\n\n\n**Collector**: Zipkin Span \n\n**Storage**: \n\n**RESTful API**:API  \n\n**Web UI**:UI  APIUI \n\nZipkin Zipkin Zipkin   URL  Sleuth   Trace  Span \n\n\n\n![image.png](typora-user-images/20220315-917e43b8-7523-4f2f-804c-49855963dbb5.png)\n\n\n\n1SleuthBravetrancertracespan\n\n2ZipkinCollectorZipkin\n\n3zipkinStorage/es\n\n3ZipkinAPIUI\n\n\n\n## Sleuth\n\n**1**\n\n~~~xml\n<dependency>\n  <groupId>org.springframework.cloud</groupId>\n  <artifactId>spring-cloud-starter-sleuth</artifactId>\n</dependency>\n~~~\n\n**2**\n\n~~~yaml\nsleuth: \n\tsampler:\n\t\trate: 100 # 10%\n~~~\n\n\n\n**3**\n\n~~~java\n  @RequestMapping(\"/sentinel/message1\")\n    public String message1() {\n        testSentinelMessage3Service.message();\n        log.info(\"message1\");\n        return \"message1\";\n    }\n~~~\n\n\n\n\n\n\n\n~~~\n2024-01-01 20:23:39.527  INFO [spring-cloud-service,9d701f5350d96c82,9d701f5350d96c82,true] 85218 --- [io-18001-exec-1] c.l.s.controller.TestSentinelController  : message1\n\n~~~\n\n[spring-cloud-service,9d701f5350d96c82,9d701f5350d96c82,true]Spring Cloud Sleuth\n\n4\n\n1spring-cloud-service `spring.application.name`\n29d701f5350d96c82 **Trace ID**\n39d701f5350d96c82 **Span ID**\n4trueZipkin\n\n\n\n\n\n## Zipkin\n\n**Trace ID**ZipkinZipkinTwitter\n\nZipKinSleuth\n\n### ZipkinDockermysqlES\n\n#### MySql\n\n**1**\n\nzipkin\n\n **2**\n\n[https://github.com/openzipkin/zipkin/blob/master/zipkin-storage/mysql-v1/src/main/resources/mysql.sql](https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fgithub.com%2Fopenzipkin%2Fzipkin%2Fblob%2Fmaster%2Fzipkin-storage%2Fmysql-v1%2Fsrc%2Fmain%2Fresources%2Fmysql.sql&source=article&objectId=2318336)\n\n\n\n\n\n~~~sql\n--\n-- Copyright The OpenZipkin Authors\n-- SPDX-License-Identifier: Apache-2.0\n--\n\nCREATE TABLE IF NOT EXISTS zipkin_spans (\n  `trace_id_high` BIGINT NOT NULL DEFAULT 0 COMMENT 'If non zero, this means the trace uses 128 bit traceIds instead of 64 bit',\n  `trace_id` BIGINT NOT NULL,\n  `id` BIGINT NOT NULL,\n  `name` VARCHAR(255) NOT NULL,\n  `remote_service_name` VARCHAR(255),\n  `parent_id` BIGINT,\n  `debug` BIT(1),\n  `start_ts` BIGINT COMMENT 'Span.timestamp(): epoch micros used for endTs query and to implement TTL',\n  `duration` BIGINT COMMENT 'Span.duration(): micros used for minDuration and maxDuration query',\n  PRIMARY KEY (`trace_id_high`, `trace_id`, `id`)\n) ENGINE=InnoDB ROW_FORMAT=COMPRESSED CHARACTER SET=utf8 COLLATE utf8_general_ci;\n\nALTER TABLE zipkin_spans ADD INDEX(`trace_id_high`, `trace_id`) COMMENT 'for getTracesByIds';\nALTER TABLE zipkin_spans ADD INDEX(`name`) COMMENT 'for getTraces and getSpanNames';\nALTER TABLE zipkin_spans ADD INDEX(`remote_service_name`) COMMENT 'for getTraces and getRemoteServiceNames';\nALTER TABLE zipkin_spans ADD INDEX(`start_ts`) COMMENT 'for getTraces ordering and range';\n\nCREATE TABLE IF NOT EXISTS zipkin_annotations (\n  `trace_id_high` BIGINT NOT NULL DEFAULT 0 COMMENT 'If non zero, this means the trace uses 128 bit traceIds instead of 64 bit',\n  `trace_id` BIGINT NOT NULL COMMENT 'coincides with zipkin_spans.trace_id',\n  `span_id` BIGINT NOT NULL COMMENT 'coincides with zipkin_spans.id',\n  `a_key` VARCHAR(255) NOT NULL COMMENT 'BinaryAnnotation.key or Annotation.value if type == -1',\n  `a_value` BLOB COMMENT 'BinaryAnnotation.value(), which must be smaller than 64KB',\n  `a_type` INT NOT NULL COMMENT 'BinaryAnnotation.type() or -1 if Annotation',\n  `a_timestamp` BIGINT COMMENT 'Used to implement TTL; Annotation.timestamp or zipkin_spans.timestamp',\n  `endpoint_ipv4` INT COMMENT 'Null when Binary/Annotation.endpoint is null',\n  `endpoint_ipv6` BINARY(16) COMMENT 'Null when Binary/Annotation.endpoint is null, or no IPv6 address',\n  `endpoint_port` SMALLINT COMMENT 'Null when Binary/Annotation.endpoint is null',\n  `endpoint_service_name` VARCHAR(255) COMMENT 'Null when Binary/Annotation.endpoint is null'\n) ENGINE=InnoDB ROW_FORMAT=COMPRESSED CHARACTER SET=utf8 COLLATE utf8_general_ci;\n\nALTER TABLE zipkin_annotations ADD UNIQUE KEY(`trace_id_high`, `trace_id`, `span_id`, `a_key`, `a_timestamp`) COMMENT 'Ignore insert on duplicate';\nALTER TABLE zipkin_annotations ADD INDEX(`trace_id_high`, `trace_id`, `span_id`) COMMENT 'for joining with zipkin_spans';\nALTER TABLE zipkin_annotations ADD INDEX(`trace_id_high`, `trace_id`) COMMENT 'for getTraces/ByIds';\nALTER TABLE zipkin_annotations ADD INDEX(`endpoint_service_name`) COMMENT 'for getTraces and getServiceNames';\nALTER TABLE zipkin_annotations ADD INDEX(`a_type`) COMMENT 'for getTraces and autocomplete values';\nALTER TABLE zipkin_annotations ADD INDEX(`a_key`) COMMENT 'for getTraces and autocomplete values';\nALTER TABLE zipkin_annotations ADD INDEX(`trace_id`, `span_id`, `a_key`) COMMENT 'for dependencies job';\n\nCREATE TABLE IF NOT EXISTS zipkin_dependencies (\n  `day` DATE NOT NULL,\n  `parent` VARCHAR(255) NOT NULL,\n  `child` VARCHAR(255) NOT NULL,\n  `call_count` BIGINT,\n  `error_count` BIGINT,\n  PRIMARY KEY (`day`, `parent`, `child`)\n) ENGINE=InnoDB ROW_FORMAT=COMPRESSED CHARACTER SET=utf8 COLLATE utf8_general_ci;\n~~~\n\n\n\n\n\n\n\n\n\n**3**\n\nZipkin9411\n\n~~~shell\ndocker run \\\n--name zipkin-server -d \\\n--restart=always \\\n-p 9411:9411 \\\n-e MYSQL_USER=root \\\n-e MYSQL_PASS=123456 \\\n-e MYSQL_HOST=127.0.0.1 \\\n-e STORAGE_TYPE=mysql \\\n-e MYSQL_DB=zipkin \\\n-e MYSQL_TCP_PORT=3306 \\\nopenzipkin/zipkin:2.21.7\n~~~\n\n#### ES\n\nES--ES_HOSTS--ES_HOSTS=[http://192.168.0.1:9200,http://192.168.0.2:9200]\n\n~~~\ndocker run \\\n--name zipkin-server -d \\\n-p 9411:9411 \\\n--restart=always \\\n-e STORAGE_TYPE=elasticsearch \\\n-e ES_HOSTS=localhost:9200\nopenzipkin/zipkin:2.21.7\n~~~\n\nES\n\n|                 |                                                     |\n| :---------------------- | :------------------------------------------------------ |\n| ES_HOSTS                | EShttp://localhost:9200 |\n| ES_PIPELINE             | spanpipeline                            |\n| ES_TIMEOUT              | ESms10000(10S)              |\n| ES_INDEX                | Zipkinzipkin                  |\n| ES_DATE_SEPARATOR       | Zipkin-                     |\n| ES_INDEX_SHARDS         | (shard)5                              |\n| ES_INDEX_REPLICAS       | (replica)1                            |\n| ES_HTTP_LOGGING         | ESBASIC, HEADERS, BODY              |\n| ES_USERNAME/ES_PASSWORD | ES                                    |\n\n\n\n![image-20240318202804603](typora-user-images/image-20240318202804603.png)\n\n\n\n### \n\n**1**\n\n~~~xml\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-zipkin</artifactId>\n</dependency>\n\n~~~\n\n\n\n**2**\n\n~~~yaml\nspring:\n  zipkin:\n\t\tbase-url: http://127.0.0.1:9411/ #zipkin server \n\t\tdiscoveryClientEnabled: false #nacosURL \n\tsleuth: \n\t\tsampler:\n\t\t\tprobability: 1.0 # \n\n~~~\n\n\n\n3****\n\n>http://127.0.0.1:18003/spring_building/naocs/consumer\n\n\n\n**4zipkinUI**\n\n\n\n![image-20240412121048381](typora-user-images/image-20240412121048381.png)\n\n\n\n\n\n##  SkyWalking \n\n\n\n Sleuth+Zipkin  Sleuth  Zipkin \n\n SkyWalking SkyWalking \n\n\n\n### APM  SkyWalking\n\n Spring Cloud SluethZipkin CatSkyWalkingAPMApplication Performance ManagementSkyWalking  APM  Zipkin  Sleuth+Zipkin SkyWalking \n\nSkyWalking APMJava Apache Apache  SkyWalking  Apache http://skywalking.apache.org/\n\n![image-20240415090937231](typora-user-images/image-20240415090937231.png)\n\n\n\n\n\nSkyWalking  GitHub  SkyWaking  23.3K Star9.7.0\n\n****\n\n\n\n\n\n****\n\n\n\n### Sleuth+Zipkin  SkyWalking \n\n\n\n|                 | Sleuth+Zipkin           | SkyWalking                       |\n| --------------- | ----------------------- | -------------------------------- |\n|   |                       |                                |\n|         |                     |                              |\n|       |           |                          |\n|     |     | Java Agent |\n| Java VM |                   |                              |\n|         |                   |            |\n|         | MySQL,ES...       | ESMysqlH2...                 |\n|         |       | Apache     |\n|         | ... | ...          |\n\nSkyWalking  Zipkin\n\n\n\n###  SkyWalking \n\n\n\nskyWalkIng \n\n\n\n![image-20240415091018922](typora-user-images/image-20240415091018922.png)\n\nSkyWalking SkyWalking  Java Agent  SkyWalking UI SkyWalking  gRPC  HTTP  gRPC  11800 HTTP  12800  SKyWalking UI  8080 SkyWalking  ElasticSearch MySQLH2 ElasticSearch \n\n\n\nDocker\n\n~~~yaml\nversion: '3.8'\nservices:\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.6\n    container_name: elasticsearch\n    restart: always\n    ports:\n      - 9200:9200\n      - 9300:9300\n    environment:\n      - discovery.type=single-node\n      - TZ=Asia/Shanghai\n      - bootstrap.memory_lock=true\n      - \"ES_JAVA_OPTS=-Xms1024m -Xmx1024m\"\n    volumes:\n      - /opt/data/dockerData/skywalking/elasticsearch/data:/usr/share/elasticsearch/data\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n  oap:\n    image: docker.io/apache/skywalking-oap-server:9.4.0\n    container_name: oap\n    depends_on:\n      - elasticsearch\n    restart: always\n    ports:\n      - 11800:11800\n      - 12800:12800\n    environment:\n      SW_CORE_RECORD_DATA_TTL: 15\n      SW_CORE_METRICS_DATA_TTL: 15\n      SW_STORAGE: elasticsearch\n      SW_STORAGE_ES_CLUSTER_NODES: elasticsearch:9200\n      SW_ENABLE_UPDATE_UI_TEMPLATE: true\n      TZ: Asia/Shanghai\n      JAVA_OPTS: \"-Xms2048m -Xmx2048m\"\n  ui:\n    image: docker.io/apache/skywalking-ui:9.4.0\n    container_name: ui\n    depends_on:\n      - oap\n    links:\n      - oap\n    restart: always\n    ports:\n      - 8080:8080\n    environment:\n      SW_OAP_ADDRESS: http://oap:12800\n      SW_ZIPKIN_ADDRESS: http://oap:9412\n\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n\n\n\n\n\n\n Java \n\n- Skywalking-Collector  11800gRPC 12800HTTP \n- Skywalking-Webapp  SkyWalking UI 8080 ,8038\n\n\n\n\n\nSkywalking \n\n[http://127.0.0.1:8088/] SkyWalking UI \n\n\n\n![image-20240416113821316](typora-user-images/image-20240416113821316.png)\n\n\n\n###  SkyWalking Java Agent\n\n\n\nSkyWalking  JVM  Java1.5 Java Agent  Java Java Agent \n\nJava Agent  Java  javaagent \n\nJava Agent  premain  main  Java Agent \n\n\n\n~~~java\npublic class SimpleAgent {\n    public static void premain(String agentArgs, Instrumentation inst) {\n        System.out.println(\"=========premain============\");\n    }\n}\n~~~\n\n Java Agent MANIFEST.MF JVM  META-INF  MANIFEST.MF \n\n~~~\nManifest-Version: 1.0\nPremain-Class: com.lison.agent.SimpleAgent\n~~~\n\n\n\n agent.jar test-agent.jar test-agent.jar  javaagent \n\n~~~\njava -javaagent:agent.jar -jar test-agent.jar\n~~~\n\n Java \n\n~~~\n========= premain============\n Agent...\n....\n~~~\n\n\n\nSkyWalking  Java Agent  premain  SkyWalking \n\nSkyWalking Java Agent Java Agent \n\n![image-20240415094839642](typora-user-images/image-20240415094839642.png)\n\n\n\n\n\n a  a a  OpenFeign  b  b b  OpenFeign  c  c  c  JDBC  MySQL \n\n\n\n#### skywalking\n\n**1 agent**\n\n```\nagentoapagent\n```\n\n**** https://skywalking.apache.org/downloads/\n\n**skywalking9.4.0v9.1.0client**\n\n\n\n![image-20240416114024941](typora-user-images/image-20240416114024941.png)\n\n\n\n\n\nskywalking-agentconfig/agent.config\n\n~~~\nagent.service_name=${SW_AGENT_NAME:HS}\ncollector.backend_service=${SW_AGENT_COLLECTOR_BACKEND_SERVICES:192.168.54.53:11800}\n\n~~~\n\n\n\n\n\n\n\n**2**\n\n\n\nskywalkingUIskywalking\n\n~~~\n<!--skywalkingTraceId-->\n        <dependency>\n            <groupId>org.apache.skywalking</groupId>\n            <artifactId>apm-toolkit-logback-1.x</artifactId>\n            <version>9.1.0</version>\n        </dependency>\n\n\n        <dependency>\n            <groupId>org.apache.skywalking</groupId>\n            <artifactId>apm-toolkit-trace</artifactId>\n            <version>9.1.0</version>\n        </dependency>\n~~~\n\n\n\nlogback-spring.xmlresource\n\n~~~xml\n<configuration debug=\"false\" scan=\"false\">\n    <springProperty scop=\"context\" name=\"spring.application.name\" source=\"spring.application.name\" defaultValue=\"\"/>\n    <property name=\"log.path\" value=\"logs/${spring.application.name}\"/>\n    <!--  -->\n    <property name=\"CONSOLE_LOG_PATTERN\"\n              value=\"${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}\"/>\n    <!--  -->\n    <conversionRule conversionWord=\"clr\" converterClass=\"org.springframework.boot.logging.logback.ColorConverter\"/>\n    <conversionRule conversionWord=\"wex\"\n                    converterClass=\"org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter\"/>\n    <conversionRule conversionWord=\"wEx\"\n                    converterClass=\"org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter\"/>\n    <!-- Console log output -->\n    <appender name=\"console\" class=\"ch.qos.logback.core.ConsoleAppender\">\n        <encoder>\n            <pattern>${CONSOLE_LOG_PATTERN}</pattern>\n        </encoder>\n    </appender>\n\n    <!-- Log file debug output -->\n    <appender name=\"debug\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n        <file>${log.path}/debug.log</file>\n        <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n            <fileNamePattern>${log.path}/%d{yyyy-MM, aux}/debug.%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n            <maxFileSize>50MB</maxFileSize>\n            <maxHistory>30</maxHistory>\n        </rollingPolicy>\n        <encoder>\n            <pattern>%date [%thread] %-5level [%logger{50}] %file:%line - %msg%n</pattern>\n        </encoder>\n    </appender>\n\n    <!-- Log file error output -->\n    <appender name=\"error\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n        <file>${log.path}/error.log</file>\n        <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n            <fileNamePattern>${log.path}/%d{yyyy-MM}/error.%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n            <maxFileSize>50MB</maxFileSize>\n            <maxHistory>30</maxHistory>\n        </rollingPolicy>\n        <encoder>\n            <pattern>%date [%thread] %-5level [%logger{50}] %file:%line - %msg%n</pattern>\n        </encoder>\n        <filter class=\"ch.qos.logback.classic.filter.ThresholdFilter\">\n            <level>ERROR</level>\n        </filter>\n    </appender>\n    <appender name=\"stdout\" class=\"ch.qos.logback.core.ConsoleAppender\">\n        <encoder class=\"ch.qos.logback.core.encoder.LayoutWrappingEncoder\">\n            <layout class=\"org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout\">\n                <Pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%tid] [%thread] %-5level %logger{36} -%msg%n</Pattern>\n            </layout>\n        </encoder>\n    </appender>\n\n    <appender name=\"grpc\" class=\"org.apache.skywalking.apm.toolkit.log.logback.v1.x.log.GRPCLogClientAppender\">\n        <encoder class=\"ch.qos.logback.core.encoder.LayoutWrappingEncoder\">\n            <layout class=\"org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout\">\n                <Pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%X{tid}] [%thread] %-5level %logger{36} -%msg%n</Pattern>\n            </layout>\n        </encoder>\n    </appender>\n    <!--nacos  INFO -->\n    <logger name=\"com.alibaba.nacos\" level=\"OFF\">\n        <appender-ref ref=\"error\"/>\n    </logger>\n\n    <!-- Level: FATAL 0  ERROR 3  WARN 4  INFO 6  DEBUG 7 -->\n    <root level=\"INFO\">\n        <!-- <appender-ref ref=\"console\"/>-->\n        <appender-ref ref=\"debug\"/>\n        <appender-ref ref=\"error\"/>\n        <appender-ref ref=\"stdout\"/>\n        <appender-ref ref=\"grpc\"/>\n    </root>\n</configuration>\n\n~~~\n\n\n\n**3**\n\n~~~\n  @RequestMapping(\"/fegin/test\")\n    public String feginTest() {\n        iTestService.getServerPort();\n        log.info(\"message1\");\n        return \"message1\";\n    }\n~~~\n\n\n\n#### \n\n**1idea**\n\n VM options\n\n![image-20240416114808884](typora-user-images/image-20240416114808884.png)\n\njavaagentskywalking-agent\n\n~~~\n-Dskywalking.agent.service_name=\"spring-cloud-service\"\n-Dskywalking.collector.backend_service=\"opaip:11800\"\n-javaagent:/Users/lison/work/workspace/project/skywalking-agent/skywalking-agent.jar\n~~~\n\n\n\n\n\n![image-20240416114924463](typora-user-images/image-20240416114924463.png)\n\n\n\n\n\n![image-20240416120116317](typora-user-images/image-20240416120116317.png)\n\n\n\n API  SkyWalking \n\n\n\n![image-20240417091316659](typora-user-images/image-20240417091316659.png)\n\n\n\n\n\n\n\n\n\n![image-20240417092003988](typora-user-images/image-20240417092003988.png)\n\n\n\n\n\n**JVM**\n\n![image-20240417092118543](typora-user-images/image-20240417092118543.png)\n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-06-Sleuth","published":1,"date":"2024-02-23T04:13:02.041Z","updated":"2024-04-17T01:22:28.705Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhm0007ecfye251b7gq","content":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2024.4.03</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-06-Sleuth\"><a href=\"#Spring-Cloud-Alibaba-06-Sleuth\" class=\"headerlink\" title=\"Spring Cloud Alibaba-06-Sleuth\"></a>Spring Cloud Alibaba-06-Sleuth</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<blockquote>\n<p></p>\n<p>1</p>\n<p>2</p>\n</blockquote>\n<p><img src=\"/typora-user-images/fe3e2f4ebbbc4a28b707459e2e9fa511.png\" alt=\"img\"></p>\n<p>(Distributed Tracing)  </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><blockquote>\n<p>SpringCloudSleuth + Zipkin</p>\n</blockquote>\n<p><strong>Zipkin</strong></p>\n<p>Twitterspringcloud sleuth</p>\n<p><strong>Pinpoint</strong></p>\n<p>U</p>\n<p><strong>SkyWalking</strong></p>\n<p>UIApache</p>\n<p><strong>CAT</strong></p>\n<p></p>\n<h2 id=\"Sleuth\"><a href=\"#Sleuth\" class=\"headerlink\" title=\"Sleuth\"></a>Sleuth</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>sleuth</p>\n</blockquote>\n<p>sleuthrxjavafeignquartzRestTemplatezuulhystrixgrpckafkaOpentracingredisReatorcircuitbreakerspringScheduleddubbosleuth</p>\n<h3 id=\"Sleuth\"><a href=\"#Sleuth\" class=\"headerlink\" title=\"Sleuth\"></a>Sleuth</h3><blockquote>\n<p>APIAPISpanSpanTraceAnnotation(cssrsscr)</p>\n</blockquote>\n<p><img src=\"/typora-user-images/u=3986274733,3849268543&fm=253&fmt=auto&app=138&f=PNG.png\" alt=\"img\"></p>\n<ul>\n<li><p><strong>Span</strong></p>\n<p>SpanSpanSpanIDIDSpanId</p>\n</li>\n<li><p><strong>Trace</strong></p>\n<p>TraceIdspan</p>\n</li>\n<li><p><strong>Annotation</strong></p>\n<p>4</p>\n<ul>\n<li><strong>cs</strong> Client Sent </li>\n<li><strong>sr</strong> Server Received sr - cs &#x3D; </li>\n<li><strong>ss</strong>Server Sent ss - sr &#x3D; </li>\n<li><strong>cr</strong> Client Received cr - cs &#x3D; </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Sleuth-Zipkin-\"><a href=\"#Sleuth-Zipkin-\" class=\"headerlink\" title=\"Sleuth + Zipkin \"></a>Sleuth + Zipkin </h2><h3 id=\"Sleuth\"><a href=\"#Sleuth\" class=\"headerlink\" title=\"Sleuth\"></a>Sleuth</h3><p><img src=\"/typora-user-images/20220315-2c2a053e-ddb6-4656-bc61-9a94d8b14598.png\" alt=\"image.png\"></p>\n<blockquote>\n<p>AOP</p>\n<p>SleuthTraceFilterheaderspanSpanspan idtrace idTraceHttp HeadersheaderheaderSpanspan idtrace idsl4jMDCspan</p>\n</blockquote>\n<p>sleuthsleuthhttphttpIPSpanzipkin</p>\n<h3 id=\"Zipkin-\"><a href=\"#Zipkin-\" class=\"headerlink\" title=\"Zipkin \"></a>Zipkin </h3><p>Zipkin  Twitter Google Dapper </p>\n<p>REST API  </p>\n<p> API UI :</p>\n<p>Zipkin :In-MemoryMySqlCassandra  Elasticsearch</p>\n<p><img src=\"/typora-user-images/20220314-b46efe3c-5ede-471f-a116-ce05fcccd7c6.png\" alt=\"image.png\"></p>\n<p> Zipkin  4 :</p>\n<p><strong>Collector</strong>: Zipkin Span </p>\n<p><strong>Storage</strong>: </p>\n<p><strong>RESTful API</strong>:API  </p>\n<p><strong>Web UI</strong>:UI  APIUI </p>\n<p>Zipkin Zipkin Zipkin   URL  Sleuth   Trace  Span </p>\n<p><img src=\"/typora-user-images/20220315-917e43b8-7523-4f2f-804c-49855963dbb5.png\" alt=\"image.png\"></p>\n<p></p>\n<p>1SleuthBravetrancertracespan</p>\n<p>2ZipkinCollectorZipkin</p>\n<p>3zipkinStorage&#x2F;es</p>\n<p>3ZipkinAPIUI</p>\n<h2 id=\"Sleuth\"><a href=\"#Sleuth\" class=\"headerlink\" title=\"Sleuth\"></a>Sleuth</h2><p><strong>1</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">sleuth:</span> </span><br><span class=\"line\">\t<span class=\"attr\">sampler:</span></span><br><span class=\"line\">\t\t<span class=\"attr\">rate:</span> <span class=\"number\">100</span> <span class=\"comment\"># 10%</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>3</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/sentinel/message1&quot;)</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> String <span class=\"title function_\">message1</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">      testSentinelMessage3Service.message();</span><br><span class=\"line\">      log.info(<span class=\"string\">&quot;message1&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&quot;message1&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024-01-01 20:23:39.527  INFO [spring-cloud-service,9d701f5350d96c82,9d701f5350d96c82,true] 85218 --- [io-18001-exec-1] c.l.s.controller.TestSentinelController  : message1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>[spring-cloud-service,9d701f5350d96c82,9d701f5350d96c82,true]Spring Cloud Sleuth</p>\n<p>4</p>\n<p>1spring-cloud-service <code>spring.application.name</code><br>29d701f5350d96c82 <strong>Trace ID</strong><br>39d701f5350d96c82 <strong>Span ID</strong><br>4trueZipkin</p>\n<h2 id=\"Zipkin\"><a href=\"#Zipkin\" class=\"headerlink\" title=\"Zipkin\"></a>Zipkin</h2><p><strong>Trace ID</strong>ZipkinZipkinTwitter</p>\n<p>ZipKinSleuth</p>\n<h3 id=\"ZipkinDockermysqlES\"><a href=\"#ZipkinDockermysqlES\" class=\"headerlink\" title=\"ZipkinDockermysqlES\"></a>ZipkinDockermysqlES</h3><h4 id=\"MySql\"><a href=\"#MySql\" class=\"headerlink\" title=\"MySql\"></a>MySql</h4><p><strong>1</strong></p>\n<p>zipkin</p>\n<p> <strong>2</strong></p>\n<p><a href=\"https://cloud.tencent.com/developer/tools/blog-entry?target=https://github.com/openzipkin/zipkin/blob/master/zipkin-storage/mysql-v1/src/main/resources/mysql.sql&source=article&objectId=2318336\">https://github.com/openzipkin/zipkin/blob/master/zipkin-storage/mysql-v1/src/main/resources/mysql.sql</a></p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"comment\">-- Copyright The OpenZipkin Authors</span></span><br><span class=\"line\"><span class=\"comment\">-- SPDX-License-Identifier: Apache-2.0</span></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> zipkin_spans (</span><br><span class=\"line\">  `trace_id_high` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span> COMMENT <span class=\"string\">&#x27;If non zero, this means the trace uses 128 bit traceIds instead of 64 bit&#x27;</span>,</span><br><span class=\"line\">  `trace_id` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `id` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `name` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `remote_service_name` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>),</span><br><span class=\"line\">  `parent_id` <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">  `debug` BIT(<span class=\"number\">1</span>),</span><br><span class=\"line\">  `start_ts` <span class=\"type\">BIGINT</span> COMMENT <span class=\"string\">&#x27;Span.timestamp(): epoch micros used for endTs query and to implement TTL&#x27;</span>,</span><br><span class=\"line\">  `duration` <span class=\"type\">BIGINT</span> COMMENT <span class=\"string\">&#x27;Span.duration(): micros used for minDuration and maxDuration query&#x27;</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY KEY</span> (`trace_id_high`, `trace_id`, `id`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB ROW_FORMAT<span class=\"operator\">=</span>COMPRESSED <span class=\"keyword\">CHARACTER SET</span><span class=\"operator\">=</span>utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_spans <span class=\"keyword\">ADD</span> INDEX(`trace_id_high`, `trace_id`) COMMENT <span class=\"string\">&#x27;for getTracesByIds&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_spans <span class=\"keyword\">ADD</span> INDEX(`name`) COMMENT <span class=\"string\">&#x27;for getTraces and getSpanNames&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_spans <span class=\"keyword\">ADD</span> INDEX(`remote_service_name`) COMMENT <span class=\"string\">&#x27;for getTraces and getRemoteServiceNames&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_spans <span class=\"keyword\">ADD</span> INDEX(`start_ts`) COMMENT <span class=\"string\">&#x27;for getTraces ordering and range&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> zipkin_annotations (</span><br><span class=\"line\">  `trace_id_high` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span> COMMENT <span class=\"string\">&#x27;If non zero, this means the trace uses 128 bit traceIds instead of 64 bit&#x27;</span>,</span><br><span class=\"line\">  `trace_id` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;coincides with zipkin_spans.trace_id&#x27;</span>,</span><br><span class=\"line\">  `span_id` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;coincides with zipkin_spans.id&#x27;</span>,</span><br><span class=\"line\">  `a_key` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;BinaryAnnotation.key or Annotation.value if type == -1&#x27;</span>,</span><br><span class=\"line\">  `a_value` <span class=\"type\">BLOB</span> COMMENT <span class=\"string\">&#x27;BinaryAnnotation.value(), which must be smaller than 64KB&#x27;</span>,</span><br><span class=\"line\">  `a_type` <span class=\"type\">INT</span> <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;BinaryAnnotation.type() or -1 if Annotation&#x27;</span>,</span><br><span class=\"line\">  `a_timestamp` <span class=\"type\">BIGINT</span> COMMENT <span class=\"string\">&#x27;Used to implement TTL; Annotation.timestamp or zipkin_spans.timestamp&#x27;</span>,</span><br><span class=\"line\">  `endpoint_ipv4` <span class=\"type\">INT</span> COMMENT <span class=\"string\">&#x27;Null when Binary/Annotation.endpoint is null&#x27;</span>,</span><br><span class=\"line\">  `endpoint_ipv6` <span class=\"type\">BINARY</span>(<span class=\"number\">16</span>) COMMENT <span class=\"string\">&#x27;Null when Binary/Annotation.endpoint is null, or no IPv6 address&#x27;</span>,</span><br><span class=\"line\">  `endpoint_port` <span class=\"type\">SMALLINT</span> COMMENT <span class=\"string\">&#x27;Null when Binary/Annotation.endpoint is null&#x27;</span>,</span><br><span class=\"line\">  `endpoint_service_name` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) COMMENT <span class=\"string\">&#x27;Null when Binary/Annotation.endpoint is null&#x27;</span></span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB ROW_FORMAT<span class=\"operator\">=</span>COMPRESSED <span class=\"keyword\">CHARACTER SET</span><span class=\"operator\">=</span>utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> <span class=\"keyword\">UNIQUE</span> KEY(`trace_id_high`, `trace_id`, `span_id`, `a_key`, `a_timestamp`) COMMENT <span class=\"string\">&#x27;Ignore insert on duplicate&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`trace_id_high`, `trace_id`, `span_id`) COMMENT <span class=\"string\">&#x27;for joining with zipkin_spans&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`trace_id_high`, `trace_id`) COMMENT <span class=\"string\">&#x27;for getTraces/ByIds&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`endpoint_service_name`) COMMENT <span class=\"string\">&#x27;for getTraces and getServiceNames&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`a_type`) COMMENT <span class=\"string\">&#x27;for getTraces and autocomplete values&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`a_key`) COMMENT <span class=\"string\">&#x27;for getTraces and autocomplete values&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`trace_id`, `span_id`, `a_key`) COMMENT <span class=\"string\">&#x27;for dependencies job&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> zipkin_dependencies (</span><br><span class=\"line\">  `<span class=\"keyword\">day</span>` <span class=\"type\">DATE</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `parent` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `child` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `call_count` <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">  `error_count` <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY KEY</span> (`<span class=\"keyword\">day</span>`, `parent`, `child`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB ROW_FORMAT<span class=\"operator\">=</span>COMPRESSED <span class=\"keyword\">CHARACTER SET</span><span class=\"operator\">=</span>utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<p><strong>3</strong></p>\n<p>Zipkin9411</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">--name zipkin-server -d \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">-p 9411:9411 \\</span><br><span class=\"line\">-e MYSQL_USER=root \\</span><br><span class=\"line\">-e MYSQL_PASS=123456 \\</span><br><span class=\"line\">-e MYSQL_HOST=127.0.0.1 \\</span><br><span class=\"line\">-e STORAGE_TYPE=mysql \\</span><br><span class=\"line\">-e MYSQL_DB=zipkin \\</span><br><span class=\"line\">-e MYSQL_TCP_PORT=3306 \\</span><br><span class=\"line\">openzipkin/zipkin:2.21.7</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"ES\"><a href=\"#ES\" class=\"headerlink\" title=\"ES\"></a>ES</h4><p>ESES_HOSTSES_HOSTS&#x3D;[<a href=\"http://192.168.0.1:9200,http://192.168.0.2:9200]\">http://192.168.0.1:9200,http://192.168.0.2:9200]</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">--name zipkin-server -d \\</span><br><span class=\"line\">-p 9411:9411 \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">-e STORAGE_TYPE=elasticsearch \\</span><br><span class=\"line\">-e ES_HOSTS=localhost:9200</span><br><span class=\"line\">openzipkin/zipkin:2.21.7</span><br></pre></td></tr></table></figure>\n\n<p>ES</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">ES_HOSTS</td>\n<td align=\"left\">ES<a href=\"http://localhost:9200/\">http://localhost:9200</a></td>\n</tr>\n<tr>\n<td align=\"left\">ES_PIPELINE</td>\n<td align=\"left\">spanpipeline</td>\n</tr>\n<tr>\n<td align=\"left\">ES_TIMEOUT</td>\n<td align=\"left\">ESms10000(10S)</td>\n</tr>\n<tr>\n<td align=\"left\">ES_INDEX</td>\n<td align=\"left\">Zipkinzipkin</td>\n</tr>\n<tr>\n<td align=\"left\">ES_DATE_SEPARATOR</td>\n<td align=\"left\">Zipkin-</td>\n</tr>\n<tr>\n<td align=\"left\">ES_INDEX_SHARDS</td>\n<td align=\"left\">(shard)5</td>\n</tr>\n<tr>\n<td align=\"left\">ES_INDEX_REPLICAS</td>\n<td align=\"left\">(replica)1</td>\n</tr>\n<tr>\n<td align=\"left\">ES_HTTP_LOGGING</td>\n<td align=\"left\">ESBASIC, HEADERS, BODY</td>\n</tr>\n<tr>\n<td align=\"left\">ES_USERNAME&#x2F;ES_PASSWORD</td>\n<td align=\"left\">ES</td>\n</tr>\n</tbody></table>\n<p><img src=\"/typora-user-images/image-20240318202804603.png\" alt=\"image-20240318202804603\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>1</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>2</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">zipkin:</span></span><br><span class=\"line\">\t\t<span class=\"attr\">base-url:</span> <span class=\"string\">http://127.0.0.1:9411/</span> <span class=\"comment\">#zipkin server </span></span><br><span class=\"line\">\t\t<span class=\"attr\">discoveryClientEnabled:</span> <span class=\"literal\">false</span> <span class=\"comment\">#nacosURL </span></span><br><span class=\"line\">\t<span class=\"attr\">sleuth:</span> </span><br><span class=\"line\">\t\t<span class=\"attr\">sampler:</span></span><br><span class=\"line\">\t\t\t<span class=\"attr\">probability:</span> <span class=\"number\">1.0</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>3<strong></strong></p>\n<blockquote>\n<p><a href=\"http://127.0.0.1:18003/spring_building/naocs/consumer\">http://127.0.0.1:18003/spring_building/naocs/consumer</a></p>\n</blockquote>\n<p><strong>4zipkinUI</strong></p>\n<p><img src=\"/typora-user-images/image-20240412121048381.png\" alt=\"image-20240412121048381\"></p>\n<h2 id=\"-SkyWalking-\"><a href=\"#-SkyWalking-\" class=\"headerlink\" title=\" SkyWalking \"></a> SkyWalking </h2><p> Sleuth+Zipkin  Sleuth  Zipkin </p>\n<p> SkyWalking SkyWalking </p>\n<h3 id=\"APM--SkyWalking\"><a href=\"#APM--SkyWalking\" class=\"headerlink\" title=\"APM  SkyWalking\"></a>APM  SkyWalking</h3><p> Spring Cloud SluethZipkin CatSkyWalkingAPMApplication Performance ManagementSkyWalking  APM  Zipkin  Sleuth+Zipkin SkyWalking </p>\n<p>SkyWalking APMJava Apache Apache  SkyWalking  Apache <a href=\"http://skywalking.apache.org/%E3%80%82\">http://skywalking.apache.org/</a></p>\n<p><img src=\"/typora-user-images/image-20240415090937231.png\" alt=\"image-20240415090937231\"></p>\n<p>SkyWalking  GitHub  SkyWaking  23.3K Star9.7.0</p>\n<p><strong></strong></p>\n<p><strong></strong></p>\n<h3 id=\"Sleuth-Zipkin--SkyWalking-\"><a href=\"#Sleuth-Zipkin--SkyWalking-\" class=\"headerlink\" title=\"Sleuth+Zipkin  SkyWalking \"></a>Sleuth+Zipkin  SkyWalking </h3><table>\n<thead>\n<tr>\n<th></th>\n<th>Sleuth+Zipkin</th>\n<th>SkyWalking</th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>Java Agent</td>\n</tr>\n<tr>\n<td>Java VM</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>MySQL,ES</td>\n<td>ESMysqlH2</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>Apache</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<p>SkyWalking  Zipkin</p>\n<h3 id=\"-SkyWalking-\"><a href=\"#-SkyWalking-\" class=\"headerlink\" title=\" SkyWalking \"></a> SkyWalking </h3><p>skyWalkIng </p>\n<p><img src=\"/typora-user-images/image-20240415091018922.png\" alt=\"image-20240415091018922\"></p>\n<p>SkyWalking SkyWalking  Java Agent  SkyWalking UI SkyWalking  gRPC  HTTP  gRPC  11800 HTTP  12800  SKyWalking UI  8080 SkyWalking  ElasticSearch MySQLH2 ElasticSearch </p>\n<p>Docker</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/elasticsearch/elasticsearch:7.17.6</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9200</span><span class=\"string\">:9200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9300</span><span class=\"string\">:9300</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">discovery.type=single-node</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">bootstrap.memory_lock=true</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;ES_JAVA_OPTS=-Xms1024m -Xmx1024m&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/opt/data/dockerData/skywalking/elasticsearch/data:/usr/share/elasticsearch/data</span></span><br><span class=\"line\">    <span class=\"attr\">ulimits:</span></span><br><span class=\"line\">      <span class=\"attr\">memlock:</span></span><br><span class=\"line\">        <span class=\"attr\">soft:</span> <span class=\"number\">-1</span></span><br><span class=\"line\">        <span class=\"attr\">hard:</span> <span class=\"number\">-1</span></span><br><span class=\"line\">  <span class=\"attr\">oap:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.io/apache/skywalking-oap-server:9.4.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">oap</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">11800</span><span class=\"string\">:11800</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">12800</span><span class=\"string\">:12800</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">SW_CORE_RECORD_DATA_TTL:</span> <span class=\"number\">15</span></span><br><span class=\"line\">      <span class=\"attr\">SW_CORE_METRICS_DATA_TTL:</span> <span class=\"number\">15</span></span><br><span class=\"line\">      <span class=\"attr\">SW_STORAGE:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">      <span class=\"attr\">SW_STORAGE_ES_CLUSTER_NODES:</span> <span class=\"string\">elasticsearch:9200</span></span><br><span class=\"line\">      <span class=\"attr\">SW_ENABLE_UPDATE_UI_TEMPLATE:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">TZ:</span> <span class=\"string\">Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPTS:</span> <span class=\"string\">&quot;-Xms2048m -Xmx2048m&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">ui:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.io/apache/skywalking-ui:9.4.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">ui</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">oap</span></span><br><span class=\"line\">    <span class=\"attr\">links:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">oap</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">8080</span><span class=\"string\">:8080</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">SW_OAP_ADDRESS:</span> <span class=\"string\">http://oap:12800</span></span><br><span class=\"line\">      <span class=\"attr\">SW_ZIPKIN_ADDRESS:</span> <span class=\"string\">http://oap:9412</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p> Java </p>\n<ul>\n<li>Skywalking-Collector  11800gRPC 12800HTTP </li>\n<li>Skywalking-Webapp  SkyWalking UI 8080 ,8038</li>\n</ul>\n<p>Skywalking </p>\n<p>[<a href=\"http://127.0.0.1:8088/]%EF%BC%8C%E5%A6%82%E6%9E%9C%E7%9C%8B%E5%88%B0\">http://127.0.0.1:8088/]</a> SkyWalking UI </p>\n<p><img src=\"/typora-user-images/image-20240416113821316.png\" alt=\"image-20240416113821316\"></p>\n<h3 id=\"-SkyWalking-Java-Agent\"><a href=\"#-SkyWalking-Java-Agent\" class=\"headerlink\" title=\" SkyWalking Java Agent\"></a> SkyWalking Java Agent</h3><p>SkyWalking  JVM  Java1.5 Java Agent  Java Java Agent </p>\n<p>Java Agent  Java  javaagent </p>\n<p>Java Agent  premain  main  Java Agent </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SimpleAgent</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">premain</span><span class=\"params\">(String agentArgs, Instrumentation inst)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;=========premain============&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> Java Agent MANIFEST.MF JVM  META-INF  MANIFEST.MF </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Manifest-Version: 1.0</span><br><span class=\"line\">Premain-Class: com.lison.agent.SimpleAgent</span><br></pre></td></tr></table></figure>\n\n\n\n<p> agent.jar test-agent.jar test-agent.jar  javaagent </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -javaagent:agent.jar -jar test-agent.jar</span><br></pre></td></tr></table></figure>\n\n<p> Java </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">========= premain============</span><br><span class=\"line\"> Agent...</span><br><span class=\"line\">....</span><br></pre></td></tr></table></figure>\n\n\n\n<p>SkyWalking  Java Agent  premain  SkyWalking </p>\n<p>SkyWalking Java Agent Java Agent </p>\n<p><img src=\"/typora-user-images/image-20240415094839642.png\" alt=\"image-20240415094839642\"></p>\n<p></p>\n<p> a  a a  OpenFeign  b  b b  OpenFeign  c  c  c  JDBC  MySQL </p>\n<h4 id=\"skywalking\"><a href=\"#skywalking\" class=\"headerlink\" title=\"skywalking\"></a>skywalking</h4><p><strong>1 agent</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">agentoapagent</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong> <a href=\"https://skywalking.apache.org/downloads/\">https://skywalking.apache.org/downloads/</a></p>\n<p><strong>skywalking9.4.0v9.1.0client</strong></p>\n<p><img src=\"/typora-user-images/image-20240416114024941.png\" alt=\"image-20240416114024941\"></p>\n<p>skywalking-agentconfig&#x2F;agent.config</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">agent.service_name=$&#123;SW_AGENT_NAME:HS&#125;</span><br><span class=\"line\">collector.backend_service=$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:192.168.54.53:11800&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p><strong>2</strong></p>\n<p>skywalkingUIskywalking</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--skywalkingTraceId--&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.apache.skywalking&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;apm-toolkit-logback-1.x&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;9.1.0&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.apache.skywalking&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;apm-toolkit-trace&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;9.1.0&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>logback-spring.xmlresource</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span> <span class=\"attr\">debug</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">scan</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">springProperty</span> <span class=\"attr\">scop</span>=<span class=\"string\">&quot;context&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;spring.application.name&quot;</span> <span class=\"attr\">source</span>=<span class=\"string\">&quot;spring.application.name&quot;</span> <span class=\"attr\">defaultValue</span>=<span class=\"string\">&quot;&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;log.path&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;logs/$&#123;spring.application.name&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;CONSOLE_LOG_PATTERN&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">              <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;CONSOLE_LOG_PATTERN:-%clr(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conversionRule</span> <span class=\"attr\">conversionWord</span>=<span class=\"string\">&quot;clr&quot;</span> <span class=\"attr\">converterClass</span>=<span class=\"string\">&quot;org.springframework.boot.logging.logback.ColorConverter&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conversionRule</span> <span class=\"attr\">conversionWord</span>=<span class=\"string\">&quot;wex&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                    <span class=\"attr\">converterClass</span>=<span class=\"string\">&quot;org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conversionRule</span> <span class=\"attr\">conversionWord</span>=<span class=\"string\">&quot;wEx&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                    <span class=\"attr\">converterClass</span>=<span class=\"string\">&quot;org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Console log output --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;console&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Log file debug output --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;debug&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/debug.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/%d&#123;yyyy-MM, aux&#125;/debug.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>50MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>%date [%thread] %-5level [%logger&#123;50&#125;] %file:%line - %msg%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Log file error output --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;error&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/error.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/%d&#123;yyyy-MM&#125;/error.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>50MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>%date [%thread] %-5level [%logger&#123;50&#125;] %file:%line - %msg%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>ERROR<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;stdout&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%tid] [%thread] %-5level %logger&#123;36&#125; -%msg%n<span class=\"tag\">&lt;/<span class=\"name\">Pattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;grpc&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.log.GRPCLogClientAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%X&#123;tid&#125;] [%thread] %-5level %logger&#123;36&#125; -%msg%n<span class=\"tag\">&lt;/<span class=\"name\">Pattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--nacos  INFO --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;com.alibaba.nacos&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;OFF&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;error&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">logger</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Level: FATAL 0  ERROR 3  WARN 4  INFO 6  DEBUG 7 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;INFO&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;appender-ref ref=&quot;console&quot;/&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;debug&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;error&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;stdout&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;grpc&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>3</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@RequestMapping(&quot;/fegin/test&quot;)</span><br><span class=\"line\">  public String feginTest() &#123;</span><br><span class=\"line\">      iTestService.getServerPort();</span><br><span class=\"line\">      log.info(&quot;message1&quot;);</span><br><span class=\"line\">      return &quot;message1&quot;;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><strong>1idea</strong></p>\n<p> VM options</p>\n<p><img src=\"/typora-user-images/image-20240416114808884.png\" alt=\"image-20240416114808884\"></p>\n<p>javaagentskywalking-agent</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Dskywalking.agent.service_name=&quot;spring-cloud-service&quot;</span><br><span class=\"line\">-Dskywalking.collector.backend_service=&quot;opaip:11800&quot;</span><br><span class=\"line\">-javaagent:/Users/lison/work/workspace/project/skywalking-agent/skywalking-agent.jar</span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<p><img src=\"/typora-user-images/image-20240416114924463.png\" alt=\"image-20240416114924463\"></p>\n<p><img src=\"/typora-user-images/image-20240416120116317.png\" alt=\"image-20240416120116317\"></p>\n<p> API  SkyWalking </p>\n<p><img src=\"/typora-user-images/image-20240417091316659.png\" alt=\"image-20240417091316659\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240417092003988.png\" alt=\"image-20240417092003988\"></p>\n<p><strong>JVM</strong></p>\n<p><img src=\"/typora-user-images/image-20240417092118543.png\" alt=\"image-20240417092118543\"></p>\n","excerpt":"","more":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2024.4.03</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-06-Sleuth\"><a href=\"#Spring-Cloud-Alibaba-06-Sleuth\" class=\"headerlink\" title=\"Spring Cloud Alibaba-06-Sleuth\"></a>Spring Cloud Alibaba-06-Sleuth</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<blockquote>\n<p></p>\n<p>1</p>\n<p>2</p>\n</blockquote>\n<p><img src=\"/typora-user-images/fe3e2f4ebbbc4a28b707459e2e9fa511.png\" alt=\"img\"></p>\n<p>(Distributed Tracing)  </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><blockquote>\n<p>SpringCloudSleuth + Zipkin</p>\n</blockquote>\n<p><strong>Zipkin</strong></p>\n<p>Twitterspringcloud sleuth</p>\n<p><strong>Pinpoint</strong></p>\n<p>U</p>\n<p><strong>SkyWalking</strong></p>\n<p>UIApache</p>\n<p><strong>CAT</strong></p>\n<p></p>\n<h2 id=\"Sleuth\"><a href=\"#Sleuth\" class=\"headerlink\" title=\"Sleuth\"></a>Sleuth</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><blockquote>\n<p>sleuth</p>\n</blockquote>\n<p>sleuthrxjavafeignquartzRestTemplatezuulhystrixgrpckafkaOpentracingredisReatorcircuitbreakerspringScheduleddubbosleuth</p>\n<h3 id=\"Sleuth\"><a href=\"#Sleuth\" class=\"headerlink\" title=\"Sleuth\"></a>Sleuth</h3><blockquote>\n<p>APIAPISpanSpanTraceAnnotation(cssrsscr)</p>\n</blockquote>\n<p><img src=\"/typora-user-images/u=3986274733,3849268543&fm=253&fmt=auto&app=138&f=PNG.png\" alt=\"img\"></p>\n<ul>\n<li><p><strong>Span</strong></p>\n<p>SpanSpanSpanIDIDSpanId</p>\n</li>\n<li><p><strong>Trace</strong></p>\n<p>TraceIdspan</p>\n</li>\n<li><p><strong>Annotation</strong></p>\n<p>4</p>\n<ul>\n<li><strong>cs</strong> Client Sent </li>\n<li><strong>sr</strong> Server Received sr - cs &#x3D; </li>\n<li><strong>ss</strong>Server Sent ss - sr &#x3D; </li>\n<li><strong>cr</strong> Client Received cr - cs &#x3D; </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Sleuth-Zipkin-\"><a href=\"#Sleuth-Zipkin-\" class=\"headerlink\" title=\"Sleuth + Zipkin \"></a>Sleuth + Zipkin </h2><h3 id=\"Sleuth\"><a href=\"#Sleuth\" class=\"headerlink\" title=\"Sleuth\"></a>Sleuth</h3><p><img src=\"/typora-user-images/20220315-2c2a053e-ddb6-4656-bc61-9a94d8b14598.png\" alt=\"image.png\"></p>\n<blockquote>\n<p>AOP</p>\n<p>SleuthTraceFilterheaderspanSpanspan idtrace idTraceHttp HeadersheaderheaderSpanspan idtrace idsl4jMDCspan</p>\n</blockquote>\n<p>sleuthsleuthhttphttpIPSpanzipkin</p>\n<h3 id=\"Zipkin-\"><a href=\"#Zipkin-\" class=\"headerlink\" title=\"Zipkin \"></a>Zipkin </h3><p>Zipkin  Twitter Google Dapper </p>\n<p>REST API  </p>\n<p> API UI :</p>\n<p>Zipkin :In-MemoryMySqlCassandra  Elasticsearch</p>\n<p><img src=\"/typora-user-images/20220314-b46efe3c-5ede-471f-a116-ce05fcccd7c6.png\" alt=\"image.png\"></p>\n<p> Zipkin  4 :</p>\n<p><strong>Collector</strong>: Zipkin Span </p>\n<p><strong>Storage</strong>: </p>\n<p><strong>RESTful API</strong>:API  </p>\n<p><strong>Web UI</strong>:UI  APIUI </p>\n<p>Zipkin Zipkin Zipkin   URL  Sleuth   Trace  Span </p>\n<p><img src=\"/typora-user-images/20220315-917e43b8-7523-4f2f-804c-49855963dbb5.png\" alt=\"image.png\"></p>\n<p></p>\n<p>1SleuthBravetrancertracespan</p>\n<p>2ZipkinCollectorZipkin</p>\n<p>3zipkinStorage&#x2F;es</p>\n<p>3ZipkinAPIUI</p>\n<h2 id=\"Sleuth\"><a href=\"#Sleuth\" class=\"headerlink\" title=\"Sleuth\"></a>Sleuth</h2><p><strong>1</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">sleuth:</span> </span><br><span class=\"line\">\t<span class=\"attr\">sampler:</span></span><br><span class=\"line\">\t\t<span class=\"attr\">rate:</span> <span class=\"number\">100</span> <span class=\"comment\"># 10%</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>3</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/sentinel/message1&quot;)</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> String <span class=\"title function_\">message1</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">      testSentinelMessage3Service.message();</span><br><span class=\"line\">      log.info(<span class=\"string\">&quot;message1&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&quot;message1&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024-01-01 20:23:39.527  INFO [spring-cloud-service,9d701f5350d96c82,9d701f5350d96c82,true] 85218 --- [io-18001-exec-1] c.l.s.controller.TestSentinelController  : message1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>[spring-cloud-service,9d701f5350d96c82,9d701f5350d96c82,true]Spring Cloud Sleuth</p>\n<p>4</p>\n<p>1spring-cloud-service <code>spring.application.name</code><br>29d701f5350d96c82 <strong>Trace ID</strong><br>39d701f5350d96c82 <strong>Span ID</strong><br>4trueZipkin</p>\n<h2 id=\"Zipkin\"><a href=\"#Zipkin\" class=\"headerlink\" title=\"Zipkin\"></a>Zipkin</h2><p><strong>Trace ID</strong>ZipkinZipkinTwitter</p>\n<p>ZipKinSleuth</p>\n<h3 id=\"ZipkinDockermysqlES\"><a href=\"#ZipkinDockermysqlES\" class=\"headerlink\" title=\"ZipkinDockermysqlES\"></a>ZipkinDockermysqlES</h3><h4 id=\"MySql\"><a href=\"#MySql\" class=\"headerlink\" title=\"MySql\"></a>MySql</h4><p><strong>1</strong></p>\n<p>zipkin</p>\n<p> <strong>2</strong></p>\n<p><a href=\"https://cloud.tencent.com/developer/tools/blog-entry?target=https://github.com/openzipkin/zipkin/blob/master/zipkin-storage/mysql-v1/src/main/resources/mysql.sql&source=article&objectId=2318336\">https://github.com/openzipkin/zipkin/blob/master/zipkin-storage/mysql-v1/src/main/resources/mysql.sql</a></p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"comment\">-- Copyright The OpenZipkin Authors</span></span><br><span class=\"line\"><span class=\"comment\">-- SPDX-License-Identifier: Apache-2.0</span></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> zipkin_spans (</span><br><span class=\"line\">  `trace_id_high` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span> COMMENT <span class=\"string\">&#x27;If non zero, this means the trace uses 128 bit traceIds instead of 64 bit&#x27;</span>,</span><br><span class=\"line\">  `trace_id` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `id` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `name` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `remote_service_name` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>),</span><br><span class=\"line\">  `parent_id` <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">  `debug` BIT(<span class=\"number\">1</span>),</span><br><span class=\"line\">  `start_ts` <span class=\"type\">BIGINT</span> COMMENT <span class=\"string\">&#x27;Span.timestamp(): epoch micros used for endTs query and to implement TTL&#x27;</span>,</span><br><span class=\"line\">  `duration` <span class=\"type\">BIGINT</span> COMMENT <span class=\"string\">&#x27;Span.duration(): micros used for minDuration and maxDuration query&#x27;</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY KEY</span> (`trace_id_high`, `trace_id`, `id`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB ROW_FORMAT<span class=\"operator\">=</span>COMPRESSED <span class=\"keyword\">CHARACTER SET</span><span class=\"operator\">=</span>utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_spans <span class=\"keyword\">ADD</span> INDEX(`trace_id_high`, `trace_id`) COMMENT <span class=\"string\">&#x27;for getTracesByIds&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_spans <span class=\"keyword\">ADD</span> INDEX(`name`) COMMENT <span class=\"string\">&#x27;for getTraces and getSpanNames&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_spans <span class=\"keyword\">ADD</span> INDEX(`remote_service_name`) COMMENT <span class=\"string\">&#x27;for getTraces and getRemoteServiceNames&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_spans <span class=\"keyword\">ADD</span> INDEX(`start_ts`) COMMENT <span class=\"string\">&#x27;for getTraces ordering and range&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> zipkin_annotations (</span><br><span class=\"line\">  `trace_id_high` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span> COMMENT <span class=\"string\">&#x27;If non zero, this means the trace uses 128 bit traceIds instead of 64 bit&#x27;</span>,</span><br><span class=\"line\">  `trace_id` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;coincides with zipkin_spans.trace_id&#x27;</span>,</span><br><span class=\"line\">  `span_id` <span class=\"type\">BIGINT</span> <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;coincides with zipkin_spans.id&#x27;</span>,</span><br><span class=\"line\">  `a_key` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;BinaryAnnotation.key or Annotation.value if type == -1&#x27;</span>,</span><br><span class=\"line\">  `a_value` <span class=\"type\">BLOB</span> COMMENT <span class=\"string\">&#x27;BinaryAnnotation.value(), which must be smaller than 64KB&#x27;</span>,</span><br><span class=\"line\">  `a_type` <span class=\"type\">INT</span> <span class=\"keyword\">NOT NULL</span> COMMENT <span class=\"string\">&#x27;BinaryAnnotation.type() or -1 if Annotation&#x27;</span>,</span><br><span class=\"line\">  `a_timestamp` <span class=\"type\">BIGINT</span> COMMENT <span class=\"string\">&#x27;Used to implement TTL; Annotation.timestamp or zipkin_spans.timestamp&#x27;</span>,</span><br><span class=\"line\">  `endpoint_ipv4` <span class=\"type\">INT</span> COMMENT <span class=\"string\">&#x27;Null when Binary/Annotation.endpoint is null&#x27;</span>,</span><br><span class=\"line\">  `endpoint_ipv6` <span class=\"type\">BINARY</span>(<span class=\"number\">16</span>) COMMENT <span class=\"string\">&#x27;Null when Binary/Annotation.endpoint is null, or no IPv6 address&#x27;</span>,</span><br><span class=\"line\">  `endpoint_port` <span class=\"type\">SMALLINT</span> COMMENT <span class=\"string\">&#x27;Null when Binary/Annotation.endpoint is null&#x27;</span>,</span><br><span class=\"line\">  `endpoint_service_name` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) COMMENT <span class=\"string\">&#x27;Null when Binary/Annotation.endpoint is null&#x27;</span></span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB ROW_FORMAT<span class=\"operator\">=</span>COMPRESSED <span class=\"keyword\">CHARACTER SET</span><span class=\"operator\">=</span>utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> <span class=\"keyword\">UNIQUE</span> KEY(`trace_id_high`, `trace_id`, `span_id`, `a_key`, `a_timestamp`) COMMENT <span class=\"string\">&#x27;Ignore insert on duplicate&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`trace_id_high`, `trace_id`, `span_id`) COMMENT <span class=\"string\">&#x27;for joining with zipkin_spans&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`trace_id_high`, `trace_id`) COMMENT <span class=\"string\">&#x27;for getTraces/ByIds&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`endpoint_service_name`) COMMENT <span class=\"string\">&#x27;for getTraces and getServiceNames&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`a_type`) COMMENT <span class=\"string\">&#x27;for getTraces and autocomplete values&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`a_key`) COMMENT <span class=\"string\">&#x27;for getTraces and autocomplete values&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> zipkin_annotations <span class=\"keyword\">ADD</span> INDEX(`trace_id`, `span_id`, `a_key`) COMMENT <span class=\"string\">&#x27;for dependencies job&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> zipkin_dependencies (</span><br><span class=\"line\">  `<span class=\"keyword\">day</span>` <span class=\"type\">DATE</span> <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `parent` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `child` <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">  `call_count` <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">  `error_count` <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY KEY</span> (`<span class=\"keyword\">day</span>`, `parent`, `child`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB ROW_FORMAT<span class=\"operator\">=</span>COMPRESSED <span class=\"keyword\">CHARACTER SET</span><span class=\"operator\">=</span>utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<p><strong>3</strong></p>\n<p>Zipkin9411</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">--name zipkin-server -d \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">-p 9411:9411 \\</span><br><span class=\"line\">-e MYSQL_USER=root \\</span><br><span class=\"line\">-e MYSQL_PASS=123456 \\</span><br><span class=\"line\">-e MYSQL_HOST=127.0.0.1 \\</span><br><span class=\"line\">-e STORAGE_TYPE=mysql \\</span><br><span class=\"line\">-e MYSQL_DB=zipkin \\</span><br><span class=\"line\">-e MYSQL_TCP_PORT=3306 \\</span><br><span class=\"line\">openzipkin/zipkin:2.21.7</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"ES\"><a href=\"#ES\" class=\"headerlink\" title=\"ES\"></a>ES</h4><p>ESES_HOSTSES_HOSTS&#x3D;[<a href=\"http://192.168.0.1:9200,http://192.168.0.2:9200]\">http://192.168.0.1:9200,http://192.168.0.2:9200]</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">--name zipkin-server -d \\</span><br><span class=\"line\">-p 9411:9411 \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">-e STORAGE_TYPE=elasticsearch \\</span><br><span class=\"line\">-e ES_HOSTS=localhost:9200</span><br><span class=\"line\">openzipkin/zipkin:2.21.7</span><br></pre></td></tr></table></figure>\n\n<p>ES</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">ES_HOSTS</td>\n<td align=\"left\">ES<a href=\"http://localhost:9200/\">http://localhost:9200</a></td>\n</tr>\n<tr>\n<td align=\"left\">ES_PIPELINE</td>\n<td align=\"left\">spanpipeline</td>\n</tr>\n<tr>\n<td align=\"left\">ES_TIMEOUT</td>\n<td align=\"left\">ESms10000(10S)</td>\n</tr>\n<tr>\n<td align=\"left\">ES_INDEX</td>\n<td align=\"left\">Zipkinzipkin</td>\n</tr>\n<tr>\n<td align=\"left\">ES_DATE_SEPARATOR</td>\n<td align=\"left\">Zipkin-</td>\n</tr>\n<tr>\n<td align=\"left\">ES_INDEX_SHARDS</td>\n<td align=\"left\">(shard)5</td>\n</tr>\n<tr>\n<td align=\"left\">ES_INDEX_REPLICAS</td>\n<td align=\"left\">(replica)1</td>\n</tr>\n<tr>\n<td align=\"left\">ES_HTTP_LOGGING</td>\n<td align=\"left\">ESBASIC, HEADERS, BODY</td>\n</tr>\n<tr>\n<td align=\"left\">ES_USERNAME&#x2F;ES_PASSWORD</td>\n<td align=\"left\">ES</td>\n</tr>\n</tbody></table>\n<p><img src=\"/typora-user-images/image-20240318202804603.png\" alt=\"image-20240318202804603\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>1</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>2</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">zipkin:</span></span><br><span class=\"line\">\t\t<span class=\"attr\">base-url:</span> <span class=\"string\">http://127.0.0.1:9411/</span> <span class=\"comment\">#zipkin server </span></span><br><span class=\"line\">\t\t<span class=\"attr\">discoveryClientEnabled:</span> <span class=\"literal\">false</span> <span class=\"comment\">#nacosURL </span></span><br><span class=\"line\">\t<span class=\"attr\">sleuth:</span> </span><br><span class=\"line\">\t\t<span class=\"attr\">sampler:</span></span><br><span class=\"line\">\t\t\t<span class=\"attr\">probability:</span> <span class=\"number\">1.0</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>3<strong></strong></p>\n<blockquote>\n<p><a href=\"http://127.0.0.1:18003/spring_building/naocs/consumer\">http://127.0.0.1:18003/spring_building/naocs/consumer</a></p>\n</blockquote>\n<p><strong>4zipkinUI</strong></p>\n<p><img src=\"/typora-user-images/image-20240412121048381.png\" alt=\"image-20240412121048381\"></p>\n<h2 id=\"-SkyWalking-\"><a href=\"#-SkyWalking-\" class=\"headerlink\" title=\" SkyWalking \"></a> SkyWalking </h2><p> Sleuth+Zipkin  Sleuth  Zipkin </p>\n<p> SkyWalking SkyWalking </p>\n<h3 id=\"APM--SkyWalking\"><a href=\"#APM--SkyWalking\" class=\"headerlink\" title=\"APM  SkyWalking\"></a>APM  SkyWalking</h3><p> Spring Cloud SluethZipkin CatSkyWalkingAPMApplication Performance ManagementSkyWalking  APM  Zipkin  Sleuth+Zipkin SkyWalking </p>\n<p>SkyWalking APMJava Apache Apache  SkyWalking  Apache <a href=\"http://skywalking.apache.org/%E3%80%82\">http://skywalking.apache.org/</a></p>\n<p><img src=\"/typora-user-images/image-20240415090937231.png\" alt=\"image-20240415090937231\"></p>\n<p>SkyWalking  GitHub  SkyWaking  23.3K Star9.7.0</p>\n<p><strong></strong></p>\n<p><strong></strong></p>\n<h3 id=\"Sleuth-Zipkin--SkyWalking-\"><a href=\"#Sleuth-Zipkin--SkyWalking-\" class=\"headerlink\" title=\"Sleuth+Zipkin  SkyWalking \"></a>Sleuth+Zipkin  SkyWalking </h3><table>\n<thead>\n<tr>\n<th></th>\n<th>Sleuth+Zipkin</th>\n<th>SkyWalking</th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>Java Agent</td>\n</tr>\n<tr>\n<td>Java VM</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>MySQL,ES</td>\n<td>ESMysqlH2</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td>Apache</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<p>SkyWalking  Zipkin</p>\n<h3 id=\"-SkyWalking-\"><a href=\"#-SkyWalking-\" class=\"headerlink\" title=\" SkyWalking \"></a> SkyWalking </h3><p>skyWalkIng </p>\n<p><img src=\"/typora-user-images/image-20240415091018922.png\" alt=\"image-20240415091018922\"></p>\n<p>SkyWalking SkyWalking  Java Agent  SkyWalking UI SkyWalking  gRPC  HTTP  gRPC  11800 HTTP  12800  SKyWalking UI  8080 SkyWalking  ElasticSearch MySQLH2 ElasticSearch </p>\n<p>Docker</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/elasticsearch/elasticsearch:7.17.6</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9200</span><span class=\"string\">:9200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9300</span><span class=\"string\">:9300</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">discovery.type=single-node</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">bootstrap.memory_lock=true</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;ES_JAVA_OPTS=-Xms1024m -Xmx1024m&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/opt/data/dockerData/skywalking/elasticsearch/data:/usr/share/elasticsearch/data</span></span><br><span class=\"line\">    <span class=\"attr\">ulimits:</span></span><br><span class=\"line\">      <span class=\"attr\">memlock:</span></span><br><span class=\"line\">        <span class=\"attr\">soft:</span> <span class=\"number\">-1</span></span><br><span class=\"line\">        <span class=\"attr\">hard:</span> <span class=\"number\">-1</span></span><br><span class=\"line\">  <span class=\"attr\">oap:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.io/apache/skywalking-oap-server:9.4.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">oap</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">11800</span><span class=\"string\">:11800</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">12800</span><span class=\"string\">:12800</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">SW_CORE_RECORD_DATA_TTL:</span> <span class=\"number\">15</span></span><br><span class=\"line\">      <span class=\"attr\">SW_CORE_METRICS_DATA_TTL:</span> <span class=\"number\">15</span></span><br><span class=\"line\">      <span class=\"attr\">SW_STORAGE:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">      <span class=\"attr\">SW_STORAGE_ES_CLUSTER_NODES:</span> <span class=\"string\">elasticsearch:9200</span></span><br><span class=\"line\">      <span class=\"attr\">SW_ENABLE_UPDATE_UI_TEMPLATE:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">TZ:</span> <span class=\"string\">Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPTS:</span> <span class=\"string\">&quot;-Xms2048m -Xmx2048m&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">ui:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.io/apache/skywalking-ui:9.4.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">ui</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">oap</span></span><br><span class=\"line\">    <span class=\"attr\">links:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">oap</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">8080</span><span class=\"string\">:8080</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">SW_OAP_ADDRESS:</span> <span class=\"string\">http://oap:12800</span></span><br><span class=\"line\">      <span class=\"attr\">SW_ZIPKIN_ADDRESS:</span> <span class=\"string\">http://oap:9412</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p> Java </p>\n<ul>\n<li>Skywalking-Collector  11800gRPC 12800HTTP </li>\n<li>Skywalking-Webapp  SkyWalking UI 8080 ,8038</li>\n</ul>\n<p>Skywalking </p>\n<p>[<a href=\"http://127.0.0.1:8088/]%EF%BC%8C%E5%A6%82%E6%9E%9C%E7%9C%8B%E5%88%B0\">http://127.0.0.1:8088/]</a> SkyWalking UI </p>\n<p><img src=\"/typora-user-images/image-20240416113821316.png\" alt=\"image-20240416113821316\"></p>\n<h3 id=\"-SkyWalking-Java-Agent\"><a href=\"#-SkyWalking-Java-Agent\" class=\"headerlink\" title=\" SkyWalking Java Agent\"></a> SkyWalking Java Agent</h3><p>SkyWalking  JVM  Java1.5 Java Agent  Java Java Agent </p>\n<p>Java Agent  Java  javaagent </p>\n<p>Java Agent  premain  main  Java Agent </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SimpleAgent</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">premain</span><span class=\"params\">(String agentArgs, Instrumentation inst)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;=========premain============&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> Java Agent MANIFEST.MF JVM  META-INF  MANIFEST.MF </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Manifest-Version: 1.0</span><br><span class=\"line\">Premain-Class: com.lison.agent.SimpleAgent</span><br></pre></td></tr></table></figure>\n\n\n\n<p> agent.jar test-agent.jar test-agent.jar  javaagent </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -javaagent:agent.jar -jar test-agent.jar</span><br></pre></td></tr></table></figure>\n\n<p> Java </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">========= premain============</span><br><span class=\"line\"> Agent...</span><br><span class=\"line\">....</span><br></pre></td></tr></table></figure>\n\n\n\n<p>SkyWalking  Java Agent  premain  SkyWalking </p>\n<p>SkyWalking Java Agent Java Agent </p>\n<p><img src=\"/typora-user-images/image-20240415094839642.png\" alt=\"image-20240415094839642\"></p>\n<p></p>\n<p> a  a a  OpenFeign  b  b b  OpenFeign  c  c  c  JDBC  MySQL </p>\n<h4 id=\"skywalking\"><a href=\"#skywalking\" class=\"headerlink\" title=\"skywalking\"></a>skywalking</h4><p><strong>1 agent</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">agentoapagent</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong> <a href=\"https://skywalking.apache.org/downloads/\">https://skywalking.apache.org/downloads/</a></p>\n<p><strong>skywalking9.4.0v9.1.0client</strong></p>\n<p><img src=\"/typora-user-images/image-20240416114024941.png\" alt=\"image-20240416114024941\"></p>\n<p>skywalking-agentconfig&#x2F;agent.config</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">agent.service_name=$&#123;SW_AGENT_NAME:HS&#125;</span><br><span class=\"line\">collector.backend_service=$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:192.168.54.53:11800&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p><strong>2</strong></p>\n<p>skywalkingUIskywalking</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--skywalkingTraceId--&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.apache.skywalking&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;apm-toolkit-logback-1.x&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;9.1.0&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.apache.skywalking&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;apm-toolkit-trace&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;9.1.0&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>logback-spring.xmlresource</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span> <span class=\"attr\">debug</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">scan</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">springProperty</span> <span class=\"attr\">scop</span>=<span class=\"string\">&quot;context&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;spring.application.name&quot;</span> <span class=\"attr\">source</span>=<span class=\"string\">&quot;spring.application.name&quot;</span> <span class=\"attr\">defaultValue</span>=<span class=\"string\">&quot;&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;log.path&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;logs/$&#123;spring.application.name&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;CONSOLE_LOG_PATTERN&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">              <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;CONSOLE_LOG_PATTERN:-%clr(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conversionRule</span> <span class=\"attr\">conversionWord</span>=<span class=\"string\">&quot;clr&quot;</span> <span class=\"attr\">converterClass</span>=<span class=\"string\">&quot;org.springframework.boot.logging.logback.ColorConverter&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conversionRule</span> <span class=\"attr\">conversionWord</span>=<span class=\"string\">&quot;wex&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                    <span class=\"attr\">converterClass</span>=<span class=\"string\">&quot;org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conversionRule</span> <span class=\"attr\">conversionWord</span>=<span class=\"string\">&quot;wEx&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                    <span class=\"attr\">converterClass</span>=<span class=\"string\">&quot;org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Console log output --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;console&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Log file debug output --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;debug&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/debug.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/%d&#123;yyyy-MM, aux&#125;/debug.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>50MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>%date [%thread] %-5level [%logger&#123;50&#125;] %file:%line - %msg%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Log file error output --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;error&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;log.path&#125;/error.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/%d&#123;yyyy-MM&#125;/error.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class=\"tag\">&lt;/<span class=\"name\">fileNamePattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">maxFileSize</span>&gt;</span>50MB<span class=\"tag\">&lt;/<span class=\"name\">maxFileSize</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">maxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">maxHistory</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>%date [%thread] %-5level [%logger&#123;50&#125;] %file:%line - %msg%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>ERROR<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;stdout&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%tid] [%thread] %-5level %logger&#123;36&#125; -%msg%n<span class=\"tag\">&lt;/<span class=\"name\">Pattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;grpc&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.log.GRPCLogClientAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%X&#123;tid&#125;] [%thread] %-5level %logger&#123;36&#125; -%msg%n<span class=\"tag\">&lt;/<span class=\"name\">Pattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--nacos  INFO --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;com.alibaba.nacos&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;OFF&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;error&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">logger</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Level: FATAL 0  ERROR 3  WARN 4  INFO 6  DEBUG 7 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;INFO&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;appender-ref ref=&quot;console&quot;/&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;debug&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;error&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;stdout&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;grpc&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>3</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@RequestMapping(&quot;/fegin/test&quot;)</span><br><span class=\"line\">  public String feginTest() &#123;</span><br><span class=\"line\">      iTestService.getServerPort();</span><br><span class=\"line\">      log.info(&quot;message1&quot;);</span><br><span class=\"line\">      return &quot;message1&quot;;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><strong>1idea</strong></p>\n<p> VM options</p>\n<p><img src=\"/typora-user-images/image-20240416114808884.png\" alt=\"image-20240416114808884\"></p>\n<p>javaagentskywalking-agent</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-Dskywalking.agent.service_name=&quot;spring-cloud-service&quot;</span><br><span class=\"line\">-Dskywalking.collector.backend_service=&quot;opaip:11800&quot;</span><br><span class=\"line\">-javaagent:/Users/lison/work/workspace/project/skywalking-agent/skywalking-agent.jar</span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<p><img src=\"/typora-user-images/image-20240416114924463.png\" alt=\"image-20240416114924463\"></p>\n<p><img src=\"/typora-user-images/image-20240416120116317.png\" alt=\"image-20240416120116317\"></p>\n<p> API  SkyWalking </p>\n<p><img src=\"/typora-user-images/image-20240417091316659.png\" alt=\"image-20240417091316659\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240417092003988.png\" alt=\"image-20240417092003988\"></p>\n<p><strong>JVM</strong></p>\n<p><img src=\"/typora-user-images/image-20240417092118543.png\" alt=\"image-20240417092118543\"></p>\n"},{"_content":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2024.4.20`\n\n# Spring Cloud Alibaba-07-RocketMQ\n\n[toc]\n\n\n\n##  MQ\n\nMessage Queue MQMQ \n\n\n\n![image-20240507111933014](typora-user-images/image-20240507111933014.png)\n\n\n\n\n\n### MQ\n\n* \n\n  >\n  >\n  >1 \n  >\n  >2 X\n  >\n  >![image-20230627191528034](typora-user-images/image-20230627191528034.png)\n  >\n  >\n  >\n  >MQMQMQ \n  >\n  >1MQ\n  >\n  >2XMQX\n  >\n  >![image-20240507112405845](typora-user-images/image-20240507112405845.png)\n\n  \n\n  \n\n* \n\n  >\n  >\n  >![image-20230628093823674](typora-user-images/image-20230628093823674.png)\n  >\n  >\n  >\n  >MQ,\n  >\n  >![image-20230628094058045](typora-user-images/image-20230628094058045.png)\n\n  \n\n* \n\n  > 1000 5000mq\n  >\n  > ![image-20230628094428585](typora-user-images/image-20230628094428585.png)\n  >\n  > MQ1000MQ 1000 \n  >\n  > ![image-20230628094521252](typora-user-images/image-20230628094521252.png)\n  >\n  >  MQ ()\n  >    MQ\n  >\n  > :\n  >\n  > 1. \n  > 2.  MQ\n  > 3.  MQ \n  > 4. \n\n  \n\n\n\n### MQ\n\nMQ:\n\n**ZeroMQ**\n\nC socket ZeroMQdown\n\n**RabbitMQ**\n\nerlang ActiveMQ\nApacheJMS1.1spring- jms\n\n**RocketMQ**\n\nMQjava \n\n**Kafka**\n\nKafkaApachePublish/Subscribe ActiveMQ \n\n\n\n### RocketeMQ\n\n\n\nRocketMQ RocketMQ  11  RocketMQ  API \n\n\n\n![](typora-user-images/72746e97a2cd474bb21601f507779a25.png)\n\n\n\n RocketMQ  RocketMQ \n\n* Message ModelRocketMQ ProducerBrokerConsumer Producer Consumer Broker Broker  Broker TopicTopic BrokerMessage Queue Topic Message Queue ConsumerGroup Consumer \n* ProducerbrokerRocketMQBroker\n* ConsumerBroker\n* Producer GroupProducerProducerBroker\n* Consumer GroupConsumerConsumerTopicRocketMQ ClusteringBroadcasting\n* Broker ServerRocketMQ\n* Name ServerBroker IPNamesrv\n* TopicRocketMQ\n* Tag:RocketMQTag\n* Message:RocketMQMessage IDKeyMessage IDKey\n* Pull Consumer:ConsumerConsumerBroker\n* Push Consumer:ConsumerBroker\n* Clustering:,Consumer GroupConsumer\n* Broadcasting:Consumer GroupConsumer\n* Normal Ordered Message\n* Strictly Ordered Message\n\n\n\nhttps://rocketmq.apache.org/zh/docs/\n\n\n\n\n\n\n\n## RocketMQ\n\nRocketMQ http://rocketmq.apache.org/4.8.0RocketMQ  3.X  Apache Apache  MQ \n\n![image-20240507112941777](typora-user-images/image-20240507112941777.png)\n\n\n\n\n\n### RocketMQ\n\nlinuxRocketMQ, docker-compose RocketMq\n\n**docker**\n\n~~~\nmkdir rocketmq\ncd rocketmq\nmkdir data\ncd data\nmkdir -p brokerconf logs store\n~~~\n\n\n\n**rocketmqdocker-compose.yml**\n\n\n\n~~~\n\n## rocketmq\nversion: '3.8'\nservices:\n  rmqnamesrv1:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqnamesrv1\n    ports:\n      - 9876:9876\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv1/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv1/data/store:/opt/store\n    command: sh mqnamesrv  \n    networks:\n      - nt_dev\n\n  rmqnamesrv2:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqnamesrv2\n    ports:\n      - 9877:9876\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv2/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv2/data/store:/opt/store\n    command: sh mqnamesrv  \n    networks:\n      - nt_dev         \n \n\n  rmqbroker1:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqbroker1\n    ports:\n      - 10911:10911\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/data/store:/opt/store\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/brokerconf/broker.conf:/etc/rocketmq/broker.conf\n    environment:\n        NAMESRV_ADDR: \"rmqnamesrv1:9876;rmqnamesrv2:9876\"\n        JAVA_OPTS: \" -Duser.home=/opt\"\n        JAVA_OPT_EXT: \"-server -Xms128m -Xmx128m -Xmn128m\"\n    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &\n    depends_on:\n      - rmqnamesrv1\n      - rmqnamesrv2\n    networks:\n      - nt_dev \n\n\n  rmqbroker2:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqbroker2\n    ports:\n      - 10912:10911\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/data/store:/opt/store\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/brokerconf/broker.conf:/etc/rocketmq/broker.conf\n    environment:\n        NAMESRV_ADDR: \"rmqnamesrv1:9876;rmqnamesrv2:9876\"\n        JAVA_OPTS: \" -Duser.home=/opt\"\n        JAVA_OPT_EXT: \"-server -Xms128m -Xmx128m -Xmn128m\"\n    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &\n    depends_on:\n      - rmqnamesrv1\n      - rmqnamesrv2\n    networks:\n      - nt_dev \n\n  rmqbroker3:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqbroker3\n    ports:\n      - 10913:10911\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/data/store:/opt/store\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/brokerconf/broker.conf:/etc/rocketmq/broker.conf\n    environment:\n        NAMESRV_ADDR: \"rmqnamesrv1:9876;rmqnamesrv2:9876\"\n        JAVA_OPTS: \" -Duser.home=/opt\"\n        JAVA_OPT_EXT: \"-server -Xms128m -Xmx128m -Xmn128m\"\n    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &\n    depends_on:\n      - rmqnamesrv1\n      - rmqnamesrv2\n    networks:\n      - nt_dev\n\n \n  rmqconsole:\n    image: styletang/rocketmq-console-ng\n    container_name: rmqconsole\n    ports:\n      - 8080:8080\n    environment:\n        JAVA_OPTS: \"-Drocketmq.namesrv.addr=rmqnamesrv1:9876;rmqnamesrv2:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false\"\n    depends_on:\n      - rmqbroker1\n      - rmqbroker2\n      - rmqbroker3\n    networks:\n      - nt_dev\n \nnetworks:\n  nt_dev:\n    external: true\n    driver: bridge\n\n  \n~~~\n\n\n\n**brokerconfbroker.conf**\n\n\n\n\n\n/Users/lison/work/data/dockerData/rocketmq/rmqbroker1/brokerconf/broker.conf\n\n~~~\nbrokerClusterName = DefaultCluster\n#broker\nbrokerName = rmqbroker1\nbrokerId = 0\ndeleteWhen = 04\nfileReservedTime = 48\nbrokerRole = ASYNC_MASTER\nflushDiskType = ASYNC_FLUSH\n\n~~~\n\n/Users/lison/work/data/dockerData/rocketmq/rmqbroker2/brokerconf/broker.conf\n\n~~~\nbrokerClusterName = DefaultCluster\n#broker\nbrokerName = rmqbroker2\nbrokerId = 1\ndeleteWhen = 04\nfileReservedTime = 48\nbrokerRole = ASYNC_MASTER\nflushDiskType = ASYNC_FLUSH\n\n~~~\n\n\n\n/Users/lison/work/data/dockerData/rocketmq/rmqbroker3/brokerconf/broker.conf\n\n~~~\nbrokerClusterName = DefaultCluster\n#broker\nbrokerName = rmqbroker3\nbrokerId = 2\ndeleteWhen = 04\nfileReservedTime = 48\nbrokerRole = ASYNC_MASTER\nflushDiskType = ASYNC_FLUSH\n\n~~~\n\n\n\n\n\n**docker-compose**\n\n~~~\ndocker-compose up -d\n~~~\n\ndocker ps dockerip\n\n![image-20240509105505568](typora-user-images/image-20240509105505568.png)\n\n\n\n****\n\n![image-20240509105539663](typora-user-images/image-20240509105539663.png)\n\n\n\n\n\n## SpringBoot  RocketMQ\n\n1Java\n\n~~~xml\n <!-- RocketMQBroker  -->\n        <dependency>\n            <groupId>org.apache.rocketmq</groupId>\n            <artifactId>rocketmq-spring-boot-starter</artifactId>\n            <version>2.2.2</version>\n        </dependency>\n        \n <!--   \n \t\t\t<dependency>\n            <groupId>org.apache.rocketmq</groupId>\n            <artifactId>rocketmq-client</artifactId>\n            <version>4.5.2</version>\n        </dependency>-->\n        \n~~~\n\n\n\n2 application.yml\n\n\n\n~~~yaml\n#rocketmq\nrocketmq:\n  enhance:\n    # EnvironmentIsolationConfig\n    # topic\n    enabledIsolation: true\n    # topictopic_dev\n    environment: dev\n  topic: springboot-mq\n  name-server: 127.0.0.1:9876\n  # \n  producer:\n    # group\n    group: rocketmq-pro-group\n    # ,3000\n    sendMessageTimeout: 30000\n    # 2\n    retryTimesWhenSendFailed: 10\n    # 2\n    retryTimesWhenSendAsyncFailed: 10\n    #  1024*4(4M)\n    maxMessageSize: 4096\n    # brokerfalse\n    retryNextServer: false\n    # 4k(1024 * 4)\n    compressMessageBodyThreshold: 4096\n  consumer:\n    group: rocketmq-consumer-group\n~~~\n\n\n\n\n\n~~~java\npackage com.ruipeng.service;\n//\n@Slf4j\n@Service\n@RocketMQMessageListener(consumerGroup = \"rocketmq-consumer-group\", topic = \"springboot-mq\") \npublic class SmsService implements RocketMQListener<Order> { \n\t@Override \n\tpublic void onMessage(Order order) {\n\t log.info(\"{},\", JSON.toJSONString(order)); \n  }\n   } \n\n\n~~~\n\n\n\n\n\n~~~java\n//\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = OrderApplication.class)\npublic class MessageTypeTest {\n    @Autowired\n    private RocketMQTemplate rocketMQTemplate;\n\n    //\n    @Test\n    public void testSyncSend() {\n//: topic tag \"topic:tag\" //: \n        SendResult sendResult =\n                rocketMQTemplate.syncSend(\"test-topic-1\", \"\");\n        System.out.println(sendResult);\n    }\n\n    //\n    @Test\n    public void testAsyncSend() throws InterruptedException {\n        public void testSyncSendMsg () {\n//: topic, tag \"topic:tag\"\n//: \n//: ,  rocketMQTemplate.asyncSend(\"test-topic-1\", \"\", new \n            SendCallback() {\n                @Override\n                public void onSuccess (SendResult sendResult){\n                    System.out.println(sendResult);\n                }\n                @Override\n                public void onException (Throwable throwable){\n                    System.out.println(throwable);\n                }\n            });\n// Thread.sleep(30000000); \n\n        }\n    }\n\n    //\n    @Test\n    public void testOneWay() {\n        rocketMQTemplate.sendOneWay(\"test-topic-1\", \"\");\n    } \n}\n\n~~~\n\n\n\n\n\n|  |  TPS |  |    |\n| -------- | -------- | ------------ | -------- |\n|  |        |            |    |\n|  |        |            |    |\n|  |      |            |  |\n\n\n\n\n\n~~~java\n@RocketMQMessageListener(\nconsumerGroup = \"shop\",//\ntopic = \"order-topic\",//\nconsumeMode = ConsumeMode.CONCURRENTLY, //: messageModel = MessageModel.CLUSTERING, //:, \n)\npublic class SmsService implements RocketMQListener<Order> {}\n\n~~~\n\nRocketMQ:\n\n- : ,;\n- : \n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-07-RocketMQ.md","raw":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2024.4.20`\n\n# Spring Cloud Alibaba-07-RocketMQ\n\n[toc]\n\n\n\n##  MQ\n\nMessage Queue MQMQ \n\n\n\n![image-20240507111933014](typora-user-images/image-20240507111933014.png)\n\n\n\n\n\n### MQ\n\n* \n\n  >\n  >\n  >1 \n  >\n  >2 X\n  >\n  >![image-20230627191528034](typora-user-images/image-20230627191528034.png)\n  >\n  >\n  >\n  >MQMQMQ \n  >\n  >1MQ\n  >\n  >2XMQX\n  >\n  >![image-20240507112405845](typora-user-images/image-20240507112405845.png)\n\n  \n\n  \n\n* \n\n  >\n  >\n  >![image-20230628093823674](typora-user-images/image-20230628093823674.png)\n  >\n  >\n  >\n  >MQ,\n  >\n  >![image-20230628094058045](typora-user-images/image-20230628094058045.png)\n\n  \n\n* \n\n  > 1000 5000mq\n  >\n  > ![image-20230628094428585](typora-user-images/image-20230628094428585.png)\n  >\n  > MQ1000MQ 1000 \n  >\n  > ![image-20230628094521252](typora-user-images/image-20230628094521252.png)\n  >\n  >  MQ ()\n  >    MQ\n  >\n  > :\n  >\n  > 1. \n  > 2.  MQ\n  > 3.  MQ \n  > 4. \n\n  \n\n\n\n### MQ\n\nMQ:\n\n**ZeroMQ**\n\nC socket ZeroMQdown\n\n**RabbitMQ**\n\nerlang ActiveMQ\nApacheJMS1.1spring- jms\n\n**RocketMQ**\n\nMQjava \n\n**Kafka**\n\nKafkaApachePublish/Subscribe ActiveMQ \n\n\n\n### RocketeMQ\n\n\n\nRocketMQ RocketMQ  11  RocketMQ  API \n\n\n\n![](typora-user-images/72746e97a2cd474bb21601f507779a25.png)\n\n\n\n RocketMQ  RocketMQ \n\n* Message ModelRocketMQ ProducerBrokerConsumer Producer Consumer Broker Broker  Broker TopicTopic BrokerMessage Queue Topic Message Queue ConsumerGroup Consumer \n* ProducerbrokerRocketMQBroker\n* ConsumerBroker\n* Producer GroupProducerProducerBroker\n* Consumer GroupConsumerConsumerTopicRocketMQ ClusteringBroadcasting\n* Broker ServerRocketMQ\n* Name ServerBroker IPNamesrv\n* TopicRocketMQ\n* Tag:RocketMQTag\n* Message:RocketMQMessage IDKeyMessage IDKey\n* Pull Consumer:ConsumerConsumerBroker\n* Push Consumer:ConsumerBroker\n* Clustering:,Consumer GroupConsumer\n* Broadcasting:Consumer GroupConsumer\n* Normal Ordered Message\n* Strictly Ordered Message\n\n\n\nhttps://rocketmq.apache.org/zh/docs/\n\n\n\n\n\n\n\n## RocketMQ\n\nRocketMQ http://rocketmq.apache.org/4.8.0RocketMQ  3.X  Apache Apache  MQ \n\n![image-20240507112941777](typora-user-images/image-20240507112941777.png)\n\n\n\n\n\n### RocketMQ\n\nlinuxRocketMQ, docker-compose RocketMq\n\n**docker**\n\n~~~\nmkdir rocketmq\ncd rocketmq\nmkdir data\ncd data\nmkdir -p brokerconf logs store\n~~~\n\n\n\n**rocketmqdocker-compose.yml**\n\n\n\n~~~\n\n## rocketmq\nversion: '3.8'\nservices:\n  rmqnamesrv1:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqnamesrv1\n    ports:\n      - 9876:9876\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv1/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv1/data/store:/opt/store\n    command: sh mqnamesrv  \n    networks:\n      - nt_dev\n\n  rmqnamesrv2:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqnamesrv2\n    ports:\n      - 9877:9876\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv2/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv2/data/store:/opt/store\n    command: sh mqnamesrv  \n    networks:\n      - nt_dev         \n \n\n  rmqbroker1:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqbroker1\n    ports:\n      - 10911:10911\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/data/store:/opt/store\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/brokerconf/broker.conf:/etc/rocketmq/broker.conf\n    environment:\n        NAMESRV_ADDR: \"rmqnamesrv1:9876;rmqnamesrv2:9876\"\n        JAVA_OPTS: \" -Duser.home=/opt\"\n        JAVA_OPT_EXT: \"-server -Xms128m -Xmx128m -Xmn128m\"\n    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &\n    depends_on:\n      - rmqnamesrv1\n      - rmqnamesrv2\n    networks:\n      - nt_dev \n\n\n  rmqbroker2:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqbroker2\n    ports:\n      - 10912:10911\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/data/store:/opt/store\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/brokerconf/broker.conf:/etc/rocketmq/broker.conf\n    environment:\n        NAMESRV_ADDR: \"rmqnamesrv1:9876;rmqnamesrv2:9876\"\n        JAVA_OPTS: \" -Duser.home=/opt\"\n        JAVA_OPT_EXT: \"-server -Xms128m -Xmx128m -Xmn128m\"\n    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &\n    depends_on:\n      - rmqnamesrv1\n      - rmqnamesrv2\n    networks:\n      - nt_dev \n\n  rmqbroker3:\n    image: apache/rocketmq:4.9.3\n    container_name: rmqbroker3\n    ports:\n      - 10913:10911\n    volumes:\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/data/logs:/opt/logs\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/data/store:/opt/store\n      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/brokerconf/broker.conf:/etc/rocketmq/broker.conf\n    environment:\n        NAMESRV_ADDR: \"rmqnamesrv1:9876;rmqnamesrv2:9876\"\n        JAVA_OPTS: \" -Duser.home=/opt\"\n        JAVA_OPT_EXT: \"-server -Xms128m -Xmx128m -Xmn128m\"\n    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &\n    depends_on:\n      - rmqnamesrv1\n      - rmqnamesrv2\n    networks:\n      - nt_dev\n\n \n  rmqconsole:\n    image: styletang/rocketmq-console-ng\n    container_name: rmqconsole\n    ports:\n      - 8080:8080\n    environment:\n        JAVA_OPTS: \"-Drocketmq.namesrv.addr=rmqnamesrv1:9876;rmqnamesrv2:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false\"\n    depends_on:\n      - rmqbroker1\n      - rmqbroker2\n      - rmqbroker3\n    networks:\n      - nt_dev\n \nnetworks:\n  nt_dev:\n    external: true\n    driver: bridge\n\n  \n~~~\n\n\n\n**brokerconfbroker.conf**\n\n\n\n\n\n/Users/lison/work/data/dockerData/rocketmq/rmqbroker1/brokerconf/broker.conf\n\n~~~\nbrokerClusterName = DefaultCluster\n#broker\nbrokerName = rmqbroker1\nbrokerId = 0\ndeleteWhen = 04\nfileReservedTime = 48\nbrokerRole = ASYNC_MASTER\nflushDiskType = ASYNC_FLUSH\n\n~~~\n\n/Users/lison/work/data/dockerData/rocketmq/rmqbroker2/brokerconf/broker.conf\n\n~~~\nbrokerClusterName = DefaultCluster\n#broker\nbrokerName = rmqbroker2\nbrokerId = 1\ndeleteWhen = 04\nfileReservedTime = 48\nbrokerRole = ASYNC_MASTER\nflushDiskType = ASYNC_FLUSH\n\n~~~\n\n\n\n/Users/lison/work/data/dockerData/rocketmq/rmqbroker3/brokerconf/broker.conf\n\n~~~\nbrokerClusterName = DefaultCluster\n#broker\nbrokerName = rmqbroker3\nbrokerId = 2\ndeleteWhen = 04\nfileReservedTime = 48\nbrokerRole = ASYNC_MASTER\nflushDiskType = ASYNC_FLUSH\n\n~~~\n\n\n\n\n\n**docker-compose**\n\n~~~\ndocker-compose up -d\n~~~\n\ndocker ps dockerip\n\n![image-20240509105505568](typora-user-images/image-20240509105505568.png)\n\n\n\n****\n\n![image-20240509105539663](typora-user-images/image-20240509105539663.png)\n\n\n\n\n\n## SpringBoot  RocketMQ\n\n1Java\n\n~~~xml\n <!-- RocketMQBroker  -->\n        <dependency>\n            <groupId>org.apache.rocketmq</groupId>\n            <artifactId>rocketmq-spring-boot-starter</artifactId>\n            <version>2.2.2</version>\n        </dependency>\n        \n <!--   \n \t\t\t<dependency>\n            <groupId>org.apache.rocketmq</groupId>\n            <artifactId>rocketmq-client</artifactId>\n            <version>4.5.2</version>\n        </dependency>-->\n        \n~~~\n\n\n\n2 application.yml\n\n\n\n~~~yaml\n#rocketmq\nrocketmq:\n  enhance:\n    # EnvironmentIsolationConfig\n    # topic\n    enabledIsolation: true\n    # topictopic_dev\n    environment: dev\n  topic: springboot-mq\n  name-server: 127.0.0.1:9876\n  # \n  producer:\n    # group\n    group: rocketmq-pro-group\n    # ,3000\n    sendMessageTimeout: 30000\n    # 2\n    retryTimesWhenSendFailed: 10\n    # 2\n    retryTimesWhenSendAsyncFailed: 10\n    #  1024*4(4M)\n    maxMessageSize: 4096\n    # brokerfalse\n    retryNextServer: false\n    # 4k(1024 * 4)\n    compressMessageBodyThreshold: 4096\n  consumer:\n    group: rocketmq-consumer-group\n~~~\n\n\n\n\n\n~~~java\npackage com.ruipeng.service;\n//\n@Slf4j\n@Service\n@RocketMQMessageListener(consumerGroup = \"rocketmq-consumer-group\", topic = \"springboot-mq\") \npublic class SmsService implements RocketMQListener<Order> { \n\t@Override \n\tpublic void onMessage(Order order) {\n\t log.info(\"{},\", JSON.toJSONString(order)); \n  }\n   } \n\n\n~~~\n\n\n\n\n\n~~~java\n//\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = OrderApplication.class)\npublic class MessageTypeTest {\n    @Autowired\n    private RocketMQTemplate rocketMQTemplate;\n\n    //\n    @Test\n    public void testSyncSend() {\n//: topic tag \"topic:tag\" //: \n        SendResult sendResult =\n                rocketMQTemplate.syncSend(\"test-topic-1\", \"\");\n        System.out.println(sendResult);\n    }\n\n    //\n    @Test\n    public void testAsyncSend() throws InterruptedException {\n        public void testSyncSendMsg () {\n//: topic, tag \"topic:tag\"\n//: \n//: ,  rocketMQTemplate.asyncSend(\"test-topic-1\", \"\", new \n            SendCallback() {\n                @Override\n                public void onSuccess (SendResult sendResult){\n                    System.out.println(sendResult);\n                }\n                @Override\n                public void onException (Throwable throwable){\n                    System.out.println(throwable);\n                }\n            });\n// Thread.sleep(30000000); \n\n        }\n    }\n\n    //\n    @Test\n    public void testOneWay() {\n        rocketMQTemplate.sendOneWay(\"test-topic-1\", \"\");\n    } \n}\n\n~~~\n\n\n\n\n\n|  |  TPS |  |    |\n| -------- | -------- | ------------ | -------- |\n|  |        |            |    |\n|  |        |            |    |\n|  |      |            |  |\n\n\n\n\n\n~~~java\n@RocketMQMessageListener(\nconsumerGroup = \"shop\",//\ntopic = \"order-topic\",//\nconsumeMode = ConsumeMode.CONCURRENTLY, //: messageModel = MessageModel.CLUSTERING, //:, \n)\npublic class SmsService implements RocketMQListener<Order> {}\n\n~~~\n\nRocketMQ:\n\n- : ,;\n- : \n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-07-RocketMQ","published":1,"date":"2024-04-08T01:27:09.194Z","updated":"2024-05-14T01:07:13.826Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhn0008ecfy311lar40","content":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2024.4.20</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-07-RocketMQ\"><a href=\"#Spring-Cloud-Alibaba-07-RocketMQ\" class=\"headerlink\" title=\"Spring Cloud Alibaba-07-RocketMQ\"></a>Spring Cloud Alibaba-07-RocketMQ</h1><p>[toc]</p>\n<h2 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h2><p>Message Queue MQMQ </p>\n<p><img src=\"/typora-user-images/image-20240507111933014.png\" alt=\"image-20240507111933014\"></p>\n<h3 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h3><ul>\n<li><p></p>\n<blockquote>\n<p></p>\n<p>1 </p>\n<p>2 X</p>\n<p><img src=\"/typora-user-images/image-20230627191528034.png\" alt=\"image-20230627191528034\"></p>\n<p>MQMQMQ </p>\n<p>1MQ</p>\n<p>2XMQX</p>\n<p><img src=\"/typora-user-images/image-20240507112405845.png\" alt=\"image-20240507112405845\"></p>\n</blockquote>\n</li>\n<li><p></p>\n<blockquote>\n<p></p>\n<p><img src=\"/typora-user-images/image-20230628093823674.png\" alt=\"image-20230628093823674\"></p>\n<p>MQ,</p>\n<p><img src=\"/typora-user-images/image-20230628094058045.png\" alt=\"image-20230628094058045\"></p>\n</blockquote>\n</li>\n<li><p></p>\n<blockquote>\n<p>1000 5000mq</p>\n<p><img src=\"/typora-user-images/image-20230628094428585.png\" alt=\"image-20230628094428585\"></p>\n<p>MQ1000MQ 1000 </p>\n<p><img src=\"/typora-user-images/image-20230628094521252.png\" alt=\"image-20230628094521252\"></p>\n<p> MQ ()<br>   MQ</p>\n<p>:</p>\n<ol>\n<li></li>\n<li> MQ</li>\n<li> MQ </li>\n<li></li>\n</ol>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h3><p>MQ:</p>\n<p><strong>ZeroMQ</strong></p>\n<p>C socket ZeroMQdown</p>\n<p><strong>RabbitMQ</strong></p>\n<p>erlang ActiveMQ<br>ApacheJMS1.1spring- jms</p>\n<p><strong>RocketMQ</strong></p>\n<p>MQjava </p>\n<p><strong>Kafka</strong></p>\n<p>KafkaApachePublish&#x2F;Subscribe ActiveMQ </p>\n<h3 id=\"RocketeMQ\"><a href=\"#RocketeMQ\" class=\"headerlink\" title=\"RocketeMQ\"></a>RocketeMQ</h3><p>RocketMQ RocketMQ  11  RocketMQ  API </p>\n<p><img src=\"/typora-user-images/72746e97a2cd474bb21601f507779a25.png\" alt=\"\"></p>\n<p> RocketMQ  RocketMQ </p>\n<ul>\n<li>Message ModelRocketMQ ProducerBrokerConsumer Producer Consumer Broker Broker  Broker TopicTopic BrokerMessage Queue Topic Message Queue ConsumerGroup Consumer </li>\n<li>ProducerbrokerRocketMQBroker</li>\n<li>ConsumerBroker</li>\n<li>Producer GroupProducerProducerBroker</li>\n<li>Consumer GroupConsumerConsumerTopicRocketMQ ClusteringBroadcasting</li>\n<li>Broker ServerRocketMQ</li>\n<li>Name ServerBroker IPNamesrv</li>\n<li>TopicRocketMQ</li>\n<li>Tag:RocketMQTag</li>\n<li>Message:RocketMQMessage IDKeyMessage IDKey</li>\n<li>Pull Consumer:ConsumerConsumerBroker</li>\n<li>Push Consumer:ConsumerBroker</li>\n<li>Clustering:,Consumer GroupConsumer</li>\n<li>Broadcasting:Consumer GroupConsumer</li>\n<li>Normal Ordered Message</li>\n<li>Strictly Ordered Message</li>\n</ul>\n<p><a href=\"https://rocketmq.apache.org/zh/docs/\">https://rocketmq.apache.org/zh/docs/</a></p>\n<h2 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h2><p>RocketMQ <a href=\"http://rocketmq.apache.org/%EF%BC%8C%E7%9B%AE%E5%89%8D%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%B8%BA4.8.0%E3%80%82RocketMQ\">http://rocketmq.apache.org/4.8.0RocketMQ</a>  3.X  Apache Apache  MQ </p>\n<p><img src=\"/typora-user-images/image-20240507112941777.png\" alt=\"image-20240507112941777\"></p>\n<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>linuxRocketMQ, docker-compose RocketMq</p>\n<p><strong>docker</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir rocketmq</span><br><span class=\"line\">cd rocketmq</span><br><span class=\"line\">mkdir data</span><br><span class=\"line\">cd data</span><br><span class=\"line\">mkdir -p brokerconf logs store</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>rocketmqdocker-compose.yml</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">## rocketmq</span><br><span class=\"line\">version: &#x27;3.8&#x27;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  rmqnamesrv1:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqnamesrv1</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 9876:9876</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv1/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv1/data/store:/opt/store</span><br><span class=\"line\">    command: sh mqnamesrv  </span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev</span><br><span class=\"line\"></span><br><span class=\"line\">  rmqnamesrv2:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqnamesrv2</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 9877:9876</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv2/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv2/data/store:/opt/store</span><br><span class=\"line\">    command: sh mqnamesrv  </span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev         </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">  rmqbroker1:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqbroker1</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 10911:10911</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/data/store:/opt/store</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/brokerconf/broker.conf:/etc/rocketmq/broker.conf</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        NAMESRV_ADDR: &quot;rmqnamesrv1:9876;rmqnamesrv2:9876&quot;</span><br><span class=\"line\">        JAVA_OPTS: &quot; -Duser.home=/opt&quot;</span><br><span class=\"line\">        JAVA_OPT_EXT: &quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br><span class=\"line\">    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &amp;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - rmqnamesrv1</span><br><span class=\"line\">      - rmqnamesrv2</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  rmqbroker2:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqbroker2</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 10912:10911</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/data/store:/opt/store</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/brokerconf/broker.conf:/etc/rocketmq/broker.conf</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        NAMESRV_ADDR: &quot;rmqnamesrv1:9876;rmqnamesrv2:9876&quot;</span><br><span class=\"line\">        JAVA_OPTS: &quot; -Duser.home=/opt&quot;</span><br><span class=\"line\">        JAVA_OPT_EXT: &quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br><span class=\"line\">    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &amp;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - rmqnamesrv1</span><br><span class=\"line\">      - rmqnamesrv2</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev </span><br><span class=\"line\"></span><br><span class=\"line\">  rmqbroker3:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqbroker3</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 10913:10911</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/data/store:/opt/store</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/brokerconf/broker.conf:/etc/rocketmq/broker.conf</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        NAMESRV_ADDR: &quot;rmqnamesrv1:9876;rmqnamesrv2:9876&quot;</span><br><span class=\"line\">        JAVA_OPTS: &quot; -Duser.home=/opt&quot;</span><br><span class=\"line\">        JAVA_OPT_EXT: &quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br><span class=\"line\">    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &amp;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - rmqnamesrv1</span><br><span class=\"line\">      - rmqnamesrv2</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">  rmqconsole:</span><br><span class=\"line\">    image: styletang/rocketmq-console-ng</span><br><span class=\"line\">    container_name: rmqconsole</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 8080:8080</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        JAVA_OPTS: &quot;-Drocketmq.namesrv.addr=rmqnamesrv1:9876;rmqnamesrv2:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&quot;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - rmqbroker1</span><br><span class=\"line\">      - rmqbroker2</span><br><span class=\"line\">      - rmqbroker3</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev</span><br><span class=\"line\"> </span><br><span class=\"line\">networks:</span><br><span class=\"line\">  nt_dev:</span><br><span class=\"line\">    external: true</span><br><span class=\"line\">    driver: bridge</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>brokerconfbroker.conf</strong></p>\n<p></p>\n<p>&#x2F;Users&#x2F;lison&#x2F;work&#x2F;data&#x2F;dockerData&#x2F;rocketmq&#x2F;rmqbroker1&#x2F;brokerconf&#x2F;broker.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName = DefaultCluster</span><br><span class=\"line\">#broker</span><br><span class=\"line\">brokerName = rmqbroker1</span><br><span class=\"line\">brokerId = 0</span><br><span class=\"line\">deleteWhen = 04</span><br><span class=\"line\">fileReservedTime = 48</span><br><span class=\"line\">brokerRole = ASYNC_MASTER</span><br><span class=\"line\">flushDiskType = ASYNC_FLUSH</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;Users&#x2F;lison&#x2F;work&#x2F;data&#x2F;dockerData&#x2F;rocketmq&#x2F;rmqbroker2&#x2F;brokerconf&#x2F;broker.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName = DefaultCluster</span><br><span class=\"line\">#broker</span><br><span class=\"line\">brokerName = rmqbroker2</span><br><span class=\"line\">brokerId = 1</span><br><span class=\"line\">deleteWhen = 04</span><br><span class=\"line\">fileReservedTime = 48</span><br><span class=\"line\">brokerRole = ASYNC_MASTER</span><br><span class=\"line\">flushDiskType = ASYNC_FLUSH</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>&#x2F;Users&#x2F;lison&#x2F;work&#x2F;data&#x2F;dockerData&#x2F;rocketmq&#x2F;rmqbroker3&#x2F;brokerconf&#x2F;broker.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName = DefaultCluster</span><br><span class=\"line\">#broker</span><br><span class=\"line\">brokerName = rmqbroker3</span><br><span class=\"line\">brokerId = 2</span><br><span class=\"line\">deleteWhen = 04</span><br><span class=\"line\">fileReservedTime = 48</span><br><span class=\"line\">brokerRole = ASYNC_MASTER</span><br><span class=\"line\">flushDiskType = ASYNC_FLUSH</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><strong>docker-compose</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n<p>docker ps dockerip</p>\n<p><img src=\"/typora-user-images/image-20240509105505568.png\" alt=\"image-20240509105505568\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20240509105539663.png\" alt=\"image-20240509105539663\"></p>\n<h2 id=\"SpringBoot--RocketMQ\"><a href=\"#SpringBoot--RocketMQ\" class=\"headerlink\" title=\"SpringBoot  RocketMQ\"></a>SpringBoot  RocketMQ</h2><p>1Java</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- RocketMQBroker  --&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.rocketmq<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>rocketmq-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       </span><br><span class=\"line\"><span class=\"comment\">&lt;!--   </span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;dependency&gt;</span></span><br><span class=\"line\"><span class=\"comment\">           &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">           &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">           &lt;version&gt;4.5.2&lt;/version&gt;</span></span><br><span class=\"line\"><span class=\"comment\">       &lt;/dependency&gt;--&gt;</span></span><br><span class=\"line\">       </span><br></pre></td></tr></table></figure>\n\n\n\n<p>2 application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#rocketmq</span></span><br><span class=\"line\"><span class=\"attr\">rocketmq:</span></span><br><span class=\"line\">  <span class=\"attr\">enhance:</span></span><br><span class=\"line\">    <span class=\"comment\"># EnvironmentIsolationConfig</span></span><br><span class=\"line\">    <span class=\"comment\"># topic</span></span><br><span class=\"line\">    <span class=\"attr\">enabledIsolation:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\"># topictopic_dev</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span> <span class=\"string\">dev</span></span><br><span class=\"line\">  <span class=\"attr\">topic:</span> <span class=\"string\">springboot-mq</span></span><br><span class=\"line\">  <span class=\"attr\">name-server:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:9876</span></span><br><span class=\"line\">  <span class=\"comment\"># </span></span><br><span class=\"line\">  <span class=\"attr\">producer:</span></span><br><span class=\"line\">    <span class=\"comment\"># group</span></span><br><span class=\"line\">    <span class=\"attr\">group:</span> <span class=\"string\">rocketmq-pro-group</span></span><br><span class=\"line\">    <span class=\"comment\"># ,3000</span></span><br><span class=\"line\">    <span class=\"attr\">sendMessageTimeout:</span> <span class=\"number\">30000</span></span><br><span class=\"line\">    <span class=\"comment\"># 2</span></span><br><span class=\"line\">    <span class=\"attr\">retryTimesWhenSendFailed:</span> <span class=\"number\">10</span></span><br><span class=\"line\">    <span class=\"comment\"># 2</span></span><br><span class=\"line\">    <span class=\"attr\">retryTimesWhenSendAsyncFailed:</span> <span class=\"number\">10</span></span><br><span class=\"line\">    <span class=\"comment\">#  1024*4(4M)</span></span><br><span class=\"line\">    <span class=\"attr\">maxMessageSize:</span> <span class=\"number\">4096</span></span><br><span class=\"line\">    <span class=\"comment\"># brokerfalse</span></span><br><span class=\"line\">    <span class=\"attr\">retryNextServer:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"comment\"># 4k(1024 * 4)</span></span><br><span class=\"line\">    <span class=\"attr\">compressMessageBodyThreshold:</span> <span class=\"number\">4096</span></span><br><span class=\"line\">  <span class=\"attr\">consumer:</span></span><br><span class=\"line\">    <span class=\"attr\">group:</span> <span class=\"string\">rocketmq-consumer-group</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ruipeng.service;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@RocketMQMessageListener(consumerGroup = &quot;rocketmq-consumer-group&quot;, topic = &quot;springboot-mq&quot;)</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SmsService</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">RocketMQListener</span>&lt;Order&gt; &#123; </span><br><span class=\"line\">\t<span class=\"meta\">@Override</span> </span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onMessage</span><span class=\"params\">(Order order)</span> &#123;</span><br><span class=\"line\">\t log.info(<span class=\"string\">&quot;&#123;&#125;,&quot;</span>, JSON.toJSONString(order)); </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">   &#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@RunWith(SpringRunner.class)</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest(classes = OrderApplication.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MessageTypeTest</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RocketMQTemplate rocketMQTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testSyncSend</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"><span class=\"comment\">//: topic tag &quot;topic:tag&quot; //: </span></span><br><span class=\"line\">        <span class=\"type\">SendResult</span> <span class=\"variable\">sendResult</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                rocketMQTemplate.syncSend(<span class=\"string\">&quot;test-topic-1&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        System.out.println(sendResult);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testAsyncSend</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testSyncSendMsg</span> <span class=\"params\">()</span> &#123;</span><br><span class=\"line\"><span class=\"comment\">//: topic, tag &quot;topic:tag&quot;</span></span><br><span class=\"line\"><span class=\"comment\">//: </span></span><br><span class=\"line\"><span class=\"comment\">//: ,  rocketMQTemplate.asyncSend(&quot;test-topic-1&quot;, &quot;&quot;, new </span></span><br><span class=\"line\">            SendCallback() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span> <span class=\"params\">(SendResult sendResult)</span>&#123;</span><br><span class=\"line\">                    System.out.println(sendResult);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onException</span> <span class=\"params\">(Throwable throwable)</span>&#123;</span><br><span class=\"line\">                    System.out.println(throwable);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"><span class=\"comment\">// Thread.sleep(30000000); </span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testOneWay</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        rocketMQTemplate.sendOneWay(<span class=\"string\">&quot;test-topic-1&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th> TPS</th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RocketMQMessageListener(</span></span><br><span class=\"line\"><span class=\"meta\">consumerGroup = &quot;shop&quot;,//</span></span><br><span class=\"line\"><span class=\"meta\">topic = &quot;order-topic&quot;,//</span></span><br><span class=\"line\"><span class=\"meta\">consumeMode = ConsumeMode.CONCURRENTLY, //: messageModel = MessageModel.CLUSTERING, //:, </span></span><br><span class=\"line\"><span class=\"meta\">)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SmsService</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">RocketMQListener</span>&lt;Order&gt; &#123;&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RocketMQ:</p>\n<ul>\n<li>: ,;</li>\n<li>: </li>\n</ul>\n","excerpt":"","more":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2024.4.20</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-07-RocketMQ\"><a href=\"#Spring-Cloud-Alibaba-07-RocketMQ\" class=\"headerlink\" title=\"Spring Cloud Alibaba-07-RocketMQ\"></a>Spring Cloud Alibaba-07-RocketMQ</h1><p>[toc]</p>\n<h2 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h2><p>Message Queue MQMQ </p>\n<p><img src=\"/typora-user-images/image-20240507111933014.png\" alt=\"image-20240507111933014\"></p>\n<h3 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h3><ul>\n<li><p></p>\n<blockquote>\n<p></p>\n<p>1 </p>\n<p>2 X</p>\n<p><img src=\"/typora-user-images/image-20230627191528034.png\" alt=\"image-20230627191528034\"></p>\n<p>MQMQMQ </p>\n<p>1MQ</p>\n<p>2XMQX</p>\n<p><img src=\"/typora-user-images/image-20240507112405845.png\" alt=\"image-20240507112405845\"></p>\n</blockquote>\n</li>\n<li><p></p>\n<blockquote>\n<p></p>\n<p><img src=\"/typora-user-images/image-20230628093823674.png\" alt=\"image-20230628093823674\"></p>\n<p>MQ,</p>\n<p><img src=\"/typora-user-images/image-20230628094058045.png\" alt=\"image-20230628094058045\"></p>\n</blockquote>\n</li>\n<li><p></p>\n<blockquote>\n<p>1000 5000mq</p>\n<p><img src=\"/typora-user-images/image-20230628094428585.png\" alt=\"image-20230628094428585\"></p>\n<p>MQ1000MQ 1000 </p>\n<p><img src=\"/typora-user-images/image-20230628094521252.png\" alt=\"image-20230628094521252\"></p>\n<p> MQ ()<br>   MQ</p>\n<p>:</p>\n<ol>\n<li></li>\n<li> MQ</li>\n<li> MQ </li>\n<li></li>\n</ol>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"MQ\"><a href=\"#MQ\" class=\"headerlink\" title=\"MQ\"></a>MQ</h3><p>MQ:</p>\n<p><strong>ZeroMQ</strong></p>\n<p>C socket ZeroMQdown</p>\n<p><strong>RabbitMQ</strong></p>\n<p>erlang ActiveMQ<br>ApacheJMS1.1spring- jms</p>\n<p><strong>RocketMQ</strong></p>\n<p>MQjava </p>\n<p><strong>Kafka</strong></p>\n<p>KafkaApachePublish&#x2F;Subscribe ActiveMQ </p>\n<h3 id=\"RocketeMQ\"><a href=\"#RocketeMQ\" class=\"headerlink\" title=\"RocketeMQ\"></a>RocketeMQ</h3><p>RocketMQ RocketMQ  11  RocketMQ  API </p>\n<p><img src=\"/typora-user-images/72746e97a2cd474bb21601f507779a25.png\" alt=\"\"></p>\n<p> RocketMQ  RocketMQ </p>\n<ul>\n<li>Message ModelRocketMQ ProducerBrokerConsumer Producer Consumer Broker Broker  Broker TopicTopic BrokerMessage Queue Topic Message Queue ConsumerGroup Consumer </li>\n<li>ProducerbrokerRocketMQBroker</li>\n<li>ConsumerBroker</li>\n<li>Producer GroupProducerProducerBroker</li>\n<li>Consumer GroupConsumerConsumerTopicRocketMQ ClusteringBroadcasting</li>\n<li>Broker ServerRocketMQ</li>\n<li>Name ServerBroker IPNamesrv</li>\n<li>TopicRocketMQ</li>\n<li>Tag:RocketMQTag</li>\n<li>Message:RocketMQMessage IDKeyMessage IDKey</li>\n<li>Pull Consumer:ConsumerConsumerBroker</li>\n<li>Push Consumer:ConsumerBroker</li>\n<li>Clustering:,Consumer GroupConsumer</li>\n<li>Broadcasting:Consumer GroupConsumer</li>\n<li>Normal Ordered Message</li>\n<li>Strictly Ordered Message</li>\n</ul>\n<p><a href=\"https://rocketmq.apache.org/zh/docs/\">https://rocketmq.apache.org/zh/docs/</a></p>\n<h2 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h2><p>RocketMQ <a href=\"http://rocketmq.apache.org/%EF%BC%8C%E7%9B%AE%E5%89%8D%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%B8%BA4.8.0%E3%80%82RocketMQ\">http://rocketmq.apache.org/4.8.0RocketMQ</a>  3.X  Apache Apache  MQ </p>\n<p><img src=\"/typora-user-images/image-20240507112941777.png\" alt=\"image-20240507112941777\"></p>\n<h3 id=\"RocketMQ\"><a href=\"#RocketMQ\" class=\"headerlink\" title=\"RocketMQ\"></a>RocketMQ</h3><p>linuxRocketMQ, docker-compose RocketMq</p>\n<p><strong>docker</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir rocketmq</span><br><span class=\"line\">cd rocketmq</span><br><span class=\"line\">mkdir data</span><br><span class=\"line\">cd data</span><br><span class=\"line\">mkdir -p brokerconf logs store</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>rocketmqdocker-compose.yml</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">## rocketmq</span><br><span class=\"line\">version: &#x27;3.8&#x27;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  rmqnamesrv1:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqnamesrv1</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 9876:9876</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv1/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv1/data/store:/opt/store</span><br><span class=\"line\">    command: sh mqnamesrv  </span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev</span><br><span class=\"line\"></span><br><span class=\"line\">  rmqnamesrv2:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqnamesrv2</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 9877:9876</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv2/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqnamesrv2/data/store:/opt/store</span><br><span class=\"line\">    command: sh mqnamesrv  </span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev         </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">  rmqbroker1:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqbroker1</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 10911:10911</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/data/store:/opt/store</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker1/brokerconf/broker.conf:/etc/rocketmq/broker.conf</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        NAMESRV_ADDR: &quot;rmqnamesrv1:9876;rmqnamesrv2:9876&quot;</span><br><span class=\"line\">        JAVA_OPTS: &quot; -Duser.home=/opt&quot;</span><br><span class=\"line\">        JAVA_OPT_EXT: &quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br><span class=\"line\">    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &amp;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - rmqnamesrv1</span><br><span class=\"line\">      - rmqnamesrv2</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  rmqbroker2:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqbroker2</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 10912:10911</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/data/store:/opt/store</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker2/brokerconf/broker.conf:/etc/rocketmq/broker.conf</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        NAMESRV_ADDR: &quot;rmqnamesrv1:9876;rmqnamesrv2:9876&quot;</span><br><span class=\"line\">        JAVA_OPTS: &quot; -Duser.home=/opt&quot;</span><br><span class=\"line\">        JAVA_OPT_EXT: &quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br><span class=\"line\">    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &amp;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - rmqnamesrv1</span><br><span class=\"line\">      - rmqnamesrv2</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev </span><br><span class=\"line\"></span><br><span class=\"line\">  rmqbroker3:</span><br><span class=\"line\">    image: apache/rocketmq:4.9.3</span><br><span class=\"line\">    container_name: rmqbroker3</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 10913:10911</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/data/logs:/opt/logs</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/data/store:/opt/store</span><br><span class=\"line\">      - /Users/lison/work/data/dockerData/rocketmq/rmqbroker3/brokerconf/broker.conf:/etc/rocketmq/broker.conf</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        NAMESRV_ADDR: &quot;rmqnamesrv1:9876;rmqnamesrv2:9876&quot;</span><br><span class=\"line\">        JAVA_OPTS: &quot; -Duser.home=/opt&quot;</span><br><span class=\"line\">        JAVA_OPT_EXT: &quot;-server -Xms128m -Xmx128m -Xmn128m&quot;</span><br><span class=\"line\">    command: sh mqbroker -c /etc/rocketmq/broker.conf autoCreateTopicEnable=true &amp;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - rmqnamesrv1</span><br><span class=\"line\">      - rmqnamesrv2</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">  rmqconsole:</span><br><span class=\"line\">    image: styletang/rocketmq-console-ng</span><br><span class=\"line\">    container_name: rmqconsole</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 8080:8080</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">        JAVA_OPTS: &quot;-Drocketmq.namesrv.addr=rmqnamesrv1:9876;rmqnamesrv2:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&quot;</span><br><span class=\"line\">    depends_on:</span><br><span class=\"line\">      - rmqbroker1</span><br><span class=\"line\">      - rmqbroker2</span><br><span class=\"line\">      - rmqbroker3</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - nt_dev</span><br><span class=\"line\"> </span><br><span class=\"line\">networks:</span><br><span class=\"line\">  nt_dev:</span><br><span class=\"line\">    external: true</span><br><span class=\"line\">    driver: bridge</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>brokerconfbroker.conf</strong></p>\n<p></p>\n<p>&#x2F;Users&#x2F;lison&#x2F;work&#x2F;data&#x2F;dockerData&#x2F;rocketmq&#x2F;rmqbroker1&#x2F;brokerconf&#x2F;broker.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName = DefaultCluster</span><br><span class=\"line\">#broker</span><br><span class=\"line\">brokerName = rmqbroker1</span><br><span class=\"line\">brokerId = 0</span><br><span class=\"line\">deleteWhen = 04</span><br><span class=\"line\">fileReservedTime = 48</span><br><span class=\"line\">brokerRole = ASYNC_MASTER</span><br><span class=\"line\">flushDiskType = ASYNC_FLUSH</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;Users&#x2F;lison&#x2F;work&#x2F;data&#x2F;dockerData&#x2F;rocketmq&#x2F;rmqbroker2&#x2F;brokerconf&#x2F;broker.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName = DefaultCluster</span><br><span class=\"line\">#broker</span><br><span class=\"line\">brokerName = rmqbroker2</span><br><span class=\"line\">brokerId = 1</span><br><span class=\"line\">deleteWhen = 04</span><br><span class=\"line\">fileReservedTime = 48</span><br><span class=\"line\">brokerRole = ASYNC_MASTER</span><br><span class=\"line\">flushDiskType = ASYNC_FLUSH</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>&#x2F;Users&#x2F;lison&#x2F;work&#x2F;data&#x2F;dockerData&#x2F;rocketmq&#x2F;rmqbroker3&#x2F;brokerconf&#x2F;broker.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName = DefaultCluster</span><br><span class=\"line\">#broker</span><br><span class=\"line\">brokerName = rmqbroker3</span><br><span class=\"line\">brokerId = 2</span><br><span class=\"line\">deleteWhen = 04</span><br><span class=\"line\">fileReservedTime = 48</span><br><span class=\"line\">brokerRole = ASYNC_MASTER</span><br><span class=\"line\">flushDiskType = ASYNC_FLUSH</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><strong>docker-compose</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n<p>docker ps dockerip</p>\n<p><img src=\"/typora-user-images/image-20240509105505568.png\" alt=\"image-20240509105505568\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20240509105539663.png\" alt=\"image-20240509105539663\"></p>\n<h2 id=\"SpringBoot--RocketMQ\"><a href=\"#SpringBoot--RocketMQ\" class=\"headerlink\" title=\"SpringBoot  RocketMQ\"></a>SpringBoot  RocketMQ</h2><p>1Java</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- RocketMQBroker  --&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.rocketmq<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>rocketmq-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       </span><br><span class=\"line\"><span class=\"comment\">&lt;!--   </span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;dependency&gt;</span></span><br><span class=\"line\"><span class=\"comment\">           &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">           &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">           &lt;version&gt;4.5.2&lt;/version&gt;</span></span><br><span class=\"line\"><span class=\"comment\">       &lt;/dependency&gt;--&gt;</span></span><br><span class=\"line\">       </span><br></pre></td></tr></table></figure>\n\n\n\n<p>2 application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#rocketmq</span></span><br><span class=\"line\"><span class=\"attr\">rocketmq:</span></span><br><span class=\"line\">  <span class=\"attr\">enhance:</span></span><br><span class=\"line\">    <span class=\"comment\"># EnvironmentIsolationConfig</span></span><br><span class=\"line\">    <span class=\"comment\"># topic</span></span><br><span class=\"line\">    <span class=\"attr\">enabledIsolation:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\"># topictopic_dev</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span> <span class=\"string\">dev</span></span><br><span class=\"line\">  <span class=\"attr\">topic:</span> <span class=\"string\">springboot-mq</span></span><br><span class=\"line\">  <span class=\"attr\">name-server:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:9876</span></span><br><span class=\"line\">  <span class=\"comment\"># </span></span><br><span class=\"line\">  <span class=\"attr\">producer:</span></span><br><span class=\"line\">    <span class=\"comment\"># group</span></span><br><span class=\"line\">    <span class=\"attr\">group:</span> <span class=\"string\">rocketmq-pro-group</span></span><br><span class=\"line\">    <span class=\"comment\"># ,3000</span></span><br><span class=\"line\">    <span class=\"attr\">sendMessageTimeout:</span> <span class=\"number\">30000</span></span><br><span class=\"line\">    <span class=\"comment\"># 2</span></span><br><span class=\"line\">    <span class=\"attr\">retryTimesWhenSendFailed:</span> <span class=\"number\">10</span></span><br><span class=\"line\">    <span class=\"comment\"># 2</span></span><br><span class=\"line\">    <span class=\"attr\">retryTimesWhenSendAsyncFailed:</span> <span class=\"number\">10</span></span><br><span class=\"line\">    <span class=\"comment\">#  1024*4(4M)</span></span><br><span class=\"line\">    <span class=\"attr\">maxMessageSize:</span> <span class=\"number\">4096</span></span><br><span class=\"line\">    <span class=\"comment\"># brokerfalse</span></span><br><span class=\"line\">    <span class=\"attr\">retryNextServer:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"comment\"># 4k(1024 * 4)</span></span><br><span class=\"line\">    <span class=\"attr\">compressMessageBodyThreshold:</span> <span class=\"number\">4096</span></span><br><span class=\"line\">  <span class=\"attr\">consumer:</span></span><br><span class=\"line\">    <span class=\"attr\">group:</span> <span class=\"string\">rocketmq-consumer-group</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ruipeng.service;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@RocketMQMessageListener(consumerGroup = &quot;rocketmq-consumer-group&quot;, topic = &quot;springboot-mq&quot;)</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SmsService</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">RocketMQListener</span>&lt;Order&gt; &#123; </span><br><span class=\"line\">\t<span class=\"meta\">@Override</span> </span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onMessage</span><span class=\"params\">(Order order)</span> &#123;</span><br><span class=\"line\">\t log.info(<span class=\"string\">&quot;&#123;&#125;,&quot;</span>, JSON.toJSONString(order)); </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">   &#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@RunWith(SpringRunner.class)</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest(classes = OrderApplication.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MessageTypeTest</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RocketMQTemplate rocketMQTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testSyncSend</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"><span class=\"comment\">//: topic tag &quot;topic:tag&quot; //: </span></span><br><span class=\"line\">        <span class=\"type\">SendResult</span> <span class=\"variable\">sendResult</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                rocketMQTemplate.syncSend(<span class=\"string\">&quot;test-topic-1&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        System.out.println(sendResult);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testAsyncSend</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testSyncSendMsg</span> <span class=\"params\">()</span> &#123;</span><br><span class=\"line\"><span class=\"comment\">//: topic, tag &quot;topic:tag&quot;</span></span><br><span class=\"line\"><span class=\"comment\">//: </span></span><br><span class=\"line\"><span class=\"comment\">//: ,  rocketMQTemplate.asyncSend(&quot;test-topic-1&quot;, &quot;&quot;, new </span></span><br><span class=\"line\">            SendCallback() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span> <span class=\"params\">(SendResult sendResult)</span>&#123;</span><br><span class=\"line\">                    System.out.println(sendResult);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onException</span> <span class=\"params\">(Throwable throwable)</span>&#123;</span><br><span class=\"line\">                    System.out.println(throwable);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"><span class=\"comment\">// Thread.sleep(30000000); </span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testOneWay</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        rocketMQTemplate.sendOneWay(<span class=\"string\">&quot;test-topic-1&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th> TPS</th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RocketMQMessageListener(</span></span><br><span class=\"line\"><span class=\"meta\">consumerGroup = &quot;shop&quot;,//</span></span><br><span class=\"line\"><span class=\"meta\">topic = &quot;order-topic&quot;,//</span></span><br><span class=\"line\"><span class=\"meta\">consumeMode = ConsumeMode.CONCURRENTLY, //: messageModel = MessageModel.CLUSTERING, //:, </span></span><br><span class=\"line\"><span class=\"meta\">)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SmsService</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">RocketMQListener</span>&lt;Order&gt; &#123;&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RocketMQ:</p>\n<ul>\n<li>: ,;</li>\n<li>: </li>\n</ul>\n"},{"_content":"\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2024.5.03`\n\n# Spring Cloud Alibaba-09-Seata\n\n[toc]\n\n## \n\n### \n\n\n\n### \n\n :\n\n* A:(Atomicity)\n* C:(Consistency)\n* I:(Isolation)\n* D:(Durability)\n\n\n\n### \n\n\n\n\n\n\n\n\n\n### \n\n**1**\n\n![image-20240514095424805](typora-user-images/image-20240514095424805.png)\n\n\n\n**2**\n\n![image-20240514095650303](typora-user-images/image-20240514095650303.png)\n\n\n\n3\n\n![image-20240514095835213](typora-user-images/image-20240514095835213.png)\n\n\n\n\n\n## \n\n### \n\nDTPDTPX/OpenX/Open Distributed Transaction Processing Reference Model:\n\n* AP: Application  ()\n* TM: Transaction Manager  ()\n* RM: Resource Manager  ()\n\n:\n\n- : \n- :  \n\n![image-20240516094845785](typora-user-images/image-20240516094845785.png)\n\n\n\n- \n\n\n\n- : \n- : \n- : commit\n\n\n\n### \n\nAB ABAB \n\n\n\n![image-20240520161819461](typora-user-images/image-20240520161819461.png)\n\n\n\n**: A**\n\n1. AA\n2. A\n3. AA\n4. ACommitRollbackA \n5. CommitB;Rollback CommitRollback\"\"\n\n>\n>A  A :\n>:B\n>:\n>:\n\n\n\n**: B**\n\n\n\n\n* \n* \n  \n  A\n  \n\n;\n\n\n\n### \n\n\n\n\n\n\n![image-20240521094502177](typora-user-images/image-20240521094502177.png)\n\n\n\n**: A**\n\n1. \n\n2. \n\n\n\n**: B**\n\n1. \n2. \n   \n3. \n4. \n\n:\n   **:** \n   **:** \n\n\n\n### TCC\n\nTCCTry Confirm CancelTCC:\n\n**Try:**\n\n\n\n**Confirm:**\n\n TryTCC  Confirm:TryConfirmConfirm \n\n**Cancel:**\n\nTryTCCCancel Cancel\n\n\n\n![image-20240522090312508](typora-user-images/image-20240522090312508.png)\n\n\n\n![image-20240522090352573](typora-user-images/image-20240522090352573.png)\n\n\n\nTCCXA:\nXA\nTCC\n\nTCC:\n\n****:2PC\n****:TCCTryConfirmCancel\n\n\n\n## Seata\n\n2019  1  Fescar(Fast & EaSy Commit And Rollback)  Seata:Simple Extensible Autonomous Transaction Architecture\n\nhttps://seata.apache.org/\n\n\n\n![image-20240522091143334](typora-user-images/image-20240522091143334.png)\n\n\n\nSeata2PC2PC   \n\n![image-20240522090958255](typora-user-images/image-20240522090958255.png)\n\n\n\nSeata:\n\n**TC**:Transaction Coordinator  \n\n**TM**:Transaction Manager \n\n**RM:**Resource Manager TC TC\n\n![](typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70-6340401.png)\n\n\n\n**Seata:**\n\n1. ****TMTCTCIDXID\n2. ****TMRMRMTCXID\n3. ****RMSQLundo log\n4. ****TMTCTCRMRMTC\n5. ****RMTMTCTCRMRMundo log\n6. ****RMTMTCRMRMundo logundo log\n\n\n\n**Seata2PC2PC:**\n\n1. 2PC RM RMXA  SeataRMjar\n2. 2PCcommitrollback Phase2SeataPhase1 Phase2 \n\n\n\n## DockerSeata-NacosDB\n\n### \n\n**1seata**\n\n\n\n**2**\n\n~~~\nmkdir -p /Users/lison/work/data/dockerData/seata/resources\n~~~\n\n**3**\n\n~~~shell\ndocker run -d \\\n--name seata \\\nseataio/seata-server\n~~~\n\n**4**\n\n~~~\ndocker cp seata:/seata-server/resources /Users/lison/work/data/dockerData/seata/\n~~~\n\n**5**\n\n~~~\ndocker rm -f seata\n~~~\n\n\n\n### **SeataNacos**\n\nnacosseata\n\n> https://github.com/apache/incubator-seata/tree/2.x/script/config-center\n\n\n\n~~~properties\n\ntransport.type=TCP\ntransport.server=NIO\ntransport.heartbeat=true\ntransport.enableClientBatchSendRequest=true\ntransport.threadFactory.bossThreadPrefix=NettyBoss\ntransport.threadFactory.workerThreadPrefix=NettyServerNIOWorker\ntransport.threadFactory.serverExecutorThreadPrefix=NettyServerBizHandler\ntransport.threadFactory.shareBossWorker=false\ntransport.threadFactory.clientSelectorThreadPrefix=NettyClientSelector\ntransport.threadFactory.clientSelectorThreadSize=1\ntransport.threadFactory.clientWorkerThreadPrefix=NettyClientWorkerThread\ntransport.threadFactory.bossThreadSize=1\ntransport.threadFactory.workerThreadSize=default\ntransport.shutdown.wait=3\nservice.vgroupMapping.my_test_tx_group=default\nservice.default.grouplist=127.0.0.1:8091\nservice.enableDegrade=false\nservice.disableGlobalTransaction=false\nclient.rm.asyncCommitBufferLimit=10000\nclient.rm.lock.retryInterval=10\nclient.rm.lock.retryTimes=30\nclient.rm.lock.retryPolicyBranchRollbackOnConflict=true\nclient.rm.reportRetryCount=5\nclient.rm.tableMetaCheckEnable=false\nclient.rm.tableMetaCheckerInterval=60000\nclient.rm.sqlParserType=druid\nclient.rm.reportSuccessEnable=false\nclient.rm.sagaBranchRegisterEnable=false\nclient.rm.tccActionInterceptorOrder=-2147482648\nclient.tm.commitRetryCount=5\nclient.tm.rollbackRetryCount=5\nclient.tm.defaultGlobalTransactionTimeout=60000\nclient.tm.degradeCheck=false\nclient.tm.degradeCheckAllowTimes=10\nclient.tm.degradeCheckPeriod=2000\nclient.tm.interceptorOrder=-2147482648\nstore.mode=db\nstore.lock.mode=file\nstore.session.mode=file\nstore.file.dir=file_store/data\nstore.file.maxBranchSessionSize=16384\nstore.file.maxGlobalSessionSize=512\nstore.file.fileWriteBufferCacheSize=16384\nstore.file.flushDiskMode=async\nstore.file.sessionReloadReadSize=100\nstore.db.datasource=druid\nstore.db.dbType=mysql\nstore.db.driverClassName=com.mysql.jdbc.Driver\nstore.db.url=jdbc:mysql://172.18.0.2:3306/seata-server?useUnicode=true&rewriteBatchedStatements=true\nstore.db.user=root\nstore.db.password=123456\nstore.db.minConn=5\nstore.db.maxConn=30\nstore.db.globalTable=global_table\nstore.db.branchTable=branch_table\nstore.db.queryLimit=100\nstore.db.lockTable=lock_table\nstore.db.maxWait=5000\nstore.redis.mode=single\nstore.redis.single.host=127.0.0.1\nstore.redis.single.port=6379\nstore.redis.maxConn=10\nstore.redis.minConn=1\nstore.redis.maxTotal=100\nstore.redis.database=0\nstore.redis.queryLimit=100\nserver.recovery.committingRetryPeriod=1000\nserver.recovery.asynCommittingRetryPeriod=1000\nserver.recovery.rollbackingRetryPeriod=1000\nserver.recovery.timeoutRetryPeriod=1000\nserver.maxCommitRetryTimeout=-1\nserver.maxRollbackRetryTimeout=-1\nserver.rollbackRetryTimeoutUnlockEnable=false\nserver.distributedLockExpireTime=10000\nclient.undo.dataValidation=true\nclient.undo.logSerialization=jackson\nclient.undo.onlyCareUpdateColumns=true\nserver.undo.logSaveDays=7\nserver.undo.logDeletePeriod=86400000\nclient.undo.logTable=undo_log\nclient.undo.compress.enable=true\nclient.undo.compress.type=zip\nclient.undo.compress.threshold=64k\nlog.exceptionRate=100\ntransport.serialization=seata\ntransport.compressor=none\nmetrics.enabled=false\nmetrics.registryType=compact\nmetrics.exporterList=prometheus\nmetrics.exporterPrometheusPort=9898\n\n\n\n\n\n~~~\n\nnacosseata-server.properties:\n\n![image-20240524174544128](typora-user-images/image-20240524174544128.png)\n\n\n\n\n\n### **application.yml**\n\nresourcesapplication.yml,nacosapplication.yml\n\n~~~yaml\n#  Copyright 1999-2019 Seata.io Group.\n#\n#  Licensed under the Apache License, Version 2.0 (the \"License\");\n#  you may not use this file except in compliance with the License.\n#  You may obtain a copy of the License at\n#\n#  http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an \"AS IS\" BASIS,\n#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#  See the License for the specific language governing permissions and\n#  limitations under the License.\nserver:\n  port: 7091\n\nspring:\n  application:\n    name: seata-server\n    \nconsole:\n  user:\n    username: seata\n    password: seata\n\nseata:\n  config:\n    # support: nacos, consul, apollo, zk, etcd3\n    type: nacos\n    nacos:\n      server-addr: 172.18.0.6:8848   # nacosdockerip\n      namespace: seata\n      group: DEFAULT_GROUP  # nacos\n      username: nacos     # nacos\n      password: nacos     # nacos\n      context-path:\n      #file-extension: yaml # \n      ##if use MSE Nacos with auth, mutex with username/password attribute\n      #access-key:\n      #secret-key:\n      data-id: seata-server.properties # nacos\n  registry:\n    # support: nacos, eureka, redis, zk, consul, etcd3, sofa\n    type: nacos\n    nacos:\n      application: seata-server       # seatanacos\n      server-addr: 172.18.0.6:8848  # nacosdockerip\n      group: DEFAULT_GROUP   # nacos\n      namespace: seata\n      cluster: default     # seata\n      username: nacos      # nacos\n      password: nacos      # nacos\n      context-path:\n      ##if use MSE Nacos with auth, mutex with username/password attribute\n      #access-key:\n      #secret-key:\n\n  security:\n    secretKey: SeataSecretKey0c382ef121d778043159209298fd40bf3850a017\n    tokenValidityInMilliseconds: 1800000\n    ignore:\n      urls: /,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/api/v1/auth/login    \n\n\n~~~\n\nwebconsoleusernamepassword\n\n\n\n### seatamysql\n\nTC \n\n- https://github.com/apache/incubator-seata/blob/2.x/script/server/db/mysql.sql\n\n\n\nscript\\server\\db mysqlmysql.sql\n\n~~~sql\n--\n-- Licensed to the Apache Software Foundation (ASF) under one or more\n-- contributor license agreements.  See the NOTICE file distributed with\n-- this work for additional information regarding copyright ownership.\n-- The ASF licenses this file to You under the Apache License, Version 2.0\n-- (the \"License\"); you may not use this file except in compliance with\n-- the License.  You may obtain a copy of the License at\n--\n--     http://www.apache.org/licenses/LICENSE-2.0\n--\n-- Unless required by applicable law or agreed to in writing, software\n-- distributed under the License is distributed on an \"AS IS\" BASIS,\n-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-- See the License for the specific language governing permissions and\n-- limitations under the License.\n--\n\n-- -------------------------------- The script used when storeMode is 'db' --------------------------------\n-- the table to store GlobalSession data\nCREATE TABLE IF NOT EXISTS `global_table`\n(\n    `xid`                       VARCHAR(128) NOT NULL,\n    `transaction_id`            BIGINT,\n    `status`                    TINYINT      NOT NULL,\n    `application_id`            VARCHAR(32),\n    `transaction_service_group` VARCHAR(32),\n    `transaction_name`          VARCHAR(128),\n    `timeout`                   INT,\n    `begin_time`                BIGINT,\n    `application_data`          VARCHAR(2000),\n    `gmt_create`                DATETIME,\n    `gmt_modified`              DATETIME,\n    PRIMARY KEY (`xid`),\n    KEY `idx_status_gmt_modified` (`status` , `gmt_modified`),\n    KEY `idx_transaction_id` (`transaction_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8mb4;\n\n-- the table to store BranchSession data\nCREATE TABLE IF NOT EXISTS `branch_table`\n(\n    `branch_id`         BIGINT       NOT NULL,\n    `xid`               VARCHAR(128) NOT NULL,\n    `transaction_id`    BIGINT,\n    `resource_group_id` VARCHAR(32),\n    `resource_id`       VARCHAR(256),\n    `branch_type`       VARCHAR(8),\n    `status`            TINYINT,\n    `client_id`         VARCHAR(64),\n    `application_data`  VARCHAR(2000),\n    `gmt_create`        DATETIME(6),\n    `gmt_modified`      DATETIME(6),\n    PRIMARY KEY (`branch_id`),\n    KEY `idx_xid` (`xid`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8mb4;\n\n-- the table to store lock data\nCREATE TABLE IF NOT EXISTS `lock_table`\n(\n    `row_key`        VARCHAR(128) NOT NULL,\n    `xid`            VARCHAR(128),\n    `transaction_id` BIGINT,\n    `branch_id`      BIGINT       NOT NULL,\n    `resource_id`    VARCHAR(256),\n    `table_name`     VARCHAR(32),\n    `pk`             VARCHAR(36),\n    `status`         TINYINT      NOT NULL DEFAULT '0' COMMENT '0:locked ,1:rollbacking',\n    `gmt_create`     DATETIME,\n    `gmt_modified`   DATETIME,\n    PRIMARY KEY (`row_key`),\n    KEY `idx_status` (`status`),\n    KEY `idx_branch_id` (`branch_id`),\n    KEY `idx_xid` (`xid`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `distributed_lock`\n(\n    `lock_key`       CHAR(20) NOT NULL,\n    `lock_value`     VARCHAR(20) NOT NULL,\n    `expire`         BIGINT,\n    primary key (`lock_key`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8mb4;\n\nINSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('AsyncCommitting', ' ', 0);\nINSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('RetryCommitting', ' ', 0);\nINSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('RetryRollbacking', ' ', 0);\nINSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('TxTimeoutCheck', ' ', 0);\n~~~\n\n\n\n### **docker-compose.yaml**\n\n~~~yaml\n# Seata \nversion: '3.8'\nservices:\n# seata1\n  seata-server1:\n    image: seataio/seata-server\n    hostname: seata-server1\n    ports:\n      - 8091:8091\n      - 7091:7091\n    environment:\n      - TZ=Asia/Shanghai\n      - LANG=en_US.UTF-8\n      - STORE_MODE=db\n      - SEATA_IP=127.0.0.1\n      - SEATA_PORT=8091\n    volumes:\n      - /Users/lison/work/data/dockerData/seata/resources:/seata-server/resources\n~~~\n\n>SEATA_IPseata-serverIPIP\n>SEATA_PORTseata-server 8091\n>STORE_MODEseata-server dbfileredis file\n>SERVER_NODE, seata-serverID,  1,2,3IP\n>SEATA_ENV seata-server  devtest  registry-dev.conf \n\n### \n\n\n\n**1Seata**\n\n~~~\ndocker-compose up -d\n~~~\n\n\n\n**2nacos**\n\n![image-20240524175254196](typora-user-images/image-20240524175254196.png)\n\n**3**\n\n>http://127.0.0.1:7091/#/\n\n\n\n- seata\n- seata\n- application.ymlconsole\n\n\n\n![image-20240524175527451](typora-user-images/image-20240524175527451.png)\n\n\n\n## Seata\n\n\n\nSeata\n\n\n### \n\n\n\n1demospringbootbuild,test,sql:\n\n~~~\n\n\nDROP TABLE IF EXISTS `test`;\nCREATE TABLE `test` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `one` varchar(255) DEFAULT NULL,\n  `two` varchar(255) DEFAULT NULL,\n  `createTime` datetime DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE `t_user` (\n  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '',\n  `user_name` varchar(255) DEFAULT NULL COMMENT '',\n  `sex` tinyint(1) DEFAULT '0' COMMENT '01',\n  `age` int(3) DEFAULT '0' COMMENT '',\n  `address` varchar(255) DEFAULT NULL COMMENT '',\n  `phone` varchar(11) DEFAULT NULL COMMENT '',\n  `create_time` datetime DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;\n\nINSERT INTO `t_test` VALUES ('1', '1', '2', '2024-05-27 16:07:34');\n\nINSERT INTO `t_user`  VALUES('1', 'name', '0', '11','','18818900000','2024-05-27 16:07:34');\n\n~~~\n\n\n\n\n\n2\n\n~~~\n\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-seata</artifactId>\n            <exclusions>\n                <exclusion>\n                    <groupId>io.seata</groupId>\n                    <artifactId>seata-spring-boot-starter</artifactId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n\n        <dependency>\n            <groupId>io.seata</groupId>\n            <artifactId>seata-spring-boot-starter</artifactId>\n            <version>1.4.2</version>\n        </dependency>\n~~~\n\n1.4.2file.confregistry.conf\n\n\n\n3\n\n~~~yaml\nspring:\n  datasource:\n    type: com.alibaba.druid.pool.DruidDataSource\n    master:\n      url: jdbc:mysql://127.0.0.1:3306/springbootbuild?useSSL=false&serverTimezone=Asia/Shanghai\n      username: root\n      password: 123456\n      driver-class-name: com.mysql.jdbc.Driver\n      initialSize: 5\n      minIdle: 5\n      maxActive: 20\n      maxWait: 60000\n      timeBetweenEvictionRunsMillis: 60000\n      minEvictableIdleTimeMillis: 300000\n      validationQuery: SELECT user()\n      testWhileIdle: true\n      testOnBorrow: false\n      testOnReturn: false\n      poolPreparedStatements: true\n      connection-properties: druid.stat.mergeSql:true;druid.stat.slowSqlMillis:5000\n    \nseata:\n  registry:\n    type: nacos\n    nacos:\n      server-addr: 127.0.0.1:8848\n      namespace: \"seata\"\n      group: DEFAULT_GROUP\n      application: seata-server\n      username: nacos\n      password: nacos    \n~~~\n\n\n\n### seata\n\nDatabaseConfigurationSeataRMDataSourceProxyTCundo_log\n\n~~~java\npackage com.lison.springcloudservice.config.base;\n\nimport com.alibaba.druid.pool.DruidDataSource;\nimport io.seata.rm.datasource.DataSourceProxy;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport javax.sql.DataSource;\n\n/**\n * @className: com.lison.springcloudservice.config.base-> DatabaseConfiguration\n * @description:\n * @author: Lison\n * @createDate: 2024-05-27\n */\n@Configuration\npublic class DatabaseConfiguration {\n\n    private final ApplicationContext applicationContext;\n\n    public DatabaseConfiguration(ApplicationContext applicationContext) {\n        this.applicationContext = applicationContext;\n    }\n\n    @Bean\n    @ConfigurationProperties(prefix = \"spring.datasource.master\")\n    public DruidDataSource ds0() {\n        DruidDataSource druidDataSource = new DruidDataSource();\n        return druidDataSource;\n    }\n\n    @Primary\n    @Bean\n    public DataSource dataSource(DruidDataSource ds0)  {\n        DataSourceProxy pds0 = new DataSourceProxy(ds0);\n        return pds0;\n    }\n}\n\n~~~\n\n\n\n### \n\nspirngbootspirngboot\n\n~~~\n//springboot\n@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)\n@EnableDiscoveryClient\n@EnableFeignClients\npublic class SpringCloudServiceApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringCloudServiceApplication.class, args);\n    }\n\n}\n~~~\n\n\n\n### undo_log\n\nundo_log\nspringseata server\n\n~~~\n\n-- ----------------------------\n\n-- Table structure for undo_log\n\n-- ----------------------------\n\nDROP TABLE IF EXISTS `undo_log`;\nCREATE TABLE `undo_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `branch_id` bigint(20) NOT NULL,\n  `xid` varchar(100) NOT NULL,\n  `context` varchar(128) NOT NULL,\n  `rollback_info` longblob NOT NULL,\n  `log_status` int(11) NOT NULL,\n  `log_created` datetime NOT NULL,\n  `log_modified` datetime NOT NULL,\n  `ext` varchar(100) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;\n\n-- ----------------------------\n\n-- Records of undo_log\n~~~\n\n\n\n\n\n\n\n\n\n### seata\n\n\n\n**Controller**\n\n~~~java\npackage com.lison.springcloudservice.controller;\n\nimport com.lison.springcloudservice.service.ITestService;\nimport com.lison.springcloudservice.service.TestGlobalTransServiceImpl;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport javax.annotation.Resource;\n\n/**\n * @className: com.lison.springcloudservice.controller-> TestSeataController\n * @description:\n * @author: Lison\n * @createDate: 2024-05-27\n */\n\n@RestController\n@RequestMapping(value = \"/test/\")\npublic class TestSeataController {\n    @Resource\n    private TestGlobalTransServiceImpl testGlobalTransService;\n    @GetMapping(\"/seataTrans\")\n    public String testSeataTrans() throws Exception {\n        testGlobalTransService.testTrans();\n        return \"success\";\n    }\n}\n\n~~~\n\n\n\n**Service**\n\n~~~java\n\npackage com.lison.springcloudservice.service;\n\nimport io.seata.spring.annotation.GlobalTransactional;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\n/**\n * @className: com.lison.springcloudservice.service-> TestGlobalTransService\n * @description:\n * @author: Lison\n * @createDate: 2024-05-27\n */\n@Service\npublic class TestGlobalTransServiceImpl {\n    @Autowired\n    private ITestService iTestService;\n    //@GlobalTransactional\n    public void testTrans() throws Exception {\n        // \n        iTestService.insertUser();\n        // \n        iTestService.insertTest();\n        // \n        throw new Exception(\"test exception\");\n    }\n}\n\n~~~\n\nspring\n\n\n\n\n\n~~~java\npackage com.lison.springcloudservice.service.impl;\n\nimport com.lison.springcloudservice.mapper.TestMapper;\nimport com.lison.springcloudservice.mapper.UserMapper;\nimport com.lison.springcloudservice.service.ITestService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\n/**\n * @className: com.lison.springcloudservice.service.impl-> TestServiceImpl\n * @description:\n * @author: Lison\n * @createDate: 2024-05-27\n */\n@Service\npublic class TestServiceImpl  implements ITestService {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Autowired\n    private TestMapper testMapper;\n\n    @Transactional(rollbackFor = Exception.class)\n    @Override\n    public void insertUser() {\n        userMapper.insert();\n    }\n\n    @Transactional(rollbackFor = Exception.class)\n    @Override\n    public void insertTest() {\n        testMapper.insert();\n    }\n\n\n\n\n\n}\n\n~~~\n\n\n\n**Mapper**\n\n~~~java\n@Mapper\n@Component\npublic interface TestMapper {\n    @Insert(\"insert into t_test(one,two,createTime) values ( 0,18,now())\")\n    int insert();\n}\n\n\n@Mapper\n@Component\npublic interface UserMapper{\n    @Insert(\"insert into t_user (user_name,sex,age, create_time) values ('aaaaaaaaa', 0,18,now())\")\n    int insert();\n\n}\n\n~~~\n\n\n\n\n\n1http://localhost:18001/test/seataTrans\n\n2 @GlobalTransactional \n\n~~~\n2024-05-27 16:58:57.346 [TID:Ignored_Trace] [http-nio-18001-exec-1] INFO  c.l.s.config.seata.SeataInterceptor -xid in RootContext[null] xid in HttpContext[null]\n2024-05-27 16:58:57.504 [TID:Ignored_Trace] [http-nio-18001-exec-1] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] -Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.Exception: test exception] with root cause\njava.lang.Exception: test exception\n\tat com.lison.springcloudservice.service.TestGlobalTransServiceImpl.testTrans(TestGlobalTransServiceImpl.java:24)\n\tat com.lison.springcloudservice.controller.TestSeataController.$sw$original$testSeataTrans$6lb26m3(TestSeataController.java:25)\n\tat com.lison.springcloudservice.controller.TestSeataController.$sw$original$testSeataTrans$6lb26m3$accessor$$sw$ful2f31(TestSeataController.java)\n\tat com.lison.springcloudservice.controller.TestSeataController$$sw$auxiliary$p4qqk42.call(Unknown Source)\n\tat org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter.intercept(InstMethodsInter.java:86)\n\tat com.lison.springcloudservice.controller.TestSeataController.testSeataTrans(TestSeataController.java)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)\n\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793)\n\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040)\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)\n\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat brave.servlet.TracingFilter.doFilter(TracingFilter.java:68)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat brave.servlet.TracingFilter.doFilter(TracingFilter.java:87)\n\tat org.springframework.cloud.sleuth.instrument.web.LazyTracingFilter.doFilter(TraceWebServletAutoConfiguration.java:139)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:109)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541)\n\tat org.apache.catalina.core.StandardHostValve.$sw$original$invoke$6qrnli3(StandardHostValve.java:139)\n\tat org.apache.catalina.core.StandardHostValve.$sw$original$invoke$6qrnli3$accessor$$sw$p8ebm33(StandardHostValve.java)\n\tat org.apache.catalina.core.StandardHostValve$$sw$auxiliary$1213ni1.call(Unknown Source)\n\tat org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter.intercept(InstMethodsInter.java:86)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1594)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:748)\n2024-05-27 16:58:57.516 [TID:Ignored_Trace] [http-nio-18001-exec-1] INFO  c.l.s.config.seata.SeataInterceptor -xid in RootContext[null] xid in HttpContext[null]\n2024-05-27 16:58:58.508 [TID:N/A] [AsyncReporter{org.springframework.cloud.sleuth.zipkin2.sender.RestTemplateSender@3f169051}] WARN  z.r.AsyncReporter$BoundedAsyncReporter -Spans were dropped due to exceptions. All subsequent errors will be logged at FINE level.\n~~~\n\n\n\n3\n\n~~~\n */\n@Service\npublic class TestGlobalTransServiceImpl {\n    @Autowired\n    private ITestService iTestService;\n    @GlobalTransactional\n    public void testTrans() throws Exception {\n        // \n        iTestService.insertUser();\n        // \n        iTestService.insertTest();\n        // \n        throw new Exception(\"test exception\");\n    }\n}\n~~~\n\n\n\n4\n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-09-Seata .md","raw":"\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2024.5.03`\n\n# Spring Cloud Alibaba-09-Seata\n\n[toc]\n\n## \n\n### \n\n\n\n### \n\n :\n\n* A:(Atomicity)\n* C:(Consistency)\n* I:(Isolation)\n* D:(Durability)\n\n\n\n### \n\n\n\n\n\n\n\n\n\n### \n\n**1**\n\n![image-20240514095424805](typora-user-images/image-20240514095424805.png)\n\n\n\n**2**\n\n![image-20240514095650303](typora-user-images/image-20240514095650303.png)\n\n\n\n3\n\n![image-20240514095835213](typora-user-images/image-20240514095835213.png)\n\n\n\n\n\n## \n\n### \n\nDTPDTPX/OpenX/Open Distributed Transaction Processing Reference Model:\n\n* AP: Application  ()\n* TM: Transaction Manager  ()\n* RM: Resource Manager  ()\n\n:\n\n- : \n- :  \n\n![image-20240516094845785](typora-user-images/image-20240516094845785.png)\n\n\n\n- \n\n\n\n- : \n- : \n- : commit\n\n\n\n### \n\nAB ABAB \n\n\n\n![image-20240520161819461](typora-user-images/image-20240520161819461.png)\n\n\n\n**: A**\n\n1. AA\n2. A\n3. AA\n4. ACommitRollbackA \n5. CommitB;Rollback CommitRollback\"\"\n\n>\n>A  A :\n>:B\n>:\n>:\n\n\n\n**: B**\n\n\n\n\n* \n* \n  \n  A\n  \n\n;\n\n\n\n### \n\n\n\n\n\n\n![image-20240521094502177](typora-user-images/image-20240521094502177.png)\n\n\n\n**: A**\n\n1. \n\n2. \n\n\n\n**: B**\n\n1. \n2. \n   \n3. \n4. \n\n:\n   **:** \n   **:** \n\n\n\n### TCC\n\nTCCTry Confirm CancelTCC:\n\n**Try:**\n\n\n\n**Confirm:**\n\n TryTCC  Confirm:TryConfirmConfirm \n\n**Cancel:**\n\nTryTCCCancel Cancel\n\n\n\n![image-20240522090312508](typora-user-images/image-20240522090312508.png)\n\n\n\n![image-20240522090352573](typora-user-images/image-20240522090352573.png)\n\n\n\nTCCXA:\nXA\nTCC\n\nTCC:\n\n****:2PC\n****:TCCTryConfirmCancel\n\n\n\n## Seata\n\n2019  1  Fescar(Fast & EaSy Commit And Rollback)  Seata:Simple Extensible Autonomous Transaction Architecture\n\nhttps://seata.apache.org/\n\n\n\n![image-20240522091143334](typora-user-images/image-20240522091143334.png)\n\n\n\nSeata2PC2PC   \n\n![image-20240522090958255](typora-user-images/image-20240522090958255.png)\n\n\n\nSeata:\n\n**TC**:Transaction Coordinator  \n\n**TM**:Transaction Manager \n\n**RM:**Resource Manager TC TC\n\n![](typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70-6340401.png)\n\n\n\n**Seata:**\n\n1. ****TMTCTCIDXID\n2. ****TMRMRMTCXID\n3. ****RMSQLundo log\n4. ****TMTCTCRMRMTC\n5. ****RMTMTCTCRMRMundo log\n6. ****RMTMTCRMRMundo logundo log\n\n\n\n**Seata2PC2PC:**\n\n1. 2PC RM RMXA  SeataRMjar\n2. 2PCcommitrollback Phase2SeataPhase1 Phase2 \n\n\n\n## DockerSeata-NacosDB\n\n### \n\n**1seata**\n\n\n\n**2**\n\n~~~\nmkdir -p /Users/lison/work/data/dockerData/seata/resources\n~~~\n\n**3**\n\n~~~shell\ndocker run -d \\\n--name seata \\\nseataio/seata-server\n~~~\n\n**4**\n\n~~~\ndocker cp seata:/seata-server/resources /Users/lison/work/data/dockerData/seata/\n~~~\n\n**5**\n\n~~~\ndocker rm -f seata\n~~~\n\n\n\n### **SeataNacos**\n\nnacosseata\n\n> https://github.com/apache/incubator-seata/tree/2.x/script/config-center\n\n\n\n~~~properties\n\ntransport.type=TCP\ntransport.server=NIO\ntransport.heartbeat=true\ntransport.enableClientBatchSendRequest=true\ntransport.threadFactory.bossThreadPrefix=NettyBoss\ntransport.threadFactory.workerThreadPrefix=NettyServerNIOWorker\ntransport.threadFactory.serverExecutorThreadPrefix=NettyServerBizHandler\ntransport.threadFactory.shareBossWorker=false\ntransport.threadFactory.clientSelectorThreadPrefix=NettyClientSelector\ntransport.threadFactory.clientSelectorThreadSize=1\ntransport.threadFactory.clientWorkerThreadPrefix=NettyClientWorkerThread\ntransport.threadFactory.bossThreadSize=1\ntransport.threadFactory.workerThreadSize=default\ntransport.shutdown.wait=3\nservice.vgroupMapping.my_test_tx_group=default\nservice.default.grouplist=127.0.0.1:8091\nservice.enableDegrade=false\nservice.disableGlobalTransaction=false\nclient.rm.asyncCommitBufferLimit=10000\nclient.rm.lock.retryInterval=10\nclient.rm.lock.retryTimes=30\nclient.rm.lock.retryPolicyBranchRollbackOnConflict=true\nclient.rm.reportRetryCount=5\nclient.rm.tableMetaCheckEnable=false\nclient.rm.tableMetaCheckerInterval=60000\nclient.rm.sqlParserType=druid\nclient.rm.reportSuccessEnable=false\nclient.rm.sagaBranchRegisterEnable=false\nclient.rm.tccActionInterceptorOrder=-2147482648\nclient.tm.commitRetryCount=5\nclient.tm.rollbackRetryCount=5\nclient.tm.defaultGlobalTransactionTimeout=60000\nclient.tm.degradeCheck=false\nclient.tm.degradeCheckAllowTimes=10\nclient.tm.degradeCheckPeriod=2000\nclient.tm.interceptorOrder=-2147482648\nstore.mode=db\nstore.lock.mode=file\nstore.session.mode=file\nstore.file.dir=file_store/data\nstore.file.maxBranchSessionSize=16384\nstore.file.maxGlobalSessionSize=512\nstore.file.fileWriteBufferCacheSize=16384\nstore.file.flushDiskMode=async\nstore.file.sessionReloadReadSize=100\nstore.db.datasource=druid\nstore.db.dbType=mysql\nstore.db.driverClassName=com.mysql.jdbc.Driver\nstore.db.url=jdbc:mysql://172.18.0.2:3306/seata-server?useUnicode=true&rewriteBatchedStatements=true\nstore.db.user=root\nstore.db.password=123456\nstore.db.minConn=5\nstore.db.maxConn=30\nstore.db.globalTable=global_table\nstore.db.branchTable=branch_table\nstore.db.queryLimit=100\nstore.db.lockTable=lock_table\nstore.db.maxWait=5000\nstore.redis.mode=single\nstore.redis.single.host=127.0.0.1\nstore.redis.single.port=6379\nstore.redis.maxConn=10\nstore.redis.minConn=1\nstore.redis.maxTotal=100\nstore.redis.database=0\nstore.redis.queryLimit=100\nserver.recovery.committingRetryPeriod=1000\nserver.recovery.asynCommittingRetryPeriod=1000\nserver.recovery.rollbackingRetryPeriod=1000\nserver.recovery.timeoutRetryPeriod=1000\nserver.maxCommitRetryTimeout=-1\nserver.maxRollbackRetryTimeout=-1\nserver.rollbackRetryTimeoutUnlockEnable=false\nserver.distributedLockExpireTime=10000\nclient.undo.dataValidation=true\nclient.undo.logSerialization=jackson\nclient.undo.onlyCareUpdateColumns=true\nserver.undo.logSaveDays=7\nserver.undo.logDeletePeriod=86400000\nclient.undo.logTable=undo_log\nclient.undo.compress.enable=true\nclient.undo.compress.type=zip\nclient.undo.compress.threshold=64k\nlog.exceptionRate=100\ntransport.serialization=seata\ntransport.compressor=none\nmetrics.enabled=false\nmetrics.registryType=compact\nmetrics.exporterList=prometheus\nmetrics.exporterPrometheusPort=9898\n\n\n\n\n\n~~~\n\nnacosseata-server.properties:\n\n![image-20240524174544128](typora-user-images/image-20240524174544128.png)\n\n\n\n\n\n### **application.yml**\n\nresourcesapplication.yml,nacosapplication.yml\n\n~~~yaml\n#  Copyright 1999-2019 Seata.io Group.\n#\n#  Licensed under the Apache License, Version 2.0 (the \"License\");\n#  you may not use this file except in compliance with the License.\n#  You may obtain a copy of the License at\n#\n#  http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an \"AS IS\" BASIS,\n#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#  See the License for the specific language governing permissions and\n#  limitations under the License.\nserver:\n  port: 7091\n\nspring:\n  application:\n    name: seata-server\n    \nconsole:\n  user:\n    username: seata\n    password: seata\n\nseata:\n  config:\n    # support: nacos, consul, apollo, zk, etcd3\n    type: nacos\n    nacos:\n      server-addr: 172.18.0.6:8848   # nacosdockerip\n      namespace: seata\n      group: DEFAULT_GROUP  # nacos\n      username: nacos     # nacos\n      password: nacos     # nacos\n      context-path:\n      #file-extension: yaml # \n      ##if use MSE Nacos with auth, mutex with username/password attribute\n      #access-key:\n      #secret-key:\n      data-id: seata-server.properties # nacos\n  registry:\n    # support: nacos, eureka, redis, zk, consul, etcd3, sofa\n    type: nacos\n    nacos:\n      application: seata-server       # seatanacos\n      server-addr: 172.18.0.6:8848  # nacosdockerip\n      group: DEFAULT_GROUP   # nacos\n      namespace: seata\n      cluster: default     # seata\n      username: nacos      # nacos\n      password: nacos      # nacos\n      context-path:\n      ##if use MSE Nacos with auth, mutex with username/password attribute\n      #access-key:\n      #secret-key:\n\n  security:\n    secretKey: SeataSecretKey0c382ef121d778043159209298fd40bf3850a017\n    tokenValidityInMilliseconds: 1800000\n    ignore:\n      urls: /,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/api/v1/auth/login    \n\n\n~~~\n\nwebconsoleusernamepassword\n\n\n\n### seatamysql\n\nTC \n\n- https://github.com/apache/incubator-seata/blob/2.x/script/server/db/mysql.sql\n\n\n\nscript\\server\\db mysqlmysql.sql\n\n~~~sql\n--\n-- Licensed to the Apache Software Foundation (ASF) under one or more\n-- contributor license agreements.  See the NOTICE file distributed with\n-- this work for additional information regarding copyright ownership.\n-- The ASF licenses this file to You under the Apache License, Version 2.0\n-- (the \"License\"); you may not use this file except in compliance with\n-- the License.  You may obtain a copy of the License at\n--\n--     http://www.apache.org/licenses/LICENSE-2.0\n--\n-- Unless required by applicable law or agreed to in writing, software\n-- distributed under the License is distributed on an \"AS IS\" BASIS,\n-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-- See the License for the specific language governing permissions and\n-- limitations under the License.\n--\n\n-- -------------------------------- The script used when storeMode is 'db' --------------------------------\n-- the table to store GlobalSession data\nCREATE TABLE IF NOT EXISTS `global_table`\n(\n    `xid`                       VARCHAR(128) NOT NULL,\n    `transaction_id`            BIGINT,\n    `status`                    TINYINT      NOT NULL,\n    `application_id`            VARCHAR(32),\n    `transaction_service_group` VARCHAR(32),\n    `transaction_name`          VARCHAR(128),\n    `timeout`                   INT,\n    `begin_time`                BIGINT,\n    `application_data`          VARCHAR(2000),\n    `gmt_create`                DATETIME,\n    `gmt_modified`              DATETIME,\n    PRIMARY KEY (`xid`),\n    KEY `idx_status_gmt_modified` (`status` , `gmt_modified`),\n    KEY `idx_transaction_id` (`transaction_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8mb4;\n\n-- the table to store BranchSession data\nCREATE TABLE IF NOT EXISTS `branch_table`\n(\n    `branch_id`         BIGINT       NOT NULL,\n    `xid`               VARCHAR(128) NOT NULL,\n    `transaction_id`    BIGINT,\n    `resource_group_id` VARCHAR(32),\n    `resource_id`       VARCHAR(256),\n    `branch_type`       VARCHAR(8),\n    `status`            TINYINT,\n    `client_id`         VARCHAR(64),\n    `application_data`  VARCHAR(2000),\n    `gmt_create`        DATETIME(6),\n    `gmt_modified`      DATETIME(6),\n    PRIMARY KEY (`branch_id`),\n    KEY `idx_xid` (`xid`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8mb4;\n\n-- the table to store lock data\nCREATE TABLE IF NOT EXISTS `lock_table`\n(\n    `row_key`        VARCHAR(128) NOT NULL,\n    `xid`            VARCHAR(128),\n    `transaction_id` BIGINT,\n    `branch_id`      BIGINT       NOT NULL,\n    `resource_id`    VARCHAR(256),\n    `table_name`     VARCHAR(32),\n    `pk`             VARCHAR(36),\n    `status`         TINYINT      NOT NULL DEFAULT '0' COMMENT '0:locked ,1:rollbacking',\n    `gmt_create`     DATETIME,\n    `gmt_modified`   DATETIME,\n    PRIMARY KEY (`row_key`),\n    KEY `idx_status` (`status`),\n    KEY `idx_branch_id` (`branch_id`),\n    KEY `idx_xid` (`xid`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `distributed_lock`\n(\n    `lock_key`       CHAR(20) NOT NULL,\n    `lock_value`     VARCHAR(20) NOT NULL,\n    `expire`         BIGINT,\n    primary key (`lock_key`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8mb4;\n\nINSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('AsyncCommitting', ' ', 0);\nINSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('RetryCommitting', ' ', 0);\nINSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('RetryRollbacking', ' ', 0);\nINSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES ('TxTimeoutCheck', ' ', 0);\n~~~\n\n\n\n### **docker-compose.yaml**\n\n~~~yaml\n# Seata \nversion: '3.8'\nservices:\n# seata1\n  seata-server1:\n    image: seataio/seata-server\n    hostname: seata-server1\n    ports:\n      - 8091:8091\n      - 7091:7091\n    environment:\n      - TZ=Asia/Shanghai\n      - LANG=en_US.UTF-8\n      - STORE_MODE=db\n      - SEATA_IP=127.0.0.1\n      - SEATA_PORT=8091\n    volumes:\n      - /Users/lison/work/data/dockerData/seata/resources:/seata-server/resources\n~~~\n\n>SEATA_IPseata-serverIPIP\n>SEATA_PORTseata-server 8091\n>STORE_MODEseata-server dbfileredis file\n>SERVER_NODE, seata-serverID,  1,2,3IP\n>SEATA_ENV seata-server  devtest  registry-dev.conf \n\n### \n\n\n\n**1Seata**\n\n~~~\ndocker-compose up -d\n~~~\n\n\n\n**2nacos**\n\n![image-20240524175254196](typora-user-images/image-20240524175254196.png)\n\n**3**\n\n>http://127.0.0.1:7091/#/\n\n\n\n- seata\n- seata\n- application.ymlconsole\n\n\n\n![image-20240524175527451](typora-user-images/image-20240524175527451.png)\n\n\n\n## Seata\n\n\n\nSeata\n\n\n### \n\n\n\n1demospringbootbuild,test,sql:\n\n~~~\n\n\nDROP TABLE IF EXISTS `test`;\nCREATE TABLE `test` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `one` varchar(255) DEFAULT NULL,\n  `two` varchar(255) DEFAULT NULL,\n  `createTime` datetime DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE `t_user` (\n  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '',\n  `user_name` varchar(255) DEFAULT NULL COMMENT '',\n  `sex` tinyint(1) DEFAULT '0' COMMENT '01',\n  `age` int(3) DEFAULT '0' COMMENT '',\n  `address` varchar(255) DEFAULT NULL COMMENT '',\n  `phone` varchar(11) DEFAULT NULL COMMENT '',\n  `create_time` datetime DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;\n\nINSERT INTO `t_test` VALUES ('1', '1', '2', '2024-05-27 16:07:34');\n\nINSERT INTO `t_user`  VALUES('1', 'name', '0', '11','','18818900000','2024-05-27 16:07:34');\n\n~~~\n\n\n\n\n\n2\n\n~~~\n\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-seata</artifactId>\n            <exclusions>\n                <exclusion>\n                    <groupId>io.seata</groupId>\n                    <artifactId>seata-spring-boot-starter</artifactId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n\n        <dependency>\n            <groupId>io.seata</groupId>\n            <artifactId>seata-spring-boot-starter</artifactId>\n            <version>1.4.2</version>\n        </dependency>\n~~~\n\n1.4.2file.confregistry.conf\n\n\n\n3\n\n~~~yaml\nspring:\n  datasource:\n    type: com.alibaba.druid.pool.DruidDataSource\n    master:\n      url: jdbc:mysql://127.0.0.1:3306/springbootbuild?useSSL=false&serverTimezone=Asia/Shanghai\n      username: root\n      password: 123456\n      driver-class-name: com.mysql.jdbc.Driver\n      initialSize: 5\n      minIdle: 5\n      maxActive: 20\n      maxWait: 60000\n      timeBetweenEvictionRunsMillis: 60000\n      minEvictableIdleTimeMillis: 300000\n      validationQuery: SELECT user()\n      testWhileIdle: true\n      testOnBorrow: false\n      testOnReturn: false\n      poolPreparedStatements: true\n      connection-properties: druid.stat.mergeSql:true;druid.stat.slowSqlMillis:5000\n    \nseata:\n  registry:\n    type: nacos\n    nacos:\n      server-addr: 127.0.0.1:8848\n      namespace: \"seata\"\n      group: DEFAULT_GROUP\n      application: seata-server\n      username: nacos\n      password: nacos    \n~~~\n\n\n\n### seata\n\nDatabaseConfigurationSeataRMDataSourceProxyTCundo_log\n\n~~~java\npackage com.lison.springcloudservice.config.base;\n\nimport com.alibaba.druid.pool.DruidDataSource;\nimport io.seata.rm.datasource.DataSourceProxy;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport javax.sql.DataSource;\n\n/**\n * @className: com.lison.springcloudservice.config.base-> DatabaseConfiguration\n * @description:\n * @author: Lison\n * @createDate: 2024-05-27\n */\n@Configuration\npublic class DatabaseConfiguration {\n\n    private final ApplicationContext applicationContext;\n\n    public DatabaseConfiguration(ApplicationContext applicationContext) {\n        this.applicationContext = applicationContext;\n    }\n\n    @Bean\n    @ConfigurationProperties(prefix = \"spring.datasource.master\")\n    public DruidDataSource ds0() {\n        DruidDataSource druidDataSource = new DruidDataSource();\n        return druidDataSource;\n    }\n\n    @Primary\n    @Bean\n    public DataSource dataSource(DruidDataSource ds0)  {\n        DataSourceProxy pds0 = new DataSourceProxy(ds0);\n        return pds0;\n    }\n}\n\n~~~\n\n\n\n### \n\nspirngbootspirngboot\n\n~~~\n//springboot\n@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)\n@EnableDiscoveryClient\n@EnableFeignClients\npublic class SpringCloudServiceApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringCloudServiceApplication.class, args);\n    }\n\n}\n~~~\n\n\n\n### undo_log\n\nundo_log\nspringseata server\n\n~~~\n\n-- ----------------------------\n\n-- Table structure for undo_log\n\n-- ----------------------------\n\nDROP TABLE IF EXISTS `undo_log`;\nCREATE TABLE `undo_log` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `branch_id` bigint(20) NOT NULL,\n  `xid` varchar(100) NOT NULL,\n  `context` varchar(128) NOT NULL,\n  `rollback_info` longblob NOT NULL,\n  `log_status` int(11) NOT NULL,\n  `log_created` datetime NOT NULL,\n  `log_modified` datetime NOT NULL,\n  `ext` varchar(100) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;\n\n-- ----------------------------\n\n-- Records of undo_log\n~~~\n\n\n\n\n\n\n\n\n\n### seata\n\n\n\n**Controller**\n\n~~~java\npackage com.lison.springcloudservice.controller;\n\nimport com.lison.springcloudservice.service.ITestService;\nimport com.lison.springcloudservice.service.TestGlobalTransServiceImpl;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport javax.annotation.Resource;\n\n/**\n * @className: com.lison.springcloudservice.controller-> TestSeataController\n * @description:\n * @author: Lison\n * @createDate: 2024-05-27\n */\n\n@RestController\n@RequestMapping(value = \"/test/\")\npublic class TestSeataController {\n    @Resource\n    private TestGlobalTransServiceImpl testGlobalTransService;\n    @GetMapping(\"/seataTrans\")\n    public String testSeataTrans() throws Exception {\n        testGlobalTransService.testTrans();\n        return \"success\";\n    }\n}\n\n~~~\n\n\n\n**Service**\n\n~~~java\n\npackage com.lison.springcloudservice.service;\n\nimport io.seata.spring.annotation.GlobalTransactional;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\n/**\n * @className: com.lison.springcloudservice.service-> TestGlobalTransService\n * @description:\n * @author: Lison\n * @createDate: 2024-05-27\n */\n@Service\npublic class TestGlobalTransServiceImpl {\n    @Autowired\n    private ITestService iTestService;\n    //@GlobalTransactional\n    public void testTrans() throws Exception {\n        // \n        iTestService.insertUser();\n        // \n        iTestService.insertTest();\n        // \n        throw new Exception(\"test exception\");\n    }\n}\n\n~~~\n\nspring\n\n\n\n\n\n~~~java\npackage com.lison.springcloudservice.service.impl;\n\nimport com.lison.springcloudservice.mapper.TestMapper;\nimport com.lison.springcloudservice.mapper.UserMapper;\nimport com.lison.springcloudservice.service.ITestService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\n/**\n * @className: com.lison.springcloudservice.service.impl-> TestServiceImpl\n * @description:\n * @author: Lison\n * @createDate: 2024-05-27\n */\n@Service\npublic class TestServiceImpl  implements ITestService {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Autowired\n    private TestMapper testMapper;\n\n    @Transactional(rollbackFor = Exception.class)\n    @Override\n    public void insertUser() {\n        userMapper.insert();\n    }\n\n    @Transactional(rollbackFor = Exception.class)\n    @Override\n    public void insertTest() {\n        testMapper.insert();\n    }\n\n\n\n\n\n}\n\n~~~\n\n\n\n**Mapper**\n\n~~~java\n@Mapper\n@Component\npublic interface TestMapper {\n    @Insert(\"insert into t_test(one,two,createTime) values ( 0,18,now())\")\n    int insert();\n}\n\n\n@Mapper\n@Component\npublic interface UserMapper{\n    @Insert(\"insert into t_user (user_name,sex,age, create_time) values ('aaaaaaaaa', 0,18,now())\")\n    int insert();\n\n}\n\n~~~\n\n\n\n\n\n1http://localhost:18001/test/seataTrans\n\n2 @GlobalTransactional \n\n~~~\n2024-05-27 16:58:57.346 [TID:Ignored_Trace] [http-nio-18001-exec-1] INFO  c.l.s.config.seata.SeataInterceptor -xid in RootContext[null] xid in HttpContext[null]\n2024-05-27 16:58:57.504 [TID:Ignored_Trace] [http-nio-18001-exec-1] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] -Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.Exception: test exception] with root cause\njava.lang.Exception: test exception\n\tat com.lison.springcloudservice.service.TestGlobalTransServiceImpl.testTrans(TestGlobalTransServiceImpl.java:24)\n\tat com.lison.springcloudservice.controller.TestSeataController.$sw$original$testSeataTrans$6lb26m3(TestSeataController.java:25)\n\tat com.lison.springcloudservice.controller.TestSeataController.$sw$original$testSeataTrans$6lb26m3$accessor$$sw$ful2f31(TestSeataController.java)\n\tat com.lison.springcloudservice.controller.TestSeataController$$sw$auxiliary$p4qqk42.call(Unknown Source)\n\tat org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter.intercept(InstMethodsInter.java:86)\n\tat com.lison.springcloudservice.controller.TestSeataController.testSeataTrans(TestSeataController.java)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)\n\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793)\n\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040)\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)\n\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:634)\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat brave.servlet.TracingFilter.doFilter(TracingFilter.java:68)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat brave.servlet.TracingFilter.doFilter(TracingFilter.java:87)\n\tat org.springframework.cloud.sleuth.instrument.web.LazyTracingFilter.doFilter(TraceWebServletAutoConfiguration.java:139)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:109)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541)\n\tat org.apache.catalina.core.StandardHostValve.$sw$original$invoke$6qrnli3(StandardHostValve.java:139)\n\tat org.apache.catalina.core.StandardHostValve.$sw$original$invoke$6qrnli3$accessor$$sw$p8ebm33(StandardHostValve.java)\n\tat org.apache.catalina.core.StandardHostValve$$sw$auxiliary$1213ni1.call(Unknown Source)\n\tat org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter.intercept(InstMethodsInter.java:86)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1594)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:748)\n2024-05-27 16:58:57.516 [TID:Ignored_Trace] [http-nio-18001-exec-1] INFO  c.l.s.config.seata.SeataInterceptor -xid in RootContext[null] xid in HttpContext[null]\n2024-05-27 16:58:58.508 [TID:N/A] [AsyncReporter{org.springframework.cloud.sleuth.zipkin2.sender.RestTemplateSender@3f169051}] WARN  z.r.AsyncReporter$BoundedAsyncReporter -Spans were dropped due to exceptions. All subsequent errors will be logged at FINE level.\n~~~\n\n\n\n3\n\n~~~\n */\n@Service\npublic class TestGlobalTransServiceImpl {\n    @Autowired\n    private ITestService iTestService;\n    @GlobalTransactional\n    public void testTrans() throws Exception {\n        // \n        iTestService.insertUser();\n        // \n        iTestService.insertTest();\n        // \n        throw new Exception(\"test exception\");\n    }\n}\n~~~\n\n\n\n4\n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-09-Seata ","published":1,"date":"2024-04-08T01:29:32.111Z","updated":"2024-05-31T09:04:19.065Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhq0009ecfybeux64ut","content":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2024.5.03</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-09-Seata\"><a href=\"#Spring-Cloud-Alibaba-09-Seata\" class=\"headerlink\" title=\"Spring Cloud Alibaba-09-Seata\"></a>Spring Cloud Alibaba-09-Seata</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> :</p>\n<ul>\n<li>A:(Atomicity)</li>\n<li>C:(Consistency)</li>\n<li>I:(Isolation)</li>\n<li>D:(Durability)</li>\n</ul>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br></p>\n<p><br></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>1</strong></p>\n<p><img src=\"/typora-user-images/image-20240514095424805.png\" alt=\"image-20240514095424805\"></p>\n<p><strong>2</strong></p>\n<p><img src=\"/typora-user-images/image-20240514095650303.png\" alt=\"image-20240514095650303\"></p>\n<p>3</p>\n<p><img src=\"/typora-user-images/image-20240514095835213.png\" alt=\"image-20240514095835213\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>DTPDTPX&#x2F;OpenX&#x2F;Open Distributed Transaction Processing Reference Model:</p>\n<ul>\n<li>AP: Application  ()</li>\n<li>TM: Transaction Manager  ()</li>\n<li>RM: Resource Manager  ()</li>\n</ul>\n<p>:</p>\n<ul>\n<li>: </li>\n<li>:  </li>\n</ul>\n<p><img src=\"/typora-user-images/image-20240516094845785.png\" alt=\"image-20240516094845785\"></p>\n<p></p>\n<ul>\n<li></li>\n</ul>\n<p></p>\n<ul>\n<li>: </li>\n<li>: </li>\n<li>: commit</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>AB ABAB </p>\n<p><img src=\"/typora-user-images/image-20240520161819461.png\" alt=\"image-20240520161819461\"></p>\n<p><strong>: A</strong></p>\n<ol>\n<li>AA</li>\n<li>A</li>\n<li>AA</li>\n<li>ACommitRollbackA </li>\n<li>CommitB;Rollback CommitRollback</li>\n</ol>\n<blockquote>\n<p><br>A  A :<br>:B<br>:<br>:</p>\n</blockquote>\n<p><strong>: B</strong></p>\n<p><br></p>\n<ul>\n<li></li>\n<li><br><br>A<br></li>\n</ul>\n<p>;</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br></p>\n<p><img src=\"/typora-user-images/image-20240521094502177.png\" alt=\"image-20240521094502177\"></p>\n<p><strong>: A</strong></p>\n<ol>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n</ol>\n<p><strong>: B</strong></p>\n<ol>\n<li></li>\n<li><br></li>\n<li></li>\n<li></li>\n</ol>\n<p>:<br>   <strong>:</strong> <br>   <strong>:</strong> </p>\n<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><p>TCCTry Confirm CancelTCC:</p>\n<p><strong>Try:</strong></p>\n<p></p>\n<p><strong>Confirm:</strong></p>\n<p> TryTCC  Confirm:TryConfirmConfirm </p>\n<p><strong>Cancel:</strong></p>\n<p>TryTCCCancel Cancel</p>\n<p><img src=\"/typora-user-images/image-20240522090312508.png\" alt=\"image-20240522090312508\"></p>\n<p><img src=\"/typora-user-images/image-20240522090352573.png\" alt=\"image-20240522090352573\"></p>\n<p>TCCXA:<br>XA<br>TCC</p>\n<p>TCC:</p>\n<p><strong></strong>:2PC<br><strong></strong>:TCCTryConfirmCancel</p>\n<h2 id=\"Seata\"><a href=\"#Seata\" class=\"headerlink\" title=\"Seata\"></a>Seata</h2><p>2019  1  Fescar(Fast &amp; EaSy Commit And Rollback)  Seata:Simple Extensible Autonomous Transaction Architecture</p>\n<p><a href=\"https://seata.apache.org/\">https://seata.apache.org/</a></p>\n<p><img src=\"/typora-user-images/image-20240522091143334.png\" alt=\"image-20240522091143334\"></p>\n<p>Seata2PC2PC   </p>\n<p><img src=\"/typora-user-images/image-20240522090958255.png\" alt=\"image-20240522090958255\"></p>\n<p>Seata:</p>\n<p><strong>TC</strong>:Transaction Coordinator  </p>\n<p><strong>TM</strong>:Transaction Manager </p>\n<p>**RM:**Resource Manager TC TC</p>\n<p><img src=\"/typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70-6340401.png\" alt=\"\"></p>\n<p><strong>Seata:</strong></p>\n<ol>\n<li><strong></strong>TMTCTCIDXID</li>\n<li><strong></strong>TMRMRMTCXID</li>\n<li><strong></strong>RMSQLundo log</li>\n<li><strong></strong>TMTCTCRMRMTC</li>\n<li><strong></strong>RMTMTCTCRMRMundo log</li>\n<li><strong></strong>RMTMTCRMRMundo logundo log</li>\n</ol>\n<p><strong>Seata2PC2PC:</strong></p>\n<ol>\n<li>2PC RM RMXA  SeataRMjar</li>\n<li>2PCcommitrollback Phase2SeataPhase1 Phase2 </li>\n</ol>\n<h2 id=\"DockerSeata-NacosDB\"><a href=\"#DockerSeata-NacosDB\" class=\"headerlink\" title=\"DockerSeata-NacosDB\"></a>DockerSeata-NacosDB</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>1seata</strong></p>\n<p></p>\n<p><strong>2</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /Users/lison/work/data/dockerData/seata/resources</span><br></pre></td></tr></table></figure>\n\n<p><strong>3</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\</span><br><span class=\"line\">--name seata \\</span><br><span class=\"line\">seataio/seata-server</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker cp seata:/seata-server/resources /Users/lison/work/data/dockerData/seata/</span><br></pre></td></tr></table></figure>\n\n<p><strong>5</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rm -f seata</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"SeataNacos\"><a href=\"#SeataNacos\" class=\"headerlink\" title=\"SeataNacos\"></a><strong>SeataNacos</strong></h3><p>nacosseata</p>\n<blockquote>\n<p><a href=\"https://github.com/apache/incubator-seata/tree/2.x/script/config-center\">https://github.com/apache/incubator-seata/tree/2.x/script/config-center</a></p>\n</blockquote>\n<p></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">transport.type</span>=<span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">transport.server</span>=<span class=\"string\">NIO</span></span><br><span class=\"line\"><span class=\"attr\">transport.heartbeat</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">transport.enableClientBatchSendRequest</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.bossThreadPrefix</span>=<span class=\"string\">NettyBoss</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.workerThreadPrefix</span>=<span class=\"string\">NettyServerNIOWorker</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.serverExecutorThreadPrefix</span>=<span class=\"string\">NettyServerBizHandler</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.shareBossWorker</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.clientSelectorThreadPrefix</span>=<span class=\"string\">NettyClientSelector</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.clientSelectorThreadSize</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.clientWorkerThreadPrefix</span>=<span class=\"string\">NettyClientWorkerThread</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.bossThreadSize</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.workerThreadSize</span>=<span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">transport.shutdown.wait</span>=<span class=\"string\">3</span></span><br><span class=\"line\"><span class=\"attr\">service.vgroupMapping.my_test_tx_group</span>=<span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">service.default.grouplist</span>=<span class=\"string\">127.0.0.1:8091</span></span><br><span class=\"line\"><span class=\"attr\">service.enableDegrade</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">service.disableGlobalTransaction</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.asyncCommitBufferLimit</span>=<span class=\"string\">10000</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.lock.retryInterval</span>=<span class=\"string\">10</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.lock.retryTimes</span>=<span class=\"string\">30</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.lock.retryPolicyBranchRollbackOnConflict</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.reportRetryCount</span>=<span class=\"string\">5</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.tableMetaCheckEnable</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.tableMetaCheckerInterval</span>=<span class=\"string\">60000</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.sqlParserType</span>=<span class=\"string\">druid</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.reportSuccessEnable</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.sagaBranchRegisterEnable</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.tccActionInterceptorOrder</span>=<span class=\"string\">-2147482648</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.commitRetryCount</span>=<span class=\"string\">5</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.rollbackRetryCount</span>=<span class=\"string\">5</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.defaultGlobalTransactionTimeout</span>=<span class=\"string\">60000</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.degradeCheck</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.degradeCheckAllowTimes</span>=<span class=\"string\">10</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.degradeCheckPeriod</span>=<span class=\"string\">2000</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.interceptorOrder</span>=<span class=\"string\">-2147482648</span></span><br><span class=\"line\"><span class=\"attr\">store.mode</span>=<span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">store.lock.mode</span>=<span class=\"string\">file</span></span><br><span class=\"line\"><span class=\"attr\">store.session.mode</span>=<span class=\"string\">file</span></span><br><span class=\"line\"><span class=\"attr\">store.file.dir</span>=<span class=\"string\">file_store/data</span></span><br><span class=\"line\"><span class=\"attr\">store.file.maxBranchSessionSize</span>=<span class=\"string\">16384</span></span><br><span class=\"line\"><span class=\"attr\">store.file.maxGlobalSessionSize</span>=<span class=\"string\">512</span></span><br><span class=\"line\"><span class=\"attr\">store.file.fileWriteBufferCacheSize</span>=<span class=\"string\">16384</span></span><br><span class=\"line\"><span class=\"attr\">store.file.flushDiskMode</span>=<span class=\"string\">async</span></span><br><span class=\"line\"><span class=\"attr\">store.file.sessionReloadReadSize</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">store.db.datasource</span>=<span class=\"string\">druid</span></span><br><span class=\"line\"><span class=\"attr\">store.db.dbType</span>=<span class=\"string\">mysql</span></span><br><span class=\"line\"><span class=\"attr\">store.db.driverClassName</span>=<span class=\"string\">com.mysql.jdbc.Driver</span></span><br><span class=\"line\"><span class=\"attr\">store.db.url</span>=<span class=\"string\">jdbc:mysql://172.18.0.2:3306/seata-server?useUnicode=true&amp;rewriteBatchedStatements=true</span></span><br><span class=\"line\"><span class=\"attr\">store.db.user</span>=<span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">store.db.password</span>=<span class=\"string\">123456</span></span><br><span class=\"line\"><span class=\"attr\">store.db.minConn</span>=<span class=\"string\">5</span></span><br><span class=\"line\"><span class=\"attr\">store.db.maxConn</span>=<span class=\"string\">30</span></span><br><span class=\"line\"><span class=\"attr\">store.db.globalTable</span>=<span class=\"string\">global_table</span></span><br><span class=\"line\"><span class=\"attr\">store.db.branchTable</span>=<span class=\"string\">branch_table</span></span><br><span class=\"line\"><span class=\"attr\">store.db.queryLimit</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">store.db.lockTable</span>=<span class=\"string\">lock_table</span></span><br><span class=\"line\"><span class=\"attr\">store.db.maxWait</span>=<span class=\"string\">5000</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.mode</span>=<span class=\"string\">single</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.single.host</span>=<span class=\"string\">127.0.0.1</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.single.port</span>=<span class=\"string\">6379</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.maxConn</span>=<span class=\"string\">10</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.minConn</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.maxTotal</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.database</span>=<span class=\"string\">0</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.queryLimit</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">server.recovery.committingRetryPeriod</span>=<span class=\"string\">1000</span></span><br><span class=\"line\"><span class=\"attr\">server.recovery.asynCommittingRetryPeriod</span>=<span class=\"string\">1000</span></span><br><span class=\"line\"><span class=\"attr\">server.recovery.rollbackingRetryPeriod</span>=<span class=\"string\">1000</span></span><br><span class=\"line\"><span class=\"attr\">server.recovery.timeoutRetryPeriod</span>=<span class=\"string\">1000</span></span><br><span class=\"line\"><span class=\"attr\">server.maxCommitRetryTimeout</span>=<span class=\"string\">-1</span></span><br><span class=\"line\"><span class=\"attr\">server.maxRollbackRetryTimeout</span>=<span class=\"string\">-1</span></span><br><span class=\"line\"><span class=\"attr\">server.rollbackRetryTimeoutUnlockEnable</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">server.distributedLockExpireTime</span>=<span class=\"string\">10000</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.dataValidation</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.logSerialization</span>=<span class=\"string\">jackson</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.onlyCareUpdateColumns</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">server.undo.logSaveDays</span>=<span class=\"string\">7</span></span><br><span class=\"line\"><span class=\"attr\">server.undo.logDeletePeriod</span>=<span class=\"string\">86400000</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.logTable</span>=<span class=\"string\">undo_log</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.compress.enable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.compress.type</span>=<span class=\"string\">zip</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.compress.threshold</span>=<span class=\"string\">64k</span></span><br><span class=\"line\"><span class=\"attr\">log.exceptionRate</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">transport.serialization</span>=<span class=\"string\">seata</span></span><br><span class=\"line\"><span class=\"attr\">transport.compressor</span>=<span class=\"string\">none</span></span><br><span class=\"line\"><span class=\"attr\">metrics.enabled</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">metrics.registryType</span>=<span class=\"string\">compact</span></span><br><span class=\"line\"><span class=\"attr\">metrics.exporterList</span>=<span class=\"string\">prometheus</span></span><br><span class=\"line\"><span class=\"attr\">metrics.exporterPrometheusPort</span>=<span class=\"string\">9898</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>nacosseata-server.properties:</p>\n<p><img src=\"/typora-user-images/image-20240524174544128.png\" alt=\"image-20240524174544128\"></p>\n<h3 id=\"application-yml\"><a href=\"#application-yml\" class=\"headerlink\" title=\"application.yml\"></a><strong>application.yml</strong></h3><p>resourcesapplication.yml,nacosapplication.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  Copyright 1999-2019 Seata.io Group.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">#  you may not use this file except in compliance with the License.</span></span><br><span class=\"line\"><span class=\"comment\">#  You may obtain a copy of the License at</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  Unless required by applicable law or agreed to in writing, software</span></span><br><span class=\"line\"><span class=\"comment\">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class=\"line\"><span class=\"comment\">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class=\"line\"><span class=\"comment\">#  See the License for the specific language governing permissions and</span></span><br><span class=\"line\"><span class=\"comment\">#  limitations under the License.</span></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">7091</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">seata-server</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"attr\">console:</span></span><br><span class=\"line\">  <span class=\"attr\">user:</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">seata</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">seata</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">seata:</span></span><br><span class=\"line\">  <span class=\"attr\">config:</span></span><br><span class=\"line\">    <span class=\"comment\"># support: nacos, consul, apollo, zk, etcd3</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">nacos</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">server-addr:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.6</span><span class=\"string\">:8848</span>   <span class=\"comment\"># nacosdockerip</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">seata</span></span><br><span class=\"line\">      <span class=\"attr\">group:</span> <span class=\"string\">DEFAULT_GROUP</span>  <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">nacos</span>     <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">nacos</span>     <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">context-path:</span></span><br><span class=\"line\">      <span class=\"comment\">#file-extension: yaml # </span></span><br><span class=\"line\">      <span class=\"comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></span><br><span class=\"line\">      <span class=\"comment\">#access-key:</span></span><br><span class=\"line\">      <span class=\"comment\">#secret-key:</span></span><br><span class=\"line\">      <span class=\"attr\">data-id:</span> <span class=\"string\">seata-server.properties</span> <span class=\"comment\"># nacos</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"comment\"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">nacos</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">application:</span> <span class=\"string\">seata-server</span>       <span class=\"comment\"># seatanacos</span></span><br><span class=\"line\">      <span class=\"attr\">server-addr:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.6</span><span class=\"string\">:8848</span>  <span class=\"comment\"># nacosdockerip</span></span><br><span class=\"line\">      <span class=\"attr\">group:</span> <span class=\"string\">DEFAULT_GROUP</span>   <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">seata</span></span><br><span class=\"line\">      <span class=\"attr\">cluster:</span> <span class=\"string\">default</span>     <span class=\"comment\"># seata</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">nacos</span>      <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">nacos</span>      <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">context-path:</span></span><br><span class=\"line\">      <span class=\"comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></span><br><span class=\"line\">      <span class=\"comment\">#access-key:</span></span><br><span class=\"line\">      <span class=\"comment\">#secret-key:</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">security:</span></span><br><span class=\"line\">    <span class=\"attr\">secretKey:</span> <span class=\"string\">SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</span></span><br><span class=\"line\">    <span class=\"attr\">tokenValidityInMilliseconds:</span> <span class=\"number\">1800000</span></span><br><span class=\"line\">    <span class=\"attr\">ignore:</span></span><br><span class=\"line\">      <span class=\"attr\">urls:</span> <span class=\"string\">/,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/api/v1/auth/login</span>    </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>webconsoleusernamepassword</p>\n<h3 id=\"seatamysql\"><a href=\"#seatamysql\" class=\"headerlink\" title=\"seatamysql\"></a>seatamysql</h3><p>TC </p>\n<ul>\n<li><a href=\"https://github.com/apache/incubator-seata/blob/2.x/script/server/db/mysql.sql\">https://github.com/apache/incubator-seata/blob/2.x/script/server/db/mysql.sql</a></li>\n</ul>\n<p>script\\server\\db mysqlmysql.sql</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"comment\">-- Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class=\"line\"><span class=\"comment\">-- contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class=\"line\"><span class=\"comment\">-- this work for additional information regarding copyright ownership.</span></span><br><span class=\"line\"><span class=\"comment\">-- The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class=\"line\"><span class=\"comment\">-- (the &quot;License&quot;); you may not use this file except in compliance with</span></span><br><span class=\"line\"><span class=\"comment\">-- the License.  You may obtain a copy of the License at</span></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"comment\">--     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"comment\">-- Unless required by applicable law or agreed to in writing, software</span></span><br><span class=\"line\"><span class=\"comment\">-- distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class=\"line\"><span class=\"comment\">-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class=\"line\"><span class=\"comment\">-- See the License for the specific language governing permissions and</span></span><br><span class=\"line\"><span class=\"comment\">-- limitations under the License.</span></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- -------------------------------- The script used when storeMode is &#x27;db&#x27; --------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- the table to store GlobalSession data</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> `global_table`</span><br><span class=\"line\">(</span><br><span class=\"line\">    `xid`                       <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `transaction_id`            <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    `status`                    TINYINT      <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `application_id`            <span class=\"type\">VARCHAR</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">    `transaction_service_group` <span class=\"type\">VARCHAR</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">    `transaction_name`          <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>),</span><br><span class=\"line\">    `timeout`                   <span class=\"type\">INT</span>,</span><br><span class=\"line\">    `begin_time`                <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    `application_data`          <span class=\"type\">VARCHAR</span>(<span class=\"number\">2000</span>),</span><br><span class=\"line\">    `gmt_create`                DATETIME,</span><br><span class=\"line\">    `gmt_modified`              DATETIME,</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY KEY</span> (`xid`),</span><br><span class=\"line\">    KEY `idx_status_gmt_modified` (`status` , `gmt_modified`),</span><br><span class=\"line\">    KEY `idx_transaction_id` (`transaction_id`)</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> CHARSET <span class=\"operator\">=</span> utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- the table to store BranchSession data</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> `branch_table`</span><br><span class=\"line\">(</span><br><span class=\"line\">    `branch_id`         <span class=\"type\">BIGINT</span>       <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `xid`               <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `transaction_id`    <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    `resource_group_id` <span class=\"type\">VARCHAR</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">    `resource_id`       <span class=\"type\">VARCHAR</span>(<span class=\"number\">256</span>),</span><br><span class=\"line\">    `branch_type`       <span class=\"type\">VARCHAR</span>(<span class=\"number\">8</span>),</span><br><span class=\"line\">    `status`            TINYINT,</span><br><span class=\"line\">    `client_id`         <span class=\"type\">VARCHAR</span>(<span class=\"number\">64</span>),</span><br><span class=\"line\">    `application_data`  <span class=\"type\">VARCHAR</span>(<span class=\"number\">2000</span>),</span><br><span class=\"line\">    `gmt_create`        DATETIME(<span class=\"number\">6</span>),</span><br><span class=\"line\">    `gmt_modified`      DATETIME(<span class=\"number\">6</span>),</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY KEY</span> (`branch_id`),</span><br><span class=\"line\">    KEY `idx_xid` (`xid`)</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> CHARSET <span class=\"operator\">=</span> utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- the table to store lock data</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> `lock_table`</span><br><span class=\"line\">(</span><br><span class=\"line\">    `row_key`        <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `xid`            <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>),</span><br><span class=\"line\">    `transaction_id` <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    `branch_id`      <span class=\"type\">BIGINT</span>       <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `resource_id`    <span class=\"type\">VARCHAR</span>(<span class=\"number\">256</span>),</span><br><span class=\"line\">    `table_name`     <span class=\"type\">VARCHAR</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">    `pk`             <span class=\"type\">VARCHAR</span>(<span class=\"number\">36</span>),</span><br><span class=\"line\">    `status`         TINYINT      <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"string\">&#x27;0&#x27;</span> COMMENT <span class=\"string\">&#x27;0:locked ,1:rollbacking&#x27;</span>,</span><br><span class=\"line\">    `gmt_create`     DATETIME,</span><br><span class=\"line\">    `gmt_modified`   DATETIME,</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY KEY</span> (`row_key`),</span><br><span class=\"line\">    KEY `idx_status` (`status`),</span><br><span class=\"line\">    KEY `idx_branch_id` (`branch_id`),</span><br><span class=\"line\">    KEY `idx_xid` (`xid`)</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> CHARSET <span class=\"operator\">=</span> utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> `distributed_lock`</span><br><span class=\"line\">(</span><br><span class=\"line\">    `lock_key`       <span class=\"type\">CHAR</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `lock_value`     <span class=\"type\">VARCHAR</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `expire`         <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    <span class=\"keyword\">primary key</span> (`lock_key`)</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> CHARSET <span class=\"operator\">=</span> utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;AsyncCommitting&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;RetryCommitting&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;RetryRollbacking&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;TxTimeoutCheck&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>, <span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"docker-compose-yaml\"><a href=\"#docker-compose-yaml\" class=\"headerlink\" title=\"docker-compose.yaml\"></a><strong>docker-compose.yaml</strong></h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Seata </span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\"><span class=\"comment\"># seata1</span></span><br><span class=\"line\">  <span class=\"attr\">seata-server1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">seataio/seata-server</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">seata-server1</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">8091</span><span class=\"string\">:8091</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">7091</span><span class=\"string\">:7091</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">LANG=en_US.UTF-8</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">STORE_MODE=db</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">SEATA_IP=127.0.0.1</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">SEATA_PORT=8091</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/seata/resources:/seata-server/resources</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>SEATA_IPseata-serverIPIP<br>SEATA_PORTseata-server 8091<br>STORE_MODEseata-server dbfileredis file<br>SERVER_NODE, seata-serverID,  1,2,3IP<br>SEATA_ENV seata-server  devtest  registry-dev.conf </p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>1Seata</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>2nacos</strong></p>\n<p><img src=\"/typora-user-images/image-20240524175254196.png\" alt=\"image-20240524175254196\"></p>\n<p><strong>3</strong></p>\n<blockquote>\n<p><a href=\"http://127.0.0.1:7091/#/\">http://127.0.0.1:7091/#/</a></p>\n</blockquote>\n<ul>\n<li>seata</li>\n<li>seata</li>\n<li>application.ymlconsole</li>\n</ul>\n<p><img src=\"/typora-user-images/image-20240524175527451.png\" alt=\"image-20240524175527451\"></p>\n<h2 id=\"Seata\"><a href=\"#Seata\" class=\"headerlink\" title=\"Seata\"></a>Seata</h2><p>Seata<br></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>1demospringbootbuild,test,sql:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">DROP TABLE IF EXISTS `test`;</span><br><span class=\"line\">CREATE TABLE `test` (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `one` varchar(255) DEFAULT NULL,</span><br><span class=\"line\">  `two` varchar(255) DEFAULT NULL,</span><br><span class=\"line\">  `createTime` datetime DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE TABLE `t_user` (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `user_name` varchar(255) DEFAULT NULL COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `sex` tinyint(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;01&#x27;,</span><br><span class=\"line\">  `age` int(3) DEFAULT &#x27;0&#x27; COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `address` varchar(255) DEFAULT NULL COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `phone` varchar(11) DEFAULT NULL COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `create_time` datetime DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO `t_test` VALUES (&#x27;1&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;2024-05-27 16:07:34&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO `t_user`  VALUES(&#x27;1&#x27;, &#x27;name&#x27;, &#x27;0&#x27;, &#x27;11&#x27;,&#x27;&#x27;,&#x27;18818900000&#x27;,&#x27;2024-05-27 16:07:34&#x27;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;exclusions&gt;</span><br><span class=\"line\">        &lt;exclusion&gt;</span><br><span class=\"line\">            &lt;groupId&gt;io.seata&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;seata-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/exclusion&gt;</span><br><span class=\"line\">    &lt;/exclusions&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;io.seata&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;seata-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;1.4.2&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n<p>1.4.2file.confregistry.conf</p>\n<p>3</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">master:</span></span><br><span class=\"line\">      <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/springbootbuild?useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"number\">123456</span></span><br><span class=\"line\">      <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.jdbc.Driver</span></span><br><span class=\"line\">      <span class=\"attr\">initialSize:</span> <span class=\"number\">5</span></span><br><span class=\"line\">      <span class=\"attr\">minIdle:</span> <span class=\"number\">5</span></span><br><span class=\"line\">      <span class=\"attr\">maxActive:</span> <span class=\"number\">20</span></span><br><span class=\"line\">      <span class=\"attr\">maxWait:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">      <span class=\"attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">      <span class=\"attr\">minEvictableIdleTimeMillis:</span> <span class=\"number\">300000</span></span><br><span class=\"line\">      <span class=\"attr\">validationQuery:</span> <span class=\"string\">SELECT</span> <span class=\"string\">user()</span></span><br><span class=\"line\">      <span class=\"attr\">testWhileIdle:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">testOnBorrow:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">testOnReturn:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">poolPreparedStatements:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">connection-properties:</span> <span class=\"string\">druid.stat.mergeSql:true;druid.stat.slowSqlMillis:5000</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"attr\">seata:</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">nacos</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">&quot;seata&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">group:</span> <span class=\"string\">DEFAULT_GROUP</span></span><br><span class=\"line\">      <span class=\"attr\">application:</span> <span class=\"string\">seata-server</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">nacos</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">nacos</span>    </span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"seata\"><a href=\"#seata\" class=\"headerlink\" title=\"seata\"></a>seata</h3><p>DatabaseConfigurationSeataRMDataSourceProxyTCundo_log</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.config.base;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.ApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.sql.DataSource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.config.base-&gt; DatabaseConfiguration</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2024-05-27</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DatabaseConfiguration</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ApplicationContext applicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">DatabaseConfiguration</span><span class=\"params\">(ApplicationContext applicationContext)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.applicationContext = applicationContext;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@ConfigurationProperties(prefix = &quot;spring.datasource.master&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DruidDataSource <span class=\"title function_\">ds0</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DruidDataSource</span> <span class=\"variable\">druidDataSource</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DruidDataSource</span>();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> druidDataSource;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DataSource <span class=\"title function_\">dataSource</span><span class=\"params\">(DruidDataSource ds0)</span>  &#123;</span><br><span class=\"line\">        <span class=\"type\">DataSourceProxy</span> <span class=\"variable\">pds0</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DataSourceProxy</span>(ds0);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pds0;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>spirngbootspirngboot</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//springboot</span><br><span class=\"line\">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span><br><span class=\"line\">@EnableDiscoveryClient</span><br><span class=\"line\">@EnableFeignClients</span><br><span class=\"line\">public class SpringCloudServiceApplication &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringCloudServiceApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"undo-log\"><a href=\"#undo-log\" class=\"headerlink\" title=\"undo_log\"></a>undo_log</h3><p>undo_log<br>springseata server</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-- ----------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">-- Table structure for undo_log</span><br><span class=\"line\"></span><br><span class=\"line\">-- ----------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">DROP TABLE IF EXISTS `undo_log`;</span><br><span class=\"line\">CREATE TABLE `undo_log` (</span><br><span class=\"line\">  `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `branch_id` bigint(20) NOT NULL,</span><br><span class=\"line\">  `xid` varchar(100) NOT NULL,</span><br><span class=\"line\">  `context` varchar(128) NOT NULL,</span><br><span class=\"line\">  `rollback_info` longblob NOT NULL,</span><br><span class=\"line\">  `log_status` int(11) NOT NULL,</span><br><span class=\"line\">  `log_created` datetime NOT NULL,</span><br><span class=\"line\">  `log_modified` datetime NOT NULL,</span><br><span class=\"line\">  `ext` varchar(100) DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`),</span><br><span class=\"line\">  UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;</span><br><span class=\"line\"></span><br><span class=\"line\">-- ----------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">-- Records of undo_log</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<h3 id=\"seata\"><a href=\"#seata\" class=\"headerlink\" title=\"seata\"></a>seata</h3><p><strong>Controller</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.service.ITestService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.service.TestGlobalTransServiceImpl;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.controller-&gt; TestSeataController</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2024-05-27</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(value = &quot;/test/&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSeataController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> TestGlobalTransServiceImpl testGlobalTransService;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/seataTrans&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">testSeataTrans</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        testGlobalTransService.testTrans();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;success&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>Service</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.seata.spring.annotation.GlobalTransactional;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.service-&gt; TestGlobalTransService</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2024-05-27</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestGlobalTransServiceImpl</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ITestService iTestService;</span><br><span class=\"line\">    <span class=\"comment\">//@GlobalTransactional</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testTrans</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        iTestService.insertUser();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        iTestService.insertTest();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Exception</span>(<span class=\"string\">&quot;test exception&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>spring</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.mapper.TestMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.mapper.UserMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.service.ITestService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.service.impl-&gt; TestServiceImpl</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2024-05-27</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestServiceImpl</span>  <span class=\"keyword\">implements</span> <span class=\"title class_\">ITestService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserMapper userMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> TestMapper testMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Transactional(rollbackFor = Exception.class)</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">insertUser</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        userMapper.insert();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Transactional(rollbackFor = Exception.class)</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">insertTest</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        testMapper.insert();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>Mapper</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Mapper</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">TestMapper</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Insert(&quot;insert into t_test(one,two,createTime) values ( 0,18,now())&quot;)</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"title function_\">insert</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Mapper</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">UserMapper</span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Insert(&quot;insert into t_user (user_name,sex,age, create_time) values (&#x27;aaaaaaaaa&#x27;, 0,18,now())&quot;)</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"title function_\">insert</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<p>1<a href=\"http://localhost:18001/test/seataTrans\">http://localhost:18001/test/seataTrans</a></p>\n<p>2 @GlobalTransactional </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024-05-27 16:58:57.346 [TID:Ignored_Trace] [http-nio-18001-exec-1] INFO  c.l.s.config.seata.SeataInterceptor -xid in RootContext[null] xid in HttpContext[null]</span><br><span class=\"line\">2024-05-27 16:58:57.504 [TID:Ignored_Trace] [http-nio-18001-exec-1] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] -Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.Exception: test exception] with root cause</span><br><span class=\"line\">java.lang.Exception: test exception</span><br><span class=\"line\">\tat com.lison.springcloudservice.service.TestGlobalTransServiceImpl.testTrans(TestGlobalTransServiceImpl.java:24)</span><br><span class=\"line\">\tat com.lison.springcloudservice.controller.TestSeataController.$sw$original$testSeataTrans$6lb26m3(TestSeataController.java:25)</span><br><span class=\"line\">\tat com.lison.springcloudservice.controller.TestSeataController.$sw$original$testSeataTrans$6lb26m3$accessor$$sw$ful2f31(TestSeataController.java)</span><br><span class=\"line\">\tat com.lison.springcloudservice.controller.TestSeataController$$sw$auxiliary$p4qqk42.call(Unknown Source)</span><br><span class=\"line\">\tat org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter.intercept(InstMethodsInter.java:86)</span><br><span class=\"line\">\tat com.lison.springcloudservice.controller.TestSeataController.testSeataTrans(TestSeataController.java)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class=\"line\">\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class=\"line\">\tat java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class=\"line\">\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)</span><br><span class=\"line\">\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)</span><br><span class=\"line\">\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105)</span><br><span class=\"line\">\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879)</span><br><span class=\"line\">\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793)</span><br><span class=\"line\">\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)</span><br><span class=\"line\">\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040)</span><br><span class=\"line\">\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)</span><br><span class=\"line\">\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)</span><br><span class=\"line\">\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898)</span><br><span class=\"line\">\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:634)</span><br><span class=\"line\">\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)</span><br><span class=\"line\">\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:741)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat brave.servlet.TracingFilter.doFilter(TracingFilter.java:68)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)</span><br><span class=\"line\">\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)</span><br><span class=\"line\">\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat brave.servlet.TracingFilter.doFilter(TracingFilter.java:87)</span><br><span class=\"line\">\tat org.springframework.cloud.sleuth.instrument.web.LazyTracingFilter.doFilter(TraceWebServletAutoConfiguration.java:139)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:109)</span><br><span class=\"line\">\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)</span><br><span class=\"line\">\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class=\"line\">\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardHostValve.$sw$original$invoke$6qrnli3(StandardHostValve.java:139)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardHostValve.$sw$original$invoke$6qrnli3$accessor$$sw$p8ebm33(StandardHostValve.java)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardHostValve$$sw$auxiliary$1213ni1.call(Unknown Source)</span><br><span class=\"line\">\tat org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter.intercept(InstMethodsInter.java:86)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java)</span><br><span class=\"line\">\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)</span><br><span class=\"line\">\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)</span><br><span class=\"line\">\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)</span><br><span class=\"line\">\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)</span><br><span class=\"line\">\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)</span><br><span class=\"line\">\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1594)</span><br><span class=\"line\">\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\">2024-05-27 16:58:57.516 [TID:Ignored_Trace] [http-nio-18001-exec-1] INFO  c.l.s.config.seata.SeataInterceptor -xid in RootContext[null] xid in HttpContext[null]</span><br><span class=\"line\">2024-05-27 16:58:58.508 [TID:N/A] [AsyncReporter&#123;org.springframework.cloud.sleuth.zipkin2.sender.RestTemplateSender@3f169051&#125;] WARN  z.r.AsyncReporter$BoundedAsyncReporter -Spans were dropped due to exceptions. All subsequent errors will be logged at FINE level.</span><br></pre></td></tr></table></figure>\n\n\n\n<p>3</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> */</span><br><span class=\"line\">@Service</span><br><span class=\"line\">public class TestGlobalTransServiceImpl &#123;</span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private ITestService iTestService;</span><br><span class=\"line\">    @GlobalTransactional</span><br><span class=\"line\">    public void testTrans() throws Exception &#123;</span><br><span class=\"line\">        // </span><br><span class=\"line\">        iTestService.insertUser();</span><br><span class=\"line\">        // </span><br><span class=\"line\">        iTestService.insertTest();</span><br><span class=\"line\">        // </span><br><span class=\"line\">        throw new Exception(&quot;test exception&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>4</p>\n","excerpt":"","more":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2024.5.03</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-09-Seata\"><a href=\"#Spring-Cloud-Alibaba-09-Seata\" class=\"headerlink\" title=\"Spring Cloud Alibaba-09-Seata\"></a>Spring Cloud Alibaba-09-Seata</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> :</p>\n<ul>\n<li>A:(Atomicity)</li>\n<li>C:(Consistency)</li>\n<li>I:(Isolation)</li>\n<li>D:(Durability)</li>\n</ul>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br></p>\n<p><br></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>1</strong></p>\n<p><img src=\"/typora-user-images/image-20240514095424805.png\" alt=\"image-20240514095424805\"></p>\n<p><strong>2</strong></p>\n<p><img src=\"/typora-user-images/image-20240514095650303.png\" alt=\"image-20240514095650303\"></p>\n<p>3</p>\n<p><img src=\"/typora-user-images/image-20240514095835213.png\" alt=\"image-20240514095835213\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>DTPDTPX&#x2F;OpenX&#x2F;Open Distributed Transaction Processing Reference Model:</p>\n<ul>\n<li>AP: Application  ()</li>\n<li>TM: Transaction Manager  ()</li>\n<li>RM: Resource Manager  ()</li>\n</ul>\n<p>:</p>\n<ul>\n<li>: </li>\n<li>:  </li>\n</ul>\n<p><img src=\"/typora-user-images/image-20240516094845785.png\" alt=\"image-20240516094845785\"></p>\n<p></p>\n<ul>\n<li></li>\n</ul>\n<p></p>\n<ul>\n<li>: </li>\n<li>: </li>\n<li>: commit</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>AB ABAB </p>\n<p><img src=\"/typora-user-images/image-20240520161819461.png\" alt=\"image-20240520161819461\"></p>\n<p><strong>: A</strong></p>\n<ol>\n<li>AA</li>\n<li>A</li>\n<li>AA</li>\n<li>ACommitRollbackA </li>\n<li>CommitB;Rollback CommitRollback</li>\n</ol>\n<blockquote>\n<p><br>A  A :<br>:B<br>:<br>:</p>\n</blockquote>\n<p><strong>: B</strong></p>\n<p><br></p>\n<ul>\n<li></li>\n<li><br><br>A<br></li>\n</ul>\n<p>;</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br></p>\n<p><img src=\"/typora-user-images/image-20240521094502177.png\" alt=\"image-20240521094502177\"></p>\n<p><strong>: A</strong></p>\n<ol>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n</ol>\n<p><strong>: B</strong></p>\n<ol>\n<li></li>\n<li><br></li>\n<li></li>\n<li></li>\n</ol>\n<p>:<br>   <strong>:</strong> <br>   <strong>:</strong> </p>\n<h3 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h3><p>TCCTry Confirm CancelTCC:</p>\n<p><strong>Try:</strong></p>\n<p></p>\n<p><strong>Confirm:</strong></p>\n<p> TryTCC  Confirm:TryConfirmConfirm </p>\n<p><strong>Cancel:</strong></p>\n<p>TryTCCCancel Cancel</p>\n<p><img src=\"/typora-user-images/image-20240522090312508.png\" alt=\"image-20240522090312508\"></p>\n<p><img src=\"/typora-user-images/image-20240522090352573.png\" alt=\"image-20240522090352573\"></p>\n<p>TCCXA:<br>XA<br>TCC</p>\n<p>TCC:</p>\n<p><strong></strong>:2PC<br><strong></strong>:TCCTryConfirmCancel</p>\n<h2 id=\"Seata\"><a href=\"#Seata\" class=\"headerlink\" title=\"Seata\"></a>Seata</h2><p>2019  1  Fescar(Fast &amp; EaSy Commit And Rollback)  Seata:Simple Extensible Autonomous Transaction Architecture</p>\n<p><a href=\"https://seata.apache.org/\">https://seata.apache.org/</a></p>\n<p><img src=\"/typora-user-images/image-20240522091143334.png\" alt=\"image-20240522091143334\"></p>\n<p>Seata2PC2PC   </p>\n<p><img src=\"/typora-user-images/image-20240522090958255.png\" alt=\"image-20240522090958255\"></p>\n<p>Seata:</p>\n<p><strong>TC</strong>:Transaction Coordinator  </p>\n<p><strong>TM</strong>:Transaction Manager </p>\n<p>**RM:**Resource Manager TC TC</p>\n<p><img src=\"/typora-user-images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3J1aXBlbmcyNTA=,size_16,color_FFFFFF,t_70-6340401.png\" alt=\"\"></p>\n<p><strong>Seata:</strong></p>\n<ol>\n<li><strong></strong>TMTCTCIDXID</li>\n<li><strong></strong>TMRMRMTCXID</li>\n<li><strong></strong>RMSQLundo log</li>\n<li><strong></strong>TMTCTCRMRMTC</li>\n<li><strong></strong>RMTMTCTCRMRMundo log</li>\n<li><strong></strong>RMTMTCRMRMundo logundo log</li>\n</ol>\n<p><strong>Seata2PC2PC:</strong></p>\n<ol>\n<li>2PC RM RMXA  SeataRMjar</li>\n<li>2PCcommitrollback Phase2SeataPhase1 Phase2 </li>\n</ol>\n<h2 id=\"DockerSeata-NacosDB\"><a href=\"#DockerSeata-NacosDB\" class=\"headerlink\" title=\"DockerSeata-NacosDB\"></a>DockerSeata-NacosDB</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>1seata</strong></p>\n<p></p>\n<p><strong>2</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /Users/lison/work/data/dockerData/seata/resources</span><br></pre></td></tr></table></figure>\n\n<p><strong>3</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\</span><br><span class=\"line\">--name seata \\</span><br><span class=\"line\">seataio/seata-server</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker cp seata:/seata-server/resources /Users/lison/work/data/dockerData/seata/</span><br></pre></td></tr></table></figure>\n\n<p><strong>5</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rm -f seata</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"SeataNacos\"><a href=\"#SeataNacos\" class=\"headerlink\" title=\"SeataNacos\"></a><strong>SeataNacos</strong></h3><p>nacosseata</p>\n<blockquote>\n<p><a href=\"https://github.com/apache/incubator-seata/tree/2.x/script/config-center\">https://github.com/apache/incubator-seata/tree/2.x/script/config-center</a></p>\n</blockquote>\n<p></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">transport.type</span>=<span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">transport.server</span>=<span class=\"string\">NIO</span></span><br><span class=\"line\"><span class=\"attr\">transport.heartbeat</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">transport.enableClientBatchSendRequest</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.bossThreadPrefix</span>=<span class=\"string\">NettyBoss</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.workerThreadPrefix</span>=<span class=\"string\">NettyServerNIOWorker</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.serverExecutorThreadPrefix</span>=<span class=\"string\">NettyServerBizHandler</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.shareBossWorker</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.clientSelectorThreadPrefix</span>=<span class=\"string\">NettyClientSelector</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.clientSelectorThreadSize</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.clientWorkerThreadPrefix</span>=<span class=\"string\">NettyClientWorkerThread</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.bossThreadSize</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"attr\">transport.threadFactory.workerThreadSize</span>=<span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">transport.shutdown.wait</span>=<span class=\"string\">3</span></span><br><span class=\"line\"><span class=\"attr\">service.vgroupMapping.my_test_tx_group</span>=<span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">service.default.grouplist</span>=<span class=\"string\">127.0.0.1:8091</span></span><br><span class=\"line\"><span class=\"attr\">service.enableDegrade</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">service.disableGlobalTransaction</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.asyncCommitBufferLimit</span>=<span class=\"string\">10000</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.lock.retryInterval</span>=<span class=\"string\">10</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.lock.retryTimes</span>=<span class=\"string\">30</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.lock.retryPolicyBranchRollbackOnConflict</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.reportRetryCount</span>=<span class=\"string\">5</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.tableMetaCheckEnable</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.tableMetaCheckerInterval</span>=<span class=\"string\">60000</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.sqlParserType</span>=<span class=\"string\">druid</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.reportSuccessEnable</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.sagaBranchRegisterEnable</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.rm.tccActionInterceptorOrder</span>=<span class=\"string\">-2147482648</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.commitRetryCount</span>=<span class=\"string\">5</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.rollbackRetryCount</span>=<span class=\"string\">5</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.defaultGlobalTransactionTimeout</span>=<span class=\"string\">60000</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.degradeCheck</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.degradeCheckAllowTimes</span>=<span class=\"string\">10</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.degradeCheckPeriod</span>=<span class=\"string\">2000</span></span><br><span class=\"line\"><span class=\"attr\">client.tm.interceptorOrder</span>=<span class=\"string\">-2147482648</span></span><br><span class=\"line\"><span class=\"attr\">store.mode</span>=<span class=\"string\">db</span></span><br><span class=\"line\"><span class=\"attr\">store.lock.mode</span>=<span class=\"string\">file</span></span><br><span class=\"line\"><span class=\"attr\">store.session.mode</span>=<span class=\"string\">file</span></span><br><span class=\"line\"><span class=\"attr\">store.file.dir</span>=<span class=\"string\">file_store/data</span></span><br><span class=\"line\"><span class=\"attr\">store.file.maxBranchSessionSize</span>=<span class=\"string\">16384</span></span><br><span class=\"line\"><span class=\"attr\">store.file.maxGlobalSessionSize</span>=<span class=\"string\">512</span></span><br><span class=\"line\"><span class=\"attr\">store.file.fileWriteBufferCacheSize</span>=<span class=\"string\">16384</span></span><br><span class=\"line\"><span class=\"attr\">store.file.flushDiskMode</span>=<span class=\"string\">async</span></span><br><span class=\"line\"><span class=\"attr\">store.file.sessionReloadReadSize</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">store.db.datasource</span>=<span class=\"string\">druid</span></span><br><span class=\"line\"><span class=\"attr\">store.db.dbType</span>=<span class=\"string\">mysql</span></span><br><span class=\"line\"><span class=\"attr\">store.db.driverClassName</span>=<span class=\"string\">com.mysql.jdbc.Driver</span></span><br><span class=\"line\"><span class=\"attr\">store.db.url</span>=<span class=\"string\">jdbc:mysql://172.18.0.2:3306/seata-server?useUnicode=true&amp;rewriteBatchedStatements=true</span></span><br><span class=\"line\"><span class=\"attr\">store.db.user</span>=<span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">store.db.password</span>=<span class=\"string\">123456</span></span><br><span class=\"line\"><span class=\"attr\">store.db.minConn</span>=<span class=\"string\">5</span></span><br><span class=\"line\"><span class=\"attr\">store.db.maxConn</span>=<span class=\"string\">30</span></span><br><span class=\"line\"><span class=\"attr\">store.db.globalTable</span>=<span class=\"string\">global_table</span></span><br><span class=\"line\"><span class=\"attr\">store.db.branchTable</span>=<span class=\"string\">branch_table</span></span><br><span class=\"line\"><span class=\"attr\">store.db.queryLimit</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">store.db.lockTable</span>=<span class=\"string\">lock_table</span></span><br><span class=\"line\"><span class=\"attr\">store.db.maxWait</span>=<span class=\"string\">5000</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.mode</span>=<span class=\"string\">single</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.single.host</span>=<span class=\"string\">127.0.0.1</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.single.port</span>=<span class=\"string\">6379</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.maxConn</span>=<span class=\"string\">10</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.minConn</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.maxTotal</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.database</span>=<span class=\"string\">0</span></span><br><span class=\"line\"><span class=\"attr\">store.redis.queryLimit</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">server.recovery.committingRetryPeriod</span>=<span class=\"string\">1000</span></span><br><span class=\"line\"><span class=\"attr\">server.recovery.asynCommittingRetryPeriod</span>=<span class=\"string\">1000</span></span><br><span class=\"line\"><span class=\"attr\">server.recovery.rollbackingRetryPeriod</span>=<span class=\"string\">1000</span></span><br><span class=\"line\"><span class=\"attr\">server.recovery.timeoutRetryPeriod</span>=<span class=\"string\">1000</span></span><br><span class=\"line\"><span class=\"attr\">server.maxCommitRetryTimeout</span>=<span class=\"string\">-1</span></span><br><span class=\"line\"><span class=\"attr\">server.maxRollbackRetryTimeout</span>=<span class=\"string\">-1</span></span><br><span class=\"line\"><span class=\"attr\">server.rollbackRetryTimeoutUnlockEnable</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">server.distributedLockExpireTime</span>=<span class=\"string\">10000</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.dataValidation</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.logSerialization</span>=<span class=\"string\">jackson</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.onlyCareUpdateColumns</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">server.undo.logSaveDays</span>=<span class=\"string\">7</span></span><br><span class=\"line\"><span class=\"attr\">server.undo.logDeletePeriod</span>=<span class=\"string\">86400000</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.logTable</span>=<span class=\"string\">undo_log</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.compress.enable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.compress.type</span>=<span class=\"string\">zip</span></span><br><span class=\"line\"><span class=\"attr\">client.undo.compress.threshold</span>=<span class=\"string\">64k</span></span><br><span class=\"line\"><span class=\"attr\">log.exceptionRate</span>=<span class=\"string\">100</span></span><br><span class=\"line\"><span class=\"attr\">transport.serialization</span>=<span class=\"string\">seata</span></span><br><span class=\"line\"><span class=\"attr\">transport.compressor</span>=<span class=\"string\">none</span></span><br><span class=\"line\"><span class=\"attr\">metrics.enabled</span>=<span class=\"string\">false</span></span><br><span class=\"line\"><span class=\"attr\">metrics.registryType</span>=<span class=\"string\">compact</span></span><br><span class=\"line\"><span class=\"attr\">metrics.exporterList</span>=<span class=\"string\">prometheus</span></span><br><span class=\"line\"><span class=\"attr\">metrics.exporterPrometheusPort</span>=<span class=\"string\">9898</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>nacosseata-server.properties:</p>\n<p><img src=\"/typora-user-images/image-20240524174544128.png\" alt=\"image-20240524174544128\"></p>\n<h3 id=\"application-yml\"><a href=\"#application-yml\" class=\"headerlink\" title=\"application.yml\"></a><strong>application.yml</strong></h3><p>resourcesapplication.yml,nacosapplication.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  Copyright 1999-2019 Seata.io Group.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">#  you may not use this file except in compliance with the License.</span></span><br><span class=\"line\"><span class=\"comment\">#  You may obtain a copy of the License at</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  Unless required by applicable law or agreed to in writing, software</span></span><br><span class=\"line\"><span class=\"comment\">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class=\"line\"><span class=\"comment\">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class=\"line\"><span class=\"comment\">#  See the License for the specific language governing permissions and</span></span><br><span class=\"line\"><span class=\"comment\">#  limitations under the License.</span></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">7091</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">seata-server</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"attr\">console:</span></span><br><span class=\"line\">  <span class=\"attr\">user:</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">seata</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">seata</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">seata:</span></span><br><span class=\"line\">  <span class=\"attr\">config:</span></span><br><span class=\"line\">    <span class=\"comment\"># support: nacos, consul, apollo, zk, etcd3</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">nacos</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">server-addr:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.6</span><span class=\"string\">:8848</span>   <span class=\"comment\"># nacosdockerip</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">seata</span></span><br><span class=\"line\">      <span class=\"attr\">group:</span> <span class=\"string\">DEFAULT_GROUP</span>  <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">nacos</span>     <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">nacos</span>     <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">context-path:</span></span><br><span class=\"line\">      <span class=\"comment\">#file-extension: yaml # </span></span><br><span class=\"line\">      <span class=\"comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></span><br><span class=\"line\">      <span class=\"comment\">#access-key:</span></span><br><span class=\"line\">      <span class=\"comment\">#secret-key:</span></span><br><span class=\"line\">      <span class=\"attr\">data-id:</span> <span class=\"string\">seata-server.properties</span> <span class=\"comment\"># nacos</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"comment\"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">nacos</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">application:</span> <span class=\"string\">seata-server</span>       <span class=\"comment\"># seatanacos</span></span><br><span class=\"line\">      <span class=\"attr\">server-addr:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.6</span><span class=\"string\">:8848</span>  <span class=\"comment\"># nacosdockerip</span></span><br><span class=\"line\">      <span class=\"attr\">group:</span> <span class=\"string\">DEFAULT_GROUP</span>   <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">seata</span></span><br><span class=\"line\">      <span class=\"attr\">cluster:</span> <span class=\"string\">default</span>     <span class=\"comment\"># seata</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">nacos</span>      <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">nacos</span>      <span class=\"comment\"># nacos</span></span><br><span class=\"line\">      <span class=\"attr\">context-path:</span></span><br><span class=\"line\">      <span class=\"comment\">##if use MSE Nacos with auth, mutex with username/password attribute</span></span><br><span class=\"line\">      <span class=\"comment\">#access-key:</span></span><br><span class=\"line\">      <span class=\"comment\">#secret-key:</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">security:</span></span><br><span class=\"line\">    <span class=\"attr\">secretKey:</span> <span class=\"string\">SeataSecretKey0c382ef121d778043159209298fd40bf3850a017</span></span><br><span class=\"line\">    <span class=\"attr\">tokenValidityInMilliseconds:</span> <span class=\"number\">1800000</span></span><br><span class=\"line\">    <span class=\"attr\">ignore:</span></span><br><span class=\"line\">      <span class=\"attr\">urls:</span> <span class=\"string\">/,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/api/v1/auth/login</span>    </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>webconsoleusernamepassword</p>\n<h3 id=\"seatamysql\"><a href=\"#seatamysql\" class=\"headerlink\" title=\"seatamysql\"></a>seatamysql</h3><p>TC </p>\n<ul>\n<li><a href=\"https://github.com/apache/incubator-seata/blob/2.x/script/server/db/mysql.sql\">https://github.com/apache/incubator-seata/blob/2.x/script/server/db/mysql.sql</a></li>\n</ul>\n<p>script\\server\\db mysqlmysql.sql</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"comment\">-- Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class=\"line\"><span class=\"comment\">-- contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class=\"line\"><span class=\"comment\">-- this work for additional information regarding copyright ownership.</span></span><br><span class=\"line\"><span class=\"comment\">-- The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class=\"line\"><span class=\"comment\">-- (the &quot;License&quot;); you may not use this file except in compliance with</span></span><br><span class=\"line\"><span class=\"comment\">-- the License.  You may obtain a copy of the License at</span></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"comment\">--     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"comment\">-- Unless required by applicable law or agreed to in writing, software</span></span><br><span class=\"line\"><span class=\"comment\">-- distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class=\"line\"><span class=\"comment\">-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class=\"line\"><span class=\"comment\">-- See the License for the specific language governing permissions and</span></span><br><span class=\"line\"><span class=\"comment\">-- limitations under the License.</span></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- -------------------------------- The script used when storeMode is &#x27;db&#x27; --------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">-- the table to store GlobalSession data</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> `global_table`</span><br><span class=\"line\">(</span><br><span class=\"line\">    `xid`                       <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `transaction_id`            <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    `status`                    TINYINT      <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `application_id`            <span class=\"type\">VARCHAR</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">    `transaction_service_group` <span class=\"type\">VARCHAR</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">    `transaction_name`          <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>),</span><br><span class=\"line\">    `timeout`                   <span class=\"type\">INT</span>,</span><br><span class=\"line\">    `begin_time`                <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    `application_data`          <span class=\"type\">VARCHAR</span>(<span class=\"number\">2000</span>),</span><br><span class=\"line\">    `gmt_create`                DATETIME,</span><br><span class=\"line\">    `gmt_modified`              DATETIME,</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY KEY</span> (`xid`),</span><br><span class=\"line\">    KEY `idx_status_gmt_modified` (`status` , `gmt_modified`),</span><br><span class=\"line\">    KEY `idx_transaction_id` (`transaction_id`)</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> CHARSET <span class=\"operator\">=</span> utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- the table to store BranchSession data</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> `branch_table`</span><br><span class=\"line\">(</span><br><span class=\"line\">    `branch_id`         <span class=\"type\">BIGINT</span>       <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `xid`               <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `transaction_id`    <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    `resource_group_id` <span class=\"type\">VARCHAR</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">    `resource_id`       <span class=\"type\">VARCHAR</span>(<span class=\"number\">256</span>),</span><br><span class=\"line\">    `branch_type`       <span class=\"type\">VARCHAR</span>(<span class=\"number\">8</span>),</span><br><span class=\"line\">    `status`            TINYINT,</span><br><span class=\"line\">    `client_id`         <span class=\"type\">VARCHAR</span>(<span class=\"number\">64</span>),</span><br><span class=\"line\">    `application_data`  <span class=\"type\">VARCHAR</span>(<span class=\"number\">2000</span>),</span><br><span class=\"line\">    `gmt_create`        DATETIME(<span class=\"number\">6</span>),</span><br><span class=\"line\">    `gmt_modified`      DATETIME(<span class=\"number\">6</span>),</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY KEY</span> (`branch_id`),</span><br><span class=\"line\">    KEY `idx_xid` (`xid`)</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> CHARSET <span class=\"operator\">=</span> utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- the table to store lock data</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> `lock_table`</span><br><span class=\"line\">(</span><br><span class=\"line\">    `row_key`        <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `xid`            <span class=\"type\">VARCHAR</span>(<span class=\"number\">128</span>),</span><br><span class=\"line\">    `transaction_id` <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    `branch_id`      <span class=\"type\">BIGINT</span>       <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `resource_id`    <span class=\"type\">VARCHAR</span>(<span class=\"number\">256</span>),</span><br><span class=\"line\">    `table_name`     <span class=\"type\">VARCHAR</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">    `pk`             <span class=\"type\">VARCHAR</span>(<span class=\"number\">36</span>),</span><br><span class=\"line\">    `status`         TINYINT      <span class=\"keyword\">NOT NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"string\">&#x27;0&#x27;</span> COMMENT <span class=\"string\">&#x27;0:locked ,1:rollbacking&#x27;</span>,</span><br><span class=\"line\">    `gmt_create`     DATETIME,</span><br><span class=\"line\">    `gmt_modified`   DATETIME,</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY KEY</span> (`row_key`),</span><br><span class=\"line\">    KEY `idx_status` (`status`),</span><br><span class=\"line\">    KEY `idx_branch_id` (`branch_id`),</span><br><span class=\"line\">    KEY `idx_xid` (`xid`)</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> CHARSET <span class=\"operator\">=</span> utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> `distributed_lock`</span><br><span class=\"line\">(</span><br><span class=\"line\">    `lock_key`       <span class=\"type\">CHAR</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `lock_value`     <span class=\"type\">VARCHAR</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT NULL</span>,</span><br><span class=\"line\">    `expire`         <span class=\"type\">BIGINT</span>,</span><br><span class=\"line\">    <span class=\"keyword\">primary key</span> (`lock_key`)</span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB</span><br><span class=\"line\">  <span class=\"keyword\">DEFAULT</span> CHARSET <span class=\"operator\">=</span> utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;AsyncCommitting&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;RetryCommitting&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;RetryRollbacking&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;TxTimeoutCheck&#x27;</span>, <span class=\"string\">&#x27; &#x27;</span>, <span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"docker-compose-yaml\"><a href=\"#docker-compose-yaml\" class=\"headerlink\" title=\"docker-compose.yaml\"></a><strong>docker-compose.yaml</strong></h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Seata </span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\"><span class=\"comment\"># seata1</span></span><br><span class=\"line\">  <span class=\"attr\">seata-server1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">seataio/seata-server</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">seata-server1</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">8091</span><span class=\"string\">:8091</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">7091</span><span class=\"string\">:7091</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">LANG=en_US.UTF-8</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">STORE_MODE=db</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">SEATA_IP=127.0.0.1</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">SEATA_PORT=8091</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/seata/resources:/seata-server/resources</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>SEATA_IPseata-serverIPIP<br>SEATA_PORTseata-server 8091<br>STORE_MODEseata-server dbfileredis file<br>SERVER_NODE, seata-serverID,  1,2,3IP<br>SEATA_ENV seata-server  devtest  registry-dev.conf </p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong>1Seata</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>2nacos</strong></p>\n<p><img src=\"/typora-user-images/image-20240524175254196.png\" alt=\"image-20240524175254196\"></p>\n<p><strong>3</strong></p>\n<blockquote>\n<p><a href=\"http://127.0.0.1:7091/#/\">http://127.0.0.1:7091/#/</a></p>\n</blockquote>\n<ul>\n<li>seata</li>\n<li>seata</li>\n<li>application.ymlconsole</li>\n</ul>\n<p><img src=\"/typora-user-images/image-20240524175527451.png\" alt=\"image-20240524175527451\"></p>\n<h2 id=\"Seata\"><a href=\"#Seata\" class=\"headerlink\" title=\"Seata\"></a>Seata</h2><p>Seata<br></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>1demospringbootbuild,test,sql:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">DROP TABLE IF EXISTS `test`;</span><br><span class=\"line\">CREATE TABLE `test` (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `one` varchar(255) DEFAULT NULL,</span><br><span class=\"line\">  `two` varchar(255) DEFAULT NULL,</span><br><span class=\"line\">  `createTime` datetime DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4;</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE TABLE `t_user` (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `user_name` varchar(255) DEFAULT NULL COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `sex` tinyint(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;01&#x27;,</span><br><span class=\"line\">  `age` int(3) DEFAULT &#x27;0&#x27; COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `address` varchar(255) DEFAULT NULL COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `phone` varchar(11) DEFAULT NULL COMMENT &#x27;&#x27;,</span><br><span class=\"line\">  `create_time` datetime DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO `t_test` VALUES (&#x27;1&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;2024-05-27 16:07:34&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO `t_user`  VALUES(&#x27;1&#x27;, &#x27;name&#x27;, &#x27;0&#x27;, &#x27;11&#x27;,&#x27;&#x27;,&#x27;18818900000&#x27;,&#x27;2024-05-27 16:07:34&#x27;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;exclusions&gt;</span><br><span class=\"line\">        &lt;exclusion&gt;</span><br><span class=\"line\">            &lt;groupId&gt;io.seata&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;seata-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/exclusion&gt;</span><br><span class=\"line\">    &lt;/exclusions&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;io.seata&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;seata-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;1.4.2&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n<p>1.4.2file.confregistry.conf</p>\n<p>3</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">master:</span></span><br><span class=\"line\">      <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/springbootbuild?useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"number\">123456</span></span><br><span class=\"line\">      <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.jdbc.Driver</span></span><br><span class=\"line\">      <span class=\"attr\">initialSize:</span> <span class=\"number\">5</span></span><br><span class=\"line\">      <span class=\"attr\">minIdle:</span> <span class=\"number\">5</span></span><br><span class=\"line\">      <span class=\"attr\">maxActive:</span> <span class=\"number\">20</span></span><br><span class=\"line\">      <span class=\"attr\">maxWait:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">      <span class=\"attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">      <span class=\"attr\">minEvictableIdleTimeMillis:</span> <span class=\"number\">300000</span></span><br><span class=\"line\">      <span class=\"attr\">validationQuery:</span> <span class=\"string\">SELECT</span> <span class=\"string\">user()</span></span><br><span class=\"line\">      <span class=\"attr\">testWhileIdle:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">testOnBorrow:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">testOnReturn:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">poolPreparedStatements:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">connection-properties:</span> <span class=\"string\">druid.stat.mergeSql:true;druid.stat.slowSqlMillis:5000</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"attr\">seata:</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">nacos</span></span><br><span class=\"line\">    <span class=\"attr\">nacos:</span></span><br><span class=\"line\">      <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">&quot;seata&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">group:</span> <span class=\"string\">DEFAULT_GROUP</span></span><br><span class=\"line\">      <span class=\"attr\">application:</span> <span class=\"string\">seata-server</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">nacos</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">nacos</span>    </span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"seata\"><a href=\"#seata\" class=\"headerlink\" title=\"seata\"></a>seata</h3><p>DatabaseConfigurationSeataRMDataSourceProxyTCundo_log</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.config.base;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.ApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.sql.DataSource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.config.base-&gt; DatabaseConfiguration</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2024-05-27</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DatabaseConfiguration</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ApplicationContext applicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">DatabaseConfiguration</span><span class=\"params\">(ApplicationContext applicationContext)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.applicationContext = applicationContext;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@ConfigurationProperties(prefix = &quot;spring.datasource.master&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DruidDataSource <span class=\"title function_\">ds0</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DruidDataSource</span> <span class=\"variable\">druidDataSource</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DruidDataSource</span>();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> druidDataSource;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DataSource <span class=\"title function_\">dataSource</span><span class=\"params\">(DruidDataSource ds0)</span>  &#123;</span><br><span class=\"line\">        <span class=\"type\">DataSourceProxy</span> <span class=\"variable\">pds0</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DataSourceProxy</span>(ds0);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pds0;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>spirngbootspirngboot</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//springboot</span><br><span class=\"line\">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span><br><span class=\"line\">@EnableDiscoveryClient</span><br><span class=\"line\">@EnableFeignClients</span><br><span class=\"line\">public class SpringCloudServiceApplication &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringCloudServiceApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"undo-log\"><a href=\"#undo-log\" class=\"headerlink\" title=\"undo_log\"></a>undo_log</h3><p>undo_log<br>springseata server</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-- ----------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">-- Table structure for undo_log</span><br><span class=\"line\"></span><br><span class=\"line\">-- ----------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">DROP TABLE IF EXISTS `undo_log`;</span><br><span class=\"line\">CREATE TABLE `undo_log` (</span><br><span class=\"line\">  `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `branch_id` bigint(20) NOT NULL,</span><br><span class=\"line\">  `xid` varchar(100) NOT NULL,</span><br><span class=\"line\">  `context` varchar(128) NOT NULL,</span><br><span class=\"line\">  `rollback_info` longblob NOT NULL,</span><br><span class=\"line\">  `log_status` int(11) NOT NULL,</span><br><span class=\"line\">  `log_created` datetime NOT NULL,</span><br><span class=\"line\">  `log_modified` datetime NOT NULL,</span><br><span class=\"line\">  `ext` varchar(100) DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`),</span><br><span class=\"line\">  UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;</span><br><span class=\"line\"></span><br><span class=\"line\">-- ----------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">-- Records of undo_log</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<h3 id=\"seata\"><a href=\"#seata\" class=\"headerlink\" title=\"seata\"></a>seata</h3><p><strong>Controller</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.service.ITestService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.service.TestGlobalTransServiceImpl;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.controller-&gt; TestSeataController</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2024-05-27</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(value = &quot;/test/&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSeataController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> TestGlobalTransServiceImpl testGlobalTransService;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/seataTrans&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">testSeataTrans</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        testGlobalTransService.testTrans();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;success&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>Service</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.seata.spring.annotation.GlobalTransactional;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.service-&gt; TestGlobalTransService</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2024-05-27</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestGlobalTransServiceImpl</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ITestService iTestService;</span><br><span class=\"line\">    <span class=\"comment\">//@GlobalTransactional</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testTrans</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        iTestService.insertUser();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        iTestService.insertTest();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Exception</span>(<span class=\"string\">&quot;test exception&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>spring</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.springcloudservice.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.mapper.TestMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.mapper.UserMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lison.springcloudservice.service.ITestService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@className</span>: com.lison.springcloudservice.service.impl-&gt; TestServiceImpl</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span>: Lison</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@createDate</span>: 2024-05-27</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestServiceImpl</span>  <span class=\"keyword\">implements</span> <span class=\"title class_\">ITestService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserMapper userMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> TestMapper testMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Transactional(rollbackFor = Exception.class)</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">insertUser</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        userMapper.insert();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Transactional(rollbackFor = Exception.class)</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">insertTest</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        testMapper.insert();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>Mapper</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Mapper</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">TestMapper</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Insert(&quot;insert into t_test(one,two,createTime) values ( 0,18,now())&quot;)</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"title function_\">insert</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Mapper</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">UserMapper</span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Insert(&quot;insert into t_user (user_name,sex,age, create_time) values (&#x27;aaaaaaaaa&#x27;, 0,18,now())&quot;)</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"title function_\">insert</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<p>1<a href=\"http://localhost:18001/test/seataTrans\">http://localhost:18001/test/seataTrans</a></p>\n<p>2 @GlobalTransactional </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2024-05-27 16:58:57.346 [TID:Ignored_Trace] [http-nio-18001-exec-1] INFO  c.l.s.config.seata.SeataInterceptor -xid in RootContext[null] xid in HttpContext[null]</span><br><span class=\"line\">2024-05-27 16:58:57.504 [TID:Ignored_Trace] [http-nio-18001-exec-1] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] -Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.Exception: test exception] with root cause</span><br><span class=\"line\">java.lang.Exception: test exception</span><br><span class=\"line\">\tat com.lison.springcloudservice.service.TestGlobalTransServiceImpl.testTrans(TestGlobalTransServiceImpl.java:24)</span><br><span class=\"line\">\tat com.lison.springcloudservice.controller.TestSeataController.$sw$original$testSeataTrans$6lb26m3(TestSeataController.java:25)</span><br><span class=\"line\">\tat com.lison.springcloudservice.controller.TestSeataController.$sw$original$testSeataTrans$6lb26m3$accessor$$sw$ful2f31(TestSeataController.java)</span><br><span class=\"line\">\tat com.lison.springcloudservice.controller.TestSeataController$$sw$auxiliary$p4qqk42.call(Unknown Source)</span><br><span class=\"line\">\tat org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter.intercept(InstMethodsInter.java:86)</span><br><span class=\"line\">\tat com.lison.springcloudservice.controller.TestSeataController.testSeataTrans(TestSeataController.java)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class=\"line\">\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class=\"line\">\tat java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class=\"line\">\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)</span><br><span class=\"line\">\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)</span><br><span class=\"line\">\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105)</span><br><span class=\"line\">\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879)</span><br><span class=\"line\">\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793)</span><br><span class=\"line\">\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)</span><br><span class=\"line\">\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040)</span><br><span class=\"line\">\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)</span><br><span class=\"line\">\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)</span><br><span class=\"line\">\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898)</span><br><span class=\"line\">\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:634)</span><br><span class=\"line\">\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)</span><br><span class=\"line\">\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:741)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat brave.servlet.TracingFilter.doFilter(TracingFilter.java:68)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)</span><br><span class=\"line\">\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)</span><br><span class=\"line\">\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat brave.servlet.TracingFilter.doFilter(TracingFilter.java:87)</span><br><span class=\"line\">\tat org.springframework.cloud.sleuth.instrument.web.LazyTracingFilter.doFilter(TraceWebServletAutoConfiguration.java:139)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:109)</span><br><span class=\"line\">\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)</span><br><span class=\"line\">\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class=\"line\">\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardHostValve.$sw$original$invoke$6qrnli3(StandardHostValve.java:139)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardHostValve.$sw$original$invoke$6qrnli3$accessor$$sw$p8ebm33(StandardHostValve.java)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardHostValve$$sw$auxiliary$1213ni1.call(Unknown Source)</span><br><span class=\"line\">\tat org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter.intercept(InstMethodsInter.java:86)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java)</span><br><span class=\"line\">\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)</span><br><span class=\"line\">\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)</span><br><span class=\"line\">\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)</span><br><span class=\"line\">\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)</span><br><span class=\"line\">\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)</span><br><span class=\"line\">\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1594)</span><br><span class=\"line\">\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\">2024-05-27 16:58:57.516 [TID:Ignored_Trace] [http-nio-18001-exec-1] INFO  c.l.s.config.seata.SeataInterceptor -xid in RootContext[null] xid in HttpContext[null]</span><br><span class=\"line\">2024-05-27 16:58:58.508 [TID:N/A] [AsyncReporter&#123;org.springframework.cloud.sleuth.zipkin2.sender.RestTemplateSender@3f169051&#125;] WARN  z.r.AsyncReporter$BoundedAsyncReporter -Spans were dropped due to exceptions. All subsequent errors will be logged at FINE level.</span><br></pre></td></tr></table></figure>\n\n\n\n<p>3</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> */</span><br><span class=\"line\">@Service</span><br><span class=\"line\">public class TestGlobalTransServiceImpl &#123;</span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private ITestService iTestService;</span><br><span class=\"line\">    @GlobalTransactional</span><br><span class=\"line\">    public void testTrans() throws Exception &#123;</span><br><span class=\"line\">        // </span><br><span class=\"line\">        iTestService.insertUser();</span><br><span class=\"line\">        // </span><br><span class=\"line\">        iTestService.insertTest();</span><br><span class=\"line\">        // </span><br><span class=\"line\">        throw new Exception(&quot;test exception&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>4</p>\n"},{"_content":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.09.10`\n\n# Spring Cloud Alibaba-04-Sentinel\n\n[toc]\n\n\n\n## \n\n 100% \n\n\n\n## \n\n,, 100%   \n\n   \n\n![image-20231024102201145](typora-user-images/image-20231024102201145.png)\n\n\n\n\"\"\n\n\n\n\n\n## \n\n , \n\n****\n\n\n\n- ****\n\n  \n  \n  :.\n\n\n\n![image-20231024104338016](typora-user-images/image-20231024104338016.png)\n\n\n\n* ****\n\n\n\n![image-20231201143940420](typora-user-images/image-20231201143940420.png)\n\n\n\n* ****\n\n, ,\n\n![image-20231201144020748](typora-user-images/image-20231201144020748.png)\n\n* ****\n\n \n\n![image-20231201144119343](typora-user-images/image-20231201144119343.png)\n\n:\n\n* (Closed)   \n* Open  fallback \n* Half-Open\t  ;\n\n\n\n\n\n* ****\n\n\n\n![image-20231201153117052](typora-user-images/image-20231201153117052.png)\n\n\n\n****\n\n**Hystrix**\nHystrixNetflix \n\n**Resilience4J**\nResilicence4JHystrix Resilicence4jSpring Boot 1.x/2.x prometheus\n\n**Sentinel**\nSentinel  :\n\n|                | Sentinel                                                   | Hystrix                | Resilience4J                     |\n| -------------- | ---------------------------------------------------------- | ---------------------- | -------------------------------- |\n|        |                                | /  |                        |\n|    |                              |            |            |\n|    | LeapArray                                      | RxJava | Ring Bit Buffer                  |\n|    |                                                |            |                          |\n|          |                                                  |              |                        |\n|  |                                                        |                    |                              |\n|            | QPS,                             |                  | Rate Limiter                     |\n|        |                      |                  | Rate Limiter           |\n|  |                                                        |                  |                            |\n|          |  |          |  |\n\n\n\n## Sentinel\n\n### Sentinel\n\nSentinel () **** , ****\n\n\n\nSentinel:\n\nSentinel :\n\n** :**Sentinel  10 , ( ) \n:Sentinel  ,  500 \n****:Sentinel /,  Spring CloudDubbogRPC  Sentinel\n\n** SPI :**Sentinel  SPI  \n\n**Sentinel :**\n\n* (Java )/, Java  Dubbo / Spring Cloud \n* (Dashboard) Spring Boot  Tomcat  \n\n\n\n### Sentinel\n\nSentinel, Sentinel\n\n**1pom.xml**\n\n~~~xml\n<dependency>\n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>\n</dependency>\n\n~~~\n\n\n\n**2application.yml sentinel**\n**`ymlclient-ip ip`**\n\n~~~yaml\nspring:\n    cloud:\n        sentinel:\n            transport:\n                dashboard: 192.168.32.131:8858\n                client-ip: 192.168.32.1\n                port: 8719\n\n~~~\n\n\n\n\n\n\n\n**3Controller**\n\n~~~java\n@RestController\npublic class TestSentinelController {\n\n    @RequestMapping(\"/sentinel/message1\")\n    public String message1() {\n        return \"message1\";\n    }\n    @RequestMapping(\"/sentinel/message2\")\n    public String message2() {\n        return \"message2\";\n    }\n    \n}\n~~~\n\n\n\n### Sentinel\n\nSentinel , \n\n**1jar**\n\n~~~\njar, https://github.com/alibaba/Sentinel/releases \n\n\n\n# jar(SpringBoot)\njava -Dserver.port=8858 -Dcsp.sentinel.dashboard.server=localhost:8858 - Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.1.jar \n\n\n~~~\n\n\n\n2docker\n\n~~~\n\n//sentinel\ndocker pull bladex/sentinel-dashboard:1.8.1\n\n\n\n//\ndocker run --name sentinel  -d -p 8858:8858 -p 8719:8719 -d bladex/sentinel-dashboard:1.8.1 -e username=sentinel -e password=sentinel -e server=localhost:8858\n~~~\n\n\n\nlocalhost:8858  (  sentinel/sentinel )\n\n\n\n\n\n\n\n**Sentinel Sentinel **\n\n\n\n\n\n**:**\n\nSentinelSpringBoot, , ,  \n\n![image-20240219114233026](typora-user-images/image-20240219114233026.png)\n\n\n\n![image-20240219113719157](typora-user-images/image-20240219113719157.png)\n\n\n\n\n\n\n\n## \n\n\n\n1message1\n\n\n\n![image-20240219114343151](typora-user-images/image-20240219114343151.png)\n\n\n\n2, \n\n![image-20240219114515952](typora-user-images/image-20240219114515952.png)\n\n## Sentinel\n\n\n\n### \n\n* ****\n\nSentinel\n\nSentinelJava\n\n>message1\n\n* ****\n\n\n\n\n\n>message1message1\n\n### \n\n\n\n![image-20240219144606520](typora-user-images/image-20240219144606520.png)\n\nSentinel,:\n\n**1**\n  Sentinel \n\n**2**\n\n\n\n\n\n\n**Sentinel :**\n\n(1)\n\nSentinel    \n\n(2)\n\nSentinel   \n\n\n\n**Sentinel  Hystrix **\n\n>, , ,  , :\n>\n>~~~\n>       Hystrix , ,   \n>\n>       Sentinel  \n>~~~\n\n\n\n**3**\n\nSentinel   Sentinel   : Sentinel \n\n\n\n## Sentinel\n\n\n\n### \n\nQPS()  \n\n1:  :\n\n![image-20240219150634816](typora-user-images/image-20240219150634816.png)\n\n\n\n**:**\n\n:default\n\n**/:**\n\n* QPS(): QPS\n* :\n\n**:** QPS\n\n\n\n#### \n\nQPS33\n\n\n\n![image-20240219150821657](typora-user-images/image-20240219150821657.png)\n\n /order/message1 QPS > 3 Blocked by Sentinel (flow limiting)\n\n![image-20240219150910898](typora-user-images/image-20240219150910898.png)\n\n#### \n\n![image-20240219151031448](typora-user-images/image-20240219151031448.png)\n\nsentinel:\n\n****():\n\n****: []\n\n****:\n\n\n\n:\n\n****\n\n\n\n****\n\n\n\n1:,  /sentinel/message2\n\n![image-20240219151212695](typora-user-images/image-20240219151212695.png)\n\n2:postman/sentinel/message2QPS3\n\n![image-20240219152607457](typora-user-images/image-20240219152607457.png)\n\n\n\n3:/sentinel/message1,\n\n![image-20240219152638390](typora-user-images/image-20240219152638390.png)\n\n****\n\n :** **\n\n\n\n1: servicemessage\n\n~~~java\n@Service\npublic class TestSentinelMessage3ServiceImpl {\n    @SentinelResource(\"message\")\n    public void message() {\n        System.out.println(\"message\");\n    }\n}\n~~~\n\n\n\n2: Controllerservice\n\n~~~java\n\n@RestController\npublic class TestSentinelController {\n\n    @Autowired\n    private TestSentinelMessage3ServiceImpl testSentinelMessage3Service;\n\n    @RequestMapping(\"/sentinel/message1\")\n    public String message1() {\n        testSentinelMessage3Service.message();\n        return \"message1\";\n    }\n    @RequestMapping(\"/sentinel/message2\")\n    public String message2() {\n        testSentinelMessage3Service.message();\n        return \"message2\";\n    }\n\n}\n~~~\n\n\n\n\n\n![image-20240219154032740](typora-user-images/image-20240219154032740.png)\n\n  /sentinel/message1  /sentinel/message2 , 2, 1\n\n#### \n\n**():** \n\n**Warm Up:**QPSQPS 1/3\n\n\n**:**;  \n\n###  Sentinel:\n\n\n\n####  (SLOW_REQUEST_RATIO)\n\n RT\n\nstatIntervalMs1\n\n> HALF-OPEN  RT  RT \n\n-  RT200 200\n- 0~1\n- ``1108 0.8\n- java 400\n\n\n\n\n\n1.  > RT\n2. statIntervalMs> \n3.  > maxSlowRequestRatio\n4. HALF-OPEN  RT \n\n4001s5\n\n![image-20240220094227461](typora-user-images/image-20240220094227461.png)\n\n\n\n `HALF-OPEN  RT  RT `\n\n\n\n\n\n![image-20240220095107292](typora-user-images/image-20240220095107292.png)\n\n####  (ERROR_RATIO)\n\nstatIntervalMs  s \n\nHALF-OPEN \n\n [0.0, 1.0] 0% - 100%\n\n\n\n![image-20240220095645324](typora-user-images/image-20240220095645324.png)\n\n![image-20240220101010503](typora-user-images/image-20240220101010503.png)\n\n####  (ERROR_COUNT)\n\n1s\n\nHALF-OPEN \n\ntimeWindow 60s\n\n\n\n![image-20240220101429844](typora-user-images/image-20240220101429844.png)\n\n50%1\n\n\n\n![image-20240220101701432](typora-user-images/image-20240220101701432.png)\n\n\n\n### \n\n, \n\n****\n\n1\n\n~~~java\n@RequestMapping(\"/sentinel/message3\")\n@SentinelResource(\"message3\")//, \npublic String message3(String name, Integer age) {\n  return name + age;\n}\n~~~\n\n2: \n\n\n\n![image-20240220102332812](typora-user-images/image-20240220102332812.png)\n\n3: ,\n\n\n\n![image-20240220102431979](typora-user-images/image-20240220102431979.png)\n\n![image-20240220102457440](typora-user-images/image-20240220102457440.png)\n\n\n\n\n\n\n\n****\n\n\n\n,\n\n![image-20240220102621265](typora-user-images/image-20240220102621265.png)\n\n### \n\n Sentinel  (origin):\n\n;\n\n\n![image-20240220102752041](typora-user-images/image-20240220102752041.png)\n\n?\n\n>Sentinel RequestOriginParser  SentinelSentinel RequestOriginParser \n>\n\n\n\n1: \n\n\n\n~~~java\n@Component\npublic class RequestOriginParserDefinition implements RequestOriginParser {\n    @Override\n    public String parseOrigin(HttpServletRequest request) {\n        String serviceName = request.getParameter(\"serviceName\");\n        return serviceName;\n    } \n} \n\n~~~\n\n\n\n2: \nserviceName=pc()\n\n\n\n![image-20240220103006353](typora-user-images/image-20240220103006353.png)\n\n\n\n3 http://localhost:18001/sentinel/message3?serviceName=pc  \n\n\n\n![image-20240220103217414](typora-user-images/image-20240220103217414.png)\n\n### \n\n LoadRT QPS CPU \n\n () \n\n* Load( Linux/Unix-like ): load1   maxQps * minRt   CPU cores * 2.5\n* RT: RT \n* :\n*  QPS: QPS \n* CPU: CPU\n\n\n\n**: **\n\n~~~java\n\n\n//\n@Component\npublic class ExceptionHandlerPage implements BlockExceptionHandler {\n    //BlockException ,Sentinel\n    // FlowException \n    // DegradeException \n    // ParamFlowException \n    // AuthorityException \n    // SystemBlockException \n\n\n    @Override\n    public void handle(HttpServletRequest request, HttpServletResponse response, BlockException ex) throws Exception {\n        String msg = null;\n        if (ex instanceof FlowException) {\n            msg = \"\";\n        } else if (ex instanceof DegradeException) {\n            msg = \"\";\n        } else if (ex instanceof ParamFlowException) {\n            msg = \"\";\n        } else if (ex instanceof SystemBlockException) {\n            msg = \"/...\";\n        } else if (ex instanceof AuthorityException) {\n            msg = \"\";\n        }\n        // http\n        response.setStatus(500);\n        response.setCharacterEncoding(\"utf-8\");\n        response.setHeader(\"Content-Type\", \"application/json;charset=utf-8\");\n        response.setContentType(\"application/json;charset=utf-8\");\n        // spring mvcjsonjackson\n        //json\n        response.setStatus(200);\n        response.setCharacterEncoding(\"utf-8\");\n        response.setContentType(MediaType.APPLICATION_JSON_VALUE);\n        //springmvc json jackson\n        new ObjectMapper().writeValue(response.getWriter(), msg);\n        //\n        //response.sendRedirect(\"http://www.baidu.com\");\n    }\n}\n~~~\n\n:SpringCloudAlibabasentinel UrlBlockHandler sentinel2.2.5.RELEASEBlockExceptionHandler\n\n\n\n\n\n## @SentinelResource\n\nDashboard\n@SentinelResource\n\n@SentinelResource  fallback :\n\n\n\n|                |                                                          |\n| ------------------ | ------------------------------------------------------------ |\n| value              |                                                      |\n| entryType          | entryIN/OUTOUT             |\n| blockHandler       | BlockException,:1.  public2. 3.  blockHandlerClass blockHandlerClass |\n| blockHandlerClass  | blockHandler,static            |\n| fallback           | fallbackfallback ( exceptionsToIgnore ) :1.  2. 3.  fallbackClass fallbackClass |\n| fallbackClass      | fallbackstatic             |\n| defaultFallback    |  fallback fallback  fallback  defaultFallbackfallback :1.  2.  Throwable 3.  fallbackClass  fallbackClass  |\n| exceptionsToIgnore |  fallback |\n| exceptionsToTrace  | trace                                              |\n\n****\n\n\n\n~~~java\n\n@Service\npublic class TestSentinelMessage3ServiceImpl {\n        int i = 0;\n\n        @SentinelResource(\n                value = \"message\",\n                blockHandler = \"blockHandler\",//BlockException\n                fallback = \"fallback\"//Throwable\n        )\n        public String message() {\n            i++;\n            if (i % 3 == 0) {\n                throw new RuntimeException();\n            }\n            return \"message\";\n        }\n\n        //BlockException\n        public String blockHandler(BlockException ex) {\n            return \"...\";\n        }\n\n        //Throwable\n        public String fallback(Throwable throwable) {\n            return \"...\";\n        }\n    \n\n~~~\n\n****\n\n~~~java\n@Service\n@Slf4j\npublic class TestSentinelMessage3ServiceImpl {\n    int i = 0;\n\n    @SentinelResource(\n            value = \"message\",\n            blockHandlerClass = TestSentinelMessage3ServiceImplBlockHandlerClass.class,\n            blockHandler = \"blockHandler\",\n            fallbackClass = TestSentinelMessage3ServiceImplFallbackClass.class,\n            fallback = \"fallback\"\n    )\n    public String message() {\n        i++;\n        if (i % 3 == 0) {\n            throw new RuntimeException();\n        }\n        return \"message4\";\n    }\n}\n\n@Slf4j\npublic class TestSentinelMessage3ServiceImplBlockHandlerClass { //static\n    public static String blockHandler(BlockException ex) {\n        log.error(\"{}\", ex);\n        return \"...\";\n    }\n}\n\n@Slf4j\npublic class TestSentinelMessage3ServiceImplFallbackClass { //static\n    public static String fallback(Throwable throwable) {\n        log.error(\"{}\", throwable);\n        return \"...\";\n    }\n} \n\n\n~~~\n\n\n\n## Sentinel\n\n\n\nDashboardSentinel \n\n### Sentinel:\n\n|  |                                                          |                          |                                                          |\n| -------- | ------------------------------------------------------------ | ---------------------------- | ------------------------------------------------------------ |\n|  | API                      |              |  |\n| Pull | WritableDataSourceRDBMS |  |  |\n| Push | ReadableDataSourceNacosZookeeperpush |      |                                                |\n\n\n\n#### \n\nDashboardAPI\n\n![img](typora-user-images/a7002eb5f5b8429c8b8728b9f2e3e10d.png)\n\n\n\n#### \n\npullRDBMS  RuleManagertransportWritableDataSourceRegistry\n\n\n\n![img](typora-user-images/afb25fa106bada4b37da64e902060269.png)\n\n\n\nSentinelAPI pullSentinel\n\n\n\n\n\n~~~xml\n<dependency>\n    <groupId>com.alibaba.csp</groupId>\n    <artifactId>sentinel-datasource-extension</artifactId>\n</dependency>\n~~~\n\nInitFuncinitDataSourcespi\n\n\n\n~~~java\n\npublic class FileDataSourceInit implements InitFunc {\n\n    private static final String RULE_FILE_PATH = System.getProperty(\"user.home\") + File.separator;\n\n    private static final String FLOW_RULE_FILE_NAME = \"FlowRule.json\";\n\n    @Override\n    public void init() throws Exception {\n\n        //\n        dealFlowRules();\n    }\n\n\n    private void dealFlowRules() throws FileNotFoundException {\n        String ruleFilePath = RULE_FILE_PATH + FLOW_RULE_FILE_NAME;\n\n        //\n        FileRefreshableDataSource flowRuleRDS = new FileRefreshableDataSource(\n                ruleFilePath, source -> JSON.parseObject((String) source,\n                new TypeReference<List<FlowRule>>() {\n                })\n        );\n\n        // FlowRuleManager \n        FlowRuleManager.register2Property(flowRuleRDS.getProperty());\n\n        WritableDataSource<List<FlowRule>> flowRuleWDS = new FileWritableDataSource<>(\n                ruleFilePath, this::encodeJson\n        );\n\n        //  transport  WritableDataSourceRegistry .\n        // Sentinel .\n        WritableDataSourceRegistry.registerFlowDataSource(flowRuleWDS);\n    }\n\n\n    private <T> String encodeJson(T t) {\n        return JSON.toJSONString(t);\n    }\n\n}\n~~~\n\n\n\nMETA-INF/servicescom.alibaba.csp.sentinel.init.InitFunc\n\n~~~\ncom.lison.springcloudservice.config.sentinel.FileDataSourceInit\n~~~\n\nDashboardDashboardFlowRule.jsonFlowRule.json3\n\n\n\n#### \n\npushpushZooKeeper, Nacos, ApolloSentinel/Sentinel    Sentinel  SentinelSentinel\n\n![img](typora-user-images/c5abda0a657e59634fb07442a84bf5e0.png)\n\n\n\n### Nacos\n\n    Sentinel  Sentinel\n\n\n\n\n\n~~~\n<dependency>\n    <groupId>com.alibaba.csp</groupId>\n    <artifactId>sentinel-datasource-nacos</artifactId>\n</dependency>\n\n~~~\n\nnacos\n\n~~~yaml\nspring:\n  application:\n    name: spring-cloud-service\n  cloud:\n    sentinel:\n      transport:\n        dashboard: 127.0.0.1:8080\n      datasource:\n        flow-ds:\n          nacos:\n            server-addr: 127.0.0.1:8848\n            dataId: ${spring.application.name}-flow\n            groupId: DEFAULT_GROUP\n            data-type: json\n            rule-type: flow\n\n~~~\n\nNacosSentinel Dashboard\n\nsentinelnacos\n\nNacosWritableDataSourcenacos\n\n~~~java\n// WritableDataSource#writenacos\n@Override\npublic void write(T t) throws Exception {\n    lock.lock();\n    try {\n        configService.publishConfig(dataId, groupId, this.configEncoder.convert(t), ConfigType.JSON.getType());\n    } finally {\n        lock.unlock();\n    }\n}\n\n~~~\n\nSentinel DashboardNacosSentinel DashboardnacosSentinel DashboardnacosSentinel DashboardnacosSentinel\n\n\n\nAbstractDataSourceProperties\nSentinelPropertiesTreeMapdatasource\n\n> com.alibaba.cloud.sentinel.datasource.config.AbstractDataSourceProperties#postRegister\n\n\n\n~~~java\npublic void postRegister(AbstractDataSource dataSource) {\n    switch (this.getRuleType()) {\n    case FLOW:\n        FlowRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case DEGRADE:\n        DegradeRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case PARAM_FLOW:\n        ParamFlowRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case SYSTEM:\n        SystemRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case AUTHORITY:\n        AuthorityRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case GW_FLOW:\n        GatewayRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case GW_API_GROUP:\n        GatewayApiDefinitionManager.register2Property(dataSource.getProperty());\n        break;\n    default:\n        break;\n    }\n}\n~~~\n\n\n\n**NacosDataSourceNacos**\n\nNacosDataSourceNacosNacos\n\n\n\n~~~java\npublic NacosDataSource(final Properties properties, final String groupId, final String dataId,\n                       Converter<String, T> parser) {\n    super(parser);\n    if (StringUtil.isBlank(groupId) || StringUtil.isBlank(dataId)) {\n        throw new IllegalArgumentException(String.format(\"Bad argument: groupId=[%s], dataId=[%s]\",\n            groupId, dataId));\n    }\n    AssertUtil.notNull(properties, \"Nacos properties must not be null, you could put some keys from PropertyKeyConst\");\n    this.groupId = groupId;\n    this.dataId = dataId;\n    this.properties = properties;\n    this.configListener = new Listener() {\n        @Override\n        public Executor getExecutor() {\n            return pool;\n        }\n\n        @Override\n        public void receiveConfigInfo(final String configInfo) {\n            // \n            RecordLog.info(\"[NacosDataSource] New property value received for (properties: {}) (dataId: {}, groupId: {}): {}\",\n                properties, dataId, groupId, configInfo);\n            T newValue = NacosDataSource.this.parser.convert(configInfo);\n            // Update the new value to the property.\n            getProperty().updateValue(newValue);\n        }\n    };\n    // \n    initNacosListener();\n    // \n    loadInitialConfig();\n}\n\nprivate void loadInitialConfig() {\n    try {\n        T newValue = loadConfig();\n        if (newValue == null) {\n            RecordLog.warn(\"[NacosDataSource] WARN: initial config is null, you may have to check your data source\");\n        }\n        getProperty().updateValue(newValue);\n    } catch (Exception ex) {\n        RecordLog.warn(\"[NacosDataSource] Error when loading initial config\", ex);\n    }\n}\n\nprivate void initNacosListener() {\n    try {\n        this.configService = NacosFactory.createConfigService(this.properties);\n        // Add config listener.\n        configService.addListener(dataId, groupId, configListener);\n    } catch (Exception e) {\n        RecordLog.warn(\"[NacosDataSource] Error occurred when initializing Nacos data source\", e);\n        e.printStackTrace();\n    }\n}\n\n~~~\n\n**SentinelDataSourceHandlerNacosDataSource**\nSentinelAutoConfigurationSentinelDataSourceHandler\n\nSentinelDataSourceHandlerDataSourcespring\n\n> com.alibaba.cloud.sentinel.custom.SentinelDataSourceHandler#afterSingletonsInstantiated\n\n\n\n~~~java\npublic void afterSingletonsInstantiated() {\n    this.sentinelProperties.getDatasource().forEach((dataSourceName, dataSourceProperties) -> {\n        try {\n            List<String> validFields = dataSourceProperties.getValidField();\n            if (validFields.size() != 1) {\n                log.error(\"[Sentinel Starter] DataSource \" + dataSourceName + \" multi datasource active and won't loaded: \" + dataSourceProperties.getValidField());\n                return;\n            }\n\n            AbstractDataSourceProperties abstractDataSourceProperties = dataSourceProperties.getValidDataSourceProperties();\n            abstractDataSourceProperties.setEnv(this.env);\n            abstractDataSourceProperties.preCheck(dataSourceName);\n            this.registerBean(abstractDataSourceProperties, dataSourceName + \"-sentinel-\" + (String)validFields.get(0) + \"-datasource\");\n        } catch (Exception var5) {\n            log.error(\"[Sentinel Starter] DataSource \" + dataSourceName + \" build error: \" + var5.getMessage(), var5);\n        }\n\n    });\n}\n\n~~~\n\n\n\nSentinel\n    Sentinel  Sentinel\n\nSentinel1.4.0SentinelDynamicRulePublisherDynamicRuleProvider\n\n* DynamicRuleProvider: \n* DynamicRulePublisher: \n\nSentinel Dashboard test\n\n\n\n![image-20240220144907721](typora-user-images/image-20240220144907721.png)\n\nDashboard\n\nnacos\n\n\n\n~~~java\n <dependency>\n   <groupId>com.alibaba.nacos</groupId>\n   <artifactId>nacos-client</artifactId>\n   <version>2.0.3</version>\n</dependency>\n~~~\n\n\n\nNacosConfig\n\n~~~java\n\npackage com.alibaba.csp.sentinel.dashboard.rule.nacos;\n\nimport java.util.List;\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;\nimport com.alibaba.csp.sentinel.datasource.Converter;\nimport com.alibaba.fastjson.JSON;\nimport com.alibaba.nacos.api.config.ConfigFactory;\nimport com.alibaba.nacos.api.config.ConfigService;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author Eric Zhao\n * @since 1.4.0\n */\n@Configuration\npublic class NacosConfig {\n\n    @Bean\n    public Converter<List<FlowRuleEntity>, String> flowRuleEntityEncoder() {\n        return JSON::toJSONString;\n    }\n\n    @Bean\n    public Converter<String, List<FlowRuleEntity>> flowRuleEntityDecoder() {\n        return s -> JSON.parseArray(s, FlowRuleEntity.class);\n    }\n\n    @Bean\n    public ConfigService nacosConfigService() throws Exception {\n        return ConfigFactory.createConfigService(\"localhost\");\n    }\n}\n\n~~~\n\nFlowRuleNacosProviderNacos\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.rule.nacos;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.rule.DynamicRuleProvider;\nimport com.alibaba.csp.sentinel.datasource.Converter;\nimport com.alibaba.csp.sentinel.util.StringUtil;\nimport com.alibaba.nacos.api.config.ConfigService;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author Eric Zhao\n * @since 1.4.0\n */\n@Component(\"flowRuleNacosProvider\")\npublic class FlowRuleNacosProvider implements DynamicRuleProvider<List<FlowRuleEntity>> {\n\n    @Autowired\n    private ConfigService configService;\n    @Autowired\n    private Converter<String, List<FlowRuleEntity>> converter;\n\n    @Override\n    public List<FlowRuleEntity> getRules(String appName) throws Exception {\n        String rules = configService.getConfig(appName + NacosConfigUtil.FLOW_DATA_ID_POSTFIX,\n            NacosConfigUtil.GROUP_ID, 3000);\n        if (StringUtil.isEmpty(rules)) {\n            return new ArrayList<>();\n        }\n        return converter.convert(rules);\n    }\n}\n\n~~~\n\n\n\nFlowRuleNacosPublisherNacos\n\n\n\n~~~java\n\npackage com.alibaba.csp.sentinel.dashboard.rule.nacos;\n\nimport java.util.List;\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.rule.DynamicRulePublisher;\nimport com.alibaba.csp.sentinel.datasource.Converter;\nimport com.alibaba.csp.sentinel.util.AssertUtil;\nimport com.alibaba.nacos.api.config.ConfigService;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author Eric Zhao\n * @since 1.4.0\n */\n@Component(\"flowRuleNacosPublisher\")\npublic class FlowRuleNacosPublisher implements DynamicRulePublisher<List<FlowRuleEntity>> {\n\n    @Autowired\n    private ConfigService configService;\n    @Autowired\n    private Converter<List<FlowRuleEntity>, String> converter;\n\n    @Override\n    public void publish(String app, List<FlowRuleEntity> rules) throws Exception {\n        AssertUtil.notEmpty(app, \"app name cannot be empty\");\n        if (rules == null) {\n            return;\n        }\n        configService.publishConfig(app + NacosConfigUtil.FLOW_DATA_ID_POSTFIX,\n            NacosConfigUtil.GROUP_ID, converter.convert(rules));\n    }\n}\n\n~~~\n\nDashboardFlowControllerV2\n\n\n\n![image-20240221092028120](typora-user-images/image-20240221092028120.png)\n\n\n\n Nacos  Nacos  FlowControllerV2  bean  Nacos sidebar.html  dashboard.flowV1  dashboard.flow \n\n~~~java\n@Autowired\n@Qualifier(\"flowRuleNacosProvider\")\nprivate DynamicRuleProvider<List<FlowRuleEntity>> ruleProvider;\n@Autowired\n@Qualifier(\"flowRuleNacosPublisher\")\nprivate DynamicRulePublisher<List<FlowRuleEntity>> rulePublisher;\n\n~~~\n\n\n\n****\n\n\n\n**1**\n\npomsentinel-datasource-nacosscopeNacos\n\n~~~xml\n  <!-- for Nacos rule publisher sample -->\n        <dependency>\n            <groupId>com.alibaba.csp</groupId>\n            <artifactId>sentinel-datasource-nacos</artifactId>\n        </dependency>\n~~~\n\n\n\n![image-20240221091728143](typora-user-images/image-20240221091728143.png)\n\n\n\ntestnacoscom.alibaba.csp.sentinel.dashboard.rule\n\n![image-20240221091837069](typora-user-images/image-20240221091837069.png)\n\n\n\nFlowControllerV2flowRuleNacosProviderflowRuleNacosPublisher\n\n\n\n![image-20240221091441127](typora-user-images/image-20240221091441127.png)\n\n\n\n**2**\n\nsidebardashboard.flowV1dashboard.flow\n\n![image-20240221092353574](typora-user-images/image-20240221092353574.png)\n\n\n\n![image-20240221092419244](typora-user-images/image-20240221092419244.png)\n\n![image-20240221092834785](typora-user-images/image-20240221092834785.png)\n\nsentinel dashboardnacos\n\n![image-20240221093021265](typora-user-images/image-20240221093021265.png)\n\n\n\nspring-cloud-service.json\n\n~~~json\n[\n    {\n        \"app\":\"spring-cloud-service\",\n        \"clusterConfig\":{\n            \"acquireRefuseStrategy\":0,\n            \"clientOfflineTime\":2000,\n            \"fallbackToLocalWhenFail\":true,\n            \"resourceTimeout\":2000,\n            \"resourceTimeoutStrategy\":0,\n            \"sampleCount\":10,\n            \"strategy\":0,\n            \"thresholdType\":0,\n            \"windowIntervalMs\":1000\n        },\n        \"clusterMode\":false,\n        \"controlBehavior\":0,\n        \"count\":5,\n        \"gmtCreate\":1708478952132,\n        \"gmtModified\":1708478952132,\n        \"grade\":1,\n        \"id\":9,\n        \"ip\":\"10.108.202.7\",\n        \"limitApp\":\"default\",\n        \"port\":9998,\n        \"resource\":\"/sentinel/message3\",\n        \"strategy\":0\n    }\n]\n~~~\n\n\n\n\n\n****\n\n**nacos-dashboard**\n\n![image-20240221093711599](typora-user-images/image-20240221093711599.png)\n\n****\n\n\n\n>\n>\n>resources/app/views/flow_v2.html  \n>\n>1.V2\n>\n>         2.\n>\n>\n\n![image-20240221093819873](typora-user-images/image-20240221093819873.png)\n\n\n\n******\n\n F12 /v1/flow  /v2/flow\n\n\n\n![image-20240221094018816](typora-user-images/image-20240221094018816.png)\n\n\n\n>resources/app/scripts/controllers/identity.js  \n>\n> \n\n\n\n![image-20240221094225094](typora-user-images/image-20240221094225094.png)\n\n\n\n![image-20240221094244920](typora-user-images/image-20240221094244920.png)\n\nnacos~~~~~~~~~~~~~~\n\nF12V1V2js\n\n\n\n![image-20240221094447664](typora-user-images/image-20240221094447664.png)\n\n![image-20240221094852671](typora-user-images/image-20240221094852671.png)\n\n\n\n![image-20240221095745495](typora-user-images/image-20240221095745495.png)\n\n![image-20240221155333042](typora-user-images/image-20240221155333042.png)\n","source":"_posts/Spring Cloud Alibaba /Spring Cloud Alibaba-04-Sentinel.md","raw":"`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2023.09.10`\n\n# Spring Cloud Alibaba-04-Sentinel\n\n[toc]\n\n\n\n## \n\n 100% \n\n\n\n## \n\n,, 100%   \n\n   \n\n![image-20231024102201145](typora-user-images/image-20231024102201145.png)\n\n\n\n\"\"\n\n\n\n\n\n## \n\n , \n\n****\n\n\n\n- ****\n\n  \n  \n  :.\n\n\n\n![image-20231024104338016](typora-user-images/image-20231024104338016.png)\n\n\n\n* ****\n\n\n\n![image-20231201143940420](typora-user-images/image-20231201143940420.png)\n\n\n\n* ****\n\n, ,\n\n![image-20231201144020748](typora-user-images/image-20231201144020748.png)\n\n* ****\n\n \n\n![image-20231201144119343](typora-user-images/image-20231201144119343.png)\n\n:\n\n* (Closed)   \n* Open  fallback \n* Half-Open\t  ;\n\n\n\n\n\n* ****\n\n\n\n![image-20231201153117052](typora-user-images/image-20231201153117052.png)\n\n\n\n****\n\n**Hystrix**\nHystrixNetflix \n\n**Resilience4J**\nResilicence4JHystrix Resilicence4jSpring Boot 1.x/2.x prometheus\n\n**Sentinel**\nSentinel  :\n\n|                | Sentinel                                                   | Hystrix                | Resilience4J                     |\n| -------------- | ---------------------------------------------------------- | ---------------------- | -------------------------------- |\n|        |                                | /  |                        |\n|    |                              |            |            |\n|    | LeapArray                                      | RxJava | Ring Bit Buffer                  |\n|    |                                                |            |                          |\n|          |                                                  |              |                        |\n|  |                                                        |                    |                              |\n|            | QPS,                             |                  | Rate Limiter                     |\n|        |                      |                  | Rate Limiter           |\n|  |                                                        |                  |                            |\n|          |  |          |  |\n\n\n\n## Sentinel\n\n### Sentinel\n\nSentinel () **** , ****\n\n\n\nSentinel:\n\nSentinel :\n\n** :**Sentinel  10 , ( ) \n:Sentinel  ,  500 \n****:Sentinel /,  Spring CloudDubbogRPC  Sentinel\n\n** SPI :**Sentinel  SPI  \n\n**Sentinel :**\n\n* (Java )/, Java  Dubbo / Spring Cloud \n* (Dashboard) Spring Boot  Tomcat  \n\n\n\n### Sentinel\n\nSentinel, Sentinel\n\n**1pom.xml**\n\n~~~xml\n<dependency>\n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>\n</dependency>\n\n~~~\n\n\n\n**2application.yml sentinel**\n**`ymlclient-ip ip`**\n\n~~~yaml\nspring:\n    cloud:\n        sentinel:\n            transport:\n                dashboard: 192.168.32.131:8858\n                client-ip: 192.168.32.1\n                port: 8719\n\n~~~\n\n\n\n\n\n\n\n**3Controller**\n\n~~~java\n@RestController\npublic class TestSentinelController {\n\n    @RequestMapping(\"/sentinel/message1\")\n    public String message1() {\n        return \"message1\";\n    }\n    @RequestMapping(\"/sentinel/message2\")\n    public String message2() {\n        return \"message2\";\n    }\n    \n}\n~~~\n\n\n\n### Sentinel\n\nSentinel , \n\n**1jar**\n\n~~~\njar, https://github.com/alibaba/Sentinel/releases \n\n\n\n# jar(SpringBoot)\njava -Dserver.port=8858 -Dcsp.sentinel.dashboard.server=localhost:8858 - Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.1.jar \n\n\n~~~\n\n\n\n2docker\n\n~~~\n\n//sentinel\ndocker pull bladex/sentinel-dashboard:1.8.1\n\n\n\n//\ndocker run --name sentinel  -d -p 8858:8858 -p 8719:8719 -d bladex/sentinel-dashboard:1.8.1 -e username=sentinel -e password=sentinel -e server=localhost:8858\n~~~\n\n\n\nlocalhost:8858  (  sentinel/sentinel )\n\n\n\n\n\n\n\n**Sentinel Sentinel **\n\n\n\n\n\n**:**\n\nSentinelSpringBoot, , ,  \n\n![image-20240219114233026](typora-user-images/image-20240219114233026.png)\n\n\n\n![image-20240219113719157](typora-user-images/image-20240219113719157.png)\n\n\n\n\n\n\n\n## \n\n\n\n1message1\n\n\n\n![image-20240219114343151](typora-user-images/image-20240219114343151.png)\n\n\n\n2, \n\n![image-20240219114515952](typora-user-images/image-20240219114515952.png)\n\n## Sentinel\n\n\n\n### \n\n* ****\n\nSentinel\n\nSentinelJava\n\n>message1\n\n* ****\n\n\n\n\n\n>message1message1\n\n### \n\n\n\n![image-20240219144606520](typora-user-images/image-20240219144606520.png)\n\nSentinel,:\n\n**1**\n  Sentinel \n\n**2**\n\n\n\n\n\n\n**Sentinel :**\n\n(1)\n\nSentinel    \n\n(2)\n\nSentinel   \n\n\n\n**Sentinel  Hystrix **\n\n>, , ,  , :\n>\n>~~~\n>       Hystrix , ,   \n>\n>       Sentinel  \n>~~~\n\n\n\n**3**\n\nSentinel   Sentinel   : Sentinel \n\n\n\n## Sentinel\n\n\n\n### \n\nQPS()  \n\n1:  :\n\n![image-20240219150634816](typora-user-images/image-20240219150634816.png)\n\n\n\n**:**\n\n:default\n\n**/:**\n\n* QPS(): QPS\n* :\n\n**:** QPS\n\n\n\n#### \n\nQPS33\n\n\n\n![image-20240219150821657](typora-user-images/image-20240219150821657.png)\n\n /order/message1 QPS > 3 Blocked by Sentinel (flow limiting)\n\n![image-20240219150910898](typora-user-images/image-20240219150910898.png)\n\n#### \n\n![image-20240219151031448](typora-user-images/image-20240219151031448.png)\n\nsentinel:\n\n****():\n\n****: []\n\n****:\n\n\n\n:\n\n****\n\n\n\n****\n\n\n\n1:,  /sentinel/message2\n\n![image-20240219151212695](typora-user-images/image-20240219151212695.png)\n\n2:postman/sentinel/message2QPS3\n\n![image-20240219152607457](typora-user-images/image-20240219152607457.png)\n\n\n\n3:/sentinel/message1,\n\n![image-20240219152638390](typora-user-images/image-20240219152638390.png)\n\n****\n\n :** **\n\n\n\n1: servicemessage\n\n~~~java\n@Service\npublic class TestSentinelMessage3ServiceImpl {\n    @SentinelResource(\"message\")\n    public void message() {\n        System.out.println(\"message\");\n    }\n}\n~~~\n\n\n\n2: Controllerservice\n\n~~~java\n\n@RestController\npublic class TestSentinelController {\n\n    @Autowired\n    private TestSentinelMessage3ServiceImpl testSentinelMessage3Service;\n\n    @RequestMapping(\"/sentinel/message1\")\n    public String message1() {\n        testSentinelMessage3Service.message();\n        return \"message1\";\n    }\n    @RequestMapping(\"/sentinel/message2\")\n    public String message2() {\n        testSentinelMessage3Service.message();\n        return \"message2\";\n    }\n\n}\n~~~\n\n\n\n\n\n![image-20240219154032740](typora-user-images/image-20240219154032740.png)\n\n  /sentinel/message1  /sentinel/message2 , 2, 1\n\n#### \n\n**():** \n\n**Warm Up:**QPSQPS 1/3\n\n\n**:**;  \n\n###  Sentinel:\n\n\n\n####  (SLOW_REQUEST_RATIO)\n\n RT\n\nstatIntervalMs1\n\n> HALF-OPEN  RT  RT \n\n-  RT200 200\n- 0~1\n- ``1108 0.8\n- java 400\n\n\n\n\n\n1.  > RT\n2. statIntervalMs> \n3.  > maxSlowRequestRatio\n4. HALF-OPEN  RT \n\n4001s5\n\n![image-20240220094227461](typora-user-images/image-20240220094227461.png)\n\n\n\n `HALF-OPEN  RT  RT `\n\n\n\n\n\n![image-20240220095107292](typora-user-images/image-20240220095107292.png)\n\n####  (ERROR_RATIO)\n\nstatIntervalMs  s \n\nHALF-OPEN \n\n [0.0, 1.0] 0% - 100%\n\n\n\n![image-20240220095645324](typora-user-images/image-20240220095645324.png)\n\n![image-20240220101010503](typora-user-images/image-20240220101010503.png)\n\n####  (ERROR_COUNT)\n\n1s\n\nHALF-OPEN \n\ntimeWindow 60s\n\n\n\n![image-20240220101429844](typora-user-images/image-20240220101429844.png)\n\n50%1\n\n\n\n![image-20240220101701432](typora-user-images/image-20240220101701432.png)\n\n\n\n### \n\n, \n\n****\n\n1\n\n~~~java\n@RequestMapping(\"/sentinel/message3\")\n@SentinelResource(\"message3\")//, \npublic String message3(String name, Integer age) {\n  return name + age;\n}\n~~~\n\n2: \n\n\n\n![image-20240220102332812](typora-user-images/image-20240220102332812.png)\n\n3: ,\n\n\n\n![image-20240220102431979](typora-user-images/image-20240220102431979.png)\n\n![image-20240220102457440](typora-user-images/image-20240220102457440.png)\n\n\n\n\n\n\n\n****\n\n\n\n,\n\n![image-20240220102621265](typora-user-images/image-20240220102621265.png)\n\n### \n\n Sentinel  (origin):\n\n;\n\n\n![image-20240220102752041](typora-user-images/image-20240220102752041.png)\n\n?\n\n>Sentinel RequestOriginParser  SentinelSentinel RequestOriginParser \n>\n\n\n\n1: \n\n\n\n~~~java\n@Component\npublic class RequestOriginParserDefinition implements RequestOriginParser {\n    @Override\n    public String parseOrigin(HttpServletRequest request) {\n        String serviceName = request.getParameter(\"serviceName\");\n        return serviceName;\n    } \n} \n\n~~~\n\n\n\n2: \nserviceName=pc()\n\n\n\n![image-20240220103006353](typora-user-images/image-20240220103006353.png)\n\n\n\n3 http://localhost:18001/sentinel/message3?serviceName=pc  \n\n\n\n![image-20240220103217414](typora-user-images/image-20240220103217414.png)\n\n### \n\n LoadRT QPS CPU \n\n () \n\n* Load( Linux/Unix-like ): load1   maxQps * minRt   CPU cores * 2.5\n* RT: RT \n* :\n*  QPS: QPS \n* CPU: CPU\n\n\n\n**: **\n\n~~~java\n\n\n//\n@Component\npublic class ExceptionHandlerPage implements BlockExceptionHandler {\n    //BlockException ,Sentinel\n    // FlowException \n    // DegradeException \n    // ParamFlowException \n    // AuthorityException \n    // SystemBlockException \n\n\n    @Override\n    public void handle(HttpServletRequest request, HttpServletResponse response, BlockException ex) throws Exception {\n        String msg = null;\n        if (ex instanceof FlowException) {\n            msg = \"\";\n        } else if (ex instanceof DegradeException) {\n            msg = \"\";\n        } else if (ex instanceof ParamFlowException) {\n            msg = \"\";\n        } else if (ex instanceof SystemBlockException) {\n            msg = \"/...\";\n        } else if (ex instanceof AuthorityException) {\n            msg = \"\";\n        }\n        // http\n        response.setStatus(500);\n        response.setCharacterEncoding(\"utf-8\");\n        response.setHeader(\"Content-Type\", \"application/json;charset=utf-8\");\n        response.setContentType(\"application/json;charset=utf-8\");\n        // spring mvcjsonjackson\n        //json\n        response.setStatus(200);\n        response.setCharacterEncoding(\"utf-8\");\n        response.setContentType(MediaType.APPLICATION_JSON_VALUE);\n        //springmvc json jackson\n        new ObjectMapper().writeValue(response.getWriter(), msg);\n        //\n        //response.sendRedirect(\"http://www.baidu.com\");\n    }\n}\n~~~\n\n:SpringCloudAlibabasentinel UrlBlockHandler sentinel2.2.5.RELEASEBlockExceptionHandler\n\n\n\n\n\n## @SentinelResource\n\nDashboard\n@SentinelResource\n\n@SentinelResource  fallback :\n\n\n\n|                |                                                          |\n| ------------------ | ------------------------------------------------------------ |\n| value              |                                                      |\n| entryType          | entryIN/OUTOUT             |\n| blockHandler       | BlockException,:1.  public2. 3.  blockHandlerClass blockHandlerClass |\n| blockHandlerClass  | blockHandler,static            |\n| fallback           | fallbackfallback ( exceptionsToIgnore ) :1.  2. 3.  fallbackClass fallbackClass |\n| fallbackClass      | fallbackstatic             |\n| defaultFallback    |  fallback fallback  fallback  defaultFallbackfallback :1.  2.  Throwable 3.  fallbackClass  fallbackClass  |\n| exceptionsToIgnore |  fallback |\n| exceptionsToTrace  | trace                                              |\n\n****\n\n\n\n~~~java\n\n@Service\npublic class TestSentinelMessage3ServiceImpl {\n        int i = 0;\n\n        @SentinelResource(\n                value = \"message\",\n                blockHandler = \"blockHandler\",//BlockException\n                fallback = \"fallback\"//Throwable\n        )\n        public String message() {\n            i++;\n            if (i % 3 == 0) {\n                throw new RuntimeException();\n            }\n            return \"message\";\n        }\n\n        //BlockException\n        public String blockHandler(BlockException ex) {\n            return \"...\";\n        }\n\n        //Throwable\n        public String fallback(Throwable throwable) {\n            return \"...\";\n        }\n    \n\n~~~\n\n****\n\n~~~java\n@Service\n@Slf4j\npublic class TestSentinelMessage3ServiceImpl {\n    int i = 0;\n\n    @SentinelResource(\n            value = \"message\",\n            blockHandlerClass = TestSentinelMessage3ServiceImplBlockHandlerClass.class,\n            blockHandler = \"blockHandler\",\n            fallbackClass = TestSentinelMessage3ServiceImplFallbackClass.class,\n            fallback = \"fallback\"\n    )\n    public String message() {\n        i++;\n        if (i % 3 == 0) {\n            throw new RuntimeException();\n        }\n        return \"message4\";\n    }\n}\n\n@Slf4j\npublic class TestSentinelMessage3ServiceImplBlockHandlerClass { //static\n    public static String blockHandler(BlockException ex) {\n        log.error(\"{}\", ex);\n        return \"...\";\n    }\n}\n\n@Slf4j\npublic class TestSentinelMessage3ServiceImplFallbackClass { //static\n    public static String fallback(Throwable throwable) {\n        log.error(\"{}\", throwable);\n        return \"...\";\n    }\n} \n\n\n~~~\n\n\n\n## Sentinel\n\n\n\nDashboardSentinel \n\n### Sentinel:\n\n|  |                                                          |                          |                                                          |\n| -------- | ------------------------------------------------------------ | ---------------------------- | ------------------------------------------------------------ |\n|  | API                      |              |  |\n| Pull | WritableDataSourceRDBMS |  |  |\n| Push | ReadableDataSourceNacosZookeeperpush |      |                                                |\n\n\n\n#### \n\nDashboardAPI\n\n![img](typora-user-images/a7002eb5f5b8429c8b8728b9f2e3e10d.png)\n\n\n\n#### \n\npullRDBMS  RuleManagertransportWritableDataSourceRegistry\n\n\n\n![img](typora-user-images/afb25fa106bada4b37da64e902060269.png)\n\n\n\nSentinelAPI pullSentinel\n\n\n\n\n\n~~~xml\n<dependency>\n    <groupId>com.alibaba.csp</groupId>\n    <artifactId>sentinel-datasource-extension</artifactId>\n</dependency>\n~~~\n\nInitFuncinitDataSourcespi\n\n\n\n~~~java\n\npublic class FileDataSourceInit implements InitFunc {\n\n    private static final String RULE_FILE_PATH = System.getProperty(\"user.home\") + File.separator;\n\n    private static final String FLOW_RULE_FILE_NAME = \"FlowRule.json\";\n\n    @Override\n    public void init() throws Exception {\n\n        //\n        dealFlowRules();\n    }\n\n\n    private void dealFlowRules() throws FileNotFoundException {\n        String ruleFilePath = RULE_FILE_PATH + FLOW_RULE_FILE_NAME;\n\n        //\n        FileRefreshableDataSource flowRuleRDS = new FileRefreshableDataSource(\n                ruleFilePath, source -> JSON.parseObject((String) source,\n                new TypeReference<List<FlowRule>>() {\n                })\n        );\n\n        // FlowRuleManager \n        FlowRuleManager.register2Property(flowRuleRDS.getProperty());\n\n        WritableDataSource<List<FlowRule>> flowRuleWDS = new FileWritableDataSource<>(\n                ruleFilePath, this::encodeJson\n        );\n\n        //  transport  WritableDataSourceRegistry .\n        // Sentinel .\n        WritableDataSourceRegistry.registerFlowDataSource(flowRuleWDS);\n    }\n\n\n    private <T> String encodeJson(T t) {\n        return JSON.toJSONString(t);\n    }\n\n}\n~~~\n\n\n\nMETA-INF/servicescom.alibaba.csp.sentinel.init.InitFunc\n\n~~~\ncom.lison.springcloudservice.config.sentinel.FileDataSourceInit\n~~~\n\nDashboardDashboardFlowRule.jsonFlowRule.json3\n\n\n\n#### \n\npushpushZooKeeper, Nacos, ApolloSentinel/Sentinel    Sentinel  SentinelSentinel\n\n![img](typora-user-images/c5abda0a657e59634fb07442a84bf5e0.png)\n\n\n\n### Nacos\n\n    Sentinel  Sentinel\n\n\n\n\n\n~~~\n<dependency>\n    <groupId>com.alibaba.csp</groupId>\n    <artifactId>sentinel-datasource-nacos</artifactId>\n</dependency>\n\n~~~\n\nnacos\n\n~~~yaml\nspring:\n  application:\n    name: spring-cloud-service\n  cloud:\n    sentinel:\n      transport:\n        dashboard: 127.0.0.1:8080\n      datasource:\n        flow-ds:\n          nacos:\n            server-addr: 127.0.0.1:8848\n            dataId: ${spring.application.name}-flow\n            groupId: DEFAULT_GROUP\n            data-type: json\n            rule-type: flow\n\n~~~\n\nNacosSentinel Dashboard\n\nsentinelnacos\n\nNacosWritableDataSourcenacos\n\n~~~java\n// WritableDataSource#writenacos\n@Override\npublic void write(T t) throws Exception {\n    lock.lock();\n    try {\n        configService.publishConfig(dataId, groupId, this.configEncoder.convert(t), ConfigType.JSON.getType());\n    } finally {\n        lock.unlock();\n    }\n}\n\n~~~\n\nSentinel DashboardNacosSentinel DashboardnacosSentinel DashboardnacosSentinel DashboardnacosSentinel\n\n\n\nAbstractDataSourceProperties\nSentinelPropertiesTreeMapdatasource\n\n> com.alibaba.cloud.sentinel.datasource.config.AbstractDataSourceProperties#postRegister\n\n\n\n~~~java\npublic void postRegister(AbstractDataSource dataSource) {\n    switch (this.getRuleType()) {\n    case FLOW:\n        FlowRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case DEGRADE:\n        DegradeRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case PARAM_FLOW:\n        ParamFlowRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case SYSTEM:\n        SystemRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case AUTHORITY:\n        AuthorityRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case GW_FLOW:\n        GatewayRuleManager.register2Property(dataSource.getProperty());\n        break;\n    case GW_API_GROUP:\n        GatewayApiDefinitionManager.register2Property(dataSource.getProperty());\n        break;\n    default:\n        break;\n    }\n}\n~~~\n\n\n\n**NacosDataSourceNacos**\n\nNacosDataSourceNacosNacos\n\n\n\n~~~java\npublic NacosDataSource(final Properties properties, final String groupId, final String dataId,\n                       Converter<String, T> parser) {\n    super(parser);\n    if (StringUtil.isBlank(groupId) || StringUtil.isBlank(dataId)) {\n        throw new IllegalArgumentException(String.format(\"Bad argument: groupId=[%s], dataId=[%s]\",\n            groupId, dataId));\n    }\n    AssertUtil.notNull(properties, \"Nacos properties must not be null, you could put some keys from PropertyKeyConst\");\n    this.groupId = groupId;\n    this.dataId = dataId;\n    this.properties = properties;\n    this.configListener = new Listener() {\n        @Override\n        public Executor getExecutor() {\n            return pool;\n        }\n\n        @Override\n        public void receiveConfigInfo(final String configInfo) {\n            // \n            RecordLog.info(\"[NacosDataSource] New property value received for (properties: {}) (dataId: {}, groupId: {}): {}\",\n                properties, dataId, groupId, configInfo);\n            T newValue = NacosDataSource.this.parser.convert(configInfo);\n            // Update the new value to the property.\n            getProperty().updateValue(newValue);\n        }\n    };\n    // \n    initNacosListener();\n    // \n    loadInitialConfig();\n}\n\nprivate void loadInitialConfig() {\n    try {\n        T newValue = loadConfig();\n        if (newValue == null) {\n            RecordLog.warn(\"[NacosDataSource] WARN: initial config is null, you may have to check your data source\");\n        }\n        getProperty().updateValue(newValue);\n    } catch (Exception ex) {\n        RecordLog.warn(\"[NacosDataSource] Error when loading initial config\", ex);\n    }\n}\n\nprivate void initNacosListener() {\n    try {\n        this.configService = NacosFactory.createConfigService(this.properties);\n        // Add config listener.\n        configService.addListener(dataId, groupId, configListener);\n    } catch (Exception e) {\n        RecordLog.warn(\"[NacosDataSource] Error occurred when initializing Nacos data source\", e);\n        e.printStackTrace();\n    }\n}\n\n~~~\n\n**SentinelDataSourceHandlerNacosDataSource**\nSentinelAutoConfigurationSentinelDataSourceHandler\n\nSentinelDataSourceHandlerDataSourcespring\n\n> com.alibaba.cloud.sentinel.custom.SentinelDataSourceHandler#afterSingletonsInstantiated\n\n\n\n~~~java\npublic void afterSingletonsInstantiated() {\n    this.sentinelProperties.getDatasource().forEach((dataSourceName, dataSourceProperties) -> {\n        try {\n            List<String> validFields = dataSourceProperties.getValidField();\n            if (validFields.size() != 1) {\n                log.error(\"[Sentinel Starter] DataSource \" + dataSourceName + \" multi datasource active and won't loaded: \" + dataSourceProperties.getValidField());\n                return;\n            }\n\n            AbstractDataSourceProperties abstractDataSourceProperties = dataSourceProperties.getValidDataSourceProperties();\n            abstractDataSourceProperties.setEnv(this.env);\n            abstractDataSourceProperties.preCheck(dataSourceName);\n            this.registerBean(abstractDataSourceProperties, dataSourceName + \"-sentinel-\" + (String)validFields.get(0) + \"-datasource\");\n        } catch (Exception var5) {\n            log.error(\"[Sentinel Starter] DataSource \" + dataSourceName + \" build error: \" + var5.getMessage(), var5);\n        }\n\n    });\n}\n\n~~~\n\n\n\nSentinel\n    Sentinel  Sentinel\n\nSentinel1.4.0SentinelDynamicRulePublisherDynamicRuleProvider\n\n* DynamicRuleProvider: \n* DynamicRulePublisher: \n\nSentinel Dashboard test\n\n\n\n![image-20240220144907721](typora-user-images/image-20240220144907721.png)\n\nDashboard\n\nnacos\n\n\n\n~~~java\n <dependency>\n   <groupId>com.alibaba.nacos</groupId>\n   <artifactId>nacos-client</artifactId>\n   <version>2.0.3</version>\n</dependency>\n~~~\n\n\n\nNacosConfig\n\n~~~java\n\npackage com.alibaba.csp.sentinel.dashboard.rule.nacos;\n\nimport java.util.List;\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;\nimport com.alibaba.csp.sentinel.datasource.Converter;\nimport com.alibaba.fastjson.JSON;\nimport com.alibaba.nacos.api.config.ConfigFactory;\nimport com.alibaba.nacos.api.config.ConfigService;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author Eric Zhao\n * @since 1.4.0\n */\n@Configuration\npublic class NacosConfig {\n\n    @Bean\n    public Converter<List<FlowRuleEntity>, String> flowRuleEntityEncoder() {\n        return JSON::toJSONString;\n    }\n\n    @Bean\n    public Converter<String, List<FlowRuleEntity>> flowRuleEntityDecoder() {\n        return s -> JSON.parseArray(s, FlowRuleEntity.class);\n    }\n\n    @Bean\n    public ConfigService nacosConfigService() throws Exception {\n        return ConfigFactory.createConfigService(\"localhost\");\n    }\n}\n\n~~~\n\nFlowRuleNacosProviderNacos\n\n~~~java\npackage com.alibaba.csp.sentinel.dashboard.rule.nacos;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.rule.DynamicRuleProvider;\nimport com.alibaba.csp.sentinel.datasource.Converter;\nimport com.alibaba.csp.sentinel.util.StringUtil;\nimport com.alibaba.nacos.api.config.ConfigService;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author Eric Zhao\n * @since 1.4.0\n */\n@Component(\"flowRuleNacosProvider\")\npublic class FlowRuleNacosProvider implements DynamicRuleProvider<List<FlowRuleEntity>> {\n\n    @Autowired\n    private ConfigService configService;\n    @Autowired\n    private Converter<String, List<FlowRuleEntity>> converter;\n\n    @Override\n    public List<FlowRuleEntity> getRules(String appName) throws Exception {\n        String rules = configService.getConfig(appName + NacosConfigUtil.FLOW_DATA_ID_POSTFIX,\n            NacosConfigUtil.GROUP_ID, 3000);\n        if (StringUtil.isEmpty(rules)) {\n            return new ArrayList<>();\n        }\n        return converter.convert(rules);\n    }\n}\n\n~~~\n\n\n\nFlowRuleNacosPublisherNacos\n\n\n\n~~~java\n\npackage com.alibaba.csp.sentinel.dashboard.rule.nacos;\n\nimport java.util.List;\n\nimport com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;\nimport com.alibaba.csp.sentinel.dashboard.rule.DynamicRulePublisher;\nimport com.alibaba.csp.sentinel.datasource.Converter;\nimport com.alibaba.csp.sentinel.util.AssertUtil;\nimport com.alibaba.nacos.api.config.ConfigService;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author Eric Zhao\n * @since 1.4.0\n */\n@Component(\"flowRuleNacosPublisher\")\npublic class FlowRuleNacosPublisher implements DynamicRulePublisher<List<FlowRuleEntity>> {\n\n    @Autowired\n    private ConfigService configService;\n    @Autowired\n    private Converter<List<FlowRuleEntity>, String> converter;\n\n    @Override\n    public void publish(String app, List<FlowRuleEntity> rules) throws Exception {\n        AssertUtil.notEmpty(app, \"app name cannot be empty\");\n        if (rules == null) {\n            return;\n        }\n        configService.publishConfig(app + NacosConfigUtil.FLOW_DATA_ID_POSTFIX,\n            NacosConfigUtil.GROUP_ID, converter.convert(rules));\n    }\n}\n\n~~~\n\nDashboardFlowControllerV2\n\n\n\n![image-20240221092028120](typora-user-images/image-20240221092028120.png)\n\n\n\n Nacos  Nacos  FlowControllerV2  bean  Nacos sidebar.html  dashboard.flowV1  dashboard.flow \n\n~~~java\n@Autowired\n@Qualifier(\"flowRuleNacosProvider\")\nprivate DynamicRuleProvider<List<FlowRuleEntity>> ruleProvider;\n@Autowired\n@Qualifier(\"flowRuleNacosPublisher\")\nprivate DynamicRulePublisher<List<FlowRuleEntity>> rulePublisher;\n\n~~~\n\n\n\n****\n\n\n\n**1**\n\npomsentinel-datasource-nacosscopeNacos\n\n~~~xml\n  <!-- for Nacos rule publisher sample -->\n        <dependency>\n            <groupId>com.alibaba.csp</groupId>\n            <artifactId>sentinel-datasource-nacos</artifactId>\n        </dependency>\n~~~\n\n\n\n![image-20240221091728143](typora-user-images/image-20240221091728143.png)\n\n\n\ntestnacoscom.alibaba.csp.sentinel.dashboard.rule\n\n![image-20240221091837069](typora-user-images/image-20240221091837069.png)\n\n\n\nFlowControllerV2flowRuleNacosProviderflowRuleNacosPublisher\n\n\n\n![image-20240221091441127](typora-user-images/image-20240221091441127.png)\n\n\n\n**2**\n\nsidebardashboard.flowV1dashboard.flow\n\n![image-20240221092353574](typora-user-images/image-20240221092353574.png)\n\n\n\n![image-20240221092419244](typora-user-images/image-20240221092419244.png)\n\n![image-20240221092834785](typora-user-images/image-20240221092834785.png)\n\nsentinel dashboardnacos\n\n![image-20240221093021265](typora-user-images/image-20240221093021265.png)\n\n\n\nspring-cloud-service.json\n\n~~~json\n[\n    {\n        \"app\":\"spring-cloud-service\",\n        \"clusterConfig\":{\n            \"acquireRefuseStrategy\":0,\n            \"clientOfflineTime\":2000,\n            \"fallbackToLocalWhenFail\":true,\n            \"resourceTimeout\":2000,\n            \"resourceTimeoutStrategy\":0,\n            \"sampleCount\":10,\n            \"strategy\":0,\n            \"thresholdType\":0,\n            \"windowIntervalMs\":1000\n        },\n        \"clusterMode\":false,\n        \"controlBehavior\":0,\n        \"count\":5,\n        \"gmtCreate\":1708478952132,\n        \"gmtModified\":1708478952132,\n        \"grade\":1,\n        \"id\":9,\n        \"ip\":\"10.108.202.7\",\n        \"limitApp\":\"default\",\n        \"port\":9998,\n        \"resource\":\"/sentinel/message3\",\n        \"strategy\":0\n    }\n]\n~~~\n\n\n\n\n\n****\n\n**nacos-dashboard**\n\n![image-20240221093711599](typora-user-images/image-20240221093711599.png)\n\n****\n\n\n\n>\n>\n>resources/app/views/flow_v2.html  \n>\n>1.V2\n>\n>         2.\n>\n>\n\n![image-20240221093819873](typora-user-images/image-20240221093819873.png)\n\n\n\n******\n\n F12 /v1/flow  /v2/flow\n\n\n\n![image-20240221094018816](typora-user-images/image-20240221094018816.png)\n\n\n\n>resources/app/scripts/controllers/identity.js  \n>\n> \n\n\n\n![image-20240221094225094](typora-user-images/image-20240221094225094.png)\n\n\n\n![image-20240221094244920](typora-user-images/image-20240221094244920.png)\n\nnacos~~~~~~~~~~~~~~\n\nF12V1V2js\n\n\n\n![image-20240221094447664](typora-user-images/image-20240221094447664.png)\n\n![image-20240221094852671](typora-user-images/image-20240221094852671.png)\n\n\n\n![image-20240221095745495](typora-user-images/image-20240221095745495.png)\n\n![image-20240221155333042](typora-user-images/image-20240221155333042.png)\n","slug":"Spring Cloud Alibaba /Spring Cloud Alibaba-04-Sentinel","published":1,"date":"2023-10-24T02:17:50.992Z","updated":"2024-02-21T08:30:03.704Z","title":"","comments":1,"layout":"post","photos":[],"_id":"cmbhu8dhr000aecfy69yvc0oc","content":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.09.10</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-04-Sentinel\"><a href=\"#Spring-Cloud-Alibaba-04-Sentinel\" class=\"headerlink\" title=\"Spring Cloud Alibaba-04-Sentinel\"></a>Spring Cloud Alibaba-04-Sentinel</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> 100% </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>,, 100%   </p>\n<p>   </p>\n<p><img src=\"/typora-user-images/image-20231024102201145.png\" alt=\"image-20231024102201145\"></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> , </p>\n<p><strong></strong></p>\n<p></p>\n<ul>\n<li><p><strong></strong></p>\n<p><br><br>:.</p>\n</li>\n</ul>\n<p><img src=\"/typora-user-images/image-20231024104338016.png\" alt=\"image-20231024104338016\"></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p></p>\n<p><img src=\"/typora-user-images/image-20231201143940420.png\" alt=\"image-20231201143940420\"></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p>, ,</p>\n<p><img src=\"/typora-user-images/image-20231201144020748.png\" alt=\"image-20231201144020748\"></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> </p>\n<p><img src=\"/typora-user-images/image-20231201144119343.png\" alt=\"image-20231201144119343\"></p>\n<p>:</p>\n<ul>\n<li><p>(Closed)   </p>\n</li>\n<li><p>Open  fallback </p>\n</li>\n<li><p>Half-Open\t  ;</p>\n</li>\n<li><p><strong></strong></p>\n</li>\n</ul>\n<p></p>\n<p><img src=\"/typora-user-images/image-20231201153117052.png\" alt=\"image-20231201153117052\"></p>\n<p><strong></strong></p>\n<p><strong>Hystrix</strong><br>HystrixNetflix </p>\n<p><strong>Resilience4J</strong><br>Resilicence4JHystrix Resilicence4jSpring Boot 1.x&#x2F;2.x prometheus</p>\n<p><strong>Sentinel</strong><br>Sentinel  :</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Sentinel</th>\n<th>Hystrix</th>\n<th>Resilience4J</th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td>&#x2F;</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>LeapArray</td>\n<td>RxJava</td>\n<td>Ring Bit Buffer</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>QPS,</td>\n<td></td>\n<td>Rate Limiter</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>Rate Limiter</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td> </td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h2><h3 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h3><p>Sentinel () <strong></strong> , <strong></strong></p>\n<p>Sentinel:</p>\n<p>Sentinel :</p>\n<p>** :**Sentinel  10 , ( ) <br>:Sentinel  ,  500 <br><strong></strong>:Sentinel &#x2F;,  Spring CloudDubbogRPC  Sentinel</p>\n<p>** SPI :**Sentinel  SPI  </p>\n<p><strong>Sentinel :</strong></p>\n<ul>\n<li>(Java )&#x2F;, Java  Dubbo &#x2F; Spring Cloud </li>\n<li>(Dashboard) Spring Boot  Tomcat  </li>\n</ul>\n<h3 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h3><p>Sentinel, Sentinel</p>\n<p><strong>1pom.xml</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>2application.yml sentinel</strong><br><strong><code>ymlclient-ip ip</code></strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">    <span class=\"attr\">cloud:</span></span><br><span class=\"line\">        <span class=\"attr\">sentinel:</span></span><br><span class=\"line\">            <span class=\"attr\">transport:</span></span><br><span class=\"line\">                <span class=\"attr\">dashboard:</span> <span class=\"number\">192.168</span><span class=\"number\">.32</span><span class=\"number\">.131</span><span class=\"string\">:8858</span></span><br><span class=\"line\">                <span class=\"attr\">client-ip:</span> <span class=\"number\">192.168</span><span class=\"number\">.32</span><span class=\"number\">.1</span></span><br><span class=\"line\">                <span class=\"attr\">port:</span> <span class=\"number\">8719</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p><strong>3Controller</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sentinel/message1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message1</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message1&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sentinel/message2&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message2</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message2&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h3><p>Sentinel , </p>\n<p><strong>1jar</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jar, https://github.com/alibaba/Sentinel/releases </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># jar(SpringBoot)</span><br><span class=\"line\">java -Dserver.port=8858 -Dcsp.sentinel.dashboard.server=localhost:8858 - Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.1.jar </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>2docker</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">//sentinel</span><br><span class=\"line\">docker pull bladex/sentinel-dashboard:1.8.1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//</span><br><span class=\"line\">docker run --name sentinel  -d -p 8858:8858 -p 8719:8719 -d bladex/sentinel-dashboard:1.8.1 -e username=sentinel -e password=sentinel -e server=localhost:8858</span><br></pre></td></tr></table></figure>\n\n\n\n<p>localhost:8858  (  sentinel&#x2F;sentinel )</p>\n<p></p>\n<p><strong>Sentinel Sentinel </strong></p>\n<p><strong>:</strong></p>\n<p>SentinelSpringBoot, , ,  </p>\n<p><img src=\"/typora-user-images/image-20240219114233026.png\" alt=\"image-20240219114233026\"></p>\n<p><img src=\"/typora-user-images/image-20240219113719157.png\" alt=\"image-20240219113719157\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1message1</p>\n<p><img src=\"/typora-user-images/image-20240219114343151.png\" alt=\"image-20240219114343151\"></p>\n<p>2, </p>\n<p><img src=\"/typora-user-images/image-20240219114515952.png\" alt=\"image-20240219114515952\"></p>\n<h2 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><strong></strong></li>\n</ul>\n<p>Sentinel</p>\n<p>SentinelJava</p>\n<blockquote>\n<p>message1</p>\n</blockquote>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p></p>\n<p></p>\n<blockquote>\n<p>message1message1</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"/typora-user-images/image-20240219144606520.png\" alt=\"image-20240219144606520\"></p>\n<p>Sentinel,:</p>\n<p><strong>1</strong><br>  Sentinel </p>\n<p><strong>2</strong></p>\n<p><br></p>\n<p><strong>Sentinel :</strong></p>\n<p>(1)</p>\n<p>Sentinel    </p>\n<p>(2)</p>\n<p>Sentinel   </p>\n<p><strong>Sentinel  Hystrix </strong></p>\n<blockquote>\n<p>, , ,  , :</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hystrix , ,   </span><br><span class=\"line\"></span><br><span class=\"line\">Sentinel  </span><br></pre></td></tr></table></figure></blockquote>\n<p><strong>3</strong></p>\n<p>Sentinel   Sentinel   : Sentinel </p>\n<h2 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>QPS()  </p>\n<p>1:  :</p>\n<p><img src=\"/typora-user-images/image-20240219150634816.png\" alt=\"image-20240219150634816\"></p>\n<p>**:**</p>\n<p>:default</p>\n<p><strong>&#x2F;:</strong></p>\n<ul>\n<li>QPS(): QPS</li>\n<li>:</li>\n</ul>\n<p>**:** QPS</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>QPS33</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240219150821657.png\" alt=\"image-20240219150821657\"></p>\n<p> &#x2F;order&#x2F;message1 QPS &gt; 3 Blocked by Sentinel (flow limiting)</p>\n<p><img src=\"/typora-user-images/image-20240219150910898.png\" alt=\"image-20240219150910898\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><img src=\"/typora-user-images/image-20240219151031448.png\" alt=\"image-20240219151031448\"></p>\n<p>sentinel:</p>\n<p><strong></strong>():</p>\n<p><strong></strong>: []</p>\n<p><strong></strong>:</p>\n<p>:</p>\n<p><strong></strong></p>\n<p></p>\n<p><strong></strong></p>\n<p></p>\n<p>1:,  &#x2F;sentinel&#x2F;message2</p>\n<p><img src=\"/typora-user-images/image-20240219151212695.png\" alt=\"image-20240219151212695\"></p>\n<p>2:postman&#x2F;sentinel&#x2F;message2QPS3</p>\n<p><img src=\"/typora-user-images/image-20240219152607457.png\" alt=\"image-20240219152607457\"></p>\n<p>3:&#x2F;sentinel&#x2F;message1,</p>\n<p><img src=\"/typora-user-images/image-20240219152638390.png\" alt=\"image-20240219152638390\"></p>\n<p><strong></strong></p>\n<p> :<strong> </strong></p>\n<p>1: servicemessage</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImpl</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@SentinelResource(&quot;message&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">message</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;message&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>2: Controllerservice</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> TestSentinelMessage3ServiceImpl testSentinelMessage3Service;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sentinel/message1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message1</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        testSentinelMessage3Service.message();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message1&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sentinel/message2&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message2</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        testSentinelMessage3Service.message();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message2&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><img src=\"/typora-user-images/image-20240219154032740.png\" alt=\"image-20240219154032740\"></p>\n<p>  &#x2F;sentinel&#x2F;message1  &#x2F;sentinel&#x2F;message2 , 2, 1</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><strong>():</strong> </p>\n<p>**Warm Up:**QPSQPS 1&#x2F;3<br></p>\n<p>**:**;  </p>\n<h3 id=\"-Sentinel\"><a href=\"#-Sentinel\" class=\"headerlink\" title=\" Sentinel:\"></a> Sentinel:</h3><h4 id=\"-SLOW-REQUEST-RATIO\"><a href=\"#-SLOW-REQUEST-RATIO\" class=\"headerlink\" title=\" (SLOW_REQUEST_RATIO)\"></a> (SLOW_REQUEST_RATIO)</h4><p> RT</p>\n<p>statIntervalMs1</p>\n<blockquote>\n<p>HALF-OPEN  RT  RT </p>\n</blockquote>\n<ul>\n<li> RT200 200</li>\n<li>0~1</li>\n<li><code></code>1108 0.8</li>\n<li>java 400</li>\n</ul>\n<p></p>\n<ol>\n<li> &gt; RT</li>\n<li>statIntervalMs&gt; </li>\n<li> &gt; maxSlowRequestRatio</li>\n<li>HALF-OPEN  RT </li>\n</ol>\n<p>4001s5</p>\n<p><img src=\"/typora-user-images/image-20240220094227461.png\" alt=\"image-20240220094227461\"></p>\n<p> <code>HALF-OPEN  RT  RT </code></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240220095107292.png\" alt=\"image-20240220095107292\"></p>\n<h4 id=\"-ERROR-RATIO\"><a href=\"#-ERROR-RATIO\" class=\"headerlink\" title=\" (ERROR_RATIO)\"></a> (ERROR_RATIO)</h4><p>statIntervalMs  s </p>\n<p>HALF-OPEN </p>\n<p> [0.0, 1.0] 0% - 100%</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240220095645324.png\" alt=\"image-20240220095645324\"></p>\n<p><img src=\"/typora-user-images/image-20240220101010503.png\" alt=\"image-20240220101010503\"></p>\n<h4 id=\"-ERROR-COUNT\"><a href=\"#-ERROR-COUNT\" class=\"headerlink\" title=\" (ERROR_COUNT)\"></a> (ERROR_COUNT)</h4><p>1s</p>\n<p>HALF-OPEN </p>\n<p>timeWindow 60s</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240220101429844.png\" alt=\"image-20240220101429844\"></p>\n<p>50%1</p>\n<p><img src=\"/typora-user-images/image-20240220101701432.png\" alt=\"image-20240220101701432\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>, </p>\n<p><strong></strong></p>\n<p>1</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/sentinel/message3&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@SentinelResource(&quot;message3&quot;)</span><span class=\"comment\">//, </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">message3</span><span class=\"params\">(String name, Integer age)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> name + age;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2: </p>\n<p><img src=\"/typora-user-images/image-20240220102332812.png\" alt=\"image-20240220102332812\"></p>\n<p>3: ,</p>\n<p><img src=\"/typora-user-images/image-20240220102431979.png\" alt=\"image-20240220102431979\"></p>\n<p><img src=\"/typora-user-images/image-20240220102457440.png\" alt=\"image-20240220102457440\"></p>\n<p><strong></strong></p>\n<p></p>\n<p>,</p>\n<p><img src=\"/typora-user-images/image-20240220102621265.png\" alt=\"image-20240220102621265\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> Sentinel  (origin):</p>\n<p>;<br></p>\n<p><img src=\"/typora-user-images/image-20240220102752041.png\" alt=\"image-20240220102752041\"></p>\n<p>?</p>\n<blockquote>\n<p>Sentinel RequestOriginParser  SentinelSentinel RequestOriginParser <br></p>\n</blockquote>\n<p>1: </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RequestOriginParserDefinition</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">RequestOriginParser</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">parseOrigin</span><span class=\"params\">(HttpServletRequest request)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">serviceName</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;serviceName&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> serviceName;</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>2: <br>serviceName&#x3D;pc()</p>\n<p><img src=\"/typora-user-images/image-20240220103006353.png\" alt=\"image-20240220103006353\"></p>\n<p>3 <a href=\"http://localhost:18001/sentinel/message3?serviceName=pc\">http://localhost:18001/sentinel/message3?serviceName=pc</a>  </p>\n<p><img src=\"/typora-user-images/image-20240220103217414.png\" alt=\"image-20240220103217414\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> LoadRT QPS CPU </p>\n<p> () </p>\n<ul>\n<li>Load( Linux&#x2F;Unix-like ): load1   maxQps * minRt   CPU cores * 2.5</li>\n<li>RT: RT </li>\n<li>:</li>\n<li> QPS: QPS </li>\n<li>CPU: CPU</li>\n</ul>\n<p><strong>: </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ExceptionHandlerPage</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">BlockExceptionHandler</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//BlockException ,Sentinel</span></span><br><span class=\"line\">    <span class=\"comment\">// FlowException </span></span><br><span class=\"line\">    <span class=\"comment\">// DegradeException </span></span><br><span class=\"line\">    <span class=\"comment\">// ParamFlowException </span></span><br><span class=\"line\">    <span class=\"comment\">// AuthorityException </span></span><br><span class=\"line\">    <span class=\"comment\">// SystemBlockException </span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, BlockException ex)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> FlowException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> DegradeException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> ParamFlowException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> SystemBlockException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;/...&quot;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> AuthorityException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// http</span></span><br><span class=\"line\">        response.setStatus(<span class=\"number\">500</span>);</span><br><span class=\"line\">        response.setCharacterEncoding(<span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Content-Type&quot;</span>, <span class=\"string\">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        response.setContentType(<span class=\"string\">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// spring mvcjsonjackson</span></span><br><span class=\"line\">        <span class=\"comment\">//json</span></span><br><span class=\"line\">        response.setStatus(<span class=\"number\">200</span>);</span><br><span class=\"line\">        response.setCharacterEncoding(<span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">        response.setContentType(MediaType.APPLICATION_JSON_VALUE);</span><br><span class=\"line\">        <span class=\"comment\">//springmvc json jackson</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>().writeValue(response.getWriter(), msg);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"comment\">//response.sendRedirect(&quot;http://www.baidu.com&quot;);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>:SpringCloudAlibabasentinel UrlBlockHandler sentinel2.2.5.RELEASEBlockExceptionHandler</p>\n<h2 id=\"SentinelResource\"><a href=\"#SentinelResource\" class=\"headerlink\" title=\"@SentinelResource\"></a>@SentinelResource</h2><p>Dashboard<br>@SentinelResource</p>\n<p>@SentinelResource  fallback :</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>value</td>\n<td></td>\n</tr>\n<tr>\n<td>entryType</td>\n<td>entryIN&#x2F;OUTOUT</td>\n</tr>\n<tr>\n<td>blockHandler</td>\n<td>BlockException,:1.  public2. 3.  blockHandlerClass blockHandlerClass</td>\n</tr>\n<tr>\n<td>blockHandlerClass</td>\n<td>blockHandler,static</td>\n</tr>\n<tr>\n<td>fallback</td>\n<td>fallbackfallback ( exceptionsToIgnore ) :1.  2. 3.  fallbackClass fallbackClass</td>\n</tr>\n<tr>\n<td>fallbackClass</td>\n<td>fallbackstatic</td>\n</tr>\n<tr>\n<td>defaultFallback</td>\n<td> fallback fallback  fallback  defaultFallbackfallback :1.  2.  Throwable 3.  fallbackClass  fallbackClass </td>\n</tr>\n<tr>\n<td>exceptionsToIgnore</td>\n<td> fallback</td>\n</tr>\n<tr>\n<td>exceptionsToTrace</td>\n<td>trace</td>\n</tr>\n</tbody></table>\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImpl</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@SentinelResource(</span></span><br><span class=\"line\"><span class=\"meta\">                value = &quot;message&quot;,</span></span><br><span class=\"line\"><span class=\"meta\">                blockHandler = &quot;blockHandler&quot;,//BlockException</span></span><br><span class=\"line\"><span class=\"meta\">                fallback = &quot;fallback&quot;//Throwable</span></span><br><span class=\"line\"><span class=\"meta\">        )</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">message</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i % <span class=\"number\">3</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;message&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//BlockException</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">blockHandler</span><span class=\"params\">(BlockException ex)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;...&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//Throwable</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">fallback</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;...&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImpl</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@SentinelResource(</span></span><br><span class=\"line\"><span class=\"meta\">            value = &quot;message&quot;,</span></span><br><span class=\"line\"><span class=\"meta\">            blockHandlerClass = TestSentinelMessage3ServiceImplBlockHandlerClass.class,</span></span><br><span class=\"line\"><span class=\"meta\">            blockHandler = &quot;blockHandler&quot;,</span></span><br><span class=\"line\"><span class=\"meta\">            fallbackClass = TestSentinelMessage3ServiceImplFallbackClass.class,</span></span><br><span class=\"line\"><span class=\"meta\">            fallback = &quot;fallback&quot;</span></span><br><span class=\"line\"><span class=\"meta\">    )</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        i++;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i % <span class=\"number\">3</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message4&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImplBlockHandlerClass</span> &#123; <span class=\"comment\">//static</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">blockHandler</span><span class=\"params\">(BlockException ex)</span> &#123;</span><br><span class=\"line\">        log.error(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, ex);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;...&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImplFallbackClass</span> &#123; <span class=\"comment\">//static</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">fallback</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">        log.error(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, throwable);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;...&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h2><p>DashboardSentinel </p>\n<h3 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel:\"></a>Sentinel:</h3><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td>API</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Pull</td>\n<td>WritableDataSourceRDBMS</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Push</td>\n<td>ReadableDataSourceNacosZookeeperpush</td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>DashboardAPI</p>\n<p><img src=\"/typora-user-images/a7002eb5f5b8429c8b8728b9f2e3e10d.png\" alt=\"img\"></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>pullRDBMS  RuleManagertransportWritableDataSourceRegistry</p>\n<p><img src=\"/typora-user-images/afb25fa106bada4b37da64e902060269.png\" alt=\"img\"></p>\n<p>SentinelAPI pullSentinel</p>\n<p></p>\n<p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-extension<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>InitFuncinitDataSourcespi</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FileDataSourceInit</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">InitFunc</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">RULE_FILE_PATH</span> <span class=\"operator\">=</span> System.getProperty(<span class=\"string\">&quot;user.home&quot;</span>) + File.separator;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">FLOW_RULE_FILE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;FlowRule.json&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        dealFlowRules();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">dealFlowRules</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> FileNotFoundException &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">ruleFilePath</span> <span class=\"operator\">=</span> RULE_FILE_PATH + FLOW_RULE_FILE_NAME;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">FileRefreshableDataSource</span> <span class=\"variable\">flowRuleRDS</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FileRefreshableDataSource</span>(</span><br><span class=\"line\">                ruleFilePath, source -&gt; JSON.parseObject((String) source,</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;FlowRule&gt;&gt;() &#123;</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// FlowRuleManager </span></span><br><span class=\"line\">        FlowRuleManager.register2Property(flowRuleRDS.getProperty());</span><br><span class=\"line\"></span><br><span class=\"line\">        WritableDataSource&lt;List&lt;FlowRule&gt;&gt; flowRuleWDS = <span class=\"keyword\">new</span> <span class=\"title class_\">FileWritableDataSource</span>&lt;&gt;(</span><br><span class=\"line\">                ruleFilePath, <span class=\"built_in\">this</span>::encodeJson</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  transport  WritableDataSourceRegistry .</span></span><br><span class=\"line\">        <span class=\"comment\">// Sentinel .</span></span><br><span class=\"line\">        WritableDataSourceRegistry.registerFlowDataSource(flowRuleWDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> &lt;T&gt; String <span class=\"title function_\">encodeJson</span><span class=\"params\">(T t)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JSON.toJSONString(t);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>META-INF&#x2F;servicescom.alibaba.csp.sentinel.init.InitFunc</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">com.lison.springcloudservice.config.sentinel.FileDataSourceInit</span><br></pre></td></tr></table></figure>\n\n<p>DashboardDashboardFlowRule.jsonFlowRule.json3</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>pushpushZooKeeper, Nacos, ApolloSentinel&#x2F;Sentinel    Sentinel  SentinelSentinel</p>\n<p><img src=\"/typora-user-images/c5abda0a657e59634fb07442a84bf5e0.png\" alt=\"img\"></p>\n<h3 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h3><p>    Sentinel  Sentinel</p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>nacos</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-cloud-service</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">sentinel:</span></span><br><span class=\"line\">      <span class=\"attr\">transport:</span></span><br><span class=\"line\">        <span class=\"attr\">dashboard:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8080</span></span><br><span class=\"line\">      <span class=\"attr\">datasource:</span></span><br><span class=\"line\">        <span class=\"attr\">flow-ds:</span></span><br><span class=\"line\">          <span class=\"attr\">nacos:</span></span><br><span class=\"line\">            <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\">            <span class=\"attr\">dataId:</span> <span class=\"string\">$&#123;spring.application.name&#125;-flow</span></span><br><span class=\"line\">            <span class=\"attr\">groupId:</span> <span class=\"string\">DEFAULT_GROUP</span></span><br><span class=\"line\">            <span class=\"attr\">data-type:</span> <span class=\"string\">json</span></span><br><span class=\"line\">            <span class=\"attr\">rule-type:</span> <span class=\"string\">flow</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>NacosSentinel Dashboard</p>\n<p>sentinelnacos</p>\n<p>NacosWritableDataSourcenacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// WritableDataSource#writenacos</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">write</span><span class=\"params\">(T t)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    lock.lock();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        configService.publishConfig(dataId, groupId, <span class=\"built_in\">this</span>.configEncoder.convert(t), ConfigType.JSON.getType());</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        lock.unlock();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>Sentinel DashboardNacosSentinel DashboardnacosSentinel DashboardnacosSentinel DashboardnacosSentinel</p>\n<p>AbstractDataSourceProperties<br>SentinelPropertiesTreeMapdatasource</p>\n<blockquote>\n<p>com.alibaba.cloud.sentinel.datasource.config.AbstractDataSourceProperties#postRegister</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postRegister</span><span class=\"params\">(AbstractDataSource dataSource)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.getRuleType()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> FLOW:</span><br><span class=\"line\">        FlowRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DEGRADE:</span><br><span class=\"line\">        DegradeRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> PARAM_FLOW:</span><br><span class=\"line\">        ParamFlowRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> SYSTEM:</span><br><span class=\"line\">        SystemRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> AUTHORITY:</span><br><span class=\"line\">        AuthorityRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> GW_FLOW:</span><br><span class=\"line\">        GatewayRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> GW_API_GROUP:</span><br><span class=\"line\">        GatewayApiDefinitionManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>NacosDataSourceNacos</strong></p>\n<p>NacosDataSourceNacosNacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">NacosDataSource</span><span class=\"params\">(<span class=\"keyword\">final</span> Properties properties, <span class=\"keyword\">final</span> String groupId, <span class=\"keyword\">final</span> String dataId,</span></span><br><span class=\"line\"><span class=\"params\">                       Converter&lt;String, T&gt; parser)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(parser);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StringUtil.isBlank(groupId) || StringUtil.isBlank(dataId)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(String.format(<span class=\"string\">&quot;Bad argument: groupId=[%s], dataId=[%s]&quot;</span>,</span><br><span class=\"line\">            groupId, dataId));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    AssertUtil.notNull(properties, <span class=\"string\">&quot;Nacos properties must not be null, you could put some keys from PropertyKeyConst&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.groupId = groupId;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.dataId = dataId;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.properties = properties;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.configListener = <span class=\"keyword\">new</span> <span class=\"title class_\">Listener</span>() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Executor <span class=\"title function_\">getExecutor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> pool;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">receiveConfigInfo</span><span class=\"params\">(<span class=\"keyword\">final</span> String configInfo)</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            RecordLog.info(<span class=\"string\">&quot;[NacosDataSource] New property value received for (properties: &#123;&#125;) (dataId: &#123;&#125;, groupId: &#123;&#125;): &#123;&#125;&quot;</span>,</span><br><span class=\"line\">                properties, dataId, groupId, configInfo);</span><br><span class=\"line\">            <span class=\"type\">T</span> <span class=\"variable\">newValue</span> <span class=\"operator\">=</span> NacosDataSource.<span class=\"built_in\">this</span>.parser.convert(configInfo);</span><br><span class=\"line\">            <span class=\"comment\">// Update the new value to the property.</span></span><br><span class=\"line\">            getProperty().updateValue(newValue);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    initNacosListener();</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    loadInitialConfig();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loadInitialConfig</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">T</span> <span class=\"variable\">newValue</span> <span class=\"operator\">=</span> loadConfig();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newValue == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            RecordLog.warn(<span class=\"string\">&quot;[NacosDataSource] WARN: initial config is null, you may have to check your data source&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        getProperty().updateValue(newValue);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">        RecordLog.warn(<span class=\"string\">&quot;[NacosDataSource] Error when loading initial config&quot;</span>, ex);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">initNacosListener</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.configService = NacosFactory.createConfigService(<span class=\"built_in\">this</span>.properties);</span><br><span class=\"line\">        <span class=\"comment\">// Add config listener.</span></span><br><span class=\"line\">        configService.addListener(dataId, groupId, configListener);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">        RecordLog.warn(<span class=\"string\">&quot;[NacosDataSource] Error occurred when initializing Nacos data source&quot;</span>, e);</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>SentinelDataSourceHandlerNacosDataSource</strong><br>SentinelAutoConfigurationSentinelDataSourceHandler</p>\n<p>SentinelDataSourceHandlerDataSourcespring</p>\n<blockquote>\n<p>com.alibaba.cloud.sentinel.custom.SentinelDataSourceHandler#afterSingletonsInstantiated</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">afterSingletonsInstantiated</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.sentinelProperties.getDatasource().forEach((dataSourceName, dataSourceProperties) -&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            List&lt;String&gt; validFields = dataSourceProperties.getValidField();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (validFields.size() != <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                log.error(<span class=\"string\">&quot;[Sentinel Starter] DataSource &quot;</span> + dataSourceName + <span class=\"string\">&quot; multi datasource active and won&#x27;t loaded: &quot;</span> + dataSourceProperties.getValidField());</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">AbstractDataSourceProperties</span> <span class=\"variable\">abstractDataSourceProperties</span> <span class=\"operator\">=</span> dataSourceProperties.getValidDataSourceProperties();</span><br><span class=\"line\">            abstractDataSourceProperties.setEnv(<span class=\"built_in\">this</span>.env);</span><br><span class=\"line\">            abstractDataSourceProperties.preCheck(dataSourceName);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.registerBean(abstractDataSourceProperties, dataSourceName + <span class=\"string\">&quot;-sentinel-&quot;</span> + (String)validFields.get(<span class=\"number\">0</span>) + <span class=\"string\">&quot;-datasource&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception var5) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;[Sentinel Starter] DataSource &quot;</span> + dataSourceName + <span class=\"string\">&quot; build error: &quot;</span> + var5.getMessage(), var5);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>Sentinel<br>    Sentinel  Sentinel</p>\n<p>Sentinel1.4.0SentinelDynamicRulePublisherDynamicRuleProvider</p>\n<ul>\n<li>DynamicRuleProvider: </li>\n<li>DynamicRulePublisher: </li>\n</ul>\n<p>Sentinel Dashboard test</p>\n<p><img src=\"/typora-user-images/image-20240220144907721.png\" alt=\"image-20240220144907721\"></p>\n<p>Dashboard</p>\n<p>nacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &lt;dependency&gt;</span><br><span class=\"line\">   &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;</span><br><span class=\"line\">   &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;</span><br><span class=\"line\">   &lt;version&gt;<span class=\"number\">2.0</span><span class=\"number\">.3</span>&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>NacosConfig</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.rule.nacos;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.datasource.Converter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSON;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Eric Zhao</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.4.0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Converter&lt;List&lt;FlowRuleEntity&gt;, String&gt; <span class=\"title function_\">flowRuleEntityEncoder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JSON::toJSONString;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Converter&lt;String, List&lt;FlowRuleEntity&gt;&gt; <span class=\"title function_\">flowRuleEntityDecoder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> s -&gt; JSON.parseArray(s, FlowRuleEntity.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ConfigService <span class=\"title function_\">nacosConfigService</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ConfigFactory.createConfigService(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>FlowRuleNacosProviderNacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.rule.nacos;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.rule.DynamicRuleProvider;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.datasource.Converter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.util.StringUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Eric Zhao</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.4.0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component(&quot;flowRuleNacosProvider&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FlowRuleNacosProvider</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">DynamicRuleProvider</span>&lt;List&lt;FlowRuleEntity&gt;&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigService configService;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Converter&lt;String, List&lt;FlowRuleEntity&gt;&gt; converter;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;FlowRuleEntity&gt; <span class=\"title function_\">getRules</span><span class=\"params\">(String appName)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rules</span> <span class=\"operator\">=</span> configService.getConfig(appName + NacosConfigUtil.FLOW_DATA_ID_POSTFIX,</span><br><span class=\"line\">            NacosConfigUtil.GROUP_ID, <span class=\"number\">3000</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtil.isEmpty(rules)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> converter.convert(rules);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>FlowRuleNacosPublisherNacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.rule.nacos;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.rule.DynamicRulePublisher;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.datasource.Converter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.util.AssertUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Eric Zhao</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.4.0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component(&quot;flowRuleNacosPublisher&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FlowRuleNacosPublisher</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">DynamicRulePublisher</span>&lt;List&lt;FlowRuleEntity&gt;&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigService configService;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Converter&lt;List&lt;FlowRuleEntity&gt;, String&gt; converter;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">publish</span><span class=\"params\">(String app, List&lt;FlowRuleEntity&gt; rules)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        AssertUtil.notEmpty(app, <span class=\"string\">&quot;app name cannot be empty&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rules == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        configService.publishConfig(app + NacosConfigUtil.FLOW_DATA_ID_POSTFIX,</span><br><span class=\"line\">            NacosConfigUtil.GROUP_ID, converter.convert(rules));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>DashboardFlowControllerV2</p>\n<p><img src=\"/typora-user-images/image-20240221092028120.png\" alt=\"image-20240221092028120\"></p>\n<p> Nacos  Nacos  FlowControllerV2  bean  Nacos sidebar.html  dashboard.flowV1  dashboard.flow </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"meta\">@Qualifier(&quot;flowRuleNacosProvider&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> DynamicRuleProvider&lt;List&lt;FlowRuleEntity&gt;&gt; ruleProvider;</span><br><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"meta\">@Qualifier(&quot;flowRuleNacosPublisher&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> DynamicRulePublisher&lt;List&lt;FlowRuleEntity&gt;&gt; rulePublisher;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<p></p>\n<p><strong>1</strong></p>\n<p>pomsentinel-datasource-nacosscopeNacos</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- for Nacos rule publisher sample --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240221091728143.png\" alt=\"image-20240221091728143\"></p>\n<p>testnacoscom.alibaba.csp.sentinel.dashboard.rule</p>\n<p><img src=\"/typora-user-images/image-20240221091837069.png\" alt=\"image-20240221091837069\"></p>\n<p>FlowControllerV2flowRuleNacosProviderflowRuleNacosPublisher</p>\n<p><img src=\"/typora-user-images/image-20240221091441127.png\" alt=\"image-20240221091441127\"></p>\n<p><strong>2</strong></p>\n<p>sidebardashboard.flowV1dashboard.flow</p>\n<p><img src=\"/typora-user-images/image-20240221092353574.png\" alt=\"image-20240221092353574\"></p>\n<p><img src=\"/typora-user-images/image-20240221092419244.png\" alt=\"image-20240221092419244\"></p>\n<p><img src=\"/typora-user-images/image-20240221092834785.png\" alt=\"image-20240221092834785\"></p>\n<p>sentinel dashboardnacos</p>\n<p><img src=\"/typora-user-images/image-20240221093021265.png\" alt=\"image-20240221093021265\"></p>\n<p>spring-cloud-service.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;app&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;spring-cloud-service&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;clusterConfig&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;acquireRefuseStrategy&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;clientOfflineTime&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">2000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;fallbackToLocalWhenFail&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;resourceTimeout&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">2000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;resourceTimeoutStrategy&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;sampleCount&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">10</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;strategy&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;thresholdType&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;windowIntervalMs&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1000</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;clusterMode&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;controlBehavior&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;count&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;gmtCreate&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1708478952132</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;gmtModified&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1708478952132</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;grade&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;id&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">9</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;ip&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;10.108.202.7&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;limitApp&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;default&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;port&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">9998</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;resource&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;/sentinel/message3&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;strategy&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><strong></strong></p>\n<p><strong>nacos-dashboard</strong></p>\n<p><img src=\"/typora-user-images/image-20240221093711599.png\" alt=\"image-20240221093711599\"></p>\n<p><strong></strong></p>\n<blockquote>\n<p>resources&#x2F;app&#x2F;views&#x2F;flow_v2.html  </p>\n<p>1.V2</p>\n<p>         2.</p>\n<p></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20240221093819873.png\" alt=\"image-20240221093819873\"></p>\n<p><em><strong></strong></em></p>\n<p> F12 &#x2F;v1&#x2F;flow  &#x2F;v2&#x2F;flow</p>\n<p><img src=\"/typora-user-images/image-20240221094018816.png\" alt=\"image-20240221094018816\"></p>\n<p></p>\n<blockquote>\n<p>resources&#x2F;app&#x2F;scripts&#x2F;controllers&#x2F;identity.js  </p>\n<p> </p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20240221094225094.png\" alt=\"image-20240221094225094\"></p>\n<p><img src=\"/typora-user-images/image-20240221094244920.png\" alt=\"image-20240221094244920\"></p>\n<p>nacos~~~~~~~~~~~~~~</p>\n<p>F12V1V2js</p>\n<p><img src=\"/typora-user-images/image-20240221094447664.png\" alt=\"image-20240221094447664\"></p>\n<p><img src=\"/typora-user-images/image-20240221094852671.png\" alt=\"image-20240221094852671\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240221095745495.png\" alt=\"image-20240221095745495\"></p>\n<p><img src=\"/typora-user-images/image-20240221155333042.png\" alt=\"image-20240221155333042\"></p>\n","excerpt":"","more":"<p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2023.09.10</code></p>\n<h1 id=\"Spring-Cloud-Alibaba-04-Sentinel\"><a href=\"#Spring-Cloud-Alibaba-04-Sentinel\" class=\"headerlink\" title=\"Spring Cloud Alibaba-04-Sentinel\"></a>Spring Cloud Alibaba-04-Sentinel</h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> 100% </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>,, 100%   </p>\n<p>   </p>\n<p><img src=\"/typora-user-images/image-20231024102201145.png\" alt=\"image-20231024102201145\"></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> , </p>\n<p><strong></strong></p>\n<p></p>\n<ul>\n<li><p><strong></strong></p>\n<p><br><br>:.</p>\n</li>\n</ul>\n<p><img src=\"/typora-user-images/image-20231024104338016.png\" alt=\"image-20231024104338016\"></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p></p>\n<p><img src=\"/typora-user-images/image-20231201143940420.png\" alt=\"image-20231201143940420\"></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p>, ,</p>\n<p><img src=\"/typora-user-images/image-20231201144020748.png\" alt=\"image-20231201144020748\"></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> </p>\n<p><img src=\"/typora-user-images/image-20231201144119343.png\" alt=\"image-20231201144119343\"></p>\n<p>:</p>\n<ul>\n<li><p>(Closed)   </p>\n</li>\n<li><p>Open  fallback </p>\n</li>\n<li><p>Half-Open\t  ;</p>\n</li>\n<li><p><strong></strong></p>\n</li>\n</ul>\n<p></p>\n<p><img src=\"/typora-user-images/image-20231201153117052.png\" alt=\"image-20231201153117052\"></p>\n<p><strong></strong></p>\n<p><strong>Hystrix</strong><br>HystrixNetflix </p>\n<p><strong>Resilience4J</strong><br>Resilicence4JHystrix Resilicence4jSpring Boot 1.x&#x2F;2.x prometheus</p>\n<p><strong>Sentinel</strong><br>Sentinel  :</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Sentinel</th>\n<th>Hystrix</th>\n<th>Resilience4J</th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td>&#x2F;</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>LeapArray</td>\n<td>RxJava</td>\n<td>Ring Bit Buffer</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>QPS,</td>\n<td></td>\n<td>Rate Limiter</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td>Rate Limiter</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td> </td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h2><h3 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h3><p>Sentinel () <strong></strong> , <strong></strong></p>\n<p>Sentinel:</p>\n<p>Sentinel :</p>\n<p>** :**Sentinel  10 , ( ) <br>:Sentinel  ,  500 <br><strong></strong>:Sentinel &#x2F;,  Spring CloudDubbogRPC  Sentinel</p>\n<p>** SPI :**Sentinel  SPI  </p>\n<p><strong>Sentinel :</strong></p>\n<ul>\n<li>(Java )&#x2F;, Java  Dubbo &#x2F; Spring Cloud </li>\n<li>(Dashboard) Spring Boot  Tomcat  </li>\n</ul>\n<h3 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h3><p>Sentinel, Sentinel</p>\n<p><strong>1pom.xml</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>2application.yml sentinel</strong><br><strong><code>ymlclient-ip ip</code></strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">    <span class=\"attr\">cloud:</span></span><br><span class=\"line\">        <span class=\"attr\">sentinel:</span></span><br><span class=\"line\">            <span class=\"attr\">transport:</span></span><br><span class=\"line\">                <span class=\"attr\">dashboard:</span> <span class=\"number\">192.168</span><span class=\"number\">.32</span><span class=\"number\">.131</span><span class=\"string\">:8858</span></span><br><span class=\"line\">                <span class=\"attr\">client-ip:</span> <span class=\"number\">192.168</span><span class=\"number\">.32</span><span class=\"number\">.1</span></span><br><span class=\"line\">                <span class=\"attr\">port:</span> <span class=\"number\">8719</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p><strong>3Controller</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sentinel/message1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message1</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message1&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sentinel/message2&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message2</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message2&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h3><p>Sentinel , </p>\n<p><strong>1jar</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jar, https://github.com/alibaba/Sentinel/releases </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># jar(SpringBoot)</span><br><span class=\"line\">java -Dserver.port=8858 -Dcsp.sentinel.dashboard.server=localhost:8858 - Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.1.jar </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>2docker</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">//sentinel</span><br><span class=\"line\">docker pull bladex/sentinel-dashboard:1.8.1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//</span><br><span class=\"line\">docker run --name sentinel  -d -p 8858:8858 -p 8719:8719 -d bladex/sentinel-dashboard:1.8.1 -e username=sentinel -e password=sentinel -e server=localhost:8858</span><br></pre></td></tr></table></figure>\n\n\n\n<p>localhost:8858  (  sentinel&#x2F;sentinel )</p>\n<p></p>\n<p><strong>Sentinel Sentinel </strong></p>\n<p><strong>:</strong></p>\n<p>SentinelSpringBoot, , ,  </p>\n<p><img src=\"/typora-user-images/image-20240219114233026.png\" alt=\"image-20240219114233026\"></p>\n<p><img src=\"/typora-user-images/image-20240219113719157.png\" alt=\"image-20240219113719157\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1message1</p>\n<p><img src=\"/typora-user-images/image-20240219114343151.png\" alt=\"image-20240219114343151\"></p>\n<p>2, </p>\n<p><img src=\"/typora-user-images/image-20240219114515952.png\" alt=\"image-20240219114515952\"></p>\n<h2 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><strong></strong></li>\n</ul>\n<p>Sentinel</p>\n<p>SentinelJava</p>\n<blockquote>\n<p>message1</p>\n</blockquote>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p></p>\n<p></p>\n<blockquote>\n<p>message1message1</p>\n</blockquote>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"/typora-user-images/image-20240219144606520.png\" alt=\"image-20240219144606520\"></p>\n<p>Sentinel,:</p>\n<p><strong>1</strong><br>  Sentinel </p>\n<p><strong>2</strong></p>\n<p><br></p>\n<p><strong>Sentinel :</strong></p>\n<p>(1)</p>\n<p>Sentinel    </p>\n<p>(2)</p>\n<p>Sentinel   </p>\n<p><strong>Sentinel  Hystrix </strong></p>\n<blockquote>\n<p>, , ,  , :</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hystrix , ,   </span><br><span class=\"line\"></span><br><span class=\"line\">Sentinel  </span><br></pre></td></tr></table></figure></blockquote>\n<p><strong>3</strong></p>\n<p>Sentinel   Sentinel   : Sentinel </p>\n<h2 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>QPS()  </p>\n<p>1:  :</p>\n<p><img src=\"/typora-user-images/image-20240219150634816.png\" alt=\"image-20240219150634816\"></p>\n<p>**:**</p>\n<p>:default</p>\n<p><strong>&#x2F;:</strong></p>\n<ul>\n<li>QPS(): QPS</li>\n<li>:</li>\n</ul>\n<p>**:** QPS</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>QPS33</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240219150821657.png\" alt=\"image-20240219150821657\"></p>\n<p> &#x2F;order&#x2F;message1 QPS &gt; 3 Blocked by Sentinel (flow limiting)</p>\n<p><img src=\"/typora-user-images/image-20240219150910898.png\" alt=\"image-20240219150910898\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><img src=\"/typora-user-images/image-20240219151031448.png\" alt=\"image-20240219151031448\"></p>\n<p>sentinel:</p>\n<p><strong></strong>():</p>\n<p><strong></strong>: []</p>\n<p><strong></strong>:</p>\n<p>:</p>\n<p><strong></strong></p>\n<p></p>\n<p><strong></strong></p>\n<p></p>\n<p>1:,  &#x2F;sentinel&#x2F;message2</p>\n<p><img src=\"/typora-user-images/image-20240219151212695.png\" alt=\"image-20240219151212695\"></p>\n<p>2:postman&#x2F;sentinel&#x2F;message2QPS3</p>\n<p><img src=\"/typora-user-images/image-20240219152607457.png\" alt=\"image-20240219152607457\"></p>\n<p>3:&#x2F;sentinel&#x2F;message1,</p>\n<p><img src=\"/typora-user-images/image-20240219152638390.png\" alt=\"image-20240219152638390\"></p>\n<p><strong></strong></p>\n<p> :<strong> </strong></p>\n<p>1: servicemessage</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImpl</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@SentinelResource(&quot;message&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">message</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;message&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>2: Controllerservice</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> TestSentinelMessage3ServiceImpl testSentinelMessage3Service;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sentinel/message1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message1</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        testSentinelMessage3Service.message();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message1&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sentinel/message2&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message2</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        testSentinelMessage3Service.message();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message2&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><img src=\"/typora-user-images/image-20240219154032740.png\" alt=\"image-20240219154032740\"></p>\n<p>  &#x2F;sentinel&#x2F;message1  &#x2F;sentinel&#x2F;message2 , 2, 1</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><strong>():</strong> </p>\n<p>**Warm Up:**QPSQPS 1&#x2F;3<br></p>\n<p>**:**;  </p>\n<h3 id=\"-Sentinel\"><a href=\"#-Sentinel\" class=\"headerlink\" title=\" Sentinel:\"></a> Sentinel:</h3><h4 id=\"-SLOW-REQUEST-RATIO\"><a href=\"#-SLOW-REQUEST-RATIO\" class=\"headerlink\" title=\" (SLOW_REQUEST_RATIO)\"></a> (SLOW_REQUEST_RATIO)</h4><p> RT</p>\n<p>statIntervalMs1</p>\n<blockquote>\n<p>HALF-OPEN  RT  RT </p>\n</blockquote>\n<ul>\n<li> RT200 200</li>\n<li>0~1</li>\n<li><code></code>1108 0.8</li>\n<li>java 400</li>\n</ul>\n<p></p>\n<ol>\n<li> &gt; RT</li>\n<li>statIntervalMs&gt; </li>\n<li> &gt; maxSlowRequestRatio</li>\n<li>HALF-OPEN  RT </li>\n</ol>\n<p>4001s5</p>\n<p><img src=\"/typora-user-images/image-20240220094227461.png\" alt=\"image-20240220094227461\"></p>\n<p> <code>HALF-OPEN  RT  RT </code></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240220095107292.png\" alt=\"image-20240220095107292\"></p>\n<h4 id=\"-ERROR-RATIO\"><a href=\"#-ERROR-RATIO\" class=\"headerlink\" title=\" (ERROR_RATIO)\"></a> (ERROR_RATIO)</h4><p>statIntervalMs  s </p>\n<p>HALF-OPEN </p>\n<p> [0.0, 1.0] 0% - 100%</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240220095645324.png\" alt=\"image-20240220095645324\"></p>\n<p><img src=\"/typora-user-images/image-20240220101010503.png\" alt=\"image-20240220101010503\"></p>\n<h4 id=\"-ERROR-COUNT\"><a href=\"#-ERROR-COUNT\" class=\"headerlink\" title=\" (ERROR_COUNT)\"></a> (ERROR_COUNT)</h4><p>1s</p>\n<p>HALF-OPEN </p>\n<p>timeWindow 60s</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240220101429844.png\" alt=\"image-20240220101429844\"></p>\n<p>50%1</p>\n<p><img src=\"/typora-user-images/image-20240220101701432.png\" alt=\"image-20240220101701432\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>, </p>\n<p><strong></strong></p>\n<p>1</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/sentinel/message3&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@SentinelResource(&quot;message3&quot;)</span><span class=\"comment\">//, </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">message3</span><span class=\"params\">(String name, Integer age)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> name + age;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2: </p>\n<p><img src=\"/typora-user-images/image-20240220102332812.png\" alt=\"image-20240220102332812\"></p>\n<p>3: ,</p>\n<p><img src=\"/typora-user-images/image-20240220102431979.png\" alt=\"image-20240220102431979\"></p>\n<p><img src=\"/typora-user-images/image-20240220102457440.png\" alt=\"image-20240220102457440\"></p>\n<p><strong></strong></p>\n<p></p>\n<p>,</p>\n<p><img src=\"/typora-user-images/image-20240220102621265.png\" alt=\"image-20240220102621265\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> Sentinel  (origin):</p>\n<p>;<br></p>\n<p><img src=\"/typora-user-images/image-20240220102752041.png\" alt=\"image-20240220102752041\"></p>\n<p>?</p>\n<blockquote>\n<p>Sentinel RequestOriginParser  SentinelSentinel RequestOriginParser <br></p>\n</blockquote>\n<p>1: </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RequestOriginParserDefinition</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">RequestOriginParser</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">parseOrigin</span><span class=\"params\">(HttpServletRequest request)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">serviceName</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;serviceName&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> serviceName;</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>2: <br>serviceName&#x3D;pc()</p>\n<p><img src=\"/typora-user-images/image-20240220103006353.png\" alt=\"image-20240220103006353\"></p>\n<p>3 <a href=\"http://localhost:18001/sentinel/message3?serviceName=pc\">http://localhost:18001/sentinel/message3?serviceName=pc</a>  </p>\n<p><img src=\"/typora-user-images/image-20240220103217414.png\" alt=\"image-20240220103217414\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> LoadRT QPS CPU </p>\n<p> () </p>\n<ul>\n<li>Load( Linux&#x2F;Unix-like ): load1   maxQps * minRt   CPU cores * 2.5</li>\n<li>RT: RT </li>\n<li>:</li>\n<li> QPS: QPS </li>\n<li>CPU: CPU</li>\n</ul>\n<p><strong>: </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ExceptionHandlerPage</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">BlockExceptionHandler</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//BlockException ,Sentinel</span></span><br><span class=\"line\">    <span class=\"comment\">// FlowException </span></span><br><span class=\"line\">    <span class=\"comment\">// DegradeException </span></span><br><span class=\"line\">    <span class=\"comment\">// ParamFlowException </span></span><br><span class=\"line\">    <span class=\"comment\">// AuthorityException </span></span><br><span class=\"line\">    <span class=\"comment\">// SystemBlockException </span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, BlockException ex)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> FlowException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> DegradeException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> ParamFlowException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> SystemBlockException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;/...&quot;</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ex <span class=\"keyword\">instanceof</span> AuthorityException) &#123;</span><br><span class=\"line\">            msg = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// http</span></span><br><span class=\"line\">        response.setStatus(<span class=\"number\">500</span>);</span><br><span class=\"line\">        response.setCharacterEncoding(<span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Content-Type&quot;</span>, <span class=\"string\">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        response.setContentType(<span class=\"string\">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// spring mvcjsonjackson</span></span><br><span class=\"line\">        <span class=\"comment\">//json</span></span><br><span class=\"line\">        response.setStatus(<span class=\"number\">200</span>);</span><br><span class=\"line\">        response.setCharacterEncoding(<span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">        response.setContentType(MediaType.APPLICATION_JSON_VALUE);</span><br><span class=\"line\">        <span class=\"comment\">//springmvc json jackson</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>().writeValue(response.getWriter(), msg);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"comment\">//response.sendRedirect(&quot;http://www.baidu.com&quot;);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>:SpringCloudAlibabasentinel UrlBlockHandler sentinel2.2.5.RELEASEBlockExceptionHandler</p>\n<h2 id=\"SentinelResource\"><a href=\"#SentinelResource\" class=\"headerlink\" title=\"@SentinelResource\"></a>@SentinelResource</h2><p>Dashboard<br>@SentinelResource</p>\n<p>@SentinelResource  fallback :</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>value</td>\n<td></td>\n</tr>\n<tr>\n<td>entryType</td>\n<td>entryIN&#x2F;OUTOUT</td>\n</tr>\n<tr>\n<td>blockHandler</td>\n<td>BlockException,:1.  public2. 3.  blockHandlerClass blockHandlerClass</td>\n</tr>\n<tr>\n<td>blockHandlerClass</td>\n<td>blockHandler,static</td>\n</tr>\n<tr>\n<td>fallback</td>\n<td>fallbackfallback ( exceptionsToIgnore ) :1.  2. 3.  fallbackClass fallbackClass</td>\n</tr>\n<tr>\n<td>fallbackClass</td>\n<td>fallbackstatic</td>\n</tr>\n<tr>\n<td>defaultFallback</td>\n<td> fallback fallback  fallback  defaultFallbackfallback :1.  2.  Throwable 3.  fallbackClass  fallbackClass </td>\n</tr>\n<tr>\n<td>exceptionsToIgnore</td>\n<td> fallback</td>\n</tr>\n<tr>\n<td>exceptionsToTrace</td>\n<td>trace</td>\n</tr>\n</tbody></table>\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImpl</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@SentinelResource(</span></span><br><span class=\"line\"><span class=\"meta\">                value = &quot;message&quot;,</span></span><br><span class=\"line\"><span class=\"meta\">                blockHandler = &quot;blockHandler&quot;,//BlockException</span></span><br><span class=\"line\"><span class=\"meta\">                fallback = &quot;fallback&quot;//Throwable</span></span><br><span class=\"line\"><span class=\"meta\">        )</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">message</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i % <span class=\"number\">3</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;message&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//BlockException</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">blockHandler</span><span class=\"params\">(BlockException ex)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;...&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//Throwable</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">fallback</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;...&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImpl</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@SentinelResource(</span></span><br><span class=\"line\"><span class=\"meta\">            value = &quot;message&quot;,</span></span><br><span class=\"line\"><span class=\"meta\">            blockHandlerClass = TestSentinelMessage3ServiceImplBlockHandlerClass.class,</span></span><br><span class=\"line\"><span class=\"meta\">            blockHandler = &quot;blockHandler&quot;,</span></span><br><span class=\"line\"><span class=\"meta\">            fallbackClass = TestSentinelMessage3ServiceImplFallbackClass.class,</span></span><br><span class=\"line\"><span class=\"meta\">            fallback = &quot;fallback&quot;</span></span><br><span class=\"line\"><span class=\"meta\">    )</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">message</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        i++;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i % <span class=\"number\">3</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;message4&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImplBlockHandlerClass</span> &#123; <span class=\"comment\">//static</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">blockHandler</span><span class=\"params\">(BlockException ex)</span> &#123;</span><br><span class=\"line\">        log.error(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, ex);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;...&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestSentinelMessage3ServiceImplFallbackClass</span> &#123; <span class=\"comment\">//static</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">fallback</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">        log.error(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, throwable);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;...&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel\"></a>Sentinel</h2><p>DashboardSentinel </p>\n<h3 id=\"Sentinel\"><a href=\"#Sentinel\" class=\"headerlink\" title=\"Sentinel:\"></a>Sentinel:</h3><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td>API</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Pull</td>\n<td>WritableDataSourceRDBMS</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Push</td>\n<td>ReadableDataSourceNacosZookeeperpush</td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>DashboardAPI</p>\n<p><img src=\"/typora-user-images/a7002eb5f5b8429c8b8728b9f2e3e10d.png\" alt=\"img\"></p>\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>pullRDBMS  RuleManagertransportWritableDataSourceRegistry</p>\n<p><img src=\"/typora-user-images/afb25fa106bada4b37da64e902060269.png\" alt=\"img\"></p>\n<p>SentinelAPI pullSentinel</p>\n<p></p>\n<p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-extension<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>InitFuncinitDataSourcespi</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FileDataSourceInit</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">InitFunc</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">RULE_FILE_PATH</span> <span class=\"operator\">=</span> System.getProperty(<span class=\"string\">&quot;user.home&quot;</span>) + File.separator;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">FLOW_RULE_FILE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;FlowRule.json&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        dealFlowRules();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">dealFlowRules</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> FileNotFoundException &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">ruleFilePath</span> <span class=\"operator\">=</span> RULE_FILE_PATH + FLOW_RULE_FILE_NAME;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">FileRefreshableDataSource</span> <span class=\"variable\">flowRuleRDS</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FileRefreshableDataSource</span>(</span><br><span class=\"line\">                ruleFilePath, source -&gt; JSON.parseObject((String) source,</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;FlowRule&gt;&gt;() &#123;</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// FlowRuleManager </span></span><br><span class=\"line\">        FlowRuleManager.register2Property(flowRuleRDS.getProperty());</span><br><span class=\"line\"></span><br><span class=\"line\">        WritableDataSource&lt;List&lt;FlowRule&gt;&gt; flowRuleWDS = <span class=\"keyword\">new</span> <span class=\"title class_\">FileWritableDataSource</span>&lt;&gt;(</span><br><span class=\"line\">                ruleFilePath, <span class=\"built_in\">this</span>::encodeJson</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  transport  WritableDataSourceRegistry .</span></span><br><span class=\"line\">        <span class=\"comment\">// Sentinel .</span></span><br><span class=\"line\">        WritableDataSourceRegistry.registerFlowDataSource(flowRuleWDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> &lt;T&gt; String <span class=\"title function_\">encodeJson</span><span class=\"params\">(T t)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JSON.toJSONString(t);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>META-INF&#x2F;servicescom.alibaba.csp.sentinel.init.InitFunc</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">com.lison.springcloudservice.config.sentinel.FileDataSourceInit</span><br></pre></td></tr></table></figure>\n\n<p>DashboardDashboardFlowRule.jsonFlowRule.json3</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>pushpushZooKeeper, Nacos, ApolloSentinel&#x2F;Sentinel    Sentinel  SentinelSentinel</p>\n<p><img src=\"/typora-user-images/c5abda0a657e59634fb07442a84bf5e0.png\" alt=\"img\"></p>\n<h3 id=\"Nacos\"><a href=\"#Nacos\" class=\"headerlink\" title=\"Nacos\"></a>Nacos</h3><p>    Sentinel  Sentinel</p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>nacos</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-cloud-service</span></span><br><span class=\"line\">  <span class=\"attr\">cloud:</span></span><br><span class=\"line\">    <span class=\"attr\">sentinel:</span></span><br><span class=\"line\">      <span class=\"attr\">transport:</span></span><br><span class=\"line\">        <span class=\"attr\">dashboard:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8080</span></span><br><span class=\"line\">      <span class=\"attr\">datasource:</span></span><br><span class=\"line\">        <span class=\"attr\">flow-ds:</span></span><br><span class=\"line\">          <span class=\"attr\">nacos:</span></span><br><span class=\"line\">            <span class=\"attr\">server-addr:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:8848</span></span><br><span class=\"line\">            <span class=\"attr\">dataId:</span> <span class=\"string\">$&#123;spring.application.name&#125;-flow</span></span><br><span class=\"line\">            <span class=\"attr\">groupId:</span> <span class=\"string\">DEFAULT_GROUP</span></span><br><span class=\"line\">            <span class=\"attr\">data-type:</span> <span class=\"string\">json</span></span><br><span class=\"line\">            <span class=\"attr\">rule-type:</span> <span class=\"string\">flow</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>NacosSentinel Dashboard</p>\n<p>sentinelnacos</p>\n<p>NacosWritableDataSourcenacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// WritableDataSource#writenacos</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">write</span><span class=\"params\">(T t)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    lock.lock();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        configService.publishConfig(dataId, groupId, <span class=\"built_in\">this</span>.configEncoder.convert(t), ConfigType.JSON.getType());</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        lock.unlock();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>Sentinel DashboardNacosSentinel DashboardnacosSentinel DashboardnacosSentinel DashboardnacosSentinel</p>\n<p>AbstractDataSourceProperties<br>SentinelPropertiesTreeMapdatasource</p>\n<blockquote>\n<p>com.alibaba.cloud.sentinel.datasource.config.AbstractDataSourceProperties#postRegister</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postRegister</span><span class=\"params\">(AbstractDataSource dataSource)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.getRuleType()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> FLOW:</span><br><span class=\"line\">        FlowRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> DEGRADE:</span><br><span class=\"line\">        DegradeRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> PARAM_FLOW:</span><br><span class=\"line\">        ParamFlowRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> SYSTEM:</span><br><span class=\"line\">        SystemRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> AUTHORITY:</span><br><span class=\"line\">        AuthorityRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> GW_FLOW:</span><br><span class=\"line\">        GatewayRuleManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> GW_API_GROUP:</span><br><span class=\"line\">        GatewayApiDefinitionManager.register2Property(dataSource.getProperty());</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>NacosDataSourceNacos</strong></p>\n<p>NacosDataSourceNacosNacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">NacosDataSource</span><span class=\"params\">(<span class=\"keyword\">final</span> Properties properties, <span class=\"keyword\">final</span> String groupId, <span class=\"keyword\">final</span> String dataId,</span></span><br><span class=\"line\"><span class=\"params\">                       Converter&lt;String, T&gt; parser)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(parser);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StringUtil.isBlank(groupId) || StringUtil.isBlank(dataId)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(String.format(<span class=\"string\">&quot;Bad argument: groupId=[%s], dataId=[%s]&quot;</span>,</span><br><span class=\"line\">            groupId, dataId));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    AssertUtil.notNull(properties, <span class=\"string\">&quot;Nacos properties must not be null, you could put some keys from PropertyKeyConst&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.groupId = groupId;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.dataId = dataId;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.properties = properties;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.configListener = <span class=\"keyword\">new</span> <span class=\"title class_\">Listener</span>() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Executor <span class=\"title function_\">getExecutor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> pool;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">receiveConfigInfo</span><span class=\"params\">(<span class=\"keyword\">final</span> String configInfo)</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            RecordLog.info(<span class=\"string\">&quot;[NacosDataSource] New property value received for (properties: &#123;&#125;) (dataId: &#123;&#125;, groupId: &#123;&#125;): &#123;&#125;&quot;</span>,</span><br><span class=\"line\">                properties, dataId, groupId, configInfo);</span><br><span class=\"line\">            <span class=\"type\">T</span> <span class=\"variable\">newValue</span> <span class=\"operator\">=</span> NacosDataSource.<span class=\"built_in\">this</span>.parser.convert(configInfo);</span><br><span class=\"line\">            <span class=\"comment\">// Update the new value to the property.</span></span><br><span class=\"line\">            getProperty().updateValue(newValue);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    initNacosListener();</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    loadInitialConfig();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loadInitialConfig</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">T</span> <span class=\"variable\">newValue</span> <span class=\"operator\">=</span> loadConfig();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newValue == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            RecordLog.warn(<span class=\"string\">&quot;[NacosDataSource] WARN: initial config is null, you may have to check your data source&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        getProperty().updateValue(newValue);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">        RecordLog.warn(<span class=\"string\">&quot;[NacosDataSource] Error when loading initial config&quot;</span>, ex);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">initNacosListener</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.configService = NacosFactory.createConfigService(<span class=\"built_in\">this</span>.properties);</span><br><span class=\"line\">        <span class=\"comment\">// Add config listener.</span></span><br><span class=\"line\">        configService.addListener(dataId, groupId, configListener);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">        RecordLog.warn(<span class=\"string\">&quot;[NacosDataSource] Error occurred when initializing Nacos data source&quot;</span>, e);</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>SentinelDataSourceHandlerNacosDataSource</strong><br>SentinelAutoConfigurationSentinelDataSourceHandler</p>\n<p>SentinelDataSourceHandlerDataSourcespring</p>\n<blockquote>\n<p>com.alibaba.cloud.sentinel.custom.SentinelDataSourceHandler#afterSingletonsInstantiated</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">afterSingletonsInstantiated</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.sentinelProperties.getDatasource().forEach((dataSourceName, dataSourceProperties) -&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            List&lt;String&gt; validFields = dataSourceProperties.getValidField();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (validFields.size() != <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                log.error(<span class=\"string\">&quot;[Sentinel Starter] DataSource &quot;</span> + dataSourceName + <span class=\"string\">&quot; multi datasource active and won&#x27;t loaded: &quot;</span> + dataSourceProperties.getValidField());</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">AbstractDataSourceProperties</span> <span class=\"variable\">abstractDataSourceProperties</span> <span class=\"operator\">=</span> dataSourceProperties.getValidDataSourceProperties();</span><br><span class=\"line\">            abstractDataSourceProperties.setEnv(<span class=\"built_in\">this</span>.env);</span><br><span class=\"line\">            abstractDataSourceProperties.preCheck(dataSourceName);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.registerBean(abstractDataSourceProperties, dataSourceName + <span class=\"string\">&quot;-sentinel-&quot;</span> + (String)validFields.get(<span class=\"number\">0</span>) + <span class=\"string\">&quot;-datasource&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception var5) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;[Sentinel Starter] DataSource &quot;</span> + dataSourceName + <span class=\"string\">&quot; build error: &quot;</span> + var5.getMessage(), var5);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>Sentinel<br>    Sentinel  Sentinel</p>\n<p>Sentinel1.4.0SentinelDynamicRulePublisherDynamicRuleProvider</p>\n<ul>\n<li>DynamicRuleProvider: </li>\n<li>DynamicRulePublisher: </li>\n</ul>\n<p>Sentinel Dashboard test</p>\n<p><img src=\"/typora-user-images/image-20240220144907721.png\" alt=\"image-20240220144907721\"></p>\n<p>Dashboard</p>\n<p>nacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &lt;dependency&gt;</span><br><span class=\"line\">   &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;</span><br><span class=\"line\">   &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;</span><br><span class=\"line\">   &lt;version&gt;<span class=\"number\">2.0</span><span class=\"number\">.3</span>&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>NacosConfig</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.rule.nacos;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.datasource.Converter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSON;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Eric Zhao</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.4.0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NacosConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Converter&lt;List&lt;FlowRuleEntity&gt;, String&gt; <span class=\"title function_\">flowRuleEntityEncoder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JSON::toJSONString;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Converter&lt;String, List&lt;FlowRuleEntity&gt;&gt; <span class=\"title function_\">flowRuleEntityDecoder</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> s -&gt; JSON.parseArray(s, FlowRuleEntity.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ConfigService <span class=\"title function_\">nacosConfigService</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ConfigFactory.createConfigService(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>FlowRuleNacosProviderNacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.rule.nacos;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.rule.DynamicRuleProvider;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.datasource.Converter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.util.StringUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Eric Zhao</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.4.0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component(&quot;flowRuleNacosProvider&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FlowRuleNacosProvider</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">DynamicRuleProvider</span>&lt;List&lt;FlowRuleEntity&gt;&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigService configService;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Converter&lt;String, List&lt;FlowRuleEntity&gt;&gt; converter;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;FlowRuleEntity&gt; <span class=\"title function_\">getRules</span><span class=\"params\">(String appName)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rules</span> <span class=\"operator\">=</span> configService.getConfig(appName + NacosConfigUtil.FLOW_DATA_ID_POSTFIX,</span><br><span class=\"line\">            NacosConfigUtil.GROUP_ID, <span class=\"number\">3000</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtil.isEmpty(rules)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> converter.convert(rules);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>FlowRuleNacosPublisherNacos</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.alibaba.csp.sentinel.dashboard.rule.nacos;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.datasource.entity.rule.FlowRuleEntity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.dashboard.rule.DynamicRulePublisher;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.datasource.Converter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.csp.sentinel.util.AssertUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.nacos.api.config.ConfigService;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Eric Zhao</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.4.0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component(&quot;flowRuleNacosPublisher&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FlowRuleNacosPublisher</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">DynamicRulePublisher</span>&lt;List&lt;FlowRuleEntity&gt;&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigService configService;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Converter&lt;List&lt;FlowRuleEntity&gt;, String&gt; converter;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">publish</span><span class=\"params\">(String app, List&lt;FlowRuleEntity&gt; rules)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        AssertUtil.notEmpty(app, <span class=\"string\">&quot;app name cannot be empty&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rules == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        configService.publishConfig(app + NacosConfigUtil.FLOW_DATA_ID_POSTFIX,</span><br><span class=\"line\">            NacosConfigUtil.GROUP_ID, converter.convert(rules));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>DashboardFlowControllerV2</p>\n<p><img src=\"/typora-user-images/image-20240221092028120.png\" alt=\"image-20240221092028120\"></p>\n<p> Nacos  Nacos  FlowControllerV2  bean  Nacos sidebar.html  dashboard.flowV1  dashboard.flow </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"meta\">@Qualifier(&quot;flowRuleNacosProvider&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> DynamicRuleProvider&lt;List&lt;FlowRuleEntity&gt;&gt; ruleProvider;</span><br><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"meta\">@Qualifier(&quot;flowRuleNacosPublisher&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> DynamicRulePublisher&lt;List&lt;FlowRuleEntity&gt;&gt; rulePublisher;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<p></p>\n<p><strong>1</strong></p>\n<p>pomsentinel-datasource-nacosscopeNacos</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- for Nacos rule publisher sample --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20240221091728143.png\" alt=\"image-20240221091728143\"></p>\n<p>testnacoscom.alibaba.csp.sentinel.dashboard.rule</p>\n<p><img src=\"/typora-user-images/image-20240221091837069.png\" alt=\"image-20240221091837069\"></p>\n<p>FlowControllerV2flowRuleNacosProviderflowRuleNacosPublisher</p>\n<p><img src=\"/typora-user-images/image-20240221091441127.png\" alt=\"image-20240221091441127\"></p>\n<p><strong>2</strong></p>\n<p>sidebardashboard.flowV1dashboard.flow</p>\n<p><img src=\"/typora-user-images/image-20240221092353574.png\" alt=\"image-20240221092353574\"></p>\n<p><img src=\"/typora-user-images/image-20240221092419244.png\" alt=\"image-20240221092419244\"></p>\n<p><img src=\"/typora-user-images/image-20240221092834785.png\" alt=\"image-20240221092834785\"></p>\n<p>sentinel dashboardnacos</p>\n<p><img src=\"/typora-user-images/image-20240221093021265.png\" alt=\"image-20240221093021265\"></p>\n<p>spring-cloud-service.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;app&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;spring-cloud-service&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;clusterConfig&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;acquireRefuseStrategy&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;clientOfflineTime&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">2000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;fallbackToLocalWhenFail&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;resourceTimeout&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">2000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;resourceTimeoutStrategy&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;sampleCount&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">10</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;strategy&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;thresholdType&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;windowIntervalMs&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1000</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;clusterMode&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;controlBehavior&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;count&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;gmtCreate&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1708478952132</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;gmtModified&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1708478952132</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;grade&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;id&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">9</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;ip&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;10.108.202.7&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;limitApp&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;default&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;port&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">9998</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;resource&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;/sentinel/message3&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;strategy&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><strong></strong></p>\n<p><strong>nacos-dashboard</strong></p>\n<p><img src=\"/typora-user-images/image-20240221093711599.png\" alt=\"image-20240221093711599\"></p>\n<p><strong></strong></p>\n<blockquote>\n<p>resources&#x2F;app&#x2F;views&#x2F;flow_v2.html  </p>\n<p>1.V2</p>\n<p>         2.</p>\n<p></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20240221093819873.png\" alt=\"image-20240221093819873\"></p>\n<p><em><strong></strong></em></p>\n<p> F12 &#x2F;v1&#x2F;flow  &#x2F;v2&#x2F;flow</p>\n<p><img src=\"/typora-user-images/image-20240221094018816.png\" alt=\"image-20240221094018816\"></p>\n<p></p>\n<blockquote>\n<p>resources&#x2F;app&#x2F;scripts&#x2F;controllers&#x2F;identity.js  </p>\n<p> </p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20240221094225094.png\" alt=\"image-20240221094225094\"></p>\n<p><img src=\"/typora-user-images/image-20240221094244920.png\" alt=\"image-20240221094244920\"></p>\n<p>nacos~~~~~~~~~~~~~~</p>\n<p>F12V1V2js</p>\n<p><img src=\"/typora-user-images/image-20240221094447664.png\" alt=\"image-20240221094447664\"></p>\n<p><img src=\"/typora-user-images/image-20240221094852671.png\" alt=\"image-20240221094852671\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20240221095745495.png\" alt=\"image-20240221095745495\"></p>\n<p><img src=\"/typora-user-images/image-20240221155333042.png\" alt=\"image-20240221155333042\"></p>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[],"Tag":[]}}