{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"source/image/shouye.jpg","path":"image/shouye.jpg","modified":0,"renderable":0},{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/butterfly-icon.png","path":"img/butterfly-icon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/error-page.png","path":"img/error-page.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","path":"categories/Spring AI Alibaba/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","path":"categories/Spring AI Alibaba/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","path":"categories/Spring AI Alibaba/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","path":"categories/Spring AI Alibaba/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","path":"categories/Spring AI Alibaba/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","path":"categories/Spring AI Alibaba/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","path":"categories/Spring AI Alibaba/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","path":"categories/Spring AI Alibaba/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419091747915.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250419091747915.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419092017527.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250419092017527.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419102848756.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250419102848756.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419105704031.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250419105704031.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419112758947.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250419112758947.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419113622811.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250419113622811.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419181524113.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250419181524113.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419181631076.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250419181631076.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419181745960.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250419181745960.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114322913.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250422114322913.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114422258.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250422114422258.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114555482.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250422114555482.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114642336.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250422114642336.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250425104935964-5549379.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250425104935964-5549379.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250425104935964.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250425104935964.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250425174252871.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250425174252871.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429172724826.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429172724826.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429174851066.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429174851066.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429174959408.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429174959408.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175228086.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429175228086.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175342611.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429175342611.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175421998.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429175421998.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429180401580.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429180401580.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175540574.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429175540574.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429181039571.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429181039571.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429181131778.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429181131778.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429181312813.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429181312813.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429183142516.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250429183142516.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250508161105090.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250508161105090.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250508161546610.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250508161546610.png","modified":0,"renderable":0},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250508162115569.png","path":"categories/Spring AI Alibaba/typora-user-images/image-20250508162115569.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","path":"categories/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","path":"categories/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","path":"categories/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","path":"categories/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","path":"categories/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","path":"categories/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","path":"categories/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","path":"categories/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250419091747915.png","path":"categories/typora-user-images/image-20250419091747915.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250419092017527.png","path":"categories/typora-user-images/image-20250419092017527.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250419102848756.png","path":"categories/typora-user-images/image-20250419102848756.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250419105704031.png","path":"categories/typora-user-images/image-20250419105704031.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250419112758947.png","path":"categories/typora-user-images/image-20250419112758947.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250419113622811.png","path":"categories/typora-user-images/image-20250419113622811.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250419181524113.png","path":"categories/typora-user-images/image-20250419181524113.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250419181631076.png","path":"categories/typora-user-images/image-20250419181631076.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250419181745960.png","path":"categories/typora-user-images/image-20250419181745960.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250422114322913.png","path":"categories/typora-user-images/image-20250422114322913.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250422114422258.png","path":"categories/typora-user-images/image-20250422114422258.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250422114555482.png","path":"categories/typora-user-images/image-20250422114555482.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250422114642336.png","path":"categories/typora-user-images/image-20250422114642336.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250425104935964-5549379.png","path":"categories/typora-user-images/image-20250425104935964-5549379.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250425104935964.png","path":"categories/typora-user-images/image-20250425104935964.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250425174252871.png","path":"categories/typora-user-images/image-20250425174252871.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429172724826.png","path":"categories/typora-user-images/image-20250429172724826.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429174851066.png","path":"categories/typora-user-images/image-20250429174851066.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429174959408.png","path":"categories/typora-user-images/image-20250429174959408.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429175228086.png","path":"categories/typora-user-images/image-20250429175228086.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429175342611.png","path":"categories/typora-user-images/image-20250429175342611.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429175421998.png","path":"categories/typora-user-images/image-20250429175421998.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429175540574.png","path":"categories/typora-user-images/image-20250429175540574.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429180401580.png","path":"categories/typora-user-images/image-20250429180401580.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429181039571.png","path":"categories/typora-user-images/image-20250429181039571.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429181131778.png","path":"categories/typora-user-images/image-20250429181131778.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429181312813.png","path":"categories/typora-user-images/image-20250429181312813.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250429183142516.png","path":"categories/typora-user-images/image-20250429183142516.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250508161105090.png","path":"categories/typora-user-images/image-20250508161105090.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250508161546610.png","path":"categories/typora-user-images/image-20250508161546610.png","modified":0,"renderable":0},{"_id":"source/categories/typora-user-images/image-20250508162115569.png","path":"categories/typora-user-images/image-20250508162115569.png","modified":0,"renderable":0}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1749024109374},{"_id":"source/about/index.md","hash":"6f31565e4e99bb6fbf55be5771c727ada0bb6bdb","modified":1749030067185},{"_id":"source/categories/index.md","hash":"063dbfa737baf9009645a00100ec0cec8d0eb92b","modified":1749030043836},{"_id":"source/comments/index.md","hash":"7b6b47f281ec1a444ee3e4cc13d6f47d11b17534","modified":1749030059963},{"_id":"source/image/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1748598547000},{"_id":"source/link/index.md","hash":"d25bfd8890c1a4680257bafd013de0323a449965","modified":1749030063718},{"_id":"source/movies/index.md","hash":"e903c93c69e2e624fd3aad6be2efafad14c612ab","modified":1749030056487},{"_id":"source/music/index.md","hash":"a98702749c899f0b85eea15eccf737e5fd13b09d","modified":1749030048081},{"_id":"source/picture/index.md","hash":"9d8a79dcdd7be979da2d4aef0a3c8e67a34cad5e","modified":1749030052571},{"_id":"source/tags/index-1.md","hash":"64e1a23855a7dbd195d4db7219d48f7b240476e4","modified":1749030035728},{"_id":"source/tags/index.md","hash":"5fdc6f265d17bd71664bb6b844bf6e1a36e1755b","modified":1749029228364},{"_id":"source/image/shouye.jpg","hash":"e75ad850c0d85a460832e196ab1940ce99841c8f","modified":1748598528000},{"_id":"themes/butterfly/.gitignore","hash":"76e6365d33cec02b90d00699da3c0ddef1cd7efa","modified":1748584750000},{"_id":"themes/butterfly/LICENSE","hash":"c8bc7df08db9dd3b39c2c2259a163a36cf2f6808","modified":1748584750000},{"_id":"themes/butterfly/README.md","hash":"e1b9096ae0c4e5ef0a911aec05dbad4a3aae3173","modified":1748584750000},{"_id":"themes/butterfly/README_CN.md","hash":"92e45255b8725f0a00450c88fcfd51ec61e1db67","modified":1748584750000},{"_id":"themes/butterfly/_config.butterfly.yml","hash":"7166aff350fcf84cbc01835fad5731eb855cecd7","modified":1748584750000},{"_id":"themes/butterfly/package.json","hash":"dd598502734c702eed104a3f955f75568e18a29e","modified":1748584750000},{"_id":"themes/butterfly/plugins.yml","hash":"a2704f0406484fdae3410e9992cf996f9859356e","modified":1748584750000},{"_id":"themes/butterfly/.github/FUNDING.yml","hash":"da5e77f5e0cdb7e11b36546fb6796d10e3dfbe5d","modified":1748584750000},{"_id":"themes/butterfly/languages/default.yml","hash":"a2c938b1ef69195aec10c90dc7d1871953548e01","modified":1748584750000},{"_id":"themes/butterfly/languages/en.yml","hash":"a2c938b1ef69195aec10c90dc7d1871953548e01","modified":1748584750000},{"_id":"themes/butterfly/languages/ja.yml","hash":"a281d3cc3e117e90597b783dc5569dba3976d2eb","modified":1748584750000},{"_id":"themes/butterfly/languages/ko.yml","hash":"c7d861c58f204f47a5b4d6e118e1f1e8fb8a852f","modified":1748584750000},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"e0bf36edf18cf3380b900be7528b536252990c26","modified":1748584750000},{"_id":"themes/butterfly/languages/zh-HK.yml","hash":"bac3063ad2892be232f7d91361c28585a3cc7eb5","modified":1748584750000},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"bd7ee35aa30964493d2729ef105bb86331b096c3","modified":1748584750000},{"_id":"themes/butterfly/layout/archive.pug","hash":"bc77220dfc269b8faad0930e1a4142ebf68165e5","modified":1748584750000},{"_id":"themes/butterfly/layout/category.pug","hash":"a7e9805a781e34e38d27462e6ce2a5821c34bb9f","modified":1748584750000},{"_id":"themes/butterfly/layout/index.pug","hash":"a93004cc8ec8050df603d32a6e6e02cd96fd9875","modified":1748584750000},{"_id":"themes/butterfly/layout/page.pug","hash":"7ce2a49c6c41847de4ccea377ade116339984434","modified":1748584750000},{"_id":"themes/butterfly/layout/post.pug","hash":"65c4a49c65c3fc4d9dc88b9791a75710c698c3a1","modified":1748584750000},{"_id":"themes/butterfly/layout/tag.pug","hash":"ca5333bd262cb58c195c844b593a0eed0c721766","modified":1748584750000},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"10ce05c8dbde09f53bdabe40b5388de9ccc71a31","modified":1748584750000},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"63ad2249ad09fb3fe21bd5ff9adefb304a7ab24a","modified":1748584750000},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"6e0f9470b18bd37d4891282ac73d61676b040e8c","modified":1748584750000},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"e320b40c051bae1549156cd5ea4a51383cf78598","modified":1748584750000},{"_id":"themes/butterfly/.github/workflows/stale.yml","hash":"4040c76547e270aaf184e9b219a44ca41bbb1b9f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"f9b02aac0dbbb2b71c037dd215e70c8b7ec7741c","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"6bd41add3a45e55d5e51eab5285a2d1a909d37f3","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"1d11e334b22dbbedcb0f751f9ee9789d4416605e","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"e5e6c05a621483b3542f2884e8ba45e84b1e973a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"bd45e6fa935ace9cb54499b0491dacfb78ccc354","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"43f951b639038f3bc01deea03368d8dcf492cbb0","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"3e65b7bf6bccccbba7e15349f0a44f15c64c5b5e","modified":1748584750000},{"_id":"themes/butterfly/scripts/common/postDesc.js","hash":"272613a71d16f0de6dac883be4839259f774be76","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/404.js","hash":"039fc75f363d79669b0b2177d929cdff6f2ef7a4","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/comment.js","hash":"7b1b16e1e8e08245a345764616956be50487eb53","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/init.js","hash":"ce68e84a9ccfcf91100befbaa9afc392a0cd93bb","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"bac639c404588ea62e601ef0bcd368c3bd0119af","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"f59e10305fef59ea3e62a7395106c0927582879d","modified":1748584750000},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"b23108d29fff3e32384d8689c8bcd2ab306a1ae7","modified":1748584750000},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"20a6ebf63439501a4b3fc81e7a2a2ea5d103bace","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"7864ba45716c51aef8d8b04fd4bc212e0008ce3b","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/getArchiveLength.js","hash":"bf77635e920eaf52bceebc95f87c7c87a7ca8038","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"3eb0bbb1288dc7b0ff82cc46ceb53bd666893416","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"0cdf781a8c14d7b50d309e69f282ec7b178804bb","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"00c5742ad1c75b3c5684d02ffc6a1921399e5376","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/series.js","hash":"45367c4ce827329867dbcc750ec125da9ccb2cfd","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"2f44e1b3ccd170b256eae178299d6fa933a8d490","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/chartjs.js","hash":"195ba802d7e8406c155124a9c939a2318f82938b","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"25eefe10189caf3910a0e5d5b2f2043ae9255531","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"a07b586b510aa2df953102d998e84207acc34f9b","modified":1748584750000},{"_id":"themes/butterfly/scripts/events/merge_config.js","hash":"10ffed853a935498f1f5da2c5b57200c957874a7","modified":1748584750000},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"950b7d0966429bf0f9e6c5e1161e50e545e320b4","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"fa3d0a64f7fce4aff7928d4ddd95548978ba001c","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"f02fb085a88a2c0c82aeffacc24e1b71c74bd7c0","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"89c6c78d2db43b190055d5690741a79bab4f3e7e","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"cf0bc17d0180231167cc6aa8a00fc64f198cb9f9","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"50d8d8fac5c5b6e26317028895d7d82a2cf46606","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"e68d8d21f3a86e3646907a3685550ee20e8d4a9f","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/score.js","hash":"f589fb6646bd17cf12d77a9b251dd614e1c8b899","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/series.js","hash":"40bc9a065e3a1423e0e66f4911e00713ca9f5e9e","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"3c486b149e28edd1a06843f05a5c355000991b82","modified":1748584750000},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"176804f07567aa80f1ed95897a968a996b155dec","modified":1748584750000},{"_id":"themes/butterfly/source/css/index.styl","hash":"b13d96924a5534bff91d75566b196ac87b4fac22","modified":1748584750000},{"_id":"themes/butterfly/source/css/var.styl","hash":"d1eec577074ab7b262182885576135bf1896e12c","modified":1748584750000},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1748584750000},{"_id":"themes/butterfly/source/img/error-page.png","hash":"d2519710498a871ca3e913c57e2ba20a805b6430","modified":1748584750000},{"_id":"themes/butterfly/source/img/favicon.ico","hash":"455ac256580bf31a45813dbbdb87219bfc8bfb04","modified":1748584750000},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1748584750000},{"_id":"themes/butterfly/source/js/main.js","hash":"5a52047b8520f79864d5a4ee2379a29751aead23","modified":1748584750000},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"fdb5482d04a75bd79946ad1ed291d281d0e9362d","modified":1748584750000},{"_id":"themes/butterfly/source/js/utils.js","hash":"48637ad8e405306772b93837f33400bde1055819","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"e93a36d3c29b5a02c7f26a23f96e1f84b063cbe8","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"e792a435afee1f9491095084a00dc77e3522c1fd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"9ea75b06f19bf356f340f4a3fc1bdc0713cfe445","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"56a3c32de1a15627ff38c67f1131cdd6ec5ac924","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"f29123e603cbbcc6ce277d4e8f600ba67498077c","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"1e1a69aa2cbda2e621c741b3802093244b3cc04e","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"83ed05ef1e39f2ee70c3fba2cf96e488d8ffec66","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"5168caadc4cf541f5d6676a9c5e8ae47a948f9ad","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/head/structured_data.pug","hash":"1b83ae33961528f128596753fd05067c672d6bff","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"44331c9db74b281b5c5c41439d3407a9076df1a1","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"733184f88e3a586a5fcc9d193ad500556b6c8eed","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"18b984ce184ea53d2dff5a03cc2d0d39d2ec3406","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"7d799c4694adb6e265e3f4b975d7f7f6a7021a17","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"e2d31e0f450ad42c47f7ee96375799342bf2f19b","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/loading/fullpage-loading.pug","hash":"a2f7d69ca7ec58f24fe7d4e04ae21d5b62b01567","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/loading/index.pug","hash":"d76ce71ba106e350670c021a3dcae57547d01830","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/loading/pace.pug","hash":"9d2d539555bab495959b9df734ed5c43a9f9e5a9","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"ef7afe0df7a3746744ac8185da7163b7406120ca","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/mixins/indexPostUI.pug","hash":"f3389fa9ae4fa32e3c16573286583bc3023e57ad","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/404.pug","hash":"15d32c511e4875066fcbe9cb84c3ada07b5a7c41","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"efb40388e37cca0b5e7c3c66e811a42f8d32c910","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"6b0fa5f048aca8e9cbe56978301af918cf7ac34a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/shuoshuo.pug","hash":"b2423cfc57a5e3a0e1112ff7c18d5c5c720d89d5","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"79ad31eb72a9e14007770b18a426406a25315b38","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/post/outdate-notice.pug","hash":"b7ce9484bc5c97ea6154f0b78fb9b8951fafedbd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"b96c232e5178d927987791d9ae386dd83679535a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"db92f25ff3fd061882f81bf74ca560ff66983a0c","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"ed79fef5b5025415ea12eaed970f3fe7f6ef9596","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"43014bfc63583d3ee8808d526dd165848c0ed52f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"efe4f8019632b51c92c4f7628758538305e06e47","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"88f979a0b1a19eeb0db229247833bf9c6865c3b9","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"236c3ce26dd76e80b04d457789475c42da5ac0c8","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/umami_analytics.pug","hash":"bc35a1552d26ecdeeadbf06300078dbb5128a6e5","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"a8312b527493dabbadbb1280760168d3bc909a3b","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"21e019bdc3b1e796bb00976bb29af2d51f873624","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"73d33b6930e7944187a4b3403daf25d27077a2dd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"1aba8aa7cd767dc96879d13a13b4c8ceb9023233","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"1dba77d250eeebfb6e293d504352c7e9ea31980b","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"66e383b4ef374951eb87dd1bf4cdb7a667193fb5","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"d8753772889b5d0f4d15639ed6af5e91e53b1d03","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_post_series.pug","hash":"e0bb72fa0ce15964b11b8fe421cae3432394e35f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"1dd19a564320d248dbcee7f118a5b96c6466da65","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"bb842d2aa6469d65bf06af1372f0a19a9e4ef44c","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"842b772a387b576550fa127030e1c2e9bf65716d","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"7b5ae404a1205546b7de4be42291315cf918f2b3","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"fcddd80cdeb6aa81f342cd9f0102302f6ba087a8","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"45f620cd87b9ef2aa9d1e024e697ed6b4eecff34","modified":1748584750000},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"d12340a7df4601b9a23f070e16645861aeb3bb0a","modified":1748584750000},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"4fcb8222b9548e22f7b76f12d33e3698240cbae0","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"67062d597408068e4a59e95851e98fed34b745da","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"a51edfd3e499e7d38c32241c40e8e4d371efca73","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"ba174889e770ae9f6683379b9eae9d8c94253080","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"4cc02bcbaa4a1933a82a9ea57a603fe2d059fc77","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"fbfce4d67cacd1df22fb73d89d008693f59d9d91","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"d7b988d8588207086670f39aa49fce442c429f7a","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"094108f2a4e351a2fa496d6bd3e2388151416b3f","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"f0b01bbf321c2c24fdccaee367dd9fd448031a72","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"7d7554573c005399bc8c2264a85896d2d51be1e1","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"543eaf9c7df7e0db841e5946ee5f9082c3c46290","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"ef8e8549fe7ad4b99793844a93b4a89f77f417d5","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"d9cdf564a822a585e67fd5bac8573ba87eeb3743","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"a0f5835f04358122e8b1d38dd3e8da09a1b5b431","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"084dc4dfb41f55e237a9d6cf8c2f5dba729b83be","modified":1748584750000},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"0af7c8754f04bdd9a02a14d880774753bd2e35ee","modified":1748584750000},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"4c9849df9c68d892c7df0ca28123aeb0dc9dc424","modified":1748584750000},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"ad66212554468b7067590308ed4cf40524fea662","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"205ccc7d0ec6ce1193b46bc0c9ce0385594581fb","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"5abe5480d83ff8b452a780a484d50a44091475bf","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"c4cda7b0c99015df29ce00fdfddd2f7679653754","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"dcff804c4c237e1e908481b44c1ac4e39ac0da34","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"1f8d715faf3b91b53426e38195c0920afb3bfa1c","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"992d192db7d1c96e995b85ed11c20c571d33fbad","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/shuoshuo.styl","hash":"79bb1d9a27822ed5675d1e52f5dbd0e2f5d5010a","modified":1748584750000},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"7543bb688876a946538d66b991c71b94b5216277","modified":1748584750000},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"d8a8275a68a1421c4c09b604cf78bea16c1d0463","modified":1748584750000},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"6c4cbdadd9a49029fe0c59e29808d873e5b6b6ee","modified":1748584750000},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"1f2b86df86df81c3a59377b29102314ffc73dfa6","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"de8437a058a315d14d7e7034066f095b7b3ed4b4","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"30d1f809efd252ed0233d96d4374efd2b01d2292","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"985b183db7b7bfd8f9bdb60494549fb7f850348b","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"d27dbccaf3de1c9158d19e4fd49a25953cb5778d","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"3be8d0a75e7cc96548667cae0cb6a474279bd0b5","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"216f52fefc2274b542b549d8470503e6f1a308fb","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"4929382bd60788d34752a66e2fe764ef797a72a0","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/series.styl","hash":"0657169849bc4bf4d93b5492ade040c8f58c1901","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"3a88eedcb694da79e92581ce50cb1a430b1fb615","modified":1748584750000},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"e846ddaef494d46cdfa2379deacfe74fa1cc5264","modified":1748584750000},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"8549829fb7d3c21cd9e119884962e8c463a4a267","modified":1748584750000},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"7119f2f2943de71999d3dd6ba5c60cde846f114b","modified":1748584750000},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"a2b783230a9143de69004cfc914d9f55e6fc1660","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/abcjs.pug","hash":"febff991595504d8e850ced0b9cc090f02ed97f0","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/index.pug","hash":"f0a90d8e39915a74b16ef22e851f179415cd7eaa","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"b03ee8625149191f9d5d057bbc9824b68d8dd0c4","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d6fff5a7f84c8b09f282f9ddc0020a68a8aac9ea","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"cbfbcf34a24d21ba2b21cf9eedb76f4c3c563c5a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"846cabae287ae31b3bbfac3da022475713dd5ecc","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"716dc463fe4ef5112e7018ed60804125fdfa5cad","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"b5db4203a1392385838c73549ddeae0a4be67eba","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"7884883ec15792f7e54daacb3c62b851dde2b66a","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"fd2320ee25507bb8ef49f932c2d170586b44ea4d","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"5b29badecbbe828112c001156023fc0566045cf6","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"24d094fd917947c0ca7492fa094328b1a183b873","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"e8438941085def0591a72fc9b0d705dbf107f54f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"62466b251052cae609b6369d4cb4b6a85320757d","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"89c63a5f0c0ab6314de7158fbc8fcbc84997fc55","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"f2ea5249b3e6670f6c8c77868f4f42c502e43830","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"c81fa7d8a5cb96d1ae07bfa8c46b84a58161add1","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"8af585e6d6f73ee57114eefad574dc6e8ea9f570","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"592b2251db6c1abeb8b0eebe3b2e6d9aa0dec445","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"58914c58a190e3bc0aa37cb581e77e442b563501","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"db6713d2b90eb8183f86ac92c26761a8501c0ddb","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"3abbaaa4ea575c45b3cebffd40bad1acc6ffce84","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"7a80231fc71822e503879383a2d9611edf1d72dd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"84f7cfde00f929fa3dc40349bcab060ec68f1b9f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"53d99831f29aeb2e336ed1407d79590041f77002","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"30a7d157890de69deab28baa47fb7bb28b040efd","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"24f18b0c67803210d53abbf9c1d454c000b06eee","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"e2bf15357485cd502414b3b20f5b1f762a2fd014","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/chartjs.pug","hash":"732eb1118ea1a73aa5c164d639097c614f8e9953","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"af66d13204030d47537b9e31a6173e63589ce7ff","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"b83db9fa64d42a0bfd97efb660e09be3f166a144","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"db2f4fff80a1166476ea76ae004aa186df11bad3","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"ca2fc5928ca292f29fd8333c73733344994096fb","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"187302dbc916852ff2fdf47061e272c061611dda","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/common.pug","hash":"27fa75affebc6e84a487c62bceff783bde595256","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"fa4b4194749d05f7249f365f2b89c0281057ce54","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"72e2970b23570e308f8af5d8ba8e5e3321d01bbf","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"a7c07dbc1e970a5b247091458e1ee9b144a3366d","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"34edfebf0cace0852806be774910ccb0e0914650","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"d2e12a9fc302a4efe52c90d44896fbd73e193a1f","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d376ec17fb19fcdcf0d2ad71330190146d3af879","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"ec6c685080634ac46ffbea1b8f10313388888f43","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"7f0ede1cd3fed2669c94a8e1b21bc0b183f310b8","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/search/docsearch.pug","hash":"013756ff3363344987cc00fc9bd833baf193c341","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"f8557548d2ad8dd149c562193991c6c6cda02415","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"2622b4cf9189fa23e4a422aaf9ef272e4f2c6137","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"f5ee1c9c8ffa4bca972d30f4de69268b8d47f052","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"e51e896ccb13900de38dc81cf44dc789e2418a12","modified":1748584750000},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"efef352c1d122409575386bf3894dce8e87032e2","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"9f02598b5e4296aec6470639d4bac4c9ac46392e","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"ef52ebf1e8e751a412f9456fdaeee7d88afd9a72","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"077ec530831be1d80e93da380406b9f5abd0918a","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"1883c91d43bff10aae55122a21e0b064b6f5c9dd","modified":1748584750000},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"de4bb5fc2dfca368b35e4c1109c92f7abc9e2245","modified":1748584750000},{"_id":"themes/butterfly/source/img/butterfly-icon.png","hash":"f5dd732fed5c3bcd4aa76bac3441bac8485fb432","modified":1748584750000},{"_id":"public/about/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/categories/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/comments/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/link/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/movies/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/music/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/picture/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/tags/index-1.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/tags/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/2025/06/04/hello-world/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/archives/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/archives/2025/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/archives/2025/06/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/index.html","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1749030102757},{"_id":"public/img/error-page.png","hash":"d2519710498a871ca3e913c57e2ba20a805b6430","modified":1749030102757},{"_id":"public/img/favicon.ico","hash":"455ac256580bf31a45813dbbdb87219bfc8bfb04","modified":1749030102757},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1749030102757},{"_id":"public/css/index.css","hash":"a134b9ab9b0d4ca6444a66bdcc55bd8f600244f7","modified":1749030102757},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1749030102757},{"_id":"public/js/main.js","hash":"fb746a3e67d0373deea8481110dd436fea4ca38c","modified":1749030102757},{"_id":"public/js/tw_cn.js","hash":"7ef59df188ea523da89f4caf69c5c0f14e78da69","modified":1749030102757},{"_id":"public/js/utils.js","hash":"fd3c26366c78dd82bc87d4ddebe76c582122e1b7","modified":1749030102757},{"_id":"public/js/search/algolia.js","hash":"e5821f78381af9f0f646952a7dd118daab2a79a6","modified":1749030102757},{"_id":"public/js/search/local-search.js","hash":"4e11d033fb58563f5e1b497f1a6f1c62d3501ee6","modified":1749030102757},{"_id":"public/image/shouye.jpg","hash":"e75ad850c0d85a460832e196ab1940ce99841c8f","modified":1749030102757},{"_id":"public/img/butterfly-icon.png","hash":"f5dd732fed5c3bcd4aa76bac3441bac8485fb432","modified":1749030102757},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/.DS_Store","hash":"f265e4b85368bb93c3a912886e5b4397d2b85f99","modified":1745918838711},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","hash":"f928e205aed451715e66fcdabeda40acc17016a4","modified":1745053627459},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","hash":"ca777da537d0a7d9f37c3ee40b05b5c5004e2b05","modified":1745053849829},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","hash":"731bac951d911ce1d06ab2fffad52071e9e173ec","modified":1745053521350},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","hash":"9ae3c7049609cfddf93e501d51c6f6b2f9c54fe1","modified":1745053653702},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419105704031.png","hash":"ad3c04f5ceef79bac1791e61f283a27491face21","modified":1745031424039},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429172724826.png","hash":"da273dc2bd390a26138020b93e706ca8fbf8b261","modified":1745918844838},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429181131778.png","hash":"0e4282464cd34c9a1222095b0922267be1422f08","modified":1745921491779},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429181312813.png","hash":"aebd7fad268451f30150c11f08cc75190e10f78b","modified":1745921592816},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","hash":"6ee6552a20c710aa26ace986d93c09f17ab35a8d","modified":1745053715414},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","hash":"9881da6dc6387905b676019588e4d61dc9be066f","modified":1745053779852},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419113622811.png","hash":"c5263c854a53d3d911d53bc11404b5867969c0a5","modified":1745033782812},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250425174252871.png","hash":"c33f809927ec425d0ec5a5de446efeb804cc0714","modified":1745574172883},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429181039571.png","hash":"ac3ff91bad60dd8fcf32470de8468bd10c0a1cc3","modified":1745921439575},{"_id":"source/categories/Spring AI Alibaba/Spring AI Agent.md","hash":"d7b384fc0abb9cc26595b28c6a8fdff5513e4b08","modified":1745396492161},{"_id":"source/categories/Spring AI Alibaba/.DS_Store","hash":"ab66dc2c07d915c77eb7ae77d9f6a17171b49e61","modified":1746758325209},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-00-Spring Ai Alibaba.md","hash":"3e8e52832ab059338441700da2ef5edc38a17989","modified":1745056576496},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .md","hash":"4614676542fda9942a414b8c7b7b49991cc26181","modified":1745056587668},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-02-.md","hash":"66a8cc5009fe492b9eefab173931e9138130c6ae","modified":1745923292331},{"_id":"source/categories/Spring AI Alibaba/Untitled.md","hash":"852945edd8f145c8130c9a32a924b6daf4b284bb","modified":1746585186342},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .md","hash":"a935ba41973210a2d25f32608240378e56fccc66","modified":1745923323405},{"_id":"source/categories/Spring AI Alibaba/Spring AI Alibaba-04- Spring AI + + ToolCalling .md","hash":"c30f71ce919f7384e101a058c6deeb1d673d36c8","modified":1746692515849},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","hash":"3f5c8e5d220e8ee80edd693aa28b38db2042606f","modified":1745053412261},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419181745960.png","hash":"202acd3f001b8bc0c1eeae98b758b1651f83021a","modified":1745057865972},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419092017527.png","hash":"651a6f76b900f6d32f5c8dcef8b24803841dc1c2","modified":1745025617528},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","hash":"9a12d9ec34beb4470dd34ee9cdbf24795a8ce8ba","modified":1745053589651},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419102848756.png","hash":"46350b8cc65a3e542d3c721fff82d18b7f42cfc6","modified":1745029728757},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419112758947.png","hash":"472e0caec1f9bedaa1e95acdeb4e0a21b0b74ee0","modified":1745033278949},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114642336.png","hash":"2be0181072e00a32cf7c4ffc3da3fc9b59ee6bae","modified":1745293602337},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429183142516.png","hash":"344896ff25fb43bf4ee4b651041ac1cbceda290c","modified":1745922702519},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419091747915.png","hash":"abbb5a2b42a2feea4f067124327ba7a2e0b49844","modified":1745025467915},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419181631076.png","hash":"30174e45262d9a229860a7cb6c8cc056d56a2f16","modified":1745057791077},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175540574.png","hash":"99de9164e275203a2e77465a3c79b96e1ce6dcd4","modified":1745920540584},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250508161546610.png","hash":"b278e1e74774ebf76673cd87797fd25599530a42","modified":1746692146612},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250425104935964-5549379.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250508161105090.png","hash":"c5baca122ea19651a96d3e2008e7eefb815794fa","modified":1746691865104},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175342611.png","hash":"9ab1b9aaa6241fbe4c8d2e16f82f09bfdba51311","modified":1745920422612},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250425104935964.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250419181524113.png","hash":"f0a282ddcc5dd3b69d8cfa679c4bcd976ad82e5b","modified":1745057724118},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114322913.png","hash":"6a02df96a96bb0544d1d009868bdba0a8fe5850a","modified":1745293402925},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114422258.png","hash":"6d9b7578a561388f37ad2647180a50dcaa735b07","modified":1745293462259},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175228086.png","hash":"698a2ecc2f30b5c94f52121a41290c671451afa9","modified":1745920348093},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429175421998.png","hash":"fe77c6a9999c12a0148bb1990ae045b2bcb63418","modified":1745920462000},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250508162115569.png","hash":"a05a74331a80ea339f895adfcd63f451569a9f23","modified":1746692475571},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250422114555482.png","hash":"e33332a744c886e568bfe33b306d6f57b0e54f49","modified":1745293555482},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429180401580.png","hash":"a9206b3cba0d01688e0feac3ccba76ce81b93408","modified":1745921041592},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429174851066.png","hash":"1e66607d3f47bb278267622dd24df86e4e26237e","modified":1745920131077},{"_id":"source/categories/Spring AI Alibaba/typora-user-images/image-20250429174959408.png","hash":"12c835276e5309ffd874ab41de15a9148b6d65ca","modified":1745920199410},{"_id":"source/categories/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png","hash":"f928e205aed451715e66fcdabeda40acc17016a4","modified":1745053627459},{"_id":"source/categories/typora-user-images/.DS_Store","hash":"f265e4b85368bb93c3a912886e5b4397d2b85f99","modified":1745918838711},{"_id":"source/categories/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg","hash":"ca777da537d0a7d9f37c3ee40b05b5c5004e2b05","modified":1745053849829},{"_id":"source/categories/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg","hash":"731bac951d911ce1d06ab2fffad52071e9e173ec","modified":1745053521350},{"_id":"source/categories/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg","hash":"9ae3c7049609cfddf93e501d51c6f6b2f9c54fe1","modified":1745053653702},{"_id":"source/categories/typora-user-images/image-20250419105704031.png","hash":"ad3c04f5ceef79bac1791e61f283a27491face21","modified":1745031424039},{"_id":"source/categories/typora-user-images/image-20250429172724826.png","hash":"da273dc2bd390a26138020b93e706ca8fbf8b261","modified":1745918844838},{"_id":"source/categories/typora-user-images/image-20250429181131778.png","hash":"0e4282464cd34c9a1222095b0922267be1422f08","modified":1745921491779},{"_id":"source/categories/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg","hash":"6ee6552a20c710aa26ace986d93c09f17ab35a8d","modified":1745053715414},{"_id":"source/categories/typora-user-images/image-20250429181312813.png","hash":"aebd7fad268451f30150c11f08cc75190e10f78b","modified":1745921592816},{"_id":"source/categories/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg","hash":"9881da6dc6387905b676019588e4d61dc9be066f","modified":1745053779852},{"_id":"source/categories/typora-user-images/image-20250419113622811.png","hash":"c5263c854a53d3d911d53bc11404b5867969c0a5","modified":1745033782812},{"_id":"source/categories/typora-user-images/image-20250425174252871.png","hash":"c33f809927ec425d0ec5a5de446efeb804cc0714","modified":1745574172883},{"_id":"source/categories/typora-user-images/image-20250429181039571.png","hash":"ac3ff91bad60dd8fcf32470de8468bd10c0a1cc3","modified":1745921439575},{"_id":"source/categories/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png","hash":"3f5c8e5d220e8ee80edd693aa28b38db2042606f","modified":1745053412261},{"_id":"source/categories/typora-user-images/image-20250419181745960.png","hash":"202acd3f001b8bc0c1eeae98b758b1651f83021a","modified":1745057865972},{"_id":"source/categories/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg","hash":"9a12d9ec34beb4470dd34ee9cdbf24795a8ce8ba","modified":1745053589651},{"_id":"source/categories/typora-user-images/image-20250419092017527.png","hash":"651a6f76b900f6d32f5c8dcef8b24803841dc1c2","modified":1745025617528},{"_id":"source/categories/typora-user-images/image-20250419102848756.png","hash":"46350b8cc65a3e542d3c721fff82d18b7f42cfc6","modified":1745029728757},{"_id":"source/categories/typora-user-images/image-20250419112758947.png","hash":"472e0caec1f9bedaa1e95acdeb4e0a21b0b74ee0","modified":1745033278949},{"_id":"source/categories/typora-user-images/image-20250422114642336.png","hash":"2be0181072e00a32cf7c4ffc3da3fc9b59ee6bae","modified":1745293602337},{"_id":"source/categories/typora-user-images/image-20250429183142516.png","hash":"344896ff25fb43bf4ee4b651041ac1cbceda290c","modified":1745922702519},{"_id":"source/categories/typora-user-images/image-20250419091747915.png","hash":"abbb5a2b42a2feea4f067124327ba7a2e0b49844","modified":1745025467915},{"_id":"source/categories/typora-user-images/image-20250419181631076.png","hash":"30174e45262d9a229860a7cb6c8cc056d56a2f16","modified":1745057791077},{"_id":"source/categories/typora-user-images/image-20250429175540574.png","hash":"99de9164e275203a2e77465a3c79b96e1ce6dcd4","modified":1745920540584},{"_id":"source/categories/typora-user-images/image-20250508161546610.png","hash":"b278e1e74774ebf76673cd87797fd25599530a42","modified":1746692146612},{"_id":"source/categories/typora-user-images/image-20250425104935964.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/categories/typora-user-images/image-20250425104935964-5549379.png","hash":"1dc84b0dce69f0dd8ffdbedeb352ac0884390285","modified":1745549375966},{"_id":"source/categories/typora-user-images/image-20250429175342611.png","hash":"9ab1b9aaa6241fbe4c8d2e16f82f09bfdba51311","modified":1745920422612},{"_id":"source/categories/typora-user-images/image-20250508161105090.png","hash":"c5baca122ea19651a96d3e2008e7eefb815794fa","modified":1746691865104},{"_id":"source/categories/typora-user-images/image-20250422114322913.png","hash":"6a02df96a96bb0544d1d009868bdba0a8fe5850a","modified":1745293402925},{"_id":"source/categories/typora-user-images/image-20250419181524113.png","hash":"f0a282ddcc5dd3b69d8cfa679c4bcd976ad82e5b","modified":1745057724118},{"_id":"source/categories/typora-user-images/image-20250422114422258.png","hash":"6d9b7578a561388f37ad2647180a50dcaa735b07","modified":1745293462259},{"_id":"source/categories/typora-user-images/image-20250429175421998.png","hash":"fe77c6a9999c12a0148bb1990ae045b2bcb63418","modified":1745920462000},{"_id":"source/categories/typora-user-images/image-20250429175228086.png","hash":"698a2ecc2f30b5c94f52121a41290c671451afa9","modified":1745920348093},{"_id":"source/categories/typora-user-images/image-20250508162115569.png","hash":"a05a74331a80ea339f895adfcd63f451569a9f23","modified":1746692475571},{"_id":"source/categories/typora-user-images/image-20250422114555482.png","hash":"e33332a744c886e568bfe33b306d6f57b0e54f49","modified":1745293555482},{"_id":"source/categories/typora-user-images/image-20250429174851066.png","hash":"1e66607d3f47bb278267622dd24df86e4e26237e","modified":1745920131077},{"_id":"source/categories/typora-user-images/image-20250429180401580.png","hash":"a9206b3cba0d01688e0feac3ccba76ce81b93408","modified":1745921041592},{"_id":"source/categories/typora-user-images/image-20250429174959408.png","hash":"12c835276e5309ffd874ab41de15a9148b6d65ca","modified":1745920199410},{"_id":"source/categories/Spring AI Agent.md","hash":"09b37f49cbb6f15990b273d57f1fbf2195591d4f","modified":1749033074977},{"_id":"source/categories/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .md","hash":"4614676542fda9942a414b8c7b7b49991cc26181","modified":1745056587668},{"_id":"source/categories/Spring AI Alibaba-02-.md","hash":"66a8cc5009fe492b9eefab173931e9138130c6ae","modified":1745923292331},{"_id":"source/categories/Spring AI Alibaba-00-Spring Ai Alibaba.md","hash":"3e8e52832ab059338441700da2ef5edc38a17989","modified":1745056576496},{"_id":"source/categories/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .md","hash":"a935ba41973210a2d25f32608240378e56fccc66","modified":1745923323405},{"_id":"source/categories/Spring AI Alibaba-04- Spring AI + + ToolCalling .md","hash":"c30f71ce919f7384e101a058c6deeb1d673d36c8","modified":1746692515849},{"_id":"source/categories/Untitled.md","hash":"852945edd8f145c8130c9a32a924b6daf4b284bb","modified":1746585186342},{"_id":"source/categories/.DS_Store","hash":"35a1c54ece7ada401ae8a4fe999cd92211d26d8e","modified":1749032004230},{"_id":"source/.DS_Store","hash":"22b4a9083f0d9ffeab6b212223c34f2d71637bb2","modified":1749031959005},{"_id":"source/categories/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1749024109000}],"Category":[],"Data":[],"Page":[{"title":"about","date":"2025-06-04T09:41:07.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2025-06-04 17:41:07\n---\n","updated":"2025-06-04T09:41:07.185Z","path":"about/index.html","comments":1,"layout":"page","_id":"cmbhrd5ec0000y2ky26zdfx4j","content":"","excerpt":"","more":""},{"title":"categories","date":"2025-06-04T09:40:43.000Z","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2025-06-04 17:40:43\n---\n","updated":"2025-06-04T10:30:48.611Z","path":"categories/index.html","_id":"cmbhrd5eo0002y2ky58l67fja","comments":1,"layout":"page","content":"","excerpt":"","more":""},{"title":"comments","date":"2025-06-04T09:40:59.000Z","_content":"","source":"comments/index.md","raw":"---\ntitle: comments\ndate: 2025-06-04 17:40:59\n---\n","updated":"2025-06-04T09:40:59.963Z","path":"comments/index.html","comments":1,"layout":"page","_id":"cmbhrd5er0003y2ky8q73ez2h","content":"","excerpt":"","more":""},{"title":"link","date":"2025-06-04T09:41:03.000Z","_content":"","source":"link/index.md","raw":"---\ntitle: link\ndate: 2025-06-04 17:41:03\n---\n","updated":"2025-06-04T09:41:03.718Z","path":"link/index.html","comments":1,"layout":"page","_id":"cmbhrd5et0004y2ky1ru54cv8","content":"","excerpt":"","more":""},{"title":"movies","date":"2025-06-04T09:40:56.000Z","_content":"","source":"movies/index.md","raw":"---\ntitle: movies\ndate: 2025-06-04 17:40:56\n---\n","updated":"2025-06-04T09:40:56.487Z","path":"movies/index.html","comments":1,"layout":"page","_id":"cmbhrd5eu0005y2ky26b53sdm","content":"","excerpt":"","more":""},{"title":"music","date":"2025-06-04T09:40:48.000Z","_content":"","source":"music/index.md","raw":"---\ntitle: music\ndate: 2025-06-04 17:40:48\n---\n","updated":"2025-06-04T09:40:48.081Z","path":"music/index.html","comments":1,"layout":"page","_id":"cmbhrd5ev0006y2ky8s9b93kb","content":"","excerpt":"","more":""},{"title":"picture","date":"2025-06-04T09:40:52.000Z","_content":"","source":"picture/index.md","raw":"---\ntitle: picture\ndate: 2025-06-04 17:40:52\n---\n","updated":"2025-06-04T09:40:52.571Z","path":"picture/index.html","comments":1,"layout":"page","_id":"cmbhrd5ew0007y2kygtkm4721","content":"","excerpt":"","more":""},{"title":"tags","date":"2025-06-04T09:40:35.000Z","_content":"","source":"tags/index-1.md","raw":"---\ntitle: tags\ndate: 2025-06-04 17:40:35\n---\n","updated":"2025-06-04T09:40:35.728Z","path":"tags/index-1.html","comments":1,"layout":"page","_id":"cmbhrd5ey0008y2ky25jaec7q","content":"","excerpt":"","more":""},{"title":"tags","date":"2025-06-04T09:27:08.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2025-06-04 17:27:08\n---\n","updated":"2025-06-04T09:27:08.364Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cmbhrd5f10009y2kydwr7ctxx","content":"","excerpt":"","more":""},{"_content":"https://blog.csdn.net/chen2017sheng/article/details/145779143  AANl  \n\n\n\nhttps://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502 \n\n\n\nhttps://blog.csdn.net/weixin_42289362?type=blog","source":"categories/Spring AI Alibaba/Untitled.md","raw":"https://blog.csdn.net/chen2017sheng/article/details/145779143  AANl  \n\n\n\nhttps://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502 \n\n\n\nhttps://blog.csdn.net/weixin_42289362?type=blog","date":"2025-06-04T10:12:41.823Z","updated":"2025-05-07T02:33:06.342Z","path":"categories/Spring AI Alibaba/Untitled.html","title":"","comments":1,"layout":"page","_id":"cmbhsgz5c0000nffybjst5f7w","content":"<p><a href=\"https://blog.csdn.net/chen2017sheng/article/details/145779143\">https://blog.csdn.net/chen2017sheng/article/details/145779143</a>  AANl  </p>\n<p><a href=\"https://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502\">https://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502</a> </p>\n<p><a href=\"https://blog.csdn.net/weixin_42289362?type=blog\">https://blog.csdn.net/weixin_42289362?type=blog</a></p>\n","excerpt":"","more":"<p><a href=\"https://blog.csdn.net/chen2017sheng/article/details/145779143\">https://blog.csdn.net/chen2017sheng/article/details/145779143</a>  AANl  </p>\n<p><a href=\"https://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502\">https://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502</a> </p>\n<p><a href=\"https://blog.csdn.net/weixin_42289362?type=blog\">https://blog.csdn.net/weixin_42289362?type=blog</a></p>\n"},{"_content":"# Spring AI Agent \n\n\n\n\nAIAI  Agent Spring AI  Agent\n\nSpring AI \nSpring AI \nSpring AI  Spring Spring AI  Java  AI  AI Spring AI \n\n\nSpring AI Spring AI \n\n Spring  Spring \n\nAgent \nAgent \nAgent  Spring AI Agent \n\n\nAgent  Agent \n\n\n\n AI \n AI Agent Agent  Spring AI Agent  AI  AI \n\nSpring AI  Agent\n\n Spring AI Agent  Agent \n\n\nAgent  AI Agent \n\n\n Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent \n\nSpring AI Agent \n1.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n2.  Agent\nAgent \n\nAgent \nAgent \nAgent \n3.  Agent\nAgent \n\nAgent \nAgent \nAgent \n4.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n5.  Agent\nAgent \n\nAgent \nAgent \nAgent \n6.  Agent\nAgent \n\nAgent Agent \nAgent \nAgent \n7.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n8.  Agent\nAgent \n\nAgent \nAgent Agent \nAgent \nSpring AI Agent \nSpring AI  Agent Agent \n\nAgent \nAgent \nAgent \n Agent Agent \n\nSpring AI  Agent  Spring AI  Agent  Spring AI  Agent\n\n Spring AI  Agent  Agent  Agent  Agent \n\n\n\n# RAG  \n\nRAG\n1.1 RAG\nRAGRetrieval-Augmented GenerationRAG (LLM)\n\n1.2 RAG\nRAG2020RAGRAG\n\n1.3 RAG\nRAGRAG\n\nRAG\n2.1 \n2.1.1 \nRAGRAG\n\n2.1.2 \nRAGRAGRAG\n\n2.2 \n2.2.1 \nRAGRAG\n\n2.2.2 \nRAGRAG\n\n2.3 \n2.3.1 \nRAG\n\n2.3.2 \nRAGRAG\n\nRAG\n4.1 RAG\n4.1.1 \nRAGRAG\n\n4.1.2 \nRAGRAG\n\n4.1.3 \nRAGRAG\n\n4.2 RAG\n4.2.1 \nRAG\n\nRAG\n\n4.2.2 \nRAG\n\nRAG\n\n\nRAGRAG\n","source":"categories/Spring AI Alibaba/Spring AI Agent.md","raw":"# Spring AI Agent \n\n\n\n\nAIAI  Agent Spring AI  Agent\n\nSpring AI \nSpring AI \nSpring AI  Spring Spring AI  Java  AI  AI Spring AI \n\n\nSpring AI Spring AI \n\n Spring  Spring \n\nAgent \nAgent \nAgent  Spring AI Agent \n\n\nAgent  Agent \n\n\n\n AI \n AI Agent Agent  Spring AI Agent  AI  AI \n\nSpring AI  Agent\n\n Spring AI Agent  Agent \n\n\nAgent  AI Agent \n\n\n Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent \n\nSpring AI Agent \n1.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n2.  Agent\nAgent \n\nAgent \nAgent \nAgent \n3.  Agent\nAgent \n\nAgent \nAgent \nAgent \n4.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n5.  Agent\nAgent \n\nAgent \nAgent \nAgent \n6.  Agent\nAgent \n\nAgent Agent \nAgent \nAgent \n7.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n8.  Agent\nAgent \n\nAgent \nAgent Agent \nAgent \nSpring AI Agent \nSpring AI  Agent Agent \n\nAgent \nAgent \nAgent \n Agent Agent \n\nSpring AI  Agent  Spring AI  Agent  Spring AI  Agent\n\n Spring AI  Agent  Agent  Agent  Agent \n\n\n\n# RAG  \n\nRAG\n1.1 RAG\nRAGRetrieval-Augmented GenerationRAG (LLM)\n\n1.2 RAG\nRAG2020RAGRAG\n\n1.3 RAG\nRAGRAG\n\nRAG\n2.1 \n2.1.1 \nRAGRAG\n\n2.1.2 \nRAGRAGRAG\n\n2.2 \n2.2.1 \nRAGRAG\n\n2.2.2 \nRAGRAG\n\n2.3 \n2.3.1 \nRAG\n\n2.3.2 \nRAGRAG\n\nRAG\n4.1 RAG\n4.1.1 \nRAGRAG\n\n4.1.2 \nRAGRAG\n\n4.1.3 \nRAGRAG\n\n4.2 RAG\n4.2.1 \nRAG\n\nRAG\n\n4.2.2 \nRAG\n\nRAG\n\n\nRAGRAG\n","date":"2025-06-04T10:12:41.825Z","updated":"2025-04-23T08:21:32.161Z","path":"categories/Spring AI Alibaba/Spring AI Agent.html","title":"","comments":1,"layout":"page","_id":"cmbhsgz5e0001nffyg7cd3q2w","content":"<h1 id=\"Spring-AI-Agent-\"><a href=\"#Spring-AI-Agent-\" class=\"headerlink\" title=\"Spring AI Agent \"></a>Spring AI Agent </h1><p><br>AIAI  Agent Spring AI  Agent</p>\n<p>Spring AI <br>Spring AI <br>Spring AI  Spring Spring AI  Java  AI  AI Spring AI </p>\n<p><br>Spring AI Spring AI </p>\n<p> Spring  Spring </p>\n<p>Agent <br>Agent <br>Agent  Spring AI Agent </p>\n<p><br>Agent  Agent </p>\n<p></p>\n<p> AI <br> AI Agent Agent  Spring AI Agent  AI  AI </p>\n<p>Spring AI  Agent<br><br> Spring AI Agent  Agent </p>\n<p><br>Agent  AI Agent </p>\n<p><br> Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent </p>\n<p>Spring AI Agent </p>\n<ol>\n<li> Agent<br>Agent </li>\n</ol>\n<p>Agent <br>Agent <br>Agent Agent <br>2.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>3.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>4.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>5.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>6.  Agent<br>Agent </p>\n<p>Agent Agent <br>Agent <br>Agent <br>7.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>8.  Agent<br>Agent </p>\n<p>Agent <br>Agent Agent <br>Agent <br>Spring AI Agent <br>Spring AI  Agent Agent </p>\n<p>Agent <br>Agent <br>Agent <br> Agent Agent <br><br>Spring AI  Agent  Spring AI  Agent  Spring AI  Agent</p>\n<p> Spring AI  Agent  Agent  Agent  Agent </p>\n<h1 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h1><p>RAG<br>1.1 RAG<br>RAGRetrieval-Augmented GenerationRAG (LLM)</p>\n<p>1.2 RAG<br>RAG2020RAGRAG</p>\n<p>1.3 RAG<br>RAGRAG</p>\n<p>RAG<br>2.1 <br>2.1.1 <br>RAGRAG</p>\n<p>2.1.2 <br>RAGRAGRAG</p>\n<p>2.2 <br>2.2.1 <br>RAGRAG</p>\n<p>2.2.2 <br>RAGRAG</p>\n<p>2.3 <br>2.3.1 <br>RAG</p>\n<p>2.3.2 <br>RAGRAG</p>\n<p>RAG<br>4.1 RAG<br>4.1.1 <br>RAGRAG</p>\n<p>4.1.2 <br>RAGRAG</p>\n<p>4.1.3 <br>RAGRAG</p>\n<p>4.2 RAG<br>4.2.1 <br>RAG</p>\n<p>RAG</p>\n<p>4.2.2 <br>RAG</p>\n<p>RAG</p>\n<p><br>RAGRAG</p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Agent-\"><a href=\"#Spring-AI-Agent-\" class=\"headerlink\" title=\"Spring AI Agent \"></a>Spring AI Agent </h1><p><br>AIAI  Agent Spring AI  Agent</p>\n<p>Spring AI <br>Spring AI <br>Spring AI  Spring Spring AI  Java  AI  AI Spring AI </p>\n<p><br>Spring AI Spring AI </p>\n<p> Spring  Spring </p>\n<p>Agent <br>Agent <br>Agent  Spring AI Agent </p>\n<p><br>Agent  Agent </p>\n<p></p>\n<p> AI <br> AI Agent Agent  Spring AI Agent  AI  AI </p>\n<p>Spring AI  Agent<br><br> Spring AI Agent  Agent </p>\n<p><br>Agent  AI Agent </p>\n<p><br> Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent </p>\n<p>Spring AI Agent </p>\n<ol>\n<li> Agent<br>Agent </li>\n</ol>\n<p>Agent <br>Agent <br>Agent Agent <br>2.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>3.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>4.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>5.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>6.  Agent<br>Agent </p>\n<p>Agent Agent <br>Agent <br>Agent <br>7.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>8.  Agent<br>Agent </p>\n<p>Agent <br>Agent Agent <br>Agent <br>Spring AI Agent <br>Spring AI  Agent Agent </p>\n<p>Agent <br>Agent <br>Agent <br> Agent Agent <br><br>Spring AI  Agent  Spring AI  Agent  Spring AI  Agent</p>\n<p> Spring AI  Agent  Agent  Agent  Agent </p>\n<h1 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h1><p>RAG<br>1.1 RAG<br>RAGRetrieval-Augmented GenerationRAG (LLM)</p>\n<p>1.2 RAG<br>RAG2020RAGRAG</p>\n<p>1.3 RAG<br>RAGRAG</p>\n<p>RAG<br>2.1 <br>2.1.1 <br>RAGRAG</p>\n<p>2.1.2 <br>RAGRAGRAG</p>\n<p>2.2 <br>2.2.1 <br>RAGRAG</p>\n<p>2.2.2 <br>RAGRAG</p>\n<p>2.3 <br>2.3.1 <br>RAG</p>\n<p>2.3.2 <br>RAGRAG</p>\n<p>RAG<br>4.1 RAG<br>4.1.1 <br>RAGRAG</p>\n<p>4.1.2 <br>RAGRAG</p>\n<p>4.1.3 <br>RAGRAG</p>\n<p>4.2 RAG<br>4.2.1 <br>RAG</p>\n<p>RAG</p>\n<p>4.2.2 <br>RAG</p>\n<p>RAG</p>\n<p><br>RAGRAG</p>\n"},{"_content":"# Spring AI Alibaba-00-Spring Ai Alibaba\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.12`\n\n\n\n[toc]\n\n\n\n## \n\n[Spring AI](https://docs.spring.io/spring-ai/reference/index.html)  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models\n\n\n\n\n\n##  Spring AI Alibaba\n\n\n\nSpring AI Alibaba  Spring AI  Java AI  AI API  AI \n\n![img](typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png)\n\nSpring AI Alibaba  AI  API API \n\n-  AI  Fluent API  ChatClient\n- \n- \n-  API API \n-  Structured Output AI  POJOs\n- \n-  Function Calling\n-  AI Agent \n-  RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve \n\n AI     \n\n\n\n## \n\n### Model\n\nAI \n\nAI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion\n\n\n\n![spring-ai-concepts-model-types](typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg)\n\nSpring AI Embedding Text AI Spring AI  Embedding \n\nGPT  GPT PChat Generative Pre-trained Transformer AI \n\n\n\n### Prompt\n\nPrompt  AI  ChatGPT Prompt  API AI Prompt \n\nChatGPT  API \n\n Prompt ChatGPT  SQL AI \n\nPrompt  Prompt  Prompt \n\n Prompt  Prompt  ChatGPT 3.5\n\n### Prompt Template\n\n Prompt  Prompt Spring AI  StringTemplate \n\n Prompt \n\n>Tell me a {adjective} joke about {content}.\n\n Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt \n\n Prompt Prompt \n\n\n\n### Embedding\n\nEmbeddingEmbedding VectorEmbedding \n\n\n\n![spring-ai-embeddings](typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg)\n\n Java \n\nEmbedding RAG\n\n\n\n### Token\n\ntoken  AI  token token \n\n token  75% 90  120  token\n\n![spring-ai-concepts-tokens](typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png)\n\n\n\n token =  AI  token  token \n\n token  API \n\nChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token \n\n GPT4 Spring AI \n\n### Structured Output\n\n JSON AI  `java.lang.String`  JSON JSON  Prompt   JSON  100% \n\n Prompt \n\n![](typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg)\n\n\n\n[]\n\n\n\n###  API  AI \n\n\n\nGPT 3.5/4.0  2021  9  650GB\n\n AI \n\n- `Fine Tuning`  GPT \n- `Prompt Stuffing` Spring AI  [ (RAG)]()\n\n![prompt-stuffing](typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg)\n\n- Function Calling APISpring AI  [] \n\n\n\n\n\n### RAG\n\n (RAG)  AI \n\n ETL RAG \n\n\n\n1. \n2.  AI  token \n\nRAG  AI  AI \n\n![Spring AI RAG](typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg)\n\n\n\n\n\n- [ETL ](https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html)  AI \n- [ChatClient - RAG] `QuestionAnswerAdvisor` Advisor  RAG \n\n### Function Calling\n\n (LLM) \n\n[Function Calling](https://docs.spring.io/spring-ai/reference/api/functions.html) API LLM \n\nSpring AI `@Bean` bean \n\n![Spring AI Function Calling](typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg)\n\n- 1`name``description``input parameters`\n- 2\n- 3Spring AI \n- 4\n- 5\n\n[](https://docs.spring.io/spring-ai/reference/api/functions.html) AI \n\n### Evaluation\n\n\n\nEvaluation  AI \n\n\n\nVector Database","source":"categories/Spring AI Alibaba/Spring AI Alibaba-00-Spring Ai Alibaba.md","raw":"# Spring AI Alibaba-00-Spring Ai Alibaba\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.12`\n\n\n\n[toc]\n\n\n\n## \n\n[Spring AI](https://docs.spring.io/spring-ai/reference/index.html)  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models\n\n\n\n\n\n##  Spring AI Alibaba\n\n\n\nSpring AI Alibaba  Spring AI  Java AI  AI API  AI \n\n![img](typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png)\n\nSpring AI Alibaba  AI  API API \n\n-  AI  Fluent API  ChatClient\n- \n- \n-  API API \n-  Structured Output AI  POJOs\n- \n-  Function Calling\n-  AI Agent \n-  RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve \n\n AI     \n\n\n\n## \n\n### Model\n\nAI \n\nAI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion\n\n\n\n![spring-ai-concepts-model-types](typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg)\n\nSpring AI Embedding Text AI Spring AI  Embedding \n\nGPT  GPT PChat Generative Pre-trained Transformer AI \n\n\n\n### Prompt\n\nPrompt  AI  ChatGPT Prompt  API AI Prompt \n\nChatGPT  API \n\n Prompt ChatGPT  SQL AI \n\nPrompt  Prompt  Prompt \n\n Prompt  Prompt  ChatGPT 3.5\n\n### Prompt Template\n\n Prompt  Prompt Spring AI  StringTemplate \n\n Prompt \n\n>Tell me a {adjective} joke about {content}.\n\n Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt \n\n Prompt Prompt \n\n\n\n### Embedding\n\nEmbeddingEmbedding VectorEmbedding \n\n\n\n![spring-ai-embeddings](typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg)\n\n Java \n\nEmbedding RAG\n\n\n\n### Token\n\ntoken  AI  token token \n\n token  75% 90  120  token\n\n![spring-ai-concepts-tokens](typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png)\n\n\n\n token =  AI  token  token \n\n token  API \n\nChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token \n\n GPT4 Spring AI \n\n### Structured Output\n\n JSON AI  `java.lang.String`  JSON JSON  Prompt   JSON  100% \n\n Prompt \n\n![](typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg)\n\n\n\n[]\n\n\n\n###  API  AI \n\n\n\nGPT 3.5/4.0  2021  9  650GB\n\n AI \n\n- `Fine Tuning`  GPT \n- `Prompt Stuffing` Spring AI  [ (RAG)]()\n\n![prompt-stuffing](typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg)\n\n- Function Calling APISpring AI  [] \n\n\n\n\n\n### RAG\n\n (RAG)  AI \n\n ETL RAG \n\n\n\n1. \n2.  AI  token \n\nRAG  AI  AI \n\n![Spring AI RAG](typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg)\n\n\n\n\n\n- [ETL ](https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html)  AI \n- [ChatClient - RAG] `QuestionAnswerAdvisor` Advisor  RAG \n\n### Function Calling\n\n (LLM) \n\n[Function Calling](https://docs.spring.io/spring-ai/reference/api/functions.html) API LLM \n\nSpring AI `@Bean` bean \n\n![Spring AI Function Calling](typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg)\n\n- 1`name``description``input parameters`\n- 2\n- 3Spring AI \n- 4\n- 5\n\n[](https://docs.spring.io/spring-ai/reference/api/functions.html) AI \n\n### Evaluation\n\n\n\nEvaluation  AI \n\n\n\nVector Database","date":"2025-06-04T10:12:41.872Z","updated":"2025-04-19T09:56:16.496Z","path":"categories/Spring AI Alibaba/Spring AI Alibaba-00-Spring Ai Alibaba.html","title":"","comments":1,"layout":"page","_id":"cmbhsgz5n0002nffy895m3gu0","content":"<h1 id=\"Spring-AI-Alibaba-00-Spring-Ai-Alibaba\"><a href=\"#Spring-AI-Alibaba-00-Spring-Ai-Alibaba\" class=\"headerlink\" title=\"Spring AI Alibaba-00-Spring Ai Alibaba\"></a>Spring AI Alibaba-00-Spring Ai Alibaba</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.12</code></p>\n<p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://docs.spring.io/spring-ai/reference/index.html\">Spring AI</a>  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models</p>\n<h2 id=\"-Spring-AI-Alibaba\"><a href=\"#-Spring-AI-Alibaba\" class=\"headerlink\" title=\" Spring AI Alibaba\"></a> Spring AI Alibaba</h2><p>Spring AI Alibaba  Spring AI  Java AI  AI API  AI </p>\n<p><img src=\"/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png\" alt=\"img\"></p>\n<p>Spring AI Alibaba  AI  API API </p>\n<ul>\n<li> AI  Fluent API  ChatClient</li>\n<li></li>\n<li></li>\n<li> API API </li>\n<li> Structured Output AI  POJOs</li>\n<li></li>\n<li> Function Calling</li>\n<li> AI Agent </li>\n<li> RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve </li>\n</ul>\n<p> AI     </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h3><p>AI </p>\n<p>AI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion</p>\n<p><img src=\"/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg\" alt=\"spring-ai-concepts-model-types\"></p>\n<p>Spring AI Embedding Text AI Spring AI  Embedding </p>\n<p>GPT  GPT PChat Generative Pre-trained Transformer AI </p>\n<h3 id=\"Prompt\"><a href=\"#Prompt\" class=\"headerlink\" title=\"Prompt\"></a>Prompt</h3><p>Prompt  AI  ChatGPT Prompt  API AI Prompt </p>\n<p>ChatGPT  API </p>\n<p> Prompt ChatGPT  SQL AI </p>\n<p>Prompt  Prompt  Prompt </p>\n<p> Prompt  Prompt  ChatGPT 3.5</p>\n<h3 id=\"Prompt-Template\"><a href=\"#Prompt-Template\" class=\"headerlink\" title=\"Prompt Template\"></a>Prompt Template</h3><p> Prompt  Prompt Spring AI  StringTemplate </p>\n<p> Prompt </p>\n<blockquote>\n<p>Tell me a {adjective} joke about {content}.</p>\n</blockquote>\n<p> Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt </p>\n<p> Prompt Prompt </p>\n<h3 id=\"Embedding\"><a href=\"#Embedding\" class=\"headerlink\" title=\"Embedding\"></a>Embedding</h3><p>EmbeddingEmbedding VectorEmbedding </p>\n<p></p>\n<p><img src=\"/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg\" alt=\"spring-ai-embeddings\"></p>\n<p> Java </p>\n<p>Embedding RAG</p>\n<p></p>\n<h3 id=\"Token\"><a href=\"#Token\" class=\"headerlink\" title=\"Token\"></a>Token</h3><p>token  AI  token token </p>\n<p> token  75% 90  120  token</p>\n<p><img src=\"/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png\" alt=\"spring-ai-concepts-tokens\"></p>\n<p> token &#x3D;  AI  token  token </p>\n<p> token  API </p>\n<p>ChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token </p>\n<p> GPT4 Spring AI </p>\n<h3 id=\"Structured-Output\"><a href=\"#Structured-Output\" class=\"headerlink\" title=\"Structured Output\"></a>Structured Output</h3><p> JSON AI  <code>java.lang.String</code>  JSON JSON  Prompt   JSON  100% </p>\n<p> Prompt </p>\n<p><img src=\"/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg\" alt=\"\"></p>\n<p>[]</p>\n<h3 id=\"-API--AI-\"><a href=\"#-API--AI-\" class=\"headerlink\" title=\" API  AI \"></a> API  AI </h3><p></p>\n<p>GPT 3.5&#x2F;4.0  2021  9  650GB</p>\n<p> AI </p>\n<ul>\n<li><code>Fine Tuning</code>  GPT </li>\n<li><code>Prompt Stuffing</code> Spring AI  <a href=\"\"> (RAG)</a></li>\n</ul>\n<p><img src=\"/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg\" alt=\"prompt-stuffing\"></p>\n<ul>\n<li>Function Calling APISpring AI  [] </li>\n</ul>\n<h3 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h3><p> (RAG)  AI </p>\n<p> ETL RAG </p>\n<p></p>\n<ol>\n<li></li>\n<li> AI  token </li>\n</ol>\n<p>RAG  AI  AI </p>\n<p><img src=\"/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg\" alt=\"Spring AI RAG\"></p>\n<ul>\n<li><a href=\"https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html\">ETL </a>  AI </li>\n<li>[ChatClient - RAG] <code>QuestionAnswerAdvisor</code> Advisor  RAG </li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a>Function Calling</h3><p> (LLM) </p>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\">Function Calling</a> API LLM </p>\n<p>Spring AI <code>@Bean</code> bean </p>\n<p><img src=\"/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg\" alt=\"Spring AI Function Calling\"></p>\n<ul>\n<li>1<code>name</code><code>description</code><code>input parameters</code></li>\n<li>2</li>\n<li>3Spring AI </li>\n<li>4</li>\n<li>5</li>\n</ul>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\"></a> AI </p>\n<h3 id=\"Evaluation\"><a href=\"#Evaluation\" class=\"headerlink\" title=\"Evaluation\"></a>Evaluation</h3><p></p>\n<p>Evaluation  AI </p>\n<p></p>\n<p>Vector Database</p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-00-Spring-Ai-Alibaba\"><a href=\"#Spring-AI-Alibaba-00-Spring-Ai-Alibaba\" class=\"headerlink\" title=\"Spring AI Alibaba-00-Spring Ai Alibaba\"></a>Spring AI Alibaba-00-Spring Ai Alibaba</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.12</code></p>\n<p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://docs.spring.io/spring-ai/reference/index.html\">Spring AI</a>  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models</p>\n<h2 id=\"-Spring-AI-Alibaba\"><a href=\"#-Spring-AI-Alibaba\" class=\"headerlink\" title=\" Spring AI Alibaba\"></a> Spring AI Alibaba</h2><p>Spring AI Alibaba  Spring AI  Java AI  AI API  AI </p>\n<p><img src=\"/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png\" alt=\"img\"></p>\n<p>Spring AI Alibaba  AI  API API </p>\n<ul>\n<li> AI  Fluent API  ChatClient</li>\n<li></li>\n<li></li>\n<li> API API </li>\n<li> Structured Output AI  POJOs</li>\n<li></li>\n<li> Function Calling</li>\n<li> AI Agent </li>\n<li> RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve </li>\n</ul>\n<p> AI     </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h3><p>AI </p>\n<p>AI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion</p>\n<p><img src=\"/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg\" alt=\"spring-ai-concepts-model-types\"></p>\n<p>Spring AI Embedding Text AI Spring AI  Embedding </p>\n<p>GPT  GPT PChat Generative Pre-trained Transformer AI </p>\n<h3 id=\"Prompt\"><a href=\"#Prompt\" class=\"headerlink\" title=\"Prompt\"></a>Prompt</h3><p>Prompt  AI  ChatGPT Prompt  API AI Prompt </p>\n<p>ChatGPT  API </p>\n<p> Prompt ChatGPT  SQL AI </p>\n<p>Prompt  Prompt  Prompt </p>\n<p> Prompt  Prompt  ChatGPT 3.5</p>\n<h3 id=\"Prompt-Template\"><a href=\"#Prompt-Template\" class=\"headerlink\" title=\"Prompt Template\"></a>Prompt Template</h3><p> Prompt  Prompt Spring AI  StringTemplate </p>\n<p> Prompt </p>\n<blockquote>\n<p>Tell me a {adjective} joke about {content}.</p>\n</blockquote>\n<p> Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt </p>\n<p> Prompt Prompt </p>\n<h3 id=\"Embedding\"><a href=\"#Embedding\" class=\"headerlink\" title=\"Embedding\"></a>Embedding</h3><p>EmbeddingEmbedding VectorEmbedding </p>\n<p></p>\n<p><img src=\"/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg\" alt=\"spring-ai-embeddings\"></p>\n<p> Java </p>\n<p>Embedding RAG</p>\n<p></p>\n<h3 id=\"Token\"><a href=\"#Token\" class=\"headerlink\" title=\"Token\"></a>Token</h3><p>token  AI  token token </p>\n<p> token  75% 90  120  token</p>\n<p><img src=\"/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png\" alt=\"spring-ai-concepts-tokens\"></p>\n<p> token &#x3D;  AI  token  token </p>\n<p> token  API </p>\n<p>ChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token </p>\n<p> GPT4 Spring AI </p>\n<h3 id=\"Structured-Output\"><a href=\"#Structured-Output\" class=\"headerlink\" title=\"Structured Output\"></a>Structured Output</h3><p> JSON AI  <code>java.lang.String</code>  JSON JSON  Prompt   JSON  100% </p>\n<p> Prompt </p>\n<p><img src=\"/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg\" alt=\"\"></p>\n<p>[]</p>\n<h3 id=\"-API--AI-\"><a href=\"#-API--AI-\" class=\"headerlink\" title=\" API  AI \"></a> API  AI </h3><p></p>\n<p>GPT 3.5&#x2F;4.0  2021  9  650GB</p>\n<p> AI </p>\n<ul>\n<li><code>Fine Tuning</code>  GPT </li>\n<li><code>Prompt Stuffing</code> Spring AI  <a href=\"\"> (RAG)</a></li>\n</ul>\n<p><img src=\"/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg\" alt=\"prompt-stuffing\"></p>\n<ul>\n<li>Function Calling APISpring AI  [] </li>\n</ul>\n<h3 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h3><p> (RAG)  AI </p>\n<p> ETL RAG </p>\n<p></p>\n<ol>\n<li></li>\n<li> AI  token </li>\n</ol>\n<p>RAG  AI  AI </p>\n<p><img src=\"/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg\" alt=\"Spring AI RAG\"></p>\n<ul>\n<li><a href=\"https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html\">ETL </a>  AI </li>\n<li>[ChatClient - RAG] <code>QuestionAnswerAdvisor</code> Advisor  RAG </li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a>Function Calling</h3><p> (LLM) </p>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\">Function Calling</a> API LLM </p>\n<p>Spring AI <code>@Bean</code> bean </p>\n<p><img src=\"/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg\" alt=\"Spring AI Function Calling\"></p>\n<ul>\n<li>1<code>name</code><code>description</code><code>input parameters</code></li>\n<li>2</li>\n<li>3Spring AI </li>\n<li>4</li>\n<li>5</li>\n</ul>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\"></a> AI </p>\n<h3 id=\"Evaluation\"><a href=\"#Evaluation\" class=\"headerlink\" title=\"Evaluation\"></a>Evaluation</h3><p></p>\n<p>Evaluation  AI </p>\n<p></p>\n<p>Vector Database</p>\n"},{"_content":"# Spring AI Alibaba-01-SpringBootSpringAI Alibaba \n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\nSpring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI \n\n## \n\n:IntelliJ IDEA\n\nJDK17+, idea\n\nhttps://bailian.console.aliyun.com/\n\n\n\n## \n\n### IDEA demo\n\n\n\n![image-20250419091747915](typora-user-images/image-20250419091747915.png)\n\nweblambokjava17springboot3.4\n\n![image-20250419092017527](typora-user-images/image-20250419092017527.png)\n\n\n\n\n\n###  Pom\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.4</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>1.0.0-M3.1</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n~~~\n\n### **ChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatController {\n\n\n    private final ChatClient chatClient;\n\n    public ChatController(ChatClient.Builder chatClientBuilder) {\n        this.chatClient = chatClientBuilder\n                //  Chat Memory  Advisor\n                //  Chat Memory  ID Spring AI \n                .defaultAdvisors(\n                        new MessageChatMemoryAdvisor(new InMemoryChatMemory())\n                )\n                //  Logger  Advisor\n                .defaultAdvisors(\n                        new SimpleLoggerAdvisor()\n                )\n                //  ChatClient  ChatModel  Options \n                .defaultOptions(\n                        DashScopeChatOptions.builder()\n                                .withTopP(0.7)\n                                .build()\n                )\n                .build();\n    }\n\n    @GetMapping(\"/simple/chat\")\n    public String simpleChat(String query) {\n        log.info(\"query: {}\",query );\n        String text =  chatClient.prompt(query).call().content();\n        log.info(\"text: {}\",text );\n        return text;\n    }\n\n    @GetMapping(\"/chat\")\n    public String chat(String message) {\n\n        return this.chatClient.prompt()\n                .user(message)\n                .call()\n                .content();\n    }\n\n\n    @GetMapping(\"/hello\")\n    public String hello(String message) {\n\n        return \"Hello \" + message;\n    }\n\n}\n\n~~~\n\nspring-ai chat memory`chatClient`\n\n~~~java\nprivate ChatMemory chatMemory = new InMemoryChatMemory();                                            \n\npublic ChatController(ChatClient.Builder builder) {\n                                                   \n    this.chatClient = builder                                                                        \n            .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory, UUID.randomUUID().toString(), 10))\n            .build();                                                                                \n}\n\n~~~\n\nUUID ChatMemory\n\ntokentoken\n\n\n\n\n\n1. Spring AI Alibaba  Spring Boot 3.x JDK  17 \n2. spring-ai  Maven \n\n~~~xml\n<repositories>\n  <repository>\n    <id>spring-milestones</id>\n    <name>Spring Milestones</name>\n    <url>https://repo.spring.io/milestone</url>\n    <snapshots>\n      <enabled>false</enabled>\n    </snapshots>\n  </repository>\n</repositories>\n\n~~~\n\n\n\napplication.yml\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n~~~\n\n\n\n\n\n### \n\n\n\n\n\n~~~html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <script src=\"js/marked.min.js\"></script>\n    <title></title>\n    <style>\n        body {\n\n            background-color: #f8f9fa;\n            font-family: Arial, sans-serif;\n        }\n\n        .container {\n\n            margin: 50px auto;\n            width: 800px;\n            background-color: #fff;\n            padding: 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n        }\n\n        h1 {\n\n            text-align: center;\n            margin-bottom: 30px;\n        }\n\n        label {\n\n            display: block;\n            margin-bottom: 10px;\n            color: #333;\n        }\n\n        input[type=\"text\"] {\n\n            width: 85%;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n        }\n\n        input[type=\"submit\"] {\n\n            background-color: #2ecc71;\n            color: #fff;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 3px;\n            cursor: pointer;\n            width: 10%;\n        }\n\n        .chat-box {\n\n            width: 100%;\n            height: 500px;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            overflow-y: scroll;\n        }\n\n        .message {\n\n            margin-bottom: 10px;\n            padding: 10px;\n            background-color: #f1f1f1;\n            border-radius: 3px;\n        }\n\n        .user-message {\n\n            background-color: #2ecc71;\n            color: #fff;\n        }\n\n        .bot-message {\n\n            background-color: #e6aa6b;\n            color: #fff;\n        }\n\n        .loader {\n\n            text-align: center;\n        }\n\n        .loader::after {\n\n            content: \"\";\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            border: 2px solid #ccc;\n            border-top-color: #2ecc71;\n            animation: spin 1s infinite linear;\n        }\n\n        @keyframes spin {\n\n            to {\n\n                transform: rotate(360deg);\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"container\">\n    <h1>AI </h1>\n    <form id=\"form\" style=\"width: 47%;position: absolute;bottom: 150px;margin-left:15px\">\n        <input type=\"text\" id=\"message\" name=\"message\" placeholder=\"\">\n        <input type=\"submit\" value=\"\">\n    </form>\n    <br>\n    <div id=\"loader\" class=\"loader\" style=\"display: none;\"></div>\n    <div id=\"chat-box\" class=\"chat-box\"></div>\n</div>\n\n<script>\n    var loader = document.getElementById(\"loader\");\n\n    document.getElementById(\"form\").addEventListener(\"submit\", function(event) {\n\n        event.preventDefault();\n\n        var messageInput = document.getElementById(\"message\");\n        var message = messageInput.value;\n        messageInput.value = \"\";\n\n        var chatBox = document.getElementById(\"chat-box\");\n\n        var userMessage = document.createElement(\"div\");\n        userMessage.className = \"message\";\n        userMessage.textContent = \": \" + message;\n        chatBox.appendChild(userMessage);\n        chatBox.scrollTop = chatBox.scrollHeight;\n\n        loader.style.display = \"block\";\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", \"http://localhost:8080/ai/v1/chat?message=\" + encodeURIComponent(message), true);\n        xhr.onreadystatechange = function() {\n\n            if (xhr.readyState === 4) {\n\n                loader.style.display = \"none\";\n\n                if (xhr.status === 200) {\n\n                    var response = xhr.responseText;\n\n                    var botMessage = document.createElement(\"div\");\n                    botMessage.className = \"message bot-message\";\n\n                    var botMessageText = document.createElement(\"span\");\n                    botMessageText.className = \"message-text\";\n                    botMessage.appendChild(botMessageText);\n                    botMessageText.innerHTML = marked.marked(response);\n\n                    chatBox.appendChild(botMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else if (xhr.status === 400) {\n\n                    var error = JSON.parse(xhr.responseText);\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: \" + error.message;\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else {\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: Failed to connect to the backend service. Please make sure the backend service is running.\";\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                }\n            }\n        };\n\n        xhr.onloadstart = function() {\n\n            loader.style.display = \"block\";\n        };\n\n        xhr.onloadend = function() {\n\n            loader.style.display = \"none\";\n        };\n\n        xhr.send();\n    });\n</script>\n</body>\n</html>\n\n~~~\n\njs  `marked.min.js`\n\n [GitHub](https://github.com/cundream/marked) \n\n### APi\n\n[](https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1)\n\n\n\n![image-20250419102848756](typora-user-images/image-20250419102848756.png)\n\n\n\nKey\n\n![image-20250419105704031](typora-user-images/image-20250419105704031.png)\n\n\n\n## \n\nhttp://localhost:8080/chat.html\n\n\n\n\n\n![image-20250419113622811](typora-user-images/image-20250419113622811.png)\n\n\n\nhttp://localhost:8080/ai/v1/simple/chat?query=\n\n![image-20250419112758947](typora-user-images/image-20250419112758947.png)\n\n\n\n## \n\n\n\nSpringBootJavaer Spring AI AI\n\n- AI AI AI\n- Prompt\n- Tokentoken AI tokentokenAItoken\n-  (RAG)\n\ntoken\n\n\n\n\n\n# \n\nSpring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI ","source":"categories/Spring AI Alibaba/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .md","raw":"# Spring AI Alibaba-01-SpringBootSpringAI Alibaba \n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\nSpring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI \n\n## \n\n:IntelliJ IDEA\n\nJDK17+, idea\n\nhttps://bailian.console.aliyun.com/\n\n\n\n## \n\n### IDEA demo\n\n\n\n![image-20250419091747915](typora-user-images/image-20250419091747915.png)\n\nweblambokjava17springboot3.4\n\n![image-20250419092017527](typora-user-images/image-20250419092017527.png)\n\n\n\n\n\n###  Pom\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.4</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>1.0.0-M3.1</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n~~~\n\n### **ChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatController {\n\n\n    private final ChatClient chatClient;\n\n    public ChatController(ChatClient.Builder chatClientBuilder) {\n        this.chatClient = chatClientBuilder\n                //  Chat Memory  Advisor\n                //  Chat Memory  ID Spring AI \n                .defaultAdvisors(\n                        new MessageChatMemoryAdvisor(new InMemoryChatMemory())\n                )\n                //  Logger  Advisor\n                .defaultAdvisors(\n                        new SimpleLoggerAdvisor()\n                )\n                //  ChatClient  ChatModel  Options \n                .defaultOptions(\n                        DashScopeChatOptions.builder()\n                                .withTopP(0.7)\n                                .build()\n                )\n                .build();\n    }\n\n    @GetMapping(\"/simple/chat\")\n    public String simpleChat(String query) {\n        log.info(\"query: {}\",query );\n        String text =  chatClient.prompt(query).call().content();\n        log.info(\"text: {}\",text );\n        return text;\n    }\n\n    @GetMapping(\"/chat\")\n    public String chat(String message) {\n\n        return this.chatClient.prompt()\n                .user(message)\n                .call()\n                .content();\n    }\n\n\n    @GetMapping(\"/hello\")\n    public String hello(String message) {\n\n        return \"Hello \" + message;\n    }\n\n}\n\n~~~\n\nspring-ai chat memory`chatClient`\n\n~~~java\nprivate ChatMemory chatMemory = new InMemoryChatMemory();                                            \n\npublic ChatController(ChatClient.Builder builder) {\n                                                   \n    this.chatClient = builder                                                                        \n            .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory, UUID.randomUUID().toString(), 10))\n            .build();                                                                                \n}\n\n~~~\n\nUUID ChatMemory\n\ntokentoken\n\n\n\n\n\n1. Spring AI Alibaba  Spring Boot 3.x JDK  17 \n2. spring-ai  Maven \n\n~~~xml\n<repositories>\n  <repository>\n    <id>spring-milestones</id>\n    <name>Spring Milestones</name>\n    <url>https://repo.spring.io/milestone</url>\n    <snapshots>\n      <enabled>false</enabled>\n    </snapshots>\n  </repository>\n</repositories>\n\n~~~\n\n\n\napplication.yml\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n~~~\n\n\n\n\n\n### \n\n\n\n\n\n~~~html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <script src=\"js/marked.min.js\"></script>\n    <title></title>\n    <style>\n        body {\n\n            background-color: #f8f9fa;\n            font-family: Arial, sans-serif;\n        }\n\n        .container {\n\n            margin: 50px auto;\n            width: 800px;\n            background-color: #fff;\n            padding: 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n        }\n\n        h1 {\n\n            text-align: center;\n            margin-bottom: 30px;\n        }\n\n        label {\n\n            display: block;\n            margin-bottom: 10px;\n            color: #333;\n        }\n\n        input[type=\"text\"] {\n\n            width: 85%;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n        }\n\n        input[type=\"submit\"] {\n\n            background-color: #2ecc71;\n            color: #fff;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 3px;\n            cursor: pointer;\n            width: 10%;\n        }\n\n        .chat-box {\n\n            width: 100%;\n            height: 500px;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            overflow-y: scroll;\n        }\n\n        .message {\n\n            margin-bottom: 10px;\n            padding: 10px;\n            background-color: #f1f1f1;\n            border-radius: 3px;\n        }\n\n        .user-message {\n\n            background-color: #2ecc71;\n            color: #fff;\n        }\n\n        .bot-message {\n\n            background-color: #e6aa6b;\n            color: #fff;\n        }\n\n        .loader {\n\n            text-align: center;\n        }\n\n        .loader::after {\n\n            content: \"\";\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            border: 2px solid #ccc;\n            border-top-color: #2ecc71;\n            animation: spin 1s infinite linear;\n        }\n\n        @keyframes spin {\n\n            to {\n\n                transform: rotate(360deg);\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"container\">\n    <h1>AI </h1>\n    <form id=\"form\" style=\"width: 47%;position: absolute;bottom: 150px;margin-left:15px\">\n        <input type=\"text\" id=\"message\" name=\"message\" placeholder=\"\">\n        <input type=\"submit\" value=\"\">\n    </form>\n    <br>\n    <div id=\"loader\" class=\"loader\" style=\"display: none;\"></div>\n    <div id=\"chat-box\" class=\"chat-box\"></div>\n</div>\n\n<script>\n    var loader = document.getElementById(\"loader\");\n\n    document.getElementById(\"form\").addEventListener(\"submit\", function(event) {\n\n        event.preventDefault();\n\n        var messageInput = document.getElementById(\"message\");\n        var message = messageInput.value;\n        messageInput.value = \"\";\n\n        var chatBox = document.getElementById(\"chat-box\");\n\n        var userMessage = document.createElement(\"div\");\n        userMessage.className = \"message\";\n        userMessage.textContent = \": \" + message;\n        chatBox.appendChild(userMessage);\n        chatBox.scrollTop = chatBox.scrollHeight;\n\n        loader.style.display = \"block\";\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", \"http://localhost:8080/ai/v1/chat?message=\" + encodeURIComponent(message), true);\n        xhr.onreadystatechange = function() {\n\n            if (xhr.readyState === 4) {\n\n                loader.style.display = \"none\";\n\n                if (xhr.status === 200) {\n\n                    var response = xhr.responseText;\n\n                    var botMessage = document.createElement(\"div\");\n                    botMessage.className = \"message bot-message\";\n\n                    var botMessageText = document.createElement(\"span\");\n                    botMessageText.className = \"message-text\";\n                    botMessage.appendChild(botMessageText);\n                    botMessageText.innerHTML = marked.marked(response);\n\n                    chatBox.appendChild(botMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else if (xhr.status === 400) {\n\n                    var error = JSON.parse(xhr.responseText);\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: \" + error.message;\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else {\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: Failed to connect to the backend service. Please make sure the backend service is running.\";\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                }\n            }\n        };\n\n        xhr.onloadstart = function() {\n\n            loader.style.display = \"block\";\n        };\n\n        xhr.onloadend = function() {\n\n            loader.style.display = \"none\";\n        };\n\n        xhr.send();\n    });\n</script>\n</body>\n</html>\n\n~~~\n\njs  `marked.min.js`\n\n [GitHub](https://github.com/cundream/marked) \n\n### APi\n\n[](https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1)\n\n\n\n![image-20250419102848756](typora-user-images/image-20250419102848756.png)\n\n\n\nKey\n\n![image-20250419105704031](typora-user-images/image-20250419105704031.png)\n\n\n\n## \n\nhttp://localhost:8080/chat.html\n\n\n\n\n\n![image-20250419113622811](typora-user-images/image-20250419113622811.png)\n\n\n\nhttp://localhost:8080/ai/v1/simple/chat?query=\n\n![image-20250419112758947](typora-user-images/image-20250419112758947.png)\n\n\n\n## \n\n\n\nSpringBootJavaer Spring AI AI\n\n- AI AI AI\n- Prompt\n- Tokentoken AI tokentokenAItoken\n-  (RAG)\n\ntoken\n\n\n\n\n\n# \n\nSpring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI ","date":"2025-06-04T10:12:41.873Z","updated":"2025-04-19T09:56:27.668Z","path":"categories/Spring AI Alibaba/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .html","title":"","comments":1,"layout":"page","_id":"cmbhsgz5n0003nffy5ujm1w44","content":"<h1 id=\"Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\"><a href=\"#Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\" class=\"headerlink\" title=\"Spring AI Alibaba-01-SpringBootSpringAI Alibaba \"></a>Spring AI Alibaba-01-SpringBootSpringAI Alibaba </h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p>Spring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:IntelliJ IDEA</p>\n<p>JDK17+, idea</p>\n<p><a href=\"https://bailian.console.aliyun.com/\">https://bailian.console.aliyun.com/</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"IDEA-demo\"><a href=\"#IDEA-demo\" class=\"headerlink\" title=\"IDEA demo\"></a>IDEA demo</h3><p><img src=\"/typora-user-images/image-20250419091747915.png\" alt=\"image-20250419091747915\"></p>\n<p>weblambokjava17springboot3.4</p>\n<p><img src=\"/typora-user-images/image-20250419092017527.png\" alt=\"image-20250419092017527\"></p>\n<h3 id=\"Pom\"><a href=\"#Pom\" class=\"headerlink\" title=\"Pom\"></a>Pom</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-M3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ChatController-java\"><a href=\"#ChatController-java\" class=\"headerlink\" title=\"ChatController.java\"></a><strong>ChatController.java</strong></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder chatClientBuilder)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = chatClientBuilder</span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  Advisor</span></span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  ID Spring AI </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>())</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  Logger  Advisor</span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleLoggerAdvisor</span>()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  ChatClient  ChatModel  Options </span></span><br><span class=\"line\">                .defaultOptions(</span><br><span class=\"line\">                        DashScopeChatOptions.builder()</span><br><span class=\"line\">                                .withTopP(<span class=\"number\">0.7</span>)</span><br><span class=\"line\">                                .build()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/simple/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">simpleChat</span><span class=\"params\">(String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query: &#123;&#125;&quot;</span>,query );</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span>  chatClient.prompt(query).call().content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text: &#123;&#125;&quot;</span>,text );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.chatClient.prompt()</span><br><span class=\"line\">                .user(message)</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">hello</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello &quot;</span> + message;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>spring-ai chat memory<code>chatClient</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">ChatMemory</span> <span class=\"variable\">chatMemory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();                                            </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder builder)</span> &#123;</span><br><span class=\"line\">                                                   </span><br><span class=\"line\">    <span class=\"built_in\">this</span>.chatClient = builder                                                                        </span><br><span class=\"line\">            .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, UUID.randomUUID().toString(), <span class=\"number\">10</span>))</span><br><span class=\"line\">            .build();                                                                                </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>UUID ChatMemory</p>\n<p>tokentoken</p>\n<p></p>\n<ol>\n<li>Spring AI Alibaba  Spring Boot 3.x JDK  17 </li>\n<li>spring-ai  Maven </li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/marked.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">body</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f8f9fa</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">font-family</span>: Arial, sans-serif;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.container</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">800px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">2px</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.1</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">h1</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">label</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;text&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">85%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;submit&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">cursor</span>: pointer;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">10%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.chat-box</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">500px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow-y</span>: scroll;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f1f1f1</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.user-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.bot-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#e6aa6b</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span><span class=\"selector-pseudo\">::after</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">content</span>: <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-top-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">animation</span>: spin <span class=\"number\">1s</span> infinite linear;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"keyword\">@keyframes</span> spin &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"selector-tag\">to</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">                <span class=\"attribute\">transform</span>: <span class=\"built_in\">rotate</span>(<span class=\"number\">360deg</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>AI <span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;form&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 47%;position: absolute;bottom: 150px;margin-left:15px&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: none;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;chat-box&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-box&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">var</span> loader = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;loader&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;form&quot;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;submit&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        event.<span class=\"title function_\">preventDefault</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> messageInput = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;message&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> message = messageInput.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        messageInput.<span class=\"property\">value</span> = <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> chatBox = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;chat-box&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> userMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;: &quot;</span> + message;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"title function_\">appendChild</span>(userMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;GET&quot;</span>, <span class=\"string\">&quot;http://localhost:8080/ai/v1/chat?message=&quot;</span> + <span class=\"built_in\">encodeURIComponent</span>(message), <span class=\"literal\">true</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> === <span class=\"number\">4</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">200</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> response = xhr.<span class=\"property\">responseText</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessageText = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;span&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">className</span> = <span class=\"string\">&quot;message-text&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"title function_\">appendChild</span>(botMessageText);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">innerHTML</span> = marked.<span class=\"title function_\">marked</span>(response);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(botMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">400</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> error = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(xhr.<span class=\"property\">responseText</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: &quot;</span> + error.<span class=\"property\">message</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: Failed to connect to the backend service. Please make sure the backend service is running.&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadstart</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadend</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">send</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>js  <code>marked.min.js</code></p>\n<p> <a href=\"https://github.com/cundream/marked\">GitHub</a> </p>\n<h3 id=\"APi\"><a href=\"#APi\" class=\"headerlink\" title=\"APi\"></a>APi</h3><p><a href=\"https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1\"></a></p>\n<p><img src=\"/typora-user-images/image-20250419102848756.png\" alt=\"image-20250419102848756\"></p>\n<p>Key</p>\n<p><img src=\"/typora-user-images/image-20250419105704031.png\" alt=\"image-20250419105704031\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"http://localhost:8080/chat.html\">http://localhost:8080/chat.html</a></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250419113622811.png\" alt=\"image-20250419113622811\"></p>\n<p></p>\n<p><a href=\"http://localhost:8080/ai/v1/simple/chat?query=%E4%BD%A0%E6%98%AF%E8%B0%81\">http://localhost:8080/ai/v1/simple/chat?query=</a></p>\n<p><img src=\"/typora-user-images/image-20250419112758947.png\" alt=\"image-20250419112758947\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>SpringBootJavaer Spring AI AI</p>\n<ul>\n<li>AI AI AI</li>\n<li>Prompt</li>\n<li>Tokentoken AI tokentokenAItoken</li>\n<li> (RAG)</li>\n</ul>\n<p>token</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>Spring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI </p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\"><a href=\"#Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\" class=\"headerlink\" title=\"Spring AI Alibaba-01-SpringBootSpringAI Alibaba \"></a>Spring AI Alibaba-01-SpringBootSpringAI Alibaba </h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p>Spring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:IntelliJ IDEA</p>\n<p>JDK17+, idea</p>\n<p><a href=\"https://bailian.console.aliyun.com/\">https://bailian.console.aliyun.com/</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"IDEA-demo\"><a href=\"#IDEA-demo\" class=\"headerlink\" title=\"IDEA demo\"></a>IDEA demo</h3><p><img src=\"/typora-user-images/image-20250419091747915.png\" alt=\"image-20250419091747915\"></p>\n<p>weblambokjava17springboot3.4</p>\n<p><img src=\"/typora-user-images/image-20250419092017527.png\" alt=\"image-20250419092017527\"></p>\n<h3 id=\"Pom\"><a href=\"#Pom\" class=\"headerlink\" title=\"Pom\"></a>Pom</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-M3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ChatController-java\"><a href=\"#ChatController-java\" class=\"headerlink\" title=\"ChatController.java\"></a><strong>ChatController.java</strong></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder chatClientBuilder)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = chatClientBuilder</span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  Advisor</span></span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  ID Spring AI </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>())</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  Logger  Advisor</span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleLoggerAdvisor</span>()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  ChatClient  ChatModel  Options </span></span><br><span class=\"line\">                .defaultOptions(</span><br><span class=\"line\">                        DashScopeChatOptions.builder()</span><br><span class=\"line\">                                .withTopP(<span class=\"number\">0.7</span>)</span><br><span class=\"line\">                                .build()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/simple/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">simpleChat</span><span class=\"params\">(String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query: &#123;&#125;&quot;</span>,query );</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span>  chatClient.prompt(query).call().content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text: &#123;&#125;&quot;</span>,text );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.chatClient.prompt()</span><br><span class=\"line\">                .user(message)</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">hello</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello &quot;</span> + message;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>spring-ai chat memory<code>chatClient</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">ChatMemory</span> <span class=\"variable\">chatMemory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();                                            </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder builder)</span> &#123;</span><br><span class=\"line\">                                                   </span><br><span class=\"line\">    <span class=\"built_in\">this</span>.chatClient = builder                                                                        </span><br><span class=\"line\">            .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, UUID.randomUUID().toString(), <span class=\"number\">10</span>))</span><br><span class=\"line\">            .build();                                                                                </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>UUID ChatMemory</p>\n<p>tokentoken</p>\n<p></p>\n<ol>\n<li>Spring AI Alibaba  Spring Boot 3.x JDK  17 </li>\n<li>spring-ai  Maven </li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/marked.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">body</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f8f9fa</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">font-family</span>: Arial, sans-serif;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.container</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">800px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">2px</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.1</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">h1</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">label</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;text&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">85%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;submit&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">cursor</span>: pointer;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">10%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.chat-box</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">500px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow-y</span>: scroll;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f1f1f1</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.user-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.bot-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#e6aa6b</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span><span class=\"selector-pseudo\">::after</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">content</span>: <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-top-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">animation</span>: spin <span class=\"number\">1s</span> infinite linear;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"keyword\">@keyframes</span> spin &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"selector-tag\">to</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">                <span class=\"attribute\">transform</span>: <span class=\"built_in\">rotate</span>(<span class=\"number\">360deg</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>AI <span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;form&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 47%;position: absolute;bottom: 150px;margin-left:15px&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: none;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;chat-box&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-box&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">var</span> loader = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;loader&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;form&quot;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;submit&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        event.<span class=\"title function_\">preventDefault</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> messageInput = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;message&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> message = messageInput.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        messageInput.<span class=\"property\">value</span> = <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> chatBox = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;chat-box&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> userMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;: &quot;</span> + message;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"title function_\">appendChild</span>(userMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;GET&quot;</span>, <span class=\"string\">&quot;http://localhost:8080/ai/v1/chat?message=&quot;</span> + <span class=\"built_in\">encodeURIComponent</span>(message), <span class=\"literal\">true</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> === <span class=\"number\">4</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">200</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> response = xhr.<span class=\"property\">responseText</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessageText = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;span&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">className</span> = <span class=\"string\">&quot;message-text&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"title function_\">appendChild</span>(botMessageText);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">innerHTML</span> = marked.<span class=\"title function_\">marked</span>(response);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(botMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">400</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> error = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(xhr.<span class=\"property\">responseText</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: &quot;</span> + error.<span class=\"property\">message</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: Failed to connect to the backend service. Please make sure the backend service is running.&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadstart</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadend</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">send</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>js  <code>marked.min.js</code></p>\n<p> <a href=\"https://github.com/cundream/marked\">GitHub</a> </p>\n<h3 id=\"APi\"><a href=\"#APi\" class=\"headerlink\" title=\"APi\"></a>APi</h3><p><a href=\"https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1\"></a></p>\n<p><img src=\"/typora-user-images/image-20250419102848756.png\" alt=\"image-20250419102848756\"></p>\n<p>Key</p>\n<p><img src=\"/typora-user-images/image-20250419105704031.png\" alt=\"image-20250419105704031\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"http://localhost:8080/chat.html\">http://localhost:8080/chat.html</a></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250419113622811.png\" alt=\"image-20250419113622811\"></p>\n<p></p>\n<p><a href=\"http://localhost:8080/ai/v1/simple/chat?query=%E4%BD%A0%E6%98%AF%E8%B0%81\">http://localhost:8080/ai/v1/simple/chat?query=</a></p>\n<p><img src=\"/typora-user-images/image-20250419112758947.png\" alt=\"image-20250419112758947\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>SpringBootJavaer Spring AI AI</p>\n<ul>\n<li>AI AI AI</li>\n<li>Prompt</li>\n<li>Tokentoken AI tokentokenAItoken</li>\n<li> (RAG)</li>\n</ul>\n<p>token</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>Spring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI </p>\n"},{"_content":"# Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \n\n[toc]\n\n\n\n## \n\n\n\n### **Tool Calling **\n\n HTTP \n\n\n Spring AI  Tool Calling  OA \n\n\n\n### \n\nSpring AI  Tool Calling \n\n1. ****\n2. ****\n\n\n\n\n\n\n\n-  API\n-  OA \n-  RAG \n- \n-  vs  Tool Calling \n\n\n\n## \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** API [](https://www.weatherapi.com/)\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n Spring  Redis  ChatClient \n\n**Tool calling **\n\n1. ****\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"\")\npublic class HospitalService {\n\n    @Tool(description = \"\")\n    String registeInHos (@ToolParam(description = \"\", required = true) String docName,\n                         @ToolParam(description = \"\", required = true) String time ,\n                         @ToolParam(description = \"\", required = false) String desc,\n                         @ToolParam(description = \"ID\") String userId) {\n\n\n        String rtn1 = \"\"+docName+\"\"+time+\"\"+desc+\"\";\n        String rtn2 = \"\"+docName+\"\";\n\n\n\n\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n\n}\n\n\n~~~\n\n2. OA\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.lang3.StringUtils;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"OA\")\npublic class OaService {\n\n    private static int LEFT_DAYS = 5;\n    @Tool(description = \"\")\n    public String getCurrentDateTime() {\n        return \" \"+LEFT_DAYS+\" \";\n    }\n\n    @Tool(description = \"id(userId), (days)\")\n    String askForLeave(@ToolParam(description = \"\") String userId ,@ToolParam(description = \"\") String days) {\n        if(!StringUtils.isNumeric(days)){\n            throw new IllegalArgumentException(\"days\");\n        }\n        int dayInt = Integer.parseInt(days);\n        String rtn1 = \"\"+userId+\",\"+days+\"\";\n        String rtn2 = \"\";\n        return dayInt>=LEFT_DAYS?rtn2:rtn1;\n    }\n}\n\n\n\n~~~\n\n\n\n3. \n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\nimport java.util.Set;\n\n@Slf4j\n@Description(\"\")\npublic class RestaurantService {\n\n    private static int LEFT_DAYS = 5;\n    private static Set<String> RESTAURANT_NAME = Set.of( \"\", \"\", \"\", \"\", \"\");\n\n    @Tool(description = \"\")\n    public String queryRestaurantName(@ToolParam(description = \"\", required = true) String location) {\n        //  RESTAURANT_NAME \n        String rtn = RESTAURANT_NAME.stream().skip((int) (Math.random() * RESTAURANT_NAME.size())).limit(3).reduce((a, b) -> a + \"\" + b).get();\n        return \"\" + location + \" restaurantName\" + rtn;\n    }\n\n    @Tool(description = \"\")\n    String bookRestaurant (@ToolParam(description = \"\", required = true) String restName,\n                           @ToolParam(description = \"\", required = true) String time ,\n                           @ToolParam(description = \"\", required = true) String userNumber) {\n        String rtn1 = \"\"+restName+\"\"+time+\"\"+userNumber+\"\";\n        String rtn2 = \"\"+restName+\"\";\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n}\n\n~~~\n\n\n\n **ToolCallController.java**\n\n~~~\n  @GetMapping(value = \"/rag/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChat(@RequestParam String userId, @RequestParam String message) {\n        log.info(\"userId -> [{}], message --> [{}]\", userId, message);\n        String text = chatClient.prompt()\n                .user(message)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))\n                .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))\n                .call().content();\n        return text;\n    }\n~~~\n\n\n\n\n\n\n\n## \n\n1\n\n~~~\nhttp://localhost:8080/ai/v1/rag/simpleChat?message=\n~~~\n\n\n\n![image-20250508161105090](typora-user-images/image-20250508161105090.png)\n\n****\n\n- \n- \n\n\n\n2\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=\n~~~\n\n\n\n![image-20250508161546610](typora-user-images/image-20250508161546610.png)\n\n\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=2\n~~~\n\n\n\n![image-20250508162115569](typora-user-images/image-20250508162115569.png)\n\n\n\n****\n\n-  OA \n- \n\n","source":"categories/Spring AI Alibaba/Spring AI Alibaba-04- Spring AI + + ToolCalling .md","raw":"# Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \n\n[toc]\n\n\n\n## \n\n\n\n### **Tool Calling **\n\n HTTP \n\n\n Spring AI  Tool Calling  OA \n\n\n\n### \n\nSpring AI  Tool Calling \n\n1. ****\n2. ****\n\n\n\n\n\n\n\n-  API\n-  OA \n-  RAG \n- \n-  vs  Tool Calling \n\n\n\n## \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** API [](https://www.weatherapi.com/)\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n Spring  Redis  ChatClient \n\n**Tool calling **\n\n1. ****\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"\")\npublic class HospitalService {\n\n    @Tool(description = \"\")\n    String registeInHos (@ToolParam(description = \"\", required = true) String docName,\n                         @ToolParam(description = \"\", required = true) String time ,\n                         @ToolParam(description = \"\", required = false) String desc,\n                         @ToolParam(description = \"ID\") String userId) {\n\n\n        String rtn1 = \"\"+docName+\"\"+time+\"\"+desc+\"\";\n        String rtn2 = \"\"+docName+\"\";\n\n\n\n\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n\n}\n\n\n~~~\n\n2. OA\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.lang3.StringUtils;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"OA\")\npublic class OaService {\n\n    private static int LEFT_DAYS = 5;\n    @Tool(description = \"\")\n    public String getCurrentDateTime() {\n        return \" \"+LEFT_DAYS+\" \";\n    }\n\n    @Tool(description = \"id(userId), (days)\")\n    String askForLeave(@ToolParam(description = \"\") String userId ,@ToolParam(description = \"\") String days) {\n        if(!StringUtils.isNumeric(days)){\n            throw new IllegalArgumentException(\"days\");\n        }\n        int dayInt = Integer.parseInt(days);\n        String rtn1 = \"\"+userId+\",\"+days+\"\";\n        String rtn2 = \"\";\n        return dayInt>=LEFT_DAYS?rtn2:rtn1;\n    }\n}\n\n\n\n~~~\n\n\n\n3. \n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\nimport java.util.Set;\n\n@Slf4j\n@Description(\"\")\npublic class RestaurantService {\n\n    private static int LEFT_DAYS = 5;\n    private static Set<String> RESTAURANT_NAME = Set.of( \"\", \"\", \"\", \"\", \"\");\n\n    @Tool(description = \"\")\n    public String queryRestaurantName(@ToolParam(description = \"\", required = true) String location) {\n        //  RESTAURANT_NAME \n        String rtn = RESTAURANT_NAME.stream().skip((int) (Math.random() * RESTAURANT_NAME.size())).limit(3).reduce((a, b) -> a + \"\" + b).get();\n        return \"\" + location + \" restaurantName\" + rtn;\n    }\n\n    @Tool(description = \"\")\n    String bookRestaurant (@ToolParam(description = \"\", required = true) String restName,\n                           @ToolParam(description = \"\", required = true) String time ,\n                           @ToolParam(description = \"\", required = true) String userNumber) {\n        String rtn1 = \"\"+restName+\"\"+time+\"\"+userNumber+\"\";\n        String rtn2 = \"\"+restName+\"\";\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n}\n\n~~~\n\n\n\n **ToolCallController.java**\n\n~~~\n  @GetMapping(value = \"/rag/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChat(@RequestParam String userId, @RequestParam String message) {\n        log.info(\"userId -> [{}], message --> [{}]\", userId, message);\n        String text = chatClient.prompt()\n                .user(message)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))\n                .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))\n                .call().content();\n        return text;\n    }\n~~~\n\n\n\n\n\n\n\n## \n\n1\n\n~~~\nhttp://localhost:8080/ai/v1/rag/simpleChat?message=\n~~~\n\n\n\n![image-20250508161105090](typora-user-images/image-20250508161105090.png)\n\n****\n\n- \n- \n\n\n\n2\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=\n~~~\n\n\n\n![image-20250508161546610](typora-user-images/image-20250508161546610.png)\n\n\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=2\n~~~\n\n\n\n![image-20250508162115569](typora-user-images/image-20250508162115569.png)\n\n\n\n****\n\n-  OA \n- \n\n","date":"2025-06-04T10:12:41.877Z","updated":"2025-05-08T08:21:55.849Z","path":"categories/Spring AI Alibaba/Spring AI Alibaba-04- Spring AI + + ToolCalling .html","title":"","comments":1,"layout":"page","_id":"cmbhsgz5o0004nffydpyegff4","content":"<h1 id=\"Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\"><a href=\"#Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\" class=\"headerlink\" title=\"Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \"></a>Spring AI Alibaba-04- Spring AI + RAG + ToolCalling </h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Tool-Calling-\"><a href=\"#Tool-Calling-\" class=\"headerlink\" title=\"Tool Calling \"></a><strong>Tool Calling </strong></h3><p> HTTP <br><br><br> Spring AI  Tool Calling  OA </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Spring AI  Tool Calling </p>\n<ol>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ol>\n<p></p>\n<ul>\n<li> API</li>\n<li> OA </li>\n<li> RAG </li>\n<li></li>\n<li> vs  Tool Calling </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> API <a href=\"https://www.weatherapi.com/\"></a></li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p> Spring  Redis  ChatClient </p>\n<p><strong>Tool calling </strong></p>\n<ol>\n<li><strong></strong></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HospitalService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">registeInHos</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String docName,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = false)</span> String desc,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;ID&quot;)</span> String userId)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+desc+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>OA</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;OA&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OaService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getCurrentDateTime</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot; &quot;</span>+LEFT_DAYS+<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;id(userId), (days)&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">askForLeave</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String userId ,<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String days)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!StringUtils.isNumeric(days))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;days&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">dayInt</span> <span class=\"operator\">=</span> Integer.parseInt(days);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+userId+<span class=\"string\">&quot;,&quot;</span>+days+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dayInt&gt;=LEFT_DAYS?rtn2:rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RestaurantService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Set&lt;String&gt; RESTAURANT_NAME = Set.of( <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">queryRestaurantName</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String location)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  RESTAURANT_NAME </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn</span> <span class=\"operator\">=</span> RESTAURANT_NAME.stream().skip((<span class=\"type\">int</span>) (Math.random() * RESTAURANT_NAME.size())).limit(<span class=\"number\">3</span>).reduce((a, b) -&gt; a + <span class=\"string\">&quot;&quot;</span> + b).get();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span> + location + <span class=\"string\">&quot; restaurantName&quot;</span> + rtn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">bookRestaurant</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String restName,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String userNumber)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+userNumber+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> <strong>ToolCallController.java</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GetMapping(value = &quot;/rag/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span><br><span class=\"line\">  public String ragChat(@RequestParam String userId, @RequestParam String message) &#123;</span><br><span class=\"line\">      log.info(&quot;userId -&gt; [&#123;&#125;], message --&gt; [&#123;&#125;]&quot;, userId, message);</span><br><span class=\"line\">      String text = chatClient.prompt()</span><br><span class=\"line\">              .user(message)</span><br><span class=\"line\">              .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))</span><br><span class=\"line\">              .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))</span><br><span class=\"line\">              .call().content();</span><br><span class=\"line\">      return text;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/simpleChat?message=</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/typora-user-images/image-20250508161105090.png\" alt=\"image-20250508161105090\"></p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20250508161546610.png\" alt=\"image-20250508161546610\"></p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=2</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20250508162115569.png\" alt=\"image-20250508162115569\"></p>\n<p><strong></strong></p>\n<ul>\n<li> OA </li>\n<li></li>\n</ul>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\"><a href=\"#Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\" class=\"headerlink\" title=\"Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \"></a>Spring AI Alibaba-04- Spring AI + RAG + ToolCalling </h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Tool-Calling-\"><a href=\"#Tool-Calling-\" class=\"headerlink\" title=\"Tool Calling \"></a><strong>Tool Calling </strong></h3><p> HTTP <br><br><br> Spring AI  Tool Calling  OA </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Spring AI  Tool Calling </p>\n<ol>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ol>\n<p></p>\n<ul>\n<li> API</li>\n<li> OA </li>\n<li> RAG </li>\n<li></li>\n<li> vs  Tool Calling </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> API <a href=\"https://www.weatherapi.com/\"></a></li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p> Spring  Redis  ChatClient </p>\n<p><strong>Tool calling </strong></p>\n<ol>\n<li><strong></strong></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HospitalService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">registeInHos</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String docName,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = false)</span> String desc,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;ID&quot;)</span> String userId)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+desc+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>OA</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;OA&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OaService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getCurrentDateTime</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot; &quot;</span>+LEFT_DAYS+<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;id(userId), (days)&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">askForLeave</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String userId ,<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String days)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!StringUtils.isNumeric(days))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;days&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">dayInt</span> <span class=\"operator\">=</span> Integer.parseInt(days);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+userId+<span class=\"string\">&quot;,&quot;</span>+days+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dayInt&gt;=LEFT_DAYS?rtn2:rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RestaurantService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Set&lt;String&gt; RESTAURANT_NAME = Set.of( <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">queryRestaurantName</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String location)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  RESTAURANT_NAME </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn</span> <span class=\"operator\">=</span> RESTAURANT_NAME.stream().skip((<span class=\"type\">int</span>) (Math.random() * RESTAURANT_NAME.size())).limit(<span class=\"number\">3</span>).reduce((a, b) -&gt; a + <span class=\"string\">&quot;&quot;</span> + b).get();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span> + location + <span class=\"string\">&quot; restaurantName&quot;</span> + rtn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">bookRestaurant</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String restName,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String userNumber)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+userNumber+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> <strong>ToolCallController.java</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GetMapping(value = &quot;/rag/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span><br><span class=\"line\">  public String ragChat(@RequestParam String userId, @RequestParam String message) &#123;</span><br><span class=\"line\">      log.info(&quot;userId -&gt; [&#123;&#125;], message --&gt; [&#123;&#125;]&quot;, userId, message);</span><br><span class=\"line\">      String text = chatClient.prompt()</span><br><span class=\"line\">              .user(message)</span><br><span class=\"line\">              .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))</span><br><span class=\"line\">              .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))</span><br><span class=\"line\">              .call().content();</span><br><span class=\"line\">      return text;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/simpleChat?message=</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/typora-user-images/image-20250508161105090.png\" alt=\"image-20250508161105090\"></p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20250508161546610.png\" alt=\"image-20250508161546610\"></p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=2</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20250508162115569.png\" alt=\"image-20250508162115569\"></p>\n<p><strong></strong></p>\n<ul>\n<li> OA </li>\n<li></li>\n</ul>\n"},{"_content":"# Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES/Milvus + RAG \n\n\n\n[]AIAPI**Spring AI**Spring[AI]AI\n\n[toc]\n\n\n\n\n\n## Spring AI  Function CallingTool Calling  Agent \n\n### Spring AI \n\n#### Spring AI\n\nSpring AI\n\n* 20245301.0.0 Milestone 1API\n* 20248231.0.0 Milestone 2\n* 20241081.0.0 Milestone 3AI\n* 202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon\n* 20252141.0.0 Milestone 6\n\n\n\n#### Spring AI\n\nSpring AIAI\n\n* LLM\n* AI\n* \n* \n* \n\n### **Function Calling**\n\n#### \n\nAIAPIAI\n\n#### \n\nSpring AI\n\n**1**`Function`Java\n\n~~~java\n@Component\npublic class WeatherFunction implements Function<WeatherFunction.WeatherRequest, String> {\n    @Override\n    public String apply(WeatherRequest request) {\n        return \"The weather in \" + request.getCity() + \" is sunny.\";\n    }\n    public static class WeatherRequest {\n        private String city;\n        public String getCity() { return city; }\n        public void setCity(String city) { this.city = city; }\n    }\n}\n\n~~~\n\n**2**Spring BeanSpring AI\n\n~~~java\n@Configuration\npublic class FunctionConfig {\n    @Bean\n    @Description(\"\")\n    public Function<WeatherFunction.WeatherRequest, String> weatherFunction() {\n        return new WeatherFunction();\n    }\n}\n~~~\n\n**3**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withFunction(\"weatherFunction\").build())\n                .build();\n    }\n}\n~~~\n\n**4**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        WeatherFunction.WeatherRequest request = new WeatherFunction.WeatherRequest();\n        request.setCity(input);\n        String response = chatClient.prompt().user(input).functions(\"weatherFunction\").call().content();\n        return response;\n    }\n}\n~~~\n\n****Spring AI****Tool Calling\n\n### **Tool Calling**\n\n#### ****\n\nAI\n\n#### \n\n\n\n**1**\n\n~~~java\npublic interface WeatherTool {\n    String getWeather(String city);\n}\n~~~\n\n**2**\n\n~~~java\n@Component\npublic class WeatherToolImpl implements WeatherTool {\n    @Override\n    public String getWeather(String city) {\n        return \"The weather in \" + city + \" is sunny.\";\n    }\n}\n~~~\n\n**3Spring Bean**Spring BeanSpring\n\n~~~java\n@Configuration\npublic class ToolConfig {\n    @Bean\n    public WeatherTool weatherTool() {\n        return new WeatherToolImpl();\n    }\n}\n~~~\n\n**4**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withTool(\"weatherTool\").build())\n                .build();\n    }\n}\n\n~~~\n\n**5**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        String response = chatClient.prompt().user(input).tools(\"weatherTool\").call().content();\n        return response;\n    }\n}\n\n~~~\n\n### Agent\n\n#### \n\nAgent\n\n#### \n\n\n\nMCPLLMMCP\n\nSpring AIAI\nSpring AI\n\n### FunctionCallbacToolCallback\n\nSpring AIFunction CallbackDeprecatedTool CallbackAI\n\n**FunctionCallbackToolCallback**\n\nSpring AIFunctionCallbackToolCallback\n\n* ToolCallbackFunctionCallback\n* ToolCallback\n* FunctionCallbackSpring AIToolCallback\n\n\n\nSpring AIFunctionCallbackToolCallback\n\n\n\n## Spring AI + DeepSeek-R1 + ES/Milvus + RAG + Tool Calling\n\n### \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n\n\n![image-20250425104935964](typora-user-images/image-20250425104935964-5549379.png)\n\n\n\n**Elasticsearch**\n\n\n\n~~~yaml\n# base \nversion: '3.8'\nservices:\n\telasticsearch1:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.13.4\n    hostname: \"elasticsearch1\"\n    environment:\n      - TZ=Asia/Shanghai\n      - \"ES_JAVA_OPTS=-Xms84m -Xmx512m\"\n    ports:\n      - 9200:9200\n      - 9300:9300\n    volumes:\n      - /Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data \n      - /Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins \n      - /Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config  \n      - /Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs  \n    privileged: true\n    #restart: always\n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.7\n\n  vsftpd:\n    image: \"fauria/vsftpd\"\n    hostname: \"rabbitmq1\"\n    environment:\n      - FTP_USER=admin \n      - FTP_PASS=123456 \n      - PASV_MIN_PORT=21100\n      - PASV_MAX_PORT=21110 \n      - PASV_ADDRESS=172.18.0.8\n    ports:\n      - 21:21\n      - 21100-21110:21100-21110\n    volumes:\n      - /Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd\n      - /Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd\n    privileged: true\n    #restart: always\n    networks:\n      - nt_dev\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n![image-20250425174252871](typora-user-images/image-20250425174252871.png)\n\n### \n\n1.  Spring AI Spring AI  AI \n2.  Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2\n3.  Redis  Redis  Redis  MySQL  Redis + MySQL \n4.  ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 \n5. Tool Calling Tool Calling \n   *  1 RAG \n   *  2\n   *  3\n\n\n\n Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  \n\n\n\n## \n\n**Maven **\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.3</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <spring-boot.version>3.4.3</spring-boot.version>\n        <spring-ai.version>1.0.0-M6</spring-ai.version>\n        <alibaba.ai.version>1.0.0-M6.1</alibaba.ai.version>\n        <spring.ai.ollama.version>1.0.0-M6</spring.ai.ollama.version>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>${alibaba.ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-elasticsearch-store-spring-boot-starter</artifactId>\n            <version>${spring-ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n            <version>${spring-boot.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <repositories>\n        <repository>\n            <id>alimaven</id>\n            <name>aliyun maven</name>\n            <url>https://maven.aliyun.com/repository/public</url>\n        </repository>\n        <repository>\n            <id>spring-milestones</id>\n            <name>Spring Milestones</name>\n            <url>https://repo.spring.io/milestone</url>\n            <snapshots>\n                <enabled>false</enabled>\n            </snapshots>\n        </repository>\n        <repository>\n            <id>spring-snapshots</id>\n            <name>Spring Snapshots</name>\n            <url>https://repo.spring.io/snapshot</url>\n            <releases>\n                <enabled>false</enabled>\n            </releases>\n        </repository>\n    </repositories>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                            <version>1.18.36</version>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n~~~\n\nSpring BootSpring AIAlibaba Cloud AIMaven\n\n** `application.yml`**\n\n `model: deepseek-r1`, `model: text-embedding-v2`\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      elasticsearch:\n        initialize-schema: true\n        index-name: spring-ai-tag\n        # 1536\n        dimensions: 1536\n        similarity: cosine\n        batching-strategy: TOKEN_COUNT\n\n\n~~~\n\nRedisElasticsearchAI \n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n       @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                // \n                .defaultSystem(\"\")\n                // \n                .defaultAdvisors(\n                        new QuestionAnswerAdvisor(\n                                vectorStore,\n                                SearchRequest.builder()\n                                        .similarityThreshold(0.1) // \n                                        .topK(10) //  10 \n                                        .build()\n                        )\n                )\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n\n\n**DeepseekChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.Message;\nimport org.springframework.ai.document.Document;\nimport org.springframework.ai.document.DocumentReader;\nimport org.springframework.ai.rag.Query;\nimport org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;\nimport org.springframework.ai.reader.TextReader;\nimport org.springframework.ai.vectorstore.SearchRequest;\nimport org.springframework.ai.vectorstore.VectorStore;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @ClassName DeepseekChatController  //\n * @Description:\n * @Author: 200900681 \n * @CreateDate: 2025/4/25\n * @Version: 1.0    //\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class DeepseekChatController {\n\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private VectorStore vectorStore;\n    @Autowired\n    private ChatMemory chatMemory;\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(\"/data/load\")\n    public String loadData() throws IOException {\n        // 1. \n        DocumentReader reader = new TextReader(\"static/hospitalInfo.txt\");\n        List<Document> documents = reader.get();\n\n        // 2.\n        List<Document> splitDocuments =  new ArrayList<>();\n        for (Document document : documents) {\n            // \n            String content = document.getText();\n            // \n            String[] parts = content.split(\"\\\\n\\\\s*\\\\n\");\n            //  Document \n            for (String part : parts) {\n                splitDocuments.add(new Document(part.trim()));\n            }\n        }\n\n        log.info(\" [{}]\", splitDocuments.size());\n\n        // 3.\n        vectorStore.add(splitDocuments);\n\n        return \"success\";\n    }\n\n    @GetMapping(\"/select\")\n    public String search(@RequestParam(\"query\") String query) {\n        log.info(\"query is  [{}]\", query);\n        List<Document> results = vectorStore.similaritySearch(\n//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n\n        );\n        log.info(\"results is [{}]\", results);\n        return results.toString();\n    }\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/rewrite/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByRewrite(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1\n        QueryTransformer queryTransformer = RewriteQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n        // 2\n        Query queryByTransform = queryTransformer.transform(new Query(inputMsg));\n        // 3\n        return queryByTransform.text();\n    }\n\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/history/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByHistory(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1. \n        List<Message> history = chatMemory.get(userId, CHAT_HISTORY_SIZE);\n        // 2. \n        Query query = Query.builder()\n                .text(inputMsg)\n                .history(history)\n                .build();\n\n        // 3.  CompressionQueryTransformer\n        CompressionQueryTransformer queryTransformerByHis = CompressionQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n\n        // 4\n        Query queryByHistory = queryTransformerByHis.transform(query);\n\n        // 5\n        return queryByHistory.text();\n    }\n    \n}\n\n~~~\n\n\n\n\n\n\n\n\n\n****\n\nkimi\n\n- ``\n- 3 ``,``,``\n- 20\n\n~~~\n1. \n2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM\n2. \n(1):\n\n(2):\n\n(3):\n\n\n3. \n(1) \n \n 19853\n \n \n \n \n\n(2) \n \n 19907\n \n \n \n \n\n(3) \n \n 198211\n \n \n \n \n\n(4) \n \n 19884\n \n \n \n \n\n(5) \n \n 19809\n \n \n \n \n\n(6) \n \n 19931\n \n \n \n \n\n(7) \n \n 19875\n \n \n \n \n\n(8) \n \n 19918\n \n \n \n \n\n(9) \n \n 197912\n \n \n \n \n\n(10) \n \n 19862\n \n \n \n \n\n(11) \n \n 19837\n \n \n \n \n\n(12) \n \n 19924\n \n \n \n \n\n(13) \n \n 198110\n \n \n \n \n\n(14) \n \n 19896\n \n \n \n \n\n(15) \n \n 198411\n \n \n \n \n\n(16) \n \n 19903\n \n \n \n \n\n(17) \n \n 19889\n \n \n \n \n\n(18) \n \n 19941\n \n \n \n \n\n(19) \n \n 19858\n \n \n \n \n\n(20) \n \n 19915\n \n \n \n \n~~~\n\n\n\n\n\n## \n\n\n\n~~~\n\nhttp://127.0.0.1:8080/ai/v1/data/load\n\nhttp://127.0.0.1:8080/ai/v1/select\n\nhttp://127.0.0.1:8080/ai/v1/rag/chat\n~~~\n\n\n\n****\n\n>\n>http://127.0.0.1:8080/ai/v1/data/load\n\n\n\n![image-20250429172724826](typora-user-images/image-20250429172724826.png)\n\n![image-20250429180401580](typora-user-images/image-20250429180401580.png)\n\n>\n>http://127.0.0.1:8080/ai/v1/select?query=\n\n![image-20250429174959408](typora-user-images/image-20250429174959408.png)\n\nelasticsearch deepseek\n\nRAG+\n\n>- \n>- \n>- \n>- \n>- \n\n\n\n![image-20250429174851066](typora-user-images/image-20250429174851066.png)\n\n\n\n\n\n![image-20250429175228086](typora-user-images/image-20250429175228086.png)\n\n\n\n![image-20250429175342611](typora-user-images/image-20250429175342611.png)\n\n\n\n![image-20250429175421998](typora-user-images/image-20250429175421998.png)\n\n\n\n\n\n![image-20250429175540574](typora-user-images/image-20250429175540574.png)\n\n\n\n\n\n## milvus \n\n\n\n### Milvus\n\n**Docker-compose **\n\n~~~yaml\n#  etcd \n  etcd:\n    container_name: milvus-etcd  # \n    image: quay.io/coreos/etcd:v3.5.16  # \n    environment:\n      - ETCD_AUTO_COMPACTION_MODE=revision  # \n      - ETCD_AUTO_COMPACTION_RETENTION=1000  # \n      - ETCD_QUOTA_BACKEND_BYTES=4294967296  # \n      - ETCD_SNAPSHOT_COUNT=50000  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/etcd:/etcd  # \n    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls=http://0.0.0.0:2379 --data-dir /etcd  # \n    healthcheck:\n      test: [\"CMD\", \"etcdctl\", \"endpoint\", \"health\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n\n  #  MinIO \n  minio:\n    container_name: milvus-minio  # \n    image: minio/minio:RELEASE.2023-03-20T20-16-18Z  # \n    environment:\n      MINIO_ACCESS_KEY: minioadmin  # MinIO \n      MINIO_SECRET_KEY: minioadmin  # MinIO \n    ports:\n      - \"9001:9001\"  # \n      - \"9000:9000\"  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/minio:/minio_data  # \n    command: minio server /minio_data --console-address \":9001\"  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9000/minio/health/live\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.8   \n\n  #  Milvus \n  standalone:\n    container_name: milvus-standalone  # \n    image: milvusdb/milvus:v2.5.4  # \n    command: [\"milvus\", \"run\", \"standalone\"]  # \n    security_opt:\n    - seccomp:unconfined  # \n    environment:\n      ETCD_ENDPOINTS: etcd:2379  # etcd \n      MINIO_ADDRESS: minio:9000  # MinIO \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/milvus:/var/lib/milvus  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9091/healthz\"]  # \n      interval: 30s  # \n      start_period: 90s  # \n      timeout: 20s  # \n      retries: 3  # \n    ports:\n      - \"19530:19530\"  # \n      - \"9091:9091\"  # \n    depends_on:\n      - \"etcd\"  #  etcd \n      - \"minio\"  #  MinIO \n\n  #  Milvus Dashboard \n  dashboard:\n    image: zilliz/attu:v2.5  # \n    container_name: milvus-dashboard  # \n    environment:\n      MILVUS_URL: http://standalone:19530  # Milvus \n    ports:\n      - \"8000:3000\"  # \n    depends_on:\n      - standalone  #  Milvus \n      - etcd  #  etcd \n      - minio  #  MinIO \n\n# \nnetworks:\n  nt_dev:\n      external: true\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n\n\n****  `http://localhost:8000/`\n\n\n\n\n![image-20250429181131778](typora-user-images/image-20250429181131778.png)\n\n\n\n![image-20250429181039571](typora-user-images/image-20250429181039571.png)\n\n\n\n``milvus`,  `milvus-4321` (spring) `admin`, \n\n\n\n\n\n![image-20250429181312813](typora-user-images/image-20250429181312813.png)\n\n\n\n\n\n\n\n~~~xml\n  <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-milvus-store-spring-boot-starter</artifactId>\n </dependency>\n~~~\n\n\n\n\n\n\n\n\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  elasticsearch:\n    uris: http://127.0.0.1:9200\n    username:\n    password:\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      milvus:\n        client:\n          host: \"localhost\"\n          port: 19530\n          username: \"milvus\"\n          password: \"milvus-4321\"\n        databaseName: \"default\"\n        collectionName: \"vector_store\"\n        embeddingDimension: 1536\n        indexType: IVF_FLAT\n        metricType: COSINE\n        initialize-schema: true\n\n\n\n\n~~~\n\nRedisMilvusAI\n\n\n\n\n\n![image-20250429183142516](typora-user-images/image-20250429183142516.png)\n","source":"categories/Spring AI Alibaba/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .md","raw":"# Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES/Milvus + RAG \n\n\n\n[]AIAPI**Spring AI**Spring[AI]AI\n\n[toc]\n\n\n\n\n\n## Spring AI  Function CallingTool Calling  Agent \n\n### Spring AI \n\n#### Spring AI\n\nSpring AI\n\n* 20245301.0.0 Milestone 1API\n* 20248231.0.0 Milestone 2\n* 20241081.0.0 Milestone 3AI\n* 202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon\n* 20252141.0.0 Milestone 6\n\n\n\n#### Spring AI\n\nSpring AIAI\n\n* LLM\n* AI\n* \n* \n* \n\n### **Function Calling**\n\n#### \n\nAIAPIAI\n\n#### \n\nSpring AI\n\n**1**`Function`Java\n\n~~~java\n@Component\npublic class WeatherFunction implements Function<WeatherFunction.WeatherRequest, String> {\n    @Override\n    public String apply(WeatherRequest request) {\n        return \"The weather in \" + request.getCity() + \" is sunny.\";\n    }\n    public static class WeatherRequest {\n        private String city;\n        public String getCity() { return city; }\n        public void setCity(String city) { this.city = city; }\n    }\n}\n\n~~~\n\n**2**Spring BeanSpring AI\n\n~~~java\n@Configuration\npublic class FunctionConfig {\n    @Bean\n    @Description(\"\")\n    public Function<WeatherFunction.WeatherRequest, String> weatherFunction() {\n        return new WeatherFunction();\n    }\n}\n~~~\n\n**3**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withFunction(\"weatherFunction\").build())\n                .build();\n    }\n}\n~~~\n\n**4**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        WeatherFunction.WeatherRequest request = new WeatherFunction.WeatherRequest();\n        request.setCity(input);\n        String response = chatClient.prompt().user(input).functions(\"weatherFunction\").call().content();\n        return response;\n    }\n}\n~~~\n\n****Spring AI****Tool Calling\n\n### **Tool Calling**\n\n#### ****\n\nAI\n\n#### \n\n\n\n**1**\n\n~~~java\npublic interface WeatherTool {\n    String getWeather(String city);\n}\n~~~\n\n**2**\n\n~~~java\n@Component\npublic class WeatherToolImpl implements WeatherTool {\n    @Override\n    public String getWeather(String city) {\n        return \"The weather in \" + city + \" is sunny.\";\n    }\n}\n~~~\n\n**3Spring Bean**Spring BeanSpring\n\n~~~java\n@Configuration\npublic class ToolConfig {\n    @Bean\n    public WeatherTool weatherTool() {\n        return new WeatherToolImpl();\n    }\n}\n~~~\n\n**4**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withTool(\"weatherTool\").build())\n                .build();\n    }\n}\n\n~~~\n\n**5**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        String response = chatClient.prompt().user(input).tools(\"weatherTool\").call().content();\n        return response;\n    }\n}\n\n~~~\n\n### Agent\n\n#### \n\nAgent\n\n#### \n\n\n\nMCPLLMMCP\n\nSpring AIAI\nSpring AI\n\n### FunctionCallbacToolCallback\n\nSpring AIFunction CallbackDeprecatedTool CallbackAI\n\n**FunctionCallbackToolCallback**\n\nSpring AIFunctionCallbackToolCallback\n\n* ToolCallbackFunctionCallback\n* ToolCallback\n* FunctionCallbackSpring AIToolCallback\n\n\n\nSpring AIFunctionCallbackToolCallback\n\n\n\n## Spring AI + DeepSeek-R1 + ES/Milvus + RAG + Tool Calling\n\n### \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n\n\n![image-20250425104935964](typora-user-images/image-20250425104935964-5549379.png)\n\n\n\n**Elasticsearch**\n\n\n\n~~~yaml\n# base \nversion: '3.8'\nservices:\n\telasticsearch1:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.13.4\n    hostname: \"elasticsearch1\"\n    environment:\n      - TZ=Asia/Shanghai\n      - \"ES_JAVA_OPTS=-Xms84m -Xmx512m\"\n    ports:\n      - 9200:9200\n      - 9300:9300\n    volumes:\n      - /Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data \n      - /Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins \n      - /Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config  \n      - /Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs  \n    privileged: true\n    #restart: always\n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.7\n\n  vsftpd:\n    image: \"fauria/vsftpd\"\n    hostname: \"rabbitmq1\"\n    environment:\n      - FTP_USER=admin \n      - FTP_PASS=123456 \n      - PASV_MIN_PORT=21100\n      - PASV_MAX_PORT=21110 \n      - PASV_ADDRESS=172.18.0.8\n    ports:\n      - 21:21\n      - 21100-21110:21100-21110\n    volumes:\n      - /Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd\n      - /Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd\n    privileged: true\n    #restart: always\n    networks:\n      - nt_dev\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n![image-20250425174252871](typora-user-images/image-20250425174252871.png)\n\n### \n\n1.  Spring AI Spring AI  AI \n2.  Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2\n3.  Redis  Redis  Redis  MySQL  Redis + MySQL \n4.  ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 \n5. Tool Calling Tool Calling \n   *  1 RAG \n   *  2\n   *  3\n\n\n\n Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  \n\n\n\n## \n\n**Maven **\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.3</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <spring-boot.version>3.4.3</spring-boot.version>\n        <spring-ai.version>1.0.0-M6</spring-ai.version>\n        <alibaba.ai.version>1.0.0-M6.1</alibaba.ai.version>\n        <spring.ai.ollama.version>1.0.0-M6</spring.ai.ollama.version>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>${alibaba.ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-elasticsearch-store-spring-boot-starter</artifactId>\n            <version>${spring-ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n            <version>${spring-boot.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <repositories>\n        <repository>\n            <id>alimaven</id>\n            <name>aliyun maven</name>\n            <url>https://maven.aliyun.com/repository/public</url>\n        </repository>\n        <repository>\n            <id>spring-milestones</id>\n            <name>Spring Milestones</name>\n            <url>https://repo.spring.io/milestone</url>\n            <snapshots>\n                <enabled>false</enabled>\n            </snapshots>\n        </repository>\n        <repository>\n            <id>spring-snapshots</id>\n            <name>Spring Snapshots</name>\n            <url>https://repo.spring.io/snapshot</url>\n            <releases>\n                <enabled>false</enabled>\n            </releases>\n        </repository>\n    </repositories>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                            <version>1.18.36</version>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n~~~\n\nSpring BootSpring AIAlibaba Cloud AIMaven\n\n** `application.yml`**\n\n `model: deepseek-r1`, `model: text-embedding-v2`\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      elasticsearch:\n        initialize-schema: true\n        index-name: spring-ai-tag\n        # 1536\n        dimensions: 1536\n        similarity: cosine\n        batching-strategy: TOKEN_COUNT\n\n\n~~~\n\nRedisElasticsearchAI \n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n       @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                // \n                .defaultSystem(\"\")\n                // \n                .defaultAdvisors(\n                        new QuestionAnswerAdvisor(\n                                vectorStore,\n                                SearchRequest.builder()\n                                        .similarityThreshold(0.1) // \n                                        .topK(10) //  10 \n                                        .build()\n                        )\n                )\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n\n\n**DeepseekChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.Message;\nimport org.springframework.ai.document.Document;\nimport org.springframework.ai.document.DocumentReader;\nimport org.springframework.ai.rag.Query;\nimport org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;\nimport org.springframework.ai.reader.TextReader;\nimport org.springframework.ai.vectorstore.SearchRequest;\nimport org.springframework.ai.vectorstore.VectorStore;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @ClassName DeepseekChatController  //\n * @Description:\n * @Author: 200900681 \n * @CreateDate: 2025/4/25\n * @Version: 1.0    //\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class DeepseekChatController {\n\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private VectorStore vectorStore;\n    @Autowired\n    private ChatMemory chatMemory;\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(\"/data/load\")\n    public String loadData() throws IOException {\n        // 1. \n        DocumentReader reader = new TextReader(\"static/hospitalInfo.txt\");\n        List<Document> documents = reader.get();\n\n        // 2.\n        List<Document> splitDocuments =  new ArrayList<>();\n        for (Document document : documents) {\n            // \n            String content = document.getText();\n            // \n            String[] parts = content.split(\"\\\\n\\\\s*\\\\n\");\n            //  Document \n            for (String part : parts) {\n                splitDocuments.add(new Document(part.trim()));\n            }\n        }\n\n        log.info(\" [{}]\", splitDocuments.size());\n\n        // 3.\n        vectorStore.add(splitDocuments);\n\n        return \"success\";\n    }\n\n    @GetMapping(\"/select\")\n    public String search(@RequestParam(\"query\") String query) {\n        log.info(\"query is  [{}]\", query);\n        List<Document> results = vectorStore.similaritySearch(\n//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n\n        );\n        log.info(\"results is [{}]\", results);\n        return results.toString();\n    }\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/rewrite/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByRewrite(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1\n        QueryTransformer queryTransformer = RewriteQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n        // 2\n        Query queryByTransform = queryTransformer.transform(new Query(inputMsg));\n        // 3\n        return queryByTransform.text();\n    }\n\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/history/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByHistory(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1. \n        List<Message> history = chatMemory.get(userId, CHAT_HISTORY_SIZE);\n        // 2. \n        Query query = Query.builder()\n                .text(inputMsg)\n                .history(history)\n                .build();\n\n        // 3.  CompressionQueryTransformer\n        CompressionQueryTransformer queryTransformerByHis = CompressionQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n\n        // 4\n        Query queryByHistory = queryTransformerByHis.transform(query);\n\n        // 5\n        return queryByHistory.text();\n    }\n    \n}\n\n~~~\n\n\n\n\n\n\n\n\n\n****\n\nkimi\n\n- ``\n- 3 ``,``,``\n- 20\n\n~~~\n1. \n2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM\n2. \n(1):\n\n(2):\n\n(3):\n\n\n3. \n(1) \n \n 19853\n \n \n \n \n\n(2) \n \n 19907\n \n \n \n \n\n(3) \n \n 198211\n \n \n \n \n\n(4) \n \n 19884\n \n \n \n \n\n(5) \n \n 19809\n \n \n \n \n\n(6) \n \n 19931\n \n \n \n \n\n(7) \n \n 19875\n \n \n \n \n\n(8) \n \n 19918\n \n \n \n \n\n(9) \n \n 197912\n \n \n \n \n\n(10) \n \n 19862\n \n \n \n \n\n(11) \n \n 19837\n \n \n \n \n\n(12) \n \n 19924\n \n \n \n \n\n(13) \n \n 198110\n \n \n \n \n\n(14) \n \n 19896\n \n \n \n \n\n(15) \n \n 198411\n \n \n \n \n\n(16) \n \n 19903\n \n \n \n \n\n(17) \n \n 19889\n \n \n \n \n\n(18) \n \n 19941\n \n \n \n \n\n(19) \n \n 19858\n \n \n \n \n\n(20) \n \n 19915\n \n \n \n \n~~~\n\n\n\n\n\n## \n\n\n\n~~~\n\nhttp://127.0.0.1:8080/ai/v1/data/load\n\nhttp://127.0.0.1:8080/ai/v1/select\n\nhttp://127.0.0.1:8080/ai/v1/rag/chat\n~~~\n\n\n\n****\n\n>\n>http://127.0.0.1:8080/ai/v1/data/load\n\n\n\n![image-20250429172724826](typora-user-images/image-20250429172724826.png)\n\n![image-20250429180401580](typora-user-images/image-20250429180401580.png)\n\n>\n>http://127.0.0.1:8080/ai/v1/select?query=\n\n![image-20250429174959408](typora-user-images/image-20250429174959408.png)\n\nelasticsearch deepseek\n\nRAG+\n\n>- \n>- \n>- \n>- \n>- \n\n\n\n![image-20250429174851066](typora-user-images/image-20250429174851066.png)\n\n\n\n\n\n![image-20250429175228086](typora-user-images/image-20250429175228086.png)\n\n\n\n![image-20250429175342611](typora-user-images/image-20250429175342611.png)\n\n\n\n![image-20250429175421998](typora-user-images/image-20250429175421998.png)\n\n\n\n\n\n![image-20250429175540574](typora-user-images/image-20250429175540574.png)\n\n\n\n\n\n## milvus \n\n\n\n### Milvus\n\n**Docker-compose **\n\n~~~yaml\n#  etcd \n  etcd:\n    container_name: milvus-etcd  # \n    image: quay.io/coreos/etcd:v3.5.16  # \n    environment:\n      - ETCD_AUTO_COMPACTION_MODE=revision  # \n      - ETCD_AUTO_COMPACTION_RETENTION=1000  # \n      - ETCD_QUOTA_BACKEND_BYTES=4294967296  # \n      - ETCD_SNAPSHOT_COUNT=50000  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/etcd:/etcd  # \n    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls=http://0.0.0.0:2379 --data-dir /etcd  # \n    healthcheck:\n      test: [\"CMD\", \"etcdctl\", \"endpoint\", \"health\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n\n  #  MinIO \n  minio:\n    container_name: milvus-minio  # \n    image: minio/minio:RELEASE.2023-03-20T20-16-18Z  # \n    environment:\n      MINIO_ACCESS_KEY: minioadmin  # MinIO \n      MINIO_SECRET_KEY: minioadmin  # MinIO \n    ports:\n      - \"9001:9001\"  # \n      - \"9000:9000\"  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/minio:/minio_data  # \n    command: minio server /minio_data --console-address \":9001\"  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9000/minio/health/live\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.8   \n\n  #  Milvus \n  standalone:\n    container_name: milvus-standalone  # \n    image: milvusdb/milvus:v2.5.4  # \n    command: [\"milvus\", \"run\", \"standalone\"]  # \n    security_opt:\n    - seccomp:unconfined  # \n    environment:\n      ETCD_ENDPOINTS: etcd:2379  # etcd \n      MINIO_ADDRESS: minio:9000  # MinIO \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/milvus:/var/lib/milvus  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9091/healthz\"]  # \n      interval: 30s  # \n      start_period: 90s  # \n      timeout: 20s  # \n      retries: 3  # \n    ports:\n      - \"19530:19530\"  # \n      - \"9091:9091\"  # \n    depends_on:\n      - \"etcd\"  #  etcd \n      - \"minio\"  #  MinIO \n\n  #  Milvus Dashboard \n  dashboard:\n    image: zilliz/attu:v2.5  # \n    container_name: milvus-dashboard  # \n    environment:\n      MILVUS_URL: http://standalone:19530  # Milvus \n    ports:\n      - \"8000:3000\"  # \n    depends_on:\n      - standalone  #  Milvus \n      - etcd  #  etcd \n      - minio  #  MinIO \n\n# \nnetworks:\n  nt_dev:\n      external: true\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n\n\n****  `http://localhost:8000/`\n\n\n\n\n![image-20250429181131778](typora-user-images/image-20250429181131778.png)\n\n\n\n![image-20250429181039571](typora-user-images/image-20250429181039571.png)\n\n\n\n``milvus`,  `milvus-4321` (spring) `admin`, \n\n\n\n\n\n![image-20250429181312813](typora-user-images/image-20250429181312813.png)\n\n\n\n\n\n\n\n~~~xml\n  <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-milvus-store-spring-boot-starter</artifactId>\n </dependency>\n~~~\n\n\n\n\n\n\n\n\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  elasticsearch:\n    uris: http://127.0.0.1:9200\n    username:\n    password:\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      milvus:\n        client:\n          host: \"localhost\"\n          port: 19530\n          username: \"milvus\"\n          password: \"milvus-4321\"\n        databaseName: \"default\"\n        collectionName: \"vector_store\"\n        embeddingDimension: 1536\n        indexType: IVF_FLAT\n        metricType: COSINE\n        initialize-schema: true\n\n\n\n\n~~~\n\nRedisMilvusAI\n\n\n\n\n\n![image-20250429183142516](typora-user-images/image-20250429183142516.png)\n","date":"2025-06-04T10:12:41.876Z","updated":"2025-04-29T10:42:03.405Z","path":"categories/Spring AI Alibaba/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .html","title":"","comments":1,"layout":"page","_id":"cmbhsgz5o0005nffy6l3u85oa","content":"<h1 id=\"Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\"><a href=\"#Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\" class=\"headerlink\" title=\"Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG \"></a>Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG </h1><p>[]AIAPI<strong>Spring AI</strong>Spring[AI]AI</p>\n<p>[toc]</p>\n<h2 id=\"Spring-AI--Function-CallingTool-Calling--Agent-\"><a href=\"#Spring-AI--Function-CallingTool-Calling--Agent-\" class=\"headerlink\" title=\"Spring AI  Function CallingTool Calling  Agent \"></a>Spring AI  Function CallingTool Calling  Agent </h2><h3 id=\"Spring-AI-\"><a href=\"#Spring-AI-\" class=\"headerlink\" title=\"Spring AI \"></a>Spring AI </h3><h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AI</p>\n<ul>\n<li>20245301.0.0 Milestone 1API</li>\n<li>20248231.0.0 Milestone 2</li>\n<li>20241081.0.0 Milestone 3AI</li>\n<li>202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon</li>\n<li>20252141.0.0 Milestone 6</li>\n</ul>\n<h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AIAI</p>\n<ul>\n<li>LLM</li>\n<li>AI</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a><strong>Function Calling</strong></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>AIAPIAI</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Spring AI</p>\n<p><strong>1</strong><code>Function</code>Java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherFunction</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Function</span>&lt;WeatherFunction.WeatherRequest, String&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">apply</span><span class=\"params\">(WeatherRequest request)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + request.getCity() + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherRequest</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String city;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getCity</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> city; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setCity</span><span class=\"params\">(String city)</span> &#123; <span class=\"built_in\">this</span>.city = city; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong>Spring BeanSpring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FunctionConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Function&lt;WeatherFunction.WeatherRequest, String&gt; weatherFunction() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withFunction(<span class=\"string\">&quot;weatherFunction&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        WeatherFunction.<span class=\"type\">WeatherRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>.WeatherRequest();</span><br><span class=\"line\">        request.setCity(input);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).functions(<span class=\"string\">&quot;weatherFunction&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong>Spring AI<strong></strong>Tool Calling</p>\n<h3 id=\"Tool-Calling\"><a href=\"#Tool-Calling\" class=\"headerlink\" title=\"Tool Calling\"></a><strong>Tool Calling</strong></h3><h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p>AI</p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p><strong>1</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherToolImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + city + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3Spring Bean</strong>Spring BeanSpring</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ToolConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> WeatherTool <span class=\"title function_\">weatherTool</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherToolImpl</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withTool(<span class=\"string\">&quot;weatherTool&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>5</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).tools(<span class=\"string\">&quot;weatherTool&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Agent\"><a href=\"#Agent\" class=\"headerlink\" title=\"Agent\"></a>Agent</h3><h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p>Agent</p>\n<h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p>MCPLLMMCP<br><br>Spring AIAI<br>Spring AI</p>\n<h3 id=\"FunctionCallbacToolCallback\"><a href=\"#FunctionCallbacToolCallback\" class=\"headerlink\" title=\"FunctionCallbacToolCallback\"></a>FunctionCallbacToolCallback</h3><p>Spring AIFunction CallbackDeprecatedTool CallbackAI</p>\n<p><strong>FunctionCallbackToolCallback</strong></p>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<ul>\n<li>ToolCallbackFunctionCallback</li>\n<li>ToolCallback</li>\n<li>FunctionCallbackSpring AIToolCallback</li>\n</ul>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<h2 id=\"Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\"><a href=\"#Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\" class=\"headerlink\" title=\"Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling\"></a>Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p><img src=\"/typora-user-images/image-20250425104935964-5549379.png\" alt=\"image-20250425104935964\"></p>\n<p><strong>Elasticsearch</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># base </span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">\t<span class=\"attr\">elasticsearch1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/elasticsearch/elasticsearch:8.13.4</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;elasticsearch1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;ES_JAVA_OPTS=-Xms84m -Xmx512m&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9200</span><span class=\"string\">:9200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9300</span><span class=\"string\">:9300</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config</span>  </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs</span>  </span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.7</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">vsftpd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">&quot;fauria/vsftpd&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;rabbitmq1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_USER=admin</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_PASS=123456</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MIN_PORT=21100</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MAX_PORT=21110</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_ADDRESS=172.18.0.8</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21</span><span class=\"string\">:21</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21100</span><span class=\"number\">-21110</span><span class=\"string\">:21100-21110</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nt_dev</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/typora-user-images/image-20250425174252871.png\" alt=\"image-20250425174252871\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> Spring AI Spring AI  AI </li>\n<li> Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2</li>\n<li> Redis  Redis  Redis  MySQL  Redis + MySQL </li>\n<li> ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 </li>\n<li>Tool Calling Tool Calling <ul>\n<li> 1 RAG </li>\n<li> 2</li>\n<li> 3</li>\n</ul>\n</li>\n</ol>\n<p> Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>Maven </strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-boot.version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">spring-boot.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-ai.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring-ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">alibaba.ai.version</span>&gt;</span>1.0.0-M6.1<span class=\"tag\">&lt;/<span class=\"name\">alibaba.ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.ai.ollama.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring.ai.ollama.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;alibaba.ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-elasticsearch-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Snapshots<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.18.36<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>Spring BootSpring AIAlibaba Cloud AIMaven</p>\n<p><strong> <code>application.yml</code></strong></p>\n<p> <code>model: deepseek-r1</code>, <code>model: text-embedding-v2</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">index-name:</span> <span class=\"string\">spring-ai-tag</span></span><br><span class=\"line\">        <span class=\"comment\"># 1536</span></span><br><span class=\"line\">        <span class=\"attr\">dimensions:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">similarity:</span> <span class=\"string\">cosine</span></span><br><span class=\"line\">        <span class=\"attr\">batching-strategy:</span> <span class=\"string\">TOKEN_COUNT</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisElasticsearchAI </p>\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultSystem(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">QuestionAnswerAdvisor</span>(</span><br><span class=\"line\">                                vectorStore,</span><br><span class=\"line\">                                SearchRequest.builder()</span><br><span class=\"line\">                                        .similarityThreshold(<span class=\"number\">0.1</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">                                        .topK(<span class=\"number\">10</span>) <span class=\"comment\">//  10 </span></span><br><span class=\"line\">                                        .build()</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>DeepseekChatController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.DocumentReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.Query;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.reader.TextReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.SearchRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.VectorStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@ClassName</span> DeepseekChatController  //</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span>: 200900681 </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@CreateDate</span>: 2025/4/25</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Version</span>: 1.0    //</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DeepseekChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> VectorStore vectorStore;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/data/load&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">loadData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        <span class=\"type\">DocumentReader</span> <span class=\"variable\">reader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TextReader</span>(<span class=\"string\">&quot;static/hospitalInfo.txt&quot;</span>);</span><br><span class=\"line\">        List&lt;Document&gt; documents = reader.get();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.</span></span><br><span class=\"line\">        List&lt;Document&gt; splitDocuments =  <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Document document : documents) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">content</span> <span class=\"operator\">=</span> document.getText();</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            String[] parts = content.split(<span class=\"string\">&quot;\\\\n\\\\s*\\\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//  Document </span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (String part : parts) &#123;</span><br><span class=\"line\">                splitDocuments.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>(part.trim()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot; [&#123;&#125;]&quot;</span>, splitDocuments.size());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.</span></span><br><span class=\"line\">        vectorStore.add(splitDocuments);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;success&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/select&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">search</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;query&quot;)</span> String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query is  [&#123;&#125;]&quot;</span>, query);</span><br><span class=\"line\">        List&lt;Document&gt; results = vectorStore.similaritySearch(</span><br><span class=\"line\"><span class=\"comment\">//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()</span></span><br><span class=\"line\">                SearchRequest.builder().query(query).similarityThreshold(<span class=\"number\">0.1</span>).topK(<span class=\"number\">10</span>).build()</span><br><span class=\"line\"></span><br><span class=\"line\">        );</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;results is [&#123;&#125;]&quot;</span>, results);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> results.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/rewrite/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByRewrite</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1</span></span><br><span class=\"line\">        <span class=\"type\">QueryTransformer</span> <span class=\"variable\">queryTransformer</span> <span class=\"operator\">=</span> RewriteQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"comment\">// 2</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByTransform</span> <span class=\"operator\">=</span> queryTransformer.transform(<span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(inputMsg));</span><br><span class=\"line\">        <span class=\"comment\">// 3</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByTransform.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/history/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByHistory</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        List&lt;Message&gt; history = chatMemory.get(userId, CHAT_HISTORY_SIZE);</span><br><span class=\"line\">        <span class=\"comment\">// 2. </span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> Query.builder()</span><br><span class=\"line\">                .text(inputMsg)</span><br><span class=\"line\">                .history(history)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.  CompressionQueryTransformer</span></span><br><span class=\"line\">        <span class=\"type\">CompressionQueryTransformer</span> <span class=\"variable\">queryTransformerByHis</span> <span class=\"operator\">=</span> CompressionQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByHistory</span> <span class=\"operator\">=</span> queryTransformerByHis.transform(query);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByHistory.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<p><strong></strong></p>\n<p>kimi</p>\n<ul>\n<li><code></code></li>\n<li>3 <code></code>,<code></code>,<code></code></li>\n<li>20</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. </span><br><span class=\"line\">2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM</span><br><span class=\"line\">2. </span><br><span class=\"line\">(1):</span><br><span class=\"line\"></span><br><span class=\"line\">(2):</span><br><span class=\"line\"></span><br><span class=\"line\">(3):</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">3. </span><br><span class=\"line\">(1) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19853</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(2) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19907</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(3) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198211</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(4) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19884</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(5) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19809</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(6) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19931</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(7) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19875</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(8) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19918</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(9) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 197912</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(10) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19862</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(11) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19837</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(12) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19924</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(13) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198110</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(14) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19896</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(15) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198411</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(16) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19903</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(17) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19889</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(18) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19941</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(19) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19858</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(20) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19915</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/data/load</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/select</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/rag/chat</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/data/load\">http://127.0.0.1:8080/ai/v1/data/load</a></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429172724826.png\" alt=\"image-20250429172724826\"></p>\n<p><img src=\"/typora-user-images/image-20250429180401580.png\" alt=\"image-20250429180401580\"></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/select?query=%E5%8C%BB%E9%99%A2%E4%BB%8B%E7%BB%8D\">http://127.0.0.1:8080/ai/v1/select?query=</a></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429174959408.png\" alt=\"image-20250429174959408\"></p>\n<p>elasticsearch deepseek</p>\n<p>RAG+</p>\n<blockquote>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429174851066.png\" alt=\"image-20250429174851066\"></p>\n<p><img src=\"/typora-user-images/image-20250429175228086.png\" alt=\"image-20250429175228086\"></p>\n<p><img src=\"/typora-user-images/image-20250429175342611.png\" alt=\"image-20250429175342611\"></p>\n<p><img src=\"/typora-user-images/image-20250429175421998.png\" alt=\"image-20250429175421998\"></p>\n<p><img src=\"/typora-user-images/image-20250429175540574.png\" alt=\"image-20250429175540574\"></p>\n<h2 id=\"milvus-\"><a href=\"#milvus-\" class=\"headerlink\" title=\"milvus \"></a>milvus </h2><h3 id=\"Milvus\"><a href=\"#Milvus\" class=\"headerlink\" title=\"Milvus\"></a>Milvus</h3><p><strong>Docker-compose </strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  etcd </span></span><br><span class=\"line\">  <span class=\"attr\">etcd:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">quay.io/coreos/etcd:v3.5.16</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_MODE=revision</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_RETENTION=1000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_QUOTA_BACKEND_BYTES=4294967296</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_SNAPSHOT_COUNT=50000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/etcd:/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">etcd</span> <span class=\"string\">-advertise-client-urls=http://127.0.0.1:2379</span> <span class=\"string\">-listen-client-urls=http://0.0.0.0:2379</span> <span class=\"string\">--data-dir</span> <span class=\"string\">/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;etcdctl&quot;</span>, <span class=\"string\">&quot;endpoint&quot;</span>, <span class=\"string\">&quot;health&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\">  <span class=\"attr\">minio:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-minio</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">minio/minio:RELEASE.2023-03-20T20-16-18Z</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ACCESS_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_SECRET_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9001:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9000:9000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/minio:/minio_data</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">minio</span> <span class=\"string\">server</span> <span class=\"string\">/minio_data</span> <span class=\"string\">--console-address</span> <span class=\"string\">&quot;:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9000/minio/health/live&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.8</span>   </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">  <span class=\"attr\">standalone:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-standalone</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">milvusdb/milvus:v2.5.4</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;milvus&quot;</span>, <span class=\"string\">&quot;run&quot;</span>, <span class=\"string\">&quot;standalone&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">security_opt:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">seccomp:unconfined</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ETCD_ENDPOINTS:</span> <span class=\"string\">etcd:2379</span>  <span class=\"comment\"># etcd </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ADDRESS:</span> <span class=\"string\">minio:9000</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/milvus:/var/lib/milvus</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9091/healthz&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">start_period:</span> <span class=\"string\">90s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;19530:19530&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9091:9091&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;etcd&quot;</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;minio&quot;</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus Dashboard </span></span><br><span class=\"line\">  <span class=\"attr\">dashboard:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zilliz/attu:v2.5</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-dashboard</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MILVUS_URL:</span> <span class=\"string\">http://standalone:19530</span>  <span class=\"comment\"># Milvus </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;8000:3000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">standalone</span>  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">etcd</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">minio</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">      <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong>  <code>http://localhost:8000/</code><br></p>\n<p><img src=\"/typora-user-images/image-20250429181131778.png\" alt=\"image-20250429181131778\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250429181039571.png\" alt=\"image-20250429181039571\"></p>\n<p>&#96;&#96;milvus<code>,  </code>milvus-4321<code>(spring)</code>admin&#96;, </p>\n<p><img src=\"/typora-user-images/image-20250429181312813.png\" alt=\"image-20250429181312813\"></p>\n<p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-milvus-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">    <span class=\"attr\">uris:</span> <span class=\"string\">http://127.0.0.1:9200</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">milvus:</span></span><br><span class=\"line\">        <span class=\"attr\">client:</span></span><br><span class=\"line\">          <span class=\"attr\">host:</span> <span class=\"string\">&quot;localhost&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">port:</span> <span class=\"number\">19530</span></span><br><span class=\"line\">          <span class=\"attr\">username:</span> <span class=\"string\">&quot;milvus&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"string\">&quot;milvus-4321&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">databaseName:</span> <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">collectionName:</span> <span class=\"string\">&quot;vector_store&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">embeddingDimension:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">indexType:</span> <span class=\"string\">IVF_FLAT</span></span><br><span class=\"line\">        <span class=\"attr\">metricType:</span> <span class=\"string\">COSINE</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisMilvusAI</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250429183142516.png\" alt=\"image-20250429183142516\"></p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\"><a href=\"#Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\" class=\"headerlink\" title=\"Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG \"></a>Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG </h1><p>[]AIAPI<strong>Spring AI</strong>Spring[AI]AI</p>\n<p>[toc]</p>\n<h2 id=\"Spring-AI--Function-CallingTool-Calling--Agent-\"><a href=\"#Spring-AI--Function-CallingTool-Calling--Agent-\" class=\"headerlink\" title=\"Spring AI  Function CallingTool Calling  Agent \"></a>Spring AI  Function CallingTool Calling  Agent </h2><h3 id=\"Spring-AI-\"><a href=\"#Spring-AI-\" class=\"headerlink\" title=\"Spring AI \"></a>Spring AI </h3><h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AI</p>\n<ul>\n<li>20245301.0.0 Milestone 1API</li>\n<li>20248231.0.0 Milestone 2</li>\n<li>20241081.0.0 Milestone 3AI</li>\n<li>202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon</li>\n<li>20252141.0.0 Milestone 6</li>\n</ul>\n<h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AIAI</p>\n<ul>\n<li>LLM</li>\n<li>AI</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a><strong>Function Calling</strong></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>AIAPIAI</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Spring AI</p>\n<p><strong>1</strong><code>Function</code>Java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherFunction</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Function</span>&lt;WeatherFunction.WeatherRequest, String&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">apply</span><span class=\"params\">(WeatherRequest request)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + request.getCity() + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherRequest</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String city;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getCity</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> city; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setCity</span><span class=\"params\">(String city)</span> &#123; <span class=\"built_in\">this</span>.city = city; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong>Spring BeanSpring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FunctionConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Function&lt;WeatherFunction.WeatherRequest, String&gt; weatherFunction() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withFunction(<span class=\"string\">&quot;weatherFunction&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        WeatherFunction.<span class=\"type\">WeatherRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>.WeatherRequest();</span><br><span class=\"line\">        request.setCity(input);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).functions(<span class=\"string\">&quot;weatherFunction&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong>Spring AI<strong></strong>Tool Calling</p>\n<h3 id=\"Tool-Calling\"><a href=\"#Tool-Calling\" class=\"headerlink\" title=\"Tool Calling\"></a><strong>Tool Calling</strong></h3><h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p>AI</p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p><strong>1</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherToolImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + city + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3Spring Bean</strong>Spring BeanSpring</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ToolConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> WeatherTool <span class=\"title function_\">weatherTool</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherToolImpl</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withTool(<span class=\"string\">&quot;weatherTool&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>5</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).tools(<span class=\"string\">&quot;weatherTool&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Agent\"><a href=\"#Agent\" class=\"headerlink\" title=\"Agent\"></a>Agent</h3><h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p>Agent</p>\n<h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p>MCPLLMMCP<br><br>Spring AIAI<br>Spring AI</p>\n<h3 id=\"FunctionCallbacToolCallback\"><a href=\"#FunctionCallbacToolCallback\" class=\"headerlink\" title=\"FunctionCallbacToolCallback\"></a>FunctionCallbacToolCallback</h3><p>Spring AIFunction CallbackDeprecatedTool CallbackAI</p>\n<p><strong>FunctionCallbackToolCallback</strong></p>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<ul>\n<li>ToolCallbackFunctionCallback</li>\n<li>ToolCallback</li>\n<li>FunctionCallbackSpring AIToolCallback</li>\n</ul>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<h2 id=\"Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\"><a href=\"#Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\" class=\"headerlink\" title=\"Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling\"></a>Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p><img src=\"/typora-user-images/image-20250425104935964-5549379.png\" alt=\"image-20250425104935964\"></p>\n<p><strong>Elasticsearch</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># base </span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">\t<span class=\"attr\">elasticsearch1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/elasticsearch/elasticsearch:8.13.4</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;elasticsearch1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;ES_JAVA_OPTS=-Xms84m -Xmx512m&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9200</span><span class=\"string\">:9200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9300</span><span class=\"string\">:9300</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config</span>  </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs</span>  </span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.7</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">vsftpd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">&quot;fauria/vsftpd&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;rabbitmq1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_USER=admin</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_PASS=123456</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MIN_PORT=21100</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MAX_PORT=21110</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_ADDRESS=172.18.0.8</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21</span><span class=\"string\">:21</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21100</span><span class=\"number\">-21110</span><span class=\"string\">:21100-21110</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nt_dev</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/typora-user-images/image-20250425174252871.png\" alt=\"image-20250425174252871\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> Spring AI Spring AI  AI </li>\n<li> Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2</li>\n<li> Redis  Redis  Redis  MySQL  Redis + MySQL </li>\n<li> ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 </li>\n<li>Tool Calling Tool Calling <ul>\n<li> 1 RAG </li>\n<li> 2</li>\n<li> 3</li>\n</ul>\n</li>\n</ol>\n<p> Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>Maven </strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-boot.version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">spring-boot.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-ai.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring-ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">alibaba.ai.version</span>&gt;</span>1.0.0-M6.1<span class=\"tag\">&lt;/<span class=\"name\">alibaba.ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.ai.ollama.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring.ai.ollama.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;alibaba.ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-elasticsearch-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Snapshots<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.18.36<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>Spring BootSpring AIAlibaba Cloud AIMaven</p>\n<p><strong> <code>application.yml</code></strong></p>\n<p> <code>model: deepseek-r1</code>, <code>model: text-embedding-v2</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">index-name:</span> <span class=\"string\">spring-ai-tag</span></span><br><span class=\"line\">        <span class=\"comment\"># 1536</span></span><br><span class=\"line\">        <span class=\"attr\">dimensions:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">similarity:</span> <span class=\"string\">cosine</span></span><br><span class=\"line\">        <span class=\"attr\">batching-strategy:</span> <span class=\"string\">TOKEN_COUNT</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisElasticsearchAI </p>\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultSystem(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">QuestionAnswerAdvisor</span>(</span><br><span class=\"line\">                                vectorStore,</span><br><span class=\"line\">                                SearchRequest.builder()</span><br><span class=\"line\">                                        .similarityThreshold(<span class=\"number\">0.1</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">                                        .topK(<span class=\"number\">10</span>) <span class=\"comment\">//  10 </span></span><br><span class=\"line\">                                        .build()</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>DeepseekChatController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.DocumentReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.Query;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.reader.TextReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.SearchRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.VectorStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@ClassName</span> DeepseekChatController  //</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span>: 200900681 </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@CreateDate</span>: 2025/4/25</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Version</span>: 1.0    //</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DeepseekChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> VectorStore vectorStore;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/data/load&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">loadData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        <span class=\"type\">DocumentReader</span> <span class=\"variable\">reader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TextReader</span>(<span class=\"string\">&quot;static/hospitalInfo.txt&quot;</span>);</span><br><span class=\"line\">        List&lt;Document&gt; documents = reader.get();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.</span></span><br><span class=\"line\">        List&lt;Document&gt; splitDocuments =  <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Document document : documents) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">content</span> <span class=\"operator\">=</span> document.getText();</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            String[] parts = content.split(<span class=\"string\">&quot;\\\\n\\\\s*\\\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//  Document </span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (String part : parts) &#123;</span><br><span class=\"line\">                splitDocuments.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>(part.trim()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot; [&#123;&#125;]&quot;</span>, splitDocuments.size());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.</span></span><br><span class=\"line\">        vectorStore.add(splitDocuments);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;success&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/select&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">search</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;query&quot;)</span> String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query is  [&#123;&#125;]&quot;</span>, query);</span><br><span class=\"line\">        List&lt;Document&gt; results = vectorStore.similaritySearch(</span><br><span class=\"line\"><span class=\"comment\">//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()</span></span><br><span class=\"line\">                SearchRequest.builder().query(query).similarityThreshold(<span class=\"number\">0.1</span>).topK(<span class=\"number\">10</span>).build()</span><br><span class=\"line\"></span><br><span class=\"line\">        );</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;results is [&#123;&#125;]&quot;</span>, results);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> results.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/rewrite/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByRewrite</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1</span></span><br><span class=\"line\">        <span class=\"type\">QueryTransformer</span> <span class=\"variable\">queryTransformer</span> <span class=\"operator\">=</span> RewriteQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"comment\">// 2</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByTransform</span> <span class=\"operator\">=</span> queryTransformer.transform(<span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(inputMsg));</span><br><span class=\"line\">        <span class=\"comment\">// 3</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByTransform.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/history/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByHistory</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        List&lt;Message&gt; history = chatMemory.get(userId, CHAT_HISTORY_SIZE);</span><br><span class=\"line\">        <span class=\"comment\">// 2. </span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> Query.builder()</span><br><span class=\"line\">                .text(inputMsg)</span><br><span class=\"line\">                .history(history)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.  CompressionQueryTransformer</span></span><br><span class=\"line\">        <span class=\"type\">CompressionQueryTransformer</span> <span class=\"variable\">queryTransformerByHis</span> <span class=\"operator\">=</span> CompressionQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByHistory</span> <span class=\"operator\">=</span> queryTransformerByHis.transform(query);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByHistory.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<p><strong></strong></p>\n<p>kimi</p>\n<ul>\n<li><code></code></li>\n<li>3 <code></code>,<code></code>,<code></code></li>\n<li>20</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. </span><br><span class=\"line\">2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM</span><br><span class=\"line\">2. </span><br><span class=\"line\">(1):</span><br><span class=\"line\"></span><br><span class=\"line\">(2):</span><br><span class=\"line\"></span><br><span class=\"line\">(3):</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">3. </span><br><span class=\"line\">(1) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19853</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(2) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19907</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(3) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198211</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(4) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19884</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(5) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19809</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(6) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19931</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(7) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19875</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(8) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19918</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(9) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 197912</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(10) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19862</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(11) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19837</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(12) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19924</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(13) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198110</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(14) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19896</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(15) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198411</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(16) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19903</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(17) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19889</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(18) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19941</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(19) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19858</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(20) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19915</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/data/load</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/select</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/rag/chat</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/data/load\">http://127.0.0.1:8080/ai/v1/data/load</a></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429172724826.png\" alt=\"image-20250429172724826\"></p>\n<p><img src=\"/typora-user-images/image-20250429180401580.png\" alt=\"image-20250429180401580\"></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/select?query=%E5%8C%BB%E9%99%A2%E4%BB%8B%E7%BB%8D\">http://127.0.0.1:8080/ai/v1/select?query=</a></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429174959408.png\" alt=\"image-20250429174959408\"></p>\n<p>elasticsearch deepseek</p>\n<p>RAG+</p>\n<blockquote>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429174851066.png\" alt=\"image-20250429174851066\"></p>\n<p><img src=\"/typora-user-images/image-20250429175228086.png\" alt=\"image-20250429175228086\"></p>\n<p><img src=\"/typora-user-images/image-20250429175342611.png\" alt=\"image-20250429175342611\"></p>\n<p><img src=\"/typora-user-images/image-20250429175421998.png\" alt=\"image-20250429175421998\"></p>\n<p><img src=\"/typora-user-images/image-20250429175540574.png\" alt=\"image-20250429175540574\"></p>\n<h2 id=\"milvus-\"><a href=\"#milvus-\" class=\"headerlink\" title=\"milvus \"></a>milvus </h2><h3 id=\"Milvus\"><a href=\"#Milvus\" class=\"headerlink\" title=\"Milvus\"></a>Milvus</h3><p><strong>Docker-compose </strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  etcd </span></span><br><span class=\"line\">  <span class=\"attr\">etcd:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">quay.io/coreos/etcd:v3.5.16</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_MODE=revision</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_RETENTION=1000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_QUOTA_BACKEND_BYTES=4294967296</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_SNAPSHOT_COUNT=50000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/etcd:/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">etcd</span> <span class=\"string\">-advertise-client-urls=http://127.0.0.1:2379</span> <span class=\"string\">-listen-client-urls=http://0.0.0.0:2379</span> <span class=\"string\">--data-dir</span> <span class=\"string\">/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;etcdctl&quot;</span>, <span class=\"string\">&quot;endpoint&quot;</span>, <span class=\"string\">&quot;health&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\">  <span class=\"attr\">minio:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-minio</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">minio/minio:RELEASE.2023-03-20T20-16-18Z</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ACCESS_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_SECRET_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9001:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9000:9000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/minio:/minio_data</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">minio</span> <span class=\"string\">server</span> <span class=\"string\">/minio_data</span> <span class=\"string\">--console-address</span> <span class=\"string\">&quot;:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9000/minio/health/live&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.8</span>   </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">  <span class=\"attr\">standalone:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-standalone</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">milvusdb/milvus:v2.5.4</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;milvus&quot;</span>, <span class=\"string\">&quot;run&quot;</span>, <span class=\"string\">&quot;standalone&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">security_opt:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">seccomp:unconfined</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ETCD_ENDPOINTS:</span> <span class=\"string\">etcd:2379</span>  <span class=\"comment\"># etcd </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ADDRESS:</span> <span class=\"string\">minio:9000</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/milvus:/var/lib/milvus</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9091/healthz&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">start_period:</span> <span class=\"string\">90s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;19530:19530&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9091:9091&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;etcd&quot;</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;minio&quot;</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus Dashboard </span></span><br><span class=\"line\">  <span class=\"attr\">dashboard:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zilliz/attu:v2.5</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-dashboard</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MILVUS_URL:</span> <span class=\"string\">http://standalone:19530</span>  <span class=\"comment\"># Milvus </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;8000:3000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">standalone</span>  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">etcd</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">minio</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">      <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong>  <code>http://localhost:8000/</code><br></p>\n<p><img src=\"/typora-user-images/image-20250429181131778.png\" alt=\"image-20250429181131778\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250429181039571.png\" alt=\"image-20250429181039571\"></p>\n<p>&#96;&#96;milvus<code>,  </code>milvus-4321<code>(spring)</code>admin&#96;, </p>\n<p><img src=\"/typora-user-images/image-20250429181312813.png\" alt=\"image-20250429181312813\"></p>\n<p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-milvus-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">    <span class=\"attr\">uris:</span> <span class=\"string\">http://127.0.0.1:9200</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">milvus:</span></span><br><span class=\"line\">        <span class=\"attr\">client:</span></span><br><span class=\"line\">          <span class=\"attr\">host:</span> <span class=\"string\">&quot;localhost&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">port:</span> <span class=\"number\">19530</span></span><br><span class=\"line\">          <span class=\"attr\">username:</span> <span class=\"string\">&quot;milvus&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"string\">&quot;milvus-4321&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">databaseName:</span> <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">collectionName:</span> <span class=\"string\">&quot;vector_store&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">embeddingDimension:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">indexType:</span> <span class=\"string\">IVF_FLAT</span></span><br><span class=\"line\">        <span class=\"attr\">metricType:</span> <span class=\"string\">COSINE</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisMilvusAI</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250429183142516.png\" alt=\"image-20250429183142516\"></p>\n"},{"_content":"# Spring AI Alibaba-02-\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\n\n\n- ****IntelliJ IDEA\n- **JDK**17  IDEA  JDK\n- ****[](https://bailian.console.aliyun.com/) AI \n\n## \n\n\n\n**1ChatMemory** \n\n```java\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    /**\n     * \n     */\n    @Bean\n    public ChatMemory chatMemory() {\n        return new InMemoryChatMemory();\n    }\n}\n```\n\n**2ChatMemoryController**\n\nIDIDIDID\n\n~~~java\n//  chatClient.prompt() \nChatClient.CallResponseSpec response = chatClient.prompt()\n        //  .user(input) \n        .user(input)\n        //  .advisors  Lambda \n        .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                //  Lambda  .param  100\n                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n        //  .call() \n        .call();\n\n~~~\n\n\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatMemoryController {\n    private final ChatClient chatClient;\n\n    //  ChatModel AI  ChatMemory\n    public ChatMemoryController(ChatModel chatModel, ChatMemory chatMemory) {\n        //  ChatClient.Builder  ChatClient Advisor\n        this.chatClient = ChatClient.builder(chatModel)\n                .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory))\n                .build();\n    }\n\n    /**\n     * \n     * \n     */\n    @GetMapping(\"/multi/chat\")\n    public String chat(@RequestParam(value = \"userId\",defaultValue = \"10001\") String userId,\n                       @RequestParam(\"input\") String input) {\n        log.info(\"/multi/chat   input:  [{}]\", input);\n        //  chatClient.prompt() \n        ChatClient.CallResponseSpec response = chatClient.prompt()\n                //  .user(input) \n                .user(input)\n                //  .advisors  Lambda \n                .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                        //  Lambda  .param  100\n                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n                //  .call() \n                .call();\n        return response.content();\n    }\n}\n\n\n~~~\n\n\n\n\n\nhttp://127.0.0.1:8080/ai/v1/multi/chat\n\nuserId ID ID  ID \ninput\n\n\n\n\n\n![image-20250419181524113](typora-user-images/image-20250419181524113.png)\n\n\n\n![image-20250419181631076](typora-user-images/image-20250419181631076.png)\n\n\n\n**ID**\n\nID  lison002\n\n\n\n![image-20250419181745960](typora-user-images/image-20250419181745960.png)\n\nAI \n\n\n\n\n\n## -Redis\n\n\n\n****\n\n```\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n```\n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n    @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n Spring  Redis  ChatClient \n\n**ChatStorageMemoryController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatStorageMemoryController {\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private ChatMemory chatMemory;\n\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(value = \"/storage/chat\")\n    public String chat(@RequestParam String userId, @RequestParam String inputMsg) {\n\n        log.info(\"/redis/chat  userId: [{}],  input:  [{}]\", userId, inputMsg);\n\n        String text = chatClient.prompt()\n                .user(inputMsg)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory, userId, CHAT_HISTORY_SIZE))\n                .call()\n                .content();\n        log.info(\"text --> [{}]\", text);\n        return text;\n    }\n}\n\n~~~\n\n\n\n**application.yml**\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      password: xxxx\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n\n\n\n~~~\n\n\n\n****\n\nhttp://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=3\n\n****3\n\n![image-20250422114322913](typora-user-images/image-20250422114322913.png)\n\n****\n\n\n\n![image-20250422114422258](typora-user-images/image-20250422114422258.png)\n\n****\n\n![image-20250422114555482](typora-user-images/image-20250422114555482.png)\n\n\n\n **Redis **\n\n![image-20250422114642336](typora-user-images/image-20250422114642336.png)\n\n Redis ","source":"categories/Spring AI Alibaba/Spring AI Alibaba-02-.md","raw":"# Spring AI Alibaba-02-\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\n\n\n- ****IntelliJ IDEA\n- **JDK**17  IDEA  JDK\n- ****[](https://bailian.console.aliyun.com/) AI \n\n## \n\n\n\n**1ChatMemory** \n\n```java\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    /**\n     * \n     */\n    @Bean\n    public ChatMemory chatMemory() {\n        return new InMemoryChatMemory();\n    }\n}\n```\n\n**2ChatMemoryController**\n\nIDIDIDID\n\n~~~java\n//  chatClient.prompt() \nChatClient.CallResponseSpec response = chatClient.prompt()\n        //  .user(input) \n        .user(input)\n        //  .advisors  Lambda \n        .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                //  Lambda  .param  100\n                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n        //  .call() \n        .call();\n\n~~~\n\n\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatMemoryController {\n    private final ChatClient chatClient;\n\n    //  ChatModel AI  ChatMemory\n    public ChatMemoryController(ChatModel chatModel, ChatMemory chatMemory) {\n        //  ChatClient.Builder  ChatClient Advisor\n        this.chatClient = ChatClient.builder(chatModel)\n                .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory))\n                .build();\n    }\n\n    /**\n     * \n     * \n     */\n    @GetMapping(\"/multi/chat\")\n    public String chat(@RequestParam(value = \"userId\",defaultValue = \"10001\") String userId,\n                       @RequestParam(\"input\") String input) {\n        log.info(\"/multi/chat   input:  [{}]\", input);\n        //  chatClient.prompt() \n        ChatClient.CallResponseSpec response = chatClient.prompt()\n                //  .user(input) \n                .user(input)\n                //  .advisors  Lambda \n                .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                        //  Lambda  .param  100\n                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n                //  .call() \n                .call();\n        return response.content();\n    }\n}\n\n\n~~~\n\n\n\n\n\nhttp://127.0.0.1:8080/ai/v1/multi/chat\n\nuserId ID ID  ID \ninput\n\n\n\n\n\n![image-20250419181524113](typora-user-images/image-20250419181524113.png)\n\n\n\n![image-20250419181631076](typora-user-images/image-20250419181631076.png)\n\n\n\n**ID**\n\nID  lison002\n\n\n\n![image-20250419181745960](typora-user-images/image-20250419181745960.png)\n\nAI \n\n\n\n\n\n## -Redis\n\n\n\n****\n\n```\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n```\n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n    @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n Spring  Redis  ChatClient \n\n**ChatStorageMemoryController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatStorageMemoryController {\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private ChatMemory chatMemory;\n\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(value = \"/storage/chat\")\n    public String chat(@RequestParam String userId, @RequestParam String inputMsg) {\n\n        log.info(\"/redis/chat  userId: [{}],  input:  [{}]\", userId, inputMsg);\n\n        String text = chatClient.prompt()\n                .user(inputMsg)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory, userId, CHAT_HISTORY_SIZE))\n                .call()\n                .content();\n        log.info(\"text --> [{}]\", text);\n        return text;\n    }\n}\n\n~~~\n\n\n\n**application.yml**\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      password: xxxx\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n\n\n\n~~~\n\n\n\n****\n\nhttp://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=3\n\n****3\n\n![image-20250422114322913](typora-user-images/image-20250422114322913.png)\n\n****\n\n\n\n![image-20250422114422258](typora-user-images/image-20250422114422258.png)\n\n****\n\n![image-20250422114555482](typora-user-images/image-20250422114555482.png)\n\n\n\n **Redis **\n\n![image-20250422114642336](typora-user-images/image-20250422114642336.png)\n\n Redis ","date":"2025-06-04T10:12:41.879Z","updated":"2025-04-29T10:41:32.331Z","path":"categories/Spring AI Alibaba/Spring AI Alibaba-02-.html","title":"","comments":1,"layout":"page","_id":"cmbhsgz5p0006nffybn00cpd3","content":"<h1 id=\"Spring-AI-Alibaba-02-\"><a href=\"#Spring-AI-Alibaba-02-\" class=\"headerlink\" title=\"Spring AI Alibaba-02-\"></a>Spring AI Alibaba-02-</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p></p>\n<p></p>\n<ul>\n<li><strong></strong>IntelliJ IDEA</li>\n<li><strong>JDK</strong>17  IDEA  JDK</li>\n<li><strong></strong><a href=\"https://bailian.console.aliyun.com/\"></a> AI </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>1ChatMemory</strong> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2ChatMemoryController</strong></p>\n<p>IDIDIDID</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">        <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">        .user(input)</span><br><span class=\"line\">        <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">        .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">        <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">        .call();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  ChatModel AI  ChatMemory</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatMemoryController</span><span class=\"params\">(ChatModel chatModel, ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  ChatClient.Builder  ChatClient Advisor</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = ChatClient.builder(chatModel)</span><br><span class=\"line\">                .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory))</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/multi/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam(value = &quot;userId&quot;,defaultValue = &quot;10001&quot;)</span> String userId,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"meta\">@RequestParam(&quot;input&quot;)</span> String input)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/multi/chat   input:  [&#123;&#125;]&quot;</span>, input);</span><br><span class=\"line\">        <span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">        ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">                .user(input)</span><br><span class=\"line\">                <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">                .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                        <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">                <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">                .call();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response.content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><a href=\"http://127.0.0.1:8080/ai/v1/multi/chat%E3%80%82%E8%AF%A5%E6%8E%A5%E5%8F%A3%E6%8E%A5%E5%8F%97%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%9A\">http://127.0.0.1:8080/ai/v1/multi/chat</a></p>\n<p>userId ID ID  ID <br>input</p>\n<p><img src=\"/typora-user-images/image-20250419181524113.png\" alt=\"image-20250419181524113\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250419181631076.png\" alt=\"image-20250419181631076\"></p>\n<p><strong>ID</strong></p>\n<p>ID  lison002</p>\n<p><img src=\"/typora-user-images/image-20250419181745960.png\" alt=\"image-20250419181745960\"></p>\n<p>AI </p>\n<h2 id=\"-Redis\"><a href=\"#-Redis\" class=\"headerlink\" title=\"-Redis\"></a>-Redis</h2><p><strong></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Spring  Redis  ChatClient </p>\n<p><strong>ChatStorageMemoryController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/storage/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/redis/chat  userId: [&#123;&#125;],  input:  [&#123;&#125;]&quot;</span>, userId, inputMsg);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                .user(inputMsg)</span><br><span class=\"line\">                .advisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, userId, CHAT_HISTORY_SIZE))</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text --&gt; [&#123;&#125;]&quot;</span>, text);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>application.yml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<p><a href=\"http://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=%E4%B8%AD%E5%9B%BD%E8%BF%91%E4%BB%A33%E4%B8%AA%E5%90%8D%E4%BA%BA\">http://localhost:8080/ai/v1/storage/chat?userId=lison001&amp;inputMsg=3</a></p>\n<p>****3</p>\n<p><img src=\"/typora-user-images/image-20250422114322913.png\" alt=\"image-20250422114322913\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20250422114422258.png\" alt=\"image-20250422114422258\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20250422114555482.png\" alt=\"image-20250422114555482\"></p>\n<p> <strong>Redis </strong></p>\n<p><img src=\"/typora-user-images/image-20250422114642336.png\" alt=\"image-20250422114642336\"></p>\n<p> Redis </p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-02-\"><a href=\"#Spring-AI-Alibaba-02-\" class=\"headerlink\" title=\"Spring AI Alibaba-02-\"></a>Spring AI Alibaba-02-</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p></p>\n<p></p>\n<ul>\n<li><strong></strong>IntelliJ IDEA</li>\n<li><strong>JDK</strong>17  IDEA  JDK</li>\n<li><strong></strong><a href=\"https://bailian.console.aliyun.com/\"></a> AI </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>1ChatMemory</strong> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2ChatMemoryController</strong></p>\n<p>IDIDIDID</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">        <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">        .user(input)</span><br><span class=\"line\">        <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">        .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">        <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">        .call();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  ChatModel AI  ChatMemory</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatMemoryController</span><span class=\"params\">(ChatModel chatModel, ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  ChatClient.Builder  ChatClient Advisor</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = ChatClient.builder(chatModel)</span><br><span class=\"line\">                .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory))</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/multi/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam(value = &quot;userId&quot;,defaultValue = &quot;10001&quot;)</span> String userId,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"meta\">@RequestParam(&quot;input&quot;)</span> String input)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/multi/chat   input:  [&#123;&#125;]&quot;</span>, input);</span><br><span class=\"line\">        <span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">        ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">                .user(input)</span><br><span class=\"line\">                <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">                .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                        <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">                <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">                .call();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response.content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><a href=\"http://127.0.0.1:8080/ai/v1/multi/chat%E3%80%82%E8%AF%A5%E6%8E%A5%E5%8F%A3%E6%8E%A5%E5%8F%97%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%9A\">http://127.0.0.1:8080/ai/v1/multi/chat</a></p>\n<p>userId ID ID  ID <br>input</p>\n<p><img src=\"/typora-user-images/image-20250419181524113.png\" alt=\"image-20250419181524113\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250419181631076.png\" alt=\"image-20250419181631076\"></p>\n<p><strong>ID</strong></p>\n<p>ID  lison002</p>\n<p><img src=\"/typora-user-images/image-20250419181745960.png\" alt=\"image-20250419181745960\"></p>\n<p>AI </p>\n<h2 id=\"-Redis\"><a href=\"#-Redis\" class=\"headerlink\" title=\"-Redis\"></a>-Redis</h2><p><strong></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Spring  Redis  ChatClient </p>\n<p><strong>ChatStorageMemoryController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/storage/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/redis/chat  userId: [&#123;&#125;],  input:  [&#123;&#125;]&quot;</span>, userId, inputMsg);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                .user(inputMsg)</span><br><span class=\"line\">                .advisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, userId, CHAT_HISTORY_SIZE))</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text --&gt; [&#123;&#125;]&quot;</span>, text);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>application.yml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<p><a href=\"http://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=%E4%B8%AD%E5%9B%BD%E8%BF%91%E4%BB%A33%E4%B8%AA%E5%90%8D%E4%BA%BA\">http://localhost:8080/ai/v1/storage/chat?userId=lison001&amp;inputMsg=3</a></p>\n<p>****3</p>\n<p><img src=\"/typora-user-images/image-20250422114322913.png\" alt=\"image-20250422114322913\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20250422114422258.png\" alt=\"image-20250422114422258\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20250422114555482.png\" alt=\"image-20250422114555482\"></p>\n<p> <strong>Redis </strong></p>\n<p><img src=\"/typora-user-images/image-20250422114642336.png\" alt=\"image-20250422114642336\"></p>\n<p> Redis </p>\n"},{"_content":"# Spring AI Alibaba-01-SpringBootSpringAI Alibaba \n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\nSpring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI \n\n## \n\n:IntelliJ IDEA\n\nJDK17+, idea\n\nhttps://bailian.console.aliyun.com/\n\n\n\n## \n\n### IDEA demo\n\n\n\n![image-20250419091747915](typora-user-images/image-20250419091747915.png)\n\nweblambokjava17springboot3.4\n\n![image-20250419092017527](typora-user-images/image-20250419092017527.png)\n\n\n\n\n\n###  Pom\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.4</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>1.0.0-M3.1</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n~~~\n\n### **ChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatController {\n\n\n    private final ChatClient chatClient;\n\n    public ChatController(ChatClient.Builder chatClientBuilder) {\n        this.chatClient = chatClientBuilder\n                //  Chat Memory  Advisor\n                //  Chat Memory  ID Spring AI \n                .defaultAdvisors(\n                        new MessageChatMemoryAdvisor(new InMemoryChatMemory())\n                )\n                //  Logger  Advisor\n                .defaultAdvisors(\n                        new SimpleLoggerAdvisor()\n                )\n                //  ChatClient  ChatModel  Options \n                .defaultOptions(\n                        DashScopeChatOptions.builder()\n                                .withTopP(0.7)\n                                .build()\n                )\n                .build();\n    }\n\n    @GetMapping(\"/simple/chat\")\n    public String simpleChat(String query) {\n        log.info(\"query: {}\",query );\n        String text =  chatClient.prompt(query).call().content();\n        log.info(\"text: {}\",text );\n        return text;\n    }\n\n    @GetMapping(\"/chat\")\n    public String chat(String message) {\n\n        return this.chatClient.prompt()\n                .user(message)\n                .call()\n                .content();\n    }\n\n\n    @GetMapping(\"/hello\")\n    public String hello(String message) {\n\n        return \"Hello \" + message;\n    }\n\n}\n\n~~~\n\nspring-ai chat memory`chatClient`\n\n~~~java\nprivate ChatMemory chatMemory = new InMemoryChatMemory();                                            \n\npublic ChatController(ChatClient.Builder builder) {\n                                                   \n    this.chatClient = builder                                                                        \n            .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory, UUID.randomUUID().toString(), 10))\n            .build();                                                                                \n}\n\n~~~\n\nUUID ChatMemory\n\ntokentoken\n\n\n\n\n\n1. Spring AI Alibaba  Spring Boot 3.x JDK  17 \n2. spring-ai  Maven \n\n~~~xml\n<repositories>\n  <repository>\n    <id>spring-milestones</id>\n    <name>Spring Milestones</name>\n    <url>https://repo.spring.io/milestone</url>\n    <snapshots>\n      <enabled>false</enabled>\n    </snapshots>\n  </repository>\n</repositories>\n\n~~~\n\n\n\napplication.yml\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n~~~\n\n\n\n\n\n### \n\n\n\n\n\n~~~html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <script src=\"js/marked.min.js\"></script>\n    <title></title>\n    <style>\n        body {\n\n            background-color: #f8f9fa;\n            font-family: Arial, sans-serif;\n        }\n\n        .container {\n\n            margin: 50px auto;\n            width: 800px;\n            background-color: #fff;\n            padding: 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n        }\n\n        h1 {\n\n            text-align: center;\n            margin-bottom: 30px;\n        }\n\n        label {\n\n            display: block;\n            margin-bottom: 10px;\n            color: #333;\n        }\n\n        input[type=\"text\"] {\n\n            width: 85%;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n        }\n\n        input[type=\"submit\"] {\n\n            background-color: #2ecc71;\n            color: #fff;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 3px;\n            cursor: pointer;\n            width: 10%;\n        }\n\n        .chat-box {\n\n            width: 100%;\n            height: 500px;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            overflow-y: scroll;\n        }\n\n        .message {\n\n            margin-bottom: 10px;\n            padding: 10px;\n            background-color: #f1f1f1;\n            border-radius: 3px;\n        }\n\n        .user-message {\n\n            background-color: #2ecc71;\n            color: #fff;\n        }\n\n        .bot-message {\n\n            background-color: #e6aa6b;\n            color: #fff;\n        }\n\n        .loader {\n\n            text-align: center;\n        }\n\n        .loader::after {\n\n            content: \"\";\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            border: 2px solid #ccc;\n            border-top-color: #2ecc71;\n            animation: spin 1s infinite linear;\n        }\n\n        @keyframes spin {\n\n            to {\n\n                transform: rotate(360deg);\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"container\">\n    <h1>AI </h1>\n    <form id=\"form\" style=\"width: 47%;position: absolute;bottom: 150px;margin-left:15px\">\n        <input type=\"text\" id=\"message\" name=\"message\" placeholder=\"\">\n        <input type=\"submit\" value=\"\">\n    </form>\n    <br>\n    <div id=\"loader\" class=\"loader\" style=\"display: none;\"></div>\n    <div id=\"chat-box\" class=\"chat-box\"></div>\n</div>\n\n<script>\n    var loader = document.getElementById(\"loader\");\n\n    document.getElementById(\"form\").addEventListener(\"submit\", function(event) {\n\n        event.preventDefault();\n\n        var messageInput = document.getElementById(\"message\");\n        var message = messageInput.value;\n        messageInput.value = \"\";\n\n        var chatBox = document.getElementById(\"chat-box\");\n\n        var userMessage = document.createElement(\"div\");\n        userMessage.className = \"message\";\n        userMessage.textContent = \": \" + message;\n        chatBox.appendChild(userMessage);\n        chatBox.scrollTop = chatBox.scrollHeight;\n\n        loader.style.display = \"block\";\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", \"http://localhost:8080/ai/v1/chat?message=\" + encodeURIComponent(message), true);\n        xhr.onreadystatechange = function() {\n\n            if (xhr.readyState === 4) {\n\n                loader.style.display = \"none\";\n\n                if (xhr.status === 200) {\n\n                    var response = xhr.responseText;\n\n                    var botMessage = document.createElement(\"div\");\n                    botMessage.className = \"message bot-message\";\n\n                    var botMessageText = document.createElement(\"span\");\n                    botMessageText.className = \"message-text\";\n                    botMessage.appendChild(botMessageText);\n                    botMessageText.innerHTML = marked.marked(response);\n\n                    chatBox.appendChild(botMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else if (xhr.status === 400) {\n\n                    var error = JSON.parse(xhr.responseText);\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: \" + error.message;\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else {\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: Failed to connect to the backend service. Please make sure the backend service is running.\";\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                }\n            }\n        };\n\n        xhr.onloadstart = function() {\n\n            loader.style.display = \"block\";\n        };\n\n        xhr.onloadend = function() {\n\n            loader.style.display = \"none\";\n        };\n\n        xhr.send();\n    });\n</script>\n</body>\n</html>\n\n~~~\n\njs  `marked.min.js`\n\n [GitHub](https://github.com/cundream/marked) \n\n### APi\n\n[](https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1)\n\n\n\n![image-20250419102848756](typora-user-images/image-20250419102848756.png)\n\n\n\nKey\n\n![image-20250419105704031](typora-user-images/image-20250419105704031.png)\n\n\n\n## \n\nhttp://localhost:8080/chat.html\n\n\n\n\n\n![image-20250419113622811](typora-user-images/image-20250419113622811.png)\n\n\n\nhttp://localhost:8080/ai/v1/simple/chat?query=\n\n![image-20250419112758947](typora-user-images/image-20250419112758947.png)\n\n\n\n## \n\n\n\nSpringBootJavaer Spring AI AI\n\n- AI AI AI\n- Prompt\n- Tokentoken AI tokentokenAItoken\n-  (RAG)\n\ntoken\n\n\n\n\n\n# \n\nSpring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI ","source":"categories/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .md","raw":"# Spring AI Alibaba-01-SpringBootSpringAI Alibaba \n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\nSpring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI \n\n## \n\n:IntelliJ IDEA\n\nJDK17+, idea\n\nhttps://bailian.console.aliyun.com/\n\n\n\n## \n\n### IDEA demo\n\n\n\n![image-20250419091747915](typora-user-images/image-20250419091747915.png)\n\nweblambokjava17springboot3.4\n\n![image-20250419092017527](typora-user-images/image-20250419092017527.png)\n\n\n\n\n\n###  Pom\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.4</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>1.0.0-M3.1</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n~~~\n\n### **ChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatController {\n\n\n    private final ChatClient chatClient;\n\n    public ChatController(ChatClient.Builder chatClientBuilder) {\n        this.chatClient = chatClientBuilder\n                //  Chat Memory  Advisor\n                //  Chat Memory  ID Spring AI \n                .defaultAdvisors(\n                        new MessageChatMemoryAdvisor(new InMemoryChatMemory())\n                )\n                //  Logger  Advisor\n                .defaultAdvisors(\n                        new SimpleLoggerAdvisor()\n                )\n                //  ChatClient  ChatModel  Options \n                .defaultOptions(\n                        DashScopeChatOptions.builder()\n                                .withTopP(0.7)\n                                .build()\n                )\n                .build();\n    }\n\n    @GetMapping(\"/simple/chat\")\n    public String simpleChat(String query) {\n        log.info(\"query: {}\",query );\n        String text =  chatClient.prompt(query).call().content();\n        log.info(\"text: {}\",text );\n        return text;\n    }\n\n    @GetMapping(\"/chat\")\n    public String chat(String message) {\n\n        return this.chatClient.prompt()\n                .user(message)\n                .call()\n                .content();\n    }\n\n\n    @GetMapping(\"/hello\")\n    public String hello(String message) {\n\n        return \"Hello \" + message;\n    }\n\n}\n\n~~~\n\nspring-ai chat memory`chatClient`\n\n~~~java\nprivate ChatMemory chatMemory = new InMemoryChatMemory();                                            \n\npublic ChatController(ChatClient.Builder builder) {\n                                                   \n    this.chatClient = builder                                                                        \n            .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory, UUID.randomUUID().toString(), 10))\n            .build();                                                                                \n}\n\n~~~\n\nUUID ChatMemory\n\ntokentoken\n\n\n\n\n\n1. Spring AI Alibaba  Spring Boot 3.x JDK  17 \n2. spring-ai  Maven \n\n~~~xml\n<repositories>\n  <repository>\n    <id>spring-milestones</id>\n    <name>Spring Milestones</name>\n    <url>https://repo.spring.io/milestone</url>\n    <snapshots>\n      <enabled>false</enabled>\n    </snapshots>\n  </repository>\n</repositories>\n\n~~~\n\n\n\napplication.yml\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n~~~\n\n\n\n\n\n### \n\n\n\n\n\n~~~html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <script src=\"js/marked.min.js\"></script>\n    <title></title>\n    <style>\n        body {\n\n            background-color: #f8f9fa;\n            font-family: Arial, sans-serif;\n        }\n\n        .container {\n\n            margin: 50px auto;\n            width: 800px;\n            background-color: #fff;\n            padding: 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n        }\n\n        h1 {\n\n            text-align: center;\n            margin-bottom: 30px;\n        }\n\n        label {\n\n            display: block;\n            margin-bottom: 10px;\n            color: #333;\n        }\n\n        input[type=\"text\"] {\n\n            width: 85%;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n        }\n\n        input[type=\"submit\"] {\n\n            background-color: #2ecc71;\n            color: #fff;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 3px;\n            cursor: pointer;\n            width: 10%;\n        }\n\n        .chat-box {\n\n            width: 100%;\n            height: 500px;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            overflow-y: scroll;\n        }\n\n        .message {\n\n            margin-bottom: 10px;\n            padding: 10px;\n            background-color: #f1f1f1;\n            border-radius: 3px;\n        }\n\n        .user-message {\n\n            background-color: #2ecc71;\n            color: #fff;\n        }\n\n        .bot-message {\n\n            background-color: #e6aa6b;\n            color: #fff;\n        }\n\n        .loader {\n\n            text-align: center;\n        }\n\n        .loader::after {\n\n            content: \"\";\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            border: 2px solid #ccc;\n            border-top-color: #2ecc71;\n            animation: spin 1s infinite linear;\n        }\n\n        @keyframes spin {\n\n            to {\n\n                transform: rotate(360deg);\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"container\">\n    <h1>AI </h1>\n    <form id=\"form\" style=\"width: 47%;position: absolute;bottom: 150px;margin-left:15px\">\n        <input type=\"text\" id=\"message\" name=\"message\" placeholder=\"\">\n        <input type=\"submit\" value=\"\">\n    </form>\n    <br>\n    <div id=\"loader\" class=\"loader\" style=\"display: none;\"></div>\n    <div id=\"chat-box\" class=\"chat-box\"></div>\n</div>\n\n<script>\n    var loader = document.getElementById(\"loader\");\n\n    document.getElementById(\"form\").addEventListener(\"submit\", function(event) {\n\n        event.preventDefault();\n\n        var messageInput = document.getElementById(\"message\");\n        var message = messageInput.value;\n        messageInput.value = \"\";\n\n        var chatBox = document.getElementById(\"chat-box\");\n\n        var userMessage = document.createElement(\"div\");\n        userMessage.className = \"message\";\n        userMessage.textContent = \": \" + message;\n        chatBox.appendChild(userMessage);\n        chatBox.scrollTop = chatBox.scrollHeight;\n\n        loader.style.display = \"block\";\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", \"http://localhost:8080/ai/v1/chat?message=\" + encodeURIComponent(message), true);\n        xhr.onreadystatechange = function() {\n\n            if (xhr.readyState === 4) {\n\n                loader.style.display = \"none\";\n\n                if (xhr.status === 200) {\n\n                    var response = xhr.responseText;\n\n                    var botMessage = document.createElement(\"div\");\n                    botMessage.className = \"message bot-message\";\n\n                    var botMessageText = document.createElement(\"span\");\n                    botMessageText.className = \"message-text\";\n                    botMessage.appendChild(botMessageText);\n                    botMessageText.innerHTML = marked.marked(response);\n\n                    chatBox.appendChild(botMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else if (xhr.status === 400) {\n\n                    var error = JSON.parse(xhr.responseText);\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: \" + error.message;\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                } else {\n\n                    var errorMessage = document.createElement(\"div\");\n                    errorMessage.className = \"message bot-message\";\n                    errorMessage.textContent = \"Bot: Failed to connect to the backend service. Please make sure the backend service is running.\";\n                    chatBox.appendChild(errorMessage);\n                    chatBox.scrollTop = chatBox.scrollHeight;\n                }\n            }\n        };\n\n        xhr.onloadstart = function() {\n\n            loader.style.display = \"block\";\n        };\n\n        xhr.onloadend = function() {\n\n            loader.style.display = \"none\";\n        };\n\n        xhr.send();\n    });\n</script>\n</body>\n</html>\n\n~~~\n\njs  `marked.min.js`\n\n [GitHub](https://github.com/cundream/marked) \n\n### APi\n\n[](https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1)\n\n\n\n![image-20250419102848756](typora-user-images/image-20250419102848756.png)\n\n\n\nKey\n\n![image-20250419105704031](typora-user-images/image-20250419105704031.png)\n\n\n\n## \n\nhttp://localhost:8080/chat.html\n\n\n\n\n\n![image-20250419113622811](typora-user-images/image-20250419113622811.png)\n\n\n\nhttp://localhost:8080/ai/v1/simple/chat?query=\n\n![image-20250419112758947](typora-user-images/image-20250419112758947.png)\n\n\n\n## \n\n\n\nSpringBootJavaer Spring AI AI\n\n- AI AI AI\n- Prompt\n- Tokentoken AI tokentokenAItoken\n-  (RAG)\n\ntoken\n\n\n\n\n\n# \n\nSpring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI ","date":"2025-06-04T10:13:19.150Z","updated":"2025-04-19T09:56:27.668Z","path":"categories/Spring AI Alibaba-01-SpringBootSpringAI Alibaba .html","_id":"cmbhshry70007nffycp184m6m","title":"","comments":1,"layout":"page","content":"<h1 id=\"Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\"><a href=\"#Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\" class=\"headerlink\" title=\"Spring AI Alibaba-01-SpringBootSpringAI Alibaba \"></a>Spring AI Alibaba-01-SpringBootSpringAI Alibaba </h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p>Spring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:IntelliJ IDEA</p>\n<p>JDK17+, idea</p>\n<p><a href=\"https://bailian.console.aliyun.com/\">https://bailian.console.aliyun.com/</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"IDEA-demo\"><a href=\"#IDEA-demo\" class=\"headerlink\" title=\"IDEA demo\"></a>IDEA demo</h3><p><img src=\"/typora-user-images/image-20250419091747915.png\" alt=\"image-20250419091747915\"></p>\n<p>weblambokjava17springboot3.4</p>\n<p><img src=\"/typora-user-images/image-20250419092017527.png\" alt=\"image-20250419092017527\"></p>\n<h3 id=\"Pom\"><a href=\"#Pom\" class=\"headerlink\" title=\"Pom\"></a>Pom</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-M3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ChatController-java\"><a href=\"#ChatController-java\" class=\"headerlink\" title=\"ChatController.java\"></a><strong>ChatController.java</strong></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder chatClientBuilder)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = chatClientBuilder</span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  Advisor</span></span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  ID Spring AI </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>())</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  Logger  Advisor</span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleLoggerAdvisor</span>()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  ChatClient  ChatModel  Options </span></span><br><span class=\"line\">                .defaultOptions(</span><br><span class=\"line\">                        DashScopeChatOptions.builder()</span><br><span class=\"line\">                                .withTopP(<span class=\"number\">0.7</span>)</span><br><span class=\"line\">                                .build()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/simple/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">simpleChat</span><span class=\"params\">(String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query: &#123;&#125;&quot;</span>,query );</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span>  chatClient.prompt(query).call().content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text: &#123;&#125;&quot;</span>,text );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.chatClient.prompt()</span><br><span class=\"line\">                .user(message)</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">hello</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello &quot;</span> + message;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>spring-ai chat memory<code>chatClient</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">ChatMemory</span> <span class=\"variable\">chatMemory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();                                            </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder builder)</span> &#123;</span><br><span class=\"line\">                                                   </span><br><span class=\"line\">    <span class=\"built_in\">this</span>.chatClient = builder                                                                        </span><br><span class=\"line\">            .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, UUID.randomUUID().toString(), <span class=\"number\">10</span>))</span><br><span class=\"line\">            .build();                                                                                </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>UUID ChatMemory</p>\n<p>tokentoken</p>\n<p></p>\n<ol>\n<li>Spring AI Alibaba  Spring Boot 3.x JDK  17 </li>\n<li>spring-ai  Maven </li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/marked.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">body</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f8f9fa</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">font-family</span>: Arial, sans-serif;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.container</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">800px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">2px</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.1</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">h1</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">label</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;text&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">85%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;submit&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">cursor</span>: pointer;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">10%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.chat-box</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">500px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow-y</span>: scroll;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f1f1f1</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.user-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.bot-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#e6aa6b</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span><span class=\"selector-pseudo\">::after</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">content</span>: <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-top-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">animation</span>: spin <span class=\"number\">1s</span> infinite linear;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"keyword\">@keyframes</span> spin &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"selector-tag\">to</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">                <span class=\"attribute\">transform</span>: <span class=\"built_in\">rotate</span>(<span class=\"number\">360deg</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>AI <span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;form&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 47%;position: absolute;bottom: 150px;margin-left:15px&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: none;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;chat-box&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-box&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">var</span> loader = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;loader&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;form&quot;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;submit&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        event.<span class=\"title function_\">preventDefault</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> messageInput = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;message&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> message = messageInput.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        messageInput.<span class=\"property\">value</span> = <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> chatBox = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;chat-box&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> userMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;: &quot;</span> + message;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"title function_\">appendChild</span>(userMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;GET&quot;</span>, <span class=\"string\">&quot;http://localhost:8080/ai/v1/chat?message=&quot;</span> + <span class=\"built_in\">encodeURIComponent</span>(message), <span class=\"literal\">true</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> === <span class=\"number\">4</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">200</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> response = xhr.<span class=\"property\">responseText</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessageText = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;span&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">className</span> = <span class=\"string\">&quot;message-text&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"title function_\">appendChild</span>(botMessageText);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">innerHTML</span> = marked.<span class=\"title function_\">marked</span>(response);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(botMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">400</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> error = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(xhr.<span class=\"property\">responseText</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: &quot;</span> + error.<span class=\"property\">message</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: Failed to connect to the backend service. Please make sure the backend service is running.&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadstart</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadend</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">send</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>js  <code>marked.min.js</code></p>\n<p> <a href=\"https://github.com/cundream/marked\">GitHub</a> </p>\n<h3 id=\"APi\"><a href=\"#APi\" class=\"headerlink\" title=\"APi\"></a>APi</h3><p><a href=\"https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1\"></a></p>\n<p><img src=\"/typora-user-images/image-20250419102848756.png\" alt=\"image-20250419102848756\"></p>\n<p>Key</p>\n<p><img src=\"/typora-user-images/image-20250419105704031.png\" alt=\"image-20250419105704031\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"http://localhost:8080/chat.html\">http://localhost:8080/chat.html</a></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250419113622811.png\" alt=\"image-20250419113622811\"></p>\n<p></p>\n<p><a href=\"http://localhost:8080/ai/v1/simple/chat?query=%E4%BD%A0%E6%98%AF%E8%B0%81\">http://localhost:8080/ai/v1/simple/chat?query=</a></p>\n<p><img src=\"/typora-user-images/image-20250419112758947.png\" alt=\"image-20250419112758947\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>SpringBootJavaer Spring AI AI</p>\n<ul>\n<li>AI AI AI</li>\n<li>Prompt</li>\n<li>Tokentoken AI tokentokenAItoken</li>\n<li> (RAG)</li>\n</ul>\n<p>token</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>Spring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI </p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\"><a href=\"#Spring-AI-Alibaba-01-SpringBootSpringAI-Alibaba-\" class=\"headerlink\" title=\"Spring AI Alibaba-01-SpringBootSpringAI Alibaba \"></a>Spring AI Alibaba-01-SpringBootSpringAI Alibaba </h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p>Spring  Spring AI Spring AI  Spring AI Alibaba Alibaba  Javaer AI Spring AI Alibaba  AI </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:IntelliJ IDEA</p>\n<p>JDK17+, idea</p>\n<p><a href=\"https://bailian.console.aliyun.com/\">https://bailian.console.aliyun.com/</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"IDEA-demo\"><a href=\"#IDEA-demo\" class=\"headerlink\" title=\"IDEA demo\"></a>IDEA demo</h3><p><img src=\"/typora-user-images/image-20250419091747915.png\" alt=\"image-20250419091747915\"></p>\n<p>weblambokjava17springboot3.4</p>\n<p><img src=\"/typora-user-images/image-20250419092017527.png\" alt=\"image-20250419092017527\"></p>\n<h3 id=\"Pom\"><a href=\"#Pom\" class=\"headerlink\" title=\"Pom\"></a>Pom</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0-M3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ChatController-java\"><a href=\"#ChatController-java\" class=\"headerlink\" title=\"ChatController.java\"></a><strong>ChatController.java</strong></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder chatClientBuilder)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = chatClientBuilder</span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  Advisor</span></span><br><span class=\"line\">                <span class=\"comment\">//  Chat Memory  ID Spring AI </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>())</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  Logger  Advisor</span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleLoggerAdvisor</span>()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                <span class=\"comment\">//  ChatClient  ChatModel  Options </span></span><br><span class=\"line\">                .defaultOptions(</span><br><span class=\"line\">                        DashScopeChatOptions.builder()</span><br><span class=\"line\">                                .withTopP(<span class=\"number\">0.7</span>)</span><br><span class=\"line\">                                .build()</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/simple/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">simpleChat</span><span class=\"params\">(String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query: &#123;&#125;&quot;</span>,query );</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span>  chatClient.prompt(query).call().content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text: &#123;&#125;&quot;</span>,text );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.chatClient.prompt()</span><br><span class=\"line\">                .user(message)</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">hello</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello &quot;</span> + message;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>spring-ai chat memory<code>chatClient</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">ChatMemory</span> <span class=\"variable\">chatMemory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();                                            </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ChatController</span><span class=\"params\">(ChatClient.Builder builder)</span> &#123;</span><br><span class=\"line\">                                                   </span><br><span class=\"line\">    <span class=\"built_in\">this</span>.chatClient = builder                                                                        </span><br><span class=\"line\">            .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, UUID.randomUUID().toString(), <span class=\"number\">10</span>))</span><br><span class=\"line\">            .build();                                                                                </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>UUID ChatMemory</p>\n<p>tokentoken</p>\n<p></p>\n<ol>\n<li>Spring AI Alibaba  Spring Boot 3.x JDK  17 </li>\n<li>spring-ai  Maven </li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/marked.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">body</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f8f9fa</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">font-family</span>: Arial, sans-serif;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.container</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">50px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">800px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">2px</span> <span class=\"number\">5px</span> <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.1</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">h1</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">label</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#333</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;text&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">85%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">input</span><span class=\"selector-attr\">[type=<span class=\"string\">&quot;submit&quot;</span>]</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span> <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">cursor</span>: pointer;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">10%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.chat-box</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">500px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow-y</span>: scroll;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#f1f1f1</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.user-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.bot-message</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#e6aa6b</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">text-align</span>: center;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.loader</span><span class=\"selector-pseudo\">::after</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">content</span>: <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: inline-block;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> solid <span class=\"number\">#ccc</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-top-color</span>: <span class=\"number\">#2ecc71</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">animation</span>: spin <span class=\"number\">1s</span> infinite linear;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"keyword\">@keyframes</span> spin &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"selector-tag\">to</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">                <span class=\"attribute\">transform</span>: <span class=\"built_in\">rotate</span>(<span class=\"number\">360deg</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>AI <span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;form&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 47%;position: absolute;bottom: 150px;margin-left:15px&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;message&quot;</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;loader&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: none;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;chat-box&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;chat-box&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">var</span> loader = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;loader&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;form&quot;</span>).<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;submit&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">event</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        event.<span class=\"title function_\">preventDefault</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> messageInput = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;message&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> message = messageInput.<span class=\"property\">value</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        messageInput.<span class=\"property\">value</span> = <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> chatBox = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;chat-box&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> userMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        userMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;: &quot;</span> + message;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"title function_\">appendChild</span>(userMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&quot;GET&quot;</span>, <span class=\"string\">&quot;http://localhost:8080/ai/v1/chat?message=&quot;</span> + <span class=\"built_in\">encodeURIComponent</span>(message), <span class=\"literal\">true</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"keyword\">if</span> (xhr.<span class=\"property\">readyState</span> === <span class=\"number\">4</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">200</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> response = xhr.<span class=\"property\">responseText</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> botMessageText = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;span&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">className</span> = <span class=\"string\">&quot;message-text&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessage.<span class=\"title function_\">appendChild</span>(botMessageText);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    botMessageText.<span class=\"property\">innerHTML</span> = marked.<span class=\"title function_\">marked</span>(response);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(botMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (xhr.<span class=\"property\">status</span> === <span class=\"number\">400</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> error = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(xhr.<span class=\"property\">responseText</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: &quot;</span> + error.<span class=\"property\">message</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">var</span> errorMessage = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">className</span> = <span class=\"string\">&quot;message bot-message&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    errorMessage.<span class=\"property\">textContent</span> = <span class=\"string\">&quot;Bot: Failed to connect to the backend service. Please make sure the backend service is running.&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"title function_\">appendChild</span>(errorMessage);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    chatBox.<span class=\"property\">scrollTop</span> = chatBox.<span class=\"property\">scrollHeight</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadstart</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"property\">onloadend</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">            loader.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        xhr.<span class=\"title function_\">send</span>();</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>js  <code>marked.min.js</code></p>\n<p> <a href=\"https://github.com/cundream/marked\">GitHub</a> </p>\n<h3 id=\"APi\"><a href=\"#APi\" class=\"headerlink\" title=\"APi\"></a>APi</h3><p><a href=\"https://help.aliyun.com/zh/model-studio/first-api-call-to-qwen?spm=a2c4g.11186623.help-menu-2400256.d_0_0_1.7adc2562bAay6p&scm=20140722.H_2840915._.OR_help-T_cn~zh-V_1\"></a></p>\n<p><img src=\"/typora-user-images/image-20250419102848756.png\" alt=\"image-20250419102848756\"></p>\n<p>Key</p>\n<p><img src=\"/typora-user-images/image-20250419105704031.png\" alt=\"image-20250419105704031\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"http://localhost:8080/chat.html\">http://localhost:8080/chat.html</a></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250419113622811.png\" alt=\"image-20250419113622811\"></p>\n<p></p>\n<p><a href=\"http://localhost:8080/ai/v1/simple/chat?query=%E4%BD%A0%E6%98%AF%E8%B0%81\">http://localhost:8080/ai/v1/simple/chat?query=</a></p>\n<p><img src=\"/typora-user-images/image-20250419112758947.png\" alt=\"image-20250419112758947\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>SpringBootJavaer Spring AI AI</p>\n<ul>\n<li>AI AI AI</li>\n<li>Prompt</li>\n<li>Tokentoken AI tokentokenAItoken</li>\n<li> (RAG)</li>\n</ul>\n<p>token</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>Spring AIAIAPIAIJava AI (RAG)Java  Spring AI  AI </p>\n"},{"title":"categories","date":"2025-06-04T09:41:07.000Z","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n\n\n# Spring AI Agent \n\n\n\n\nAIAI  Agent Spring AI  Agent\n\nSpring AI \nSpring AI \nSpring AI  Spring Spring AI  Java  AI  AI Spring AI \n\n\nSpring AI Spring AI \n\n Spring  Spring \n\nAgent \nAgent \nAgent  Spring AI Agent \n\n\nAgent  Agent \n\n\n\n AI \n AI Agent Agent  Spring AI Agent  AI  AI \n\nSpring AI  Agent\n\n Spring AI Agent  Agent \n\n\nAgent  AI Agent \n\n\n Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent \n\nSpring AI Agent \n1.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n2.  Agent\nAgent \n\nAgent \nAgent \nAgent \n3.  Agent\nAgent \n\nAgent \nAgent \nAgent \n4.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n5.  Agent\nAgent \n\nAgent \nAgent \nAgent \n6.  Agent\nAgent \n\nAgent Agent \nAgent \nAgent \n7.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n8.  Agent\nAgent \n\nAgent \nAgent Agent \nAgent \nSpring AI Agent \nSpring AI  Agent Agent \n\nAgent \nAgent \nAgent \n Agent Agent \n\nSpring AI  Agent  Spring AI  Agent  Spring AI  Agent\n\n Spring AI  Agent  Agent  Agent  Agent \n\n\n\n# RAG  \n\nRAG\n1.1 RAG\nRAGRetrieval-Augmented GenerationRAG (LLM)\n\n1.2 RAG\nRAG2020RAGRAG\n\n1.3 RAG\nRAGRAG\n\nRAG\n2.1 \n2.1.1 \nRAGRAG\n\n2.1.2 \nRAGRAGRAG\n\n2.2 \n2.2.1 \nRAGRAG\n\n2.2.2 \nRAGRAG\n\n2.3 \n2.3.1 \nRAG\n\n2.3.2 \nRAGRAG\n\nRAG\n4.1 RAG\n4.1.1 \nRAGRAG\n\n4.1.2 \nRAGRAG\n\n4.1.3 \nRAGRAG\n\n4.2 RAG\n4.2.1 \nRAG\n\nRAG\n\n4.2.2 \nRAG\n\nRAG\n\n\nRAGRAG\n","source":"categories/Spring AI Agent.md","raw":"---\ntitle: categories\ndate: 2025-06-04 17:41:07\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n\n\n# Spring AI Agent \n\n\n\n\nAIAI  Agent Spring AI  Agent\n\nSpring AI \nSpring AI \nSpring AI  Spring Spring AI  Java  AI  AI Spring AI \n\n\nSpring AI Spring AI \n\n Spring  Spring \n\nAgent \nAgent \nAgent  Spring AI Agent \n\n\nAgent  Agent \n\n\n\n AI \n AI Agent Agent  Spring AI Agent  AI  AI \n\nSpring AI  Agent\n\n Spring AI Agent  Agent \n\n\nAgent  AI Agent \n\n\n Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent \n\nSpring AI Agent \n1.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n2.  Agent\nAgent \n\nAgent \nAgent \nAgent \n3.  Agent\nAgent \n\nAgent \nAgent \nAgent \n4.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n5.  Agent\nAgent \n\nAgent \nAgent \nAgent \n6.  Agent\nAgent \n\nAgent Agent \nAgent \nAgent \n7.  Agent\nAgent \n\nAgent \nAgent \nAgent Agent \n8.  Agent\nAgent \n\nAgent \nAgent Agent \nAgent \nSpring AI Agent \nSpring AI  Agent Agent \n\nAgent \nAgent \nAgent \n Agent Agent \n\nSpring AI  Agent  Spring AI  Agent  Spring AI  Agent\n\n Spring AI  Agent  Agent  Agent  Agent \n\n\n\n# RAG  \n\nRAG\n1.1 RAG\nRAGRetrieval-Augmented GenerationRAG (LLM)\n\n1.2 RAG\nRAG2020RAGRAG\n\n1.3 RAG\nRAGRAG\n\nRAG\n2.1 \n2.1.1 \nRAGRAG\n\n2.1.2 \nRAGRAGRAG\n\n2.2 \n2.2.1 \nRAGRAG\n\n2.2.2 \nRAGRAG\n\n2.3 \n2.3.1 \nRAG\n\n2.3.2 \nRAGRAG\n\nRAG\n4.1 RAG\n4.1.1 \nRAGRAG\n\n4.1.2 \nRAGRAG\n\n4.1.3 \nRAGRAG\n\n4.2 RAG\n4.2.1 \nRAG\n\nRAG\n\n4.2.2 \nRAG\n\nRAG\n\n\nRAGRAG\n","updated":"2025-06-04T10:31:14.977Z","path":"categories/Spring AI Agent.html","_id":"cmbhshry80008nffycyn0bxzm","comments":1,"layout":"page","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h1 id=\"Spring-AI-Agent-\"><a href=\"#Spring-AI-Agent-\" class=\"headerlink\" title=\"Spring AI Agent \"></a>Spring AI Agent </h1><p><br>AIAI  Agent Spring AI  Agent</p>\n<p>Spring AI <br>Spring AI <br>Spring AI  Spring Spring AI  Java  AI  AI Spring AI </p>\n<p><br>Spring AI Spring AI </p>\n<p> Spring  Spring </p>\n<p>Agent <br>Agent <br>Agent  Spring AI Agent </p>\n<p><br>Agent  Agent </p>\n<p></p>\n<p> AI <br> AI Agent Agent  Spring AI Agent  AI  AI </p>\n<p>Spring AI  Agent<br><br> Spring AI Agent  Agent </p>\n<p><br>Agent  AI Agent </p>\n<p><br> Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent </p>\n<p>Spring AI Agent </p>\n<ol>\n<li> Agent<br>Agent </li>\n</ol>\n<p>Agent <br>Agent <br>Agent Agent <br>2.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>3.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>4.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>5.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>6.  Agent<br>Agent </p>\n<p>Agent Agent <br>Agent <br>Agent <br>7.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>8.  Agent<br>Agent </p>\n<p>Agent <br>Agent Agent <br>Agent <br>Spring AI Agent <br>Spring AI  Agent Agent </p>\n<p>Agent <br>Agent <br>Agent <br> Agent Agent <br><br>Spring AI  Agent  Spring AI  Agent  Spring AI  Agent</p>\n<p> Spring AI  Agent  Agent  Agent  Agent </p>\n<h1 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h1><p>RAG<br>1.1 RAG<br>RAGRetrieval-Augmented GenerationRAG (LLM)</p>\n<p>1.2 RAG<br>RAG2020RAGRAG</p>\n<p>1.3 RAG<br>RAGRAG</p>\n<p>RAG<br>2.1 <br>2.1.1 <br>RAGRAG</p>\n<p>2.1.2 <br>RAGRAGRAG</p>\n<p>2.2 <br>2.2.1 <br>RAGRAG</p>\n<p>2.2.2 <br>RAGRAG</p>\n<p>2.3 <br>2.3.1 <br>RAG</p>\n<p>2.3.2 <br>RAGRAG</p>\n<p>RAG<br>4.1 RAG<br>4.1.1 <br>RAGRAG</p>\n<p>4.1.2 <br>RAGRAG</p>\n<p>4.1.3 <br>RAGRAG</p>\n<p>4.2 RAG<br>4.2.1 <br>RAG</p>\n<p>RAG</p>\n<p>4.2.2 <br>RAG</p>\n<p>RAG</p>\n<p><br>RAGRAG</p>\n","excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h1 id=\"Spring-AI-Agent-\"><a href=\"#Spring-AI-Agent-\" class=\"headerlink\" title=\"Spring AI Agent \"></a>Spring AI Agent </h1><p><br>AIAI  Agent Spring AI  Agent</p>\n<p>Spring AI <br>Spring AI <br>Spring AI  Spring Spring AI  Java  AI  AI Spring AI </p>\n<p><br>Spring AI Spring AI </p>\n<p> Spring  Spring </p>\n<p>Agent <br>Agent <br>Agent  Spring AI Agent </p>\n<p><br>Agent  Agent </p>\n<p></p>\n<p> AI <br> AI Agent Agent  Spring AI Agent  AI  AI </p>\n<p>Spring AI  Agent<br><br> Spring AI Agent  Agent </p>\n<p><br>Agent  AI Agent </p>\n<p><br> Spring AI  Agent  AI Spring AI  Agent  AI  TensorFlowPyTorch Agent </p>\n<p>Spring AI Agent </p>\n<ol>\n<li> Agent<br>Agent </li>\n</ol>\n<p>Agent <br>Agent <br>Agent Agent <br>2.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>3.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>4.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>5.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent <br>6.  Agent<br>Agent </p>\n<p>Agent Agent <br>Agent <br>Agent <br>7.  Agent<br>Agent </p>\n<p>Agent <br>Agent <br>Agent Agent <br>8.  Agent<br>Agent </p>\n<p>Agent <br>Agent Agent <br>Agent <br>Spring AI Agent <br>Spring AI  Agent Agent </p>\n<p>Agent <br>Agent <br>Agent <br> Agent Agent <br><br>Spring AI  Agent  Spring AI  Agent  Spring AI  Agent</p>\n<p> Spring AI  Agent  Agent  Agent  Agent </p>\n<h1 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h1><p>RAG<br>1.1 RAG<br>RAGRetrieval-Augmented GenerationRAG (LLM)</p>\n<p>1.2 RAG<br>RAG2020RAGRAG</p>\n<p>1.3 RAG<br>RAGRAG</p>\n<p>RAG<br>2.1 <br>2.1.1 <br>RAGRAG</p>\n<p>2.1.2 <br>RAGRAGRAG</p>\n<p>2.2 <br>2.2.1 <br>RAGRAG</p>\n<p>2.2.2 <br>RAGRAG</p>\n<p>2.3 <br>2.3.1 <br>RAG</p>\n<p>2.3.2 <br>RAGRAG</p>\n<p>RAG<br>4.1 RAG<br>4.1.1 <br>RAGRAG</p>\n<p>4.1.2 <br>RAGRAG</p>\n<p>4.1.3 <br>RAGRAG</p>\n<p>4.2 RAG<br>4.2.1 <br>RAG</p>\n<p>RAG</p>\n<p>4.2.2 <br>RAG</p>\n<p>RAG</p>\n<p><br>RAGRAG</p>\n"},{"_content":"# Spring AI Alibaba-00-Spring Ai Alibaba\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.12`\n\n\n\n[toc]\n\n\n\n## \n\n[Spring AI](https://docs.spring.io/spring-ai/reference/index.html)  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models\n\n\n\n\n\n##  Spring AI Alibaba\n\n\n\nSpring AI Alibaba  Spring AI  Java AI  AI API  AI \n\n![img](typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png)\n\nSpring AI Alibaba  AI  API API \n\n-  AI  Fluent API  ChatClient\n- \n- \n-  API API \n-  Structured Output AI  POJOs\n- \n-  Function Calling\n-  AI Agent \n-  RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve \n\n AI     \n\n\n\n## \n\n### Model\n\nAI \n\nAI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion\n\n\n\n![spring-ai-concepts-model-types](typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg)\n\nSpring AI Embedding Text AI Spring AI  Embedding \n\nGPT  GPT PChat Generative Pre-trained Transformer AI \n\n\n\n### Prompt\n\nPrompt  AI  ChatGPT Prompt  API AI Prompt \n\nChatGPT  API \n\n Prompt ChatGPT  SQL AI \n\nPrompt  Prompt  Prompt \n\n Prompt  Prompt  ChatGPT 3.5\n\n### Prompt Template\n\n Prompt  Prompt Spring AI  StringTemplate \n\n Prompt \n\n>Tell me a {adjective} joke about {content}.\n\n Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt \n\n Prompt Prompt \n\n\n\n### Embedding\n\nEmbeddingEmbedding VectorEmbedding \n\n\n\n![spring-ai-embeddings](typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg)\n\n Java \n\nEmbedding RAG\n\n\n\n### Token\n\ntoken  AI  token token \n\n token  75% 90  120  token\n\n![spring-ai-concepts-tokens](typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png)\n\n\n\n token =  AI  token  token \n\n token  API \n\nChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token \n\n GPT4 Spring AI \n\n### Structured Output\n\n JSON AI  `java.lang.String`  JSON JSON  Prompt   JSON  100% \n\n Prompt \n\n![](typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg)\n\n\n\n[]\n\n\n\n###  API  AI \n\n\n\nGPT 3.5/4.0  2021  9  650GB\n\n AI \n\n- `Fine Tuning`  GPT \n- `Prompt Stuffing` Spring AI  [ (RAG)]()\n\n![prompt-stuffing](typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg)\n\n- Function Calling APISpring AI  [] \n\n\n\n\n\n### RAG\n\n (RAG)  AI \n\n ETL RAG \n\n\n\n1. \n2.  AI  token \n\nRAG  AI  AI \n\n![Spring AI RAG](typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg)\n\n\n\n\n\n- [ETL ](https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html)  AI \n- [ChatClient - RAG] `QuestionAnswerAdvisor` Advisor  RAG \n\n### Function Calling\n\n (LLM) \n\n[Function Calling](https://docs.spring.io/spring-ai/reference/api/functions.html) API LLM \n\nSpring AI `@Bean` bean \n\n![Spring AI Function Calling](typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg)\n\n- 1`name``description``input parameters`\n- 2\n- 3Spring AI \n- 4\n- 5\n\n[](https://docs.spring.io/spring-ai/reference/api/functions.html) AI \n\n### Evaluation\n\n\n\nEvaluation  AI \n\n\n\nVector Database","source":"categories/Spring AI Alibaba-00-Spring Ai Alibaba.md","raw":"# Spring AI Alibaba-00-Spring Ai Alibaba\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.12`\n\n\n\n[toc]\n\n\n\n## \n\n[Spring AI](https://docs.spring.io/spring-ai/reference/index.html)  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models\n\n\n\n\n\n##  Spring AI Alibaba\n\n\n\nSpring AI Alibaba  Spring AI  Java AI  AI API  AI \n\n![img](typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png)\n\nSpring AI Alibaba  AI  API API \n\n-  AI  Fluent API  ChatClient\n- \n- \n-  API API \n-  Structured Output AI  POJOs\n- \n-  Function Calling\n-  AI Agent \n-  RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve \n\n AI     \n\n\n\n## \n\n### Model\n\nAI \n\nAI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion\n\n\n\n![spring-ai-concepts-model-types](typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg)\n\nSpring AI Embedding Text AI Spring AI  Embedding \n\nGPT  GPT PChat Generative Pre-trained Transformer AI \n\n\n\n### Prompt\n\nPrompt  AI  ChatGPT Prompt  API AI Prompt \n\nChatGPT  API \n\n Prompt ChatGPT  SQL AI \n\nPrompt  Prompt  Prompt \n\n Prompt  Prompt  ChatGPT 3.5\n\n### Prompt Template\n\n Prompt  Prompt Spring AI  StringTemplate \n\n Prompt \n\n>Tell me a {adjective} joke about {content}.\n\n Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt \n\n Prompt Prompt \n\n\n\n### Embedding\n\nEmbeddingEmbedding VectorEmbedding \n\n\n\n![spring-ai-embeddings](typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg)\n\n Java \n\nEmbedding RAG\n\n\n\n### Token\n\ntoken  AI  token token \n\n token  75% 90  120  token\n\n![spring-ai-concepts-tokens](typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png)\n\n\n\n token =  AI  token  token \n\n token  API \n\nChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token \n\n GPT4 Spring AI \n\n### Structured Output\n\n JSON AI  `java.lang.String`  JSON JSON  Prompt   JSON  100% \n\n Prompt \n\n![](typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg)\n\n\n\n[]\n\n\n\n###  API  AI \n\n\n\nGPT 3.5/4.0  2021  9  650GB\n\n AI \n\n- `Fine Tuning`  GPT \n- `Prompt Stuffing` Spring AI  [ (RAG)]()\n\n![prompt-stuffing](typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg)\n\n- Function Calling APISpring AI  [] \n\n\n\n\n\n### RAG\n\n (RAG)  AI \n\n ETL RAG \n\n\n\n1. \n2.  AI  token \n\nRAG  AI  AI \n\n![Spring AI RAG](typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg)\n\n\n\n\n\n- [ETL ](https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html)  AI \n- [ChatClient - RAG] `QuestionAnswerAdvisor` Advisor  RAG \n\n### Function Calling\n\n (LLM) \n\n[Function Calling](https://docs.spring.io/spring-ai/reference/api/functions.html) API LLM \n\nSpring AI `@Bean` bean \n\n![Spring AI Function Calling](typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg)\n\n- 1`name``description``input parameters`\n- 2\n- 3Spring AI \n- 4\n- 5\n\n[](https://docs.spring.io/spring-ai/reference/api/functions.html) AI \n\n### Evaluation\n\n\n\nEvaluation  AI \n\n\n\nVector Database","date":"2025-06-04T10:13:19.149Z","updated":"2025-04-19T09:56:16.496Z","path":"categories/Spring AI Alibaba-00-Spring Ai Alibaba.html","_id":"cmbhshry90009nffy4z0c7zzy","title":"","comments":1,"layout":"page","content":"<h1 id=\"Spring-AI-Alibaba-00-Spring-Ai-Alibaba\"><a href=\"#Spring-AI-Alibaba-00-Spring-Ai-Alibaba\" class=\"headerlink\" title=\"Spring AI Alibaba-00-Spring Ai Alibaba\"></a>Spring AI Alibaba-00-Spring Ai Alibaba</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.12</code></p>\n<p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://docs.spring.io/spring-ai/reference/index.html\">Spring AI</a>  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models</p>\n<h2 id=\"-Spring-AI-Alibaba\"><a href=\"#-Spring-AI-Alibaba\" class=\"headerlink\" title=\" Spring AI Alibaba\"></a> Spring AI Alibaba</h2><p>Spring AI Alibaba  Spring AI  Java AI  AI API  AI </p>\n<p><img src=\"/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png\" alt=\"img\"></p>\n<p>Spring AI Alibaba  AI  API API </p>\n<ul>\n<li> AI  Fluent API  ChatClient</li>\n<li></li>\n<li></li>\n<li> API API </li>\n<li> Structured Output AI  POJOs</li>\n<li></li>\n<li> Function Calling</li>\n<li> AI Agent </li>\n<li> RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve </li>\n</ul>\n<p> AI     </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h3><p>AI </p>\n<p>AI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion</p>\n<p><img src=\"/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg\" alt=\"spring-ai-concepts-model-types\"></p>\n<p>Spring AI Embedding Text AI Spring AI  Embedding </p>\n<p>GPT  GPT PChat Generative Pre-trained Transformer AI </p>\n<h3 id=\"Prompt\"><a href=\"#Prompt\" class=\"headerlink\" title=\"Prompt\"></a>Prompt</h3><p>Prompt  AI  ChatGPT Prompt  API AI Prompt </p>\n<p>ChatGPT  API </p>\n<p> Prompt ChatGPT  SQL AI </p>\n<p>Prompt  Prompt  Prompt </p>\n<p> Prompt  Prompt  ChatGPT 3.5</p>\n<h3 id=\"Prompt-Template\"><a href=\"#Prompt-Template\" class=\"headerlink\" title=\"Prompt Template\"></a>Prompt Template</h3><p> Prompt  Prompt Spring AI  StringTemplate </p>\n<p> Prompt </p>\n<blockquote>\n<p>Tell me a {adjective} joke about {content}.</p>\n</blockquote>\n<p> Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt </p>\n<p> Prompt Prompt </p>\n<h3 id=\"Embedding\"><a href=\"#Embedding\" class=\"headerlink\" title=\"Embedding\"></a>Embedding</h3><p>EmbeddingEmbedding VectorEmbedding </p>\n<p></p>\n<p><img src=\"/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg\" alt=\"spring-ai-embeddings\"></p>\n<p> Java </p>\n<p>Embedding RAG</p>\n<p></p>\n<h3 id=\"Token\"><a href=\"#Token\" class=\"headerlink\" title=\"Token\"></a>Token</h3><p>token  AI  token token </p>\n<p> token  75% 90  120  token</p>\n<p><img src=\"/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png\" alt=\"spring-ai-concepts-tokens\"></p>\n<p> token &#x3D;  AI  token  token </p>\n<p> token  API </p>\n<p>ChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token </p>\n<p> GPT4 Spring AI </p>\n<h3 id=\"Structured-Output\"><a href=\"#Structured-Output\" class=\"headerlink\" title=\"Structured Output\"></a>Structured Output</h3><p> JSON AI  <code>java.lang.String</code>  JSON JSON  Prompt   JSON  100% </p>\n<p> Prompt </p>\n<p><img src=\"/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg\" alt=\"\"></p>\n<p>[]</p>\n<h3 id=\"-API--AI-\"><a href=\"#-API--AI-\" class=\"headerlink\" title=\" API  AI \"></a> API  AI </h3><p></p>\n<p>GPT 3.5&#x2F;4.0  2021  9  650GB</p>\n<p> AI </p>\n<ul>\n<li><code>Fine Tuning</code>  GPT </li>\n<li><code>Prompt Stuffing</code> Spring AI  <a href=\"\"> (RAG)</a></li>\n</ul>\n<p><img src=\"/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg\" alt=\"prompt-stuffing\"></p>\n<ul>\n<li>Function Calling APISpring AI  [] </li>\n</ul>\n<h3 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h3><p> (RAG)  AI </p>\n<p> ETL RAG </p>\n<p></p>\n<ol>\n<li></li>\n<li> AI  token </li>\n</ol>\n<p>RAG  AI  AI </p>\n<p><img src=\"/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg\" alt=\"Spring AI RAG\"></p>\n<ul>\n<li><a href=\"https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html\">ETL </a>  AI </li>\n<li>[ChatClient - RAG] <code>QuestionAnswerAdvisor</code> Advisor  RAG </li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a>Function Calling</h3><p> (LLM) </p>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\">Function Calling</a> API LLM </p>\n<p>Spring AI <code>@Bean</code> bean </p>\n<p><img src=\"/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg\" alt=\"Spring AI Function Calling\"></p>\n<ul>\n<li>1<code>name</code><code>description</code><code>input parameters</code></li>\n<li>2</li>\n<li>3Spring AI </li>\n<li>4</li>\n<li>5</li>\n</ul>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\"></a> AI </p>\n<h3 id=\"Evaluation\"><a href=\"#Evaluation\" class=\"headerlink\" title=\"Evaluation\"></a>Evaluation</h3><p></p>\n<p>Evaluation  AI </p>\n<p></p>\n<p>Vector Database</p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-00-Spring-Ai-Alibaba\"><a href=\"#Spring-AI-Alibaba-00-Spring-Ai-Alibaba\" class=\"headerlink\" title=\"Spring AI Alibaba-00-Spring Ai Alibaba\"></a>Spring AI Alibaba-00-Spring Ai Alibaba</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.12</code></p>\n<p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://docs.spring.io/spring-ai/reference/index.html\">Spring AI</a>  Spring  AI AI Python  LangChain  LlamaIndex Spring AI  AI  Python Spring AI  AI Connecting your enterprise Data and APIs with the AI Models</p>\n<h2 id=\"-Spring-AI-Alibaba\"><a href=\"#-Spring-AI-Alibaba\" class=\"headerlink\" title=\" Spring AI Alibaba\"></a> Spring AI Alibaba</h2><p>Spring AI Alibaba  Spring AI  Java AI  AI API  AI </p>\n<p><img src=\"/typora-user-images/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png\" alt=\"img\"></p>\n<p>Spring AI Alibaba  AI  API API </p>\n<ul>\n<li> AI  Fluent API  ChatClient</li>\n<li></li>\n<li></li>\n<li> API API </li>\n<li> Structured Output AI  POJOs</li>\n<li></li>\n<li> Function Calling</li>\n<li> AI Agent </li>\n<li> RAG  DocumentReaderSplitterEmbeddingVectorStore  Retrieve </li>\n</ul>\n<p> AI     </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h3><p>AI </p>\n<p>AI  ChatGPT  AI  ChatGPT  Midjourney  Stable Diffusion</p>\n<p><img src=\"/typora-user-images/O1CN01otCVsl22MbQzFKYzJ_!!6000000007106-0-tps-2472-1618.jpg\" alt=\"spring-ai-concepts-model-types\"></p>\n<p>Spring AI Embedding Text AI Spring AI  Embedding </p>\n<p>GPT  GPT PChat Generative Pre-trained Transformer AI </p>\n<h3 id=\"Prompt\"><a href=\"#Prompt\" class=\"headerlink\" title=\"Prompt\"></a>Prompt</h3><p>Prompt  AI  ChatGPT Prompt  API AI Prompt </p>\n<p>ChatGPT  API </p>\n<p> Prompt ChatGPT  SQL AI </p>\n<p>Prompt  Prompt  Prompt </p>\n<p> Prompt  Prompt  ChatGPT 3.5</p>\n<h3 id=\"Prompt-Template\"><a href=\"#Prompt-Template\" class=\"headerlink\" title=\"Prompt Template\"></a>Prompt Template</h3><p> Prompt  Prompt Spring AI  StringTemplate </p>\n<p> Prompt </p>\n<blockquote>\n<p>Tell me a {adjective} joke about {content}.</p>\n</blockquote>\n<p> Spring AI Prompt  Spring MVC  java.util.Map Template AI  Prompt </p>\n<p> Prompt Prompt </p>\n<h3 id=\"Embedding\"><a href=\"#Embedding\" class=\"headerlink\" title=\"Embedding\"></a>Embedding</h3><p>EmbeddingEmbedding VectorEmbedding </p>\n<p></p>\n<p><img src=\"/typora-user-images/O1CN01EnE3i61j2vin5eTGV_!!6000000004491-0-tps-3518-1136.jpg\" alt=\"spring-ai-embeddings\"></p>\n<p> Java </p>\n<p>Embedding RAG</p>\n<p></p>\n<h3 id=\"Token\"><a href=\"#Token\" class=\"headerlink\" title=\"Token\"></a>Token</h3><p>token  AI  token token </p>\n<p> token  75% 90  120  token</p>\n<p><img src=\"/typora-user-images/O1CN01ciNztT1nJCFhQodzH_!!6000000005068-2-tps-1345-246.png\" alt=\"spring-ai-concepts-tokens\"></p>\n<p> token &#x3D;  AI  token  token </p>\n<p> token  API </p>\n<p>ChatGPT3  token  4K GPT4  8K16K  32KAnthropic  Claude AI  token  100K Meta  1M token </p>\n<p> GPT4 Spring AI </p>\n<h3 id=\"Structured-Output\"><a href=\"#Structured-Output\" class=\"headerlink\" title=\"Structured Output\"></a>Structured Output</h3><p> JSON AI  <code>java.lang.String</code>  JSON JSON  Prompt   JSON  100% </p>\n<p> Prompt </p>\n<p><img src=\"/typora-user-images/O1CN01lqCPAC1Xbwc1MfYv7_!!6000000002943-0-tps-2809-1423.jpg\" alt=\"\"></p>\n<p>[]</p>\n<h3 id=\"-API--AI-\"><a href=\"#-API--AI-\" class=\"headerlink\" title=\" API  AI \"></a> API  AI </h3><p></p>\n<p>GPT 3.5&#x2F;4.0  2021  9  650GB</p>\n<p> AI </p>\n<ul>\n<li><code>Fine Tuning</code>  GPT </li>\n<li><code>Prompt Stuffing</code> Spring AI  <a href=\"\"> (RAG)</a></li>\n</ul>\n<p><img src=\"/typora-user-images/O1CN01hRUT291k1O09cdQEU_!!6000000004623-0-tps-3249-1230.jpg\" alt=\"prompt-stuffing\"></p>\n<ul>\n<li>Function Calling APISpring AI  [] </li>\n</ul>\n<h3 id=\"RAG\"><a href=\"#RAG\" class=\"headerlink\" title=\"RAG\"></a>RAG</h3><p> (RAG)  AI </p>\n<p> ETL RAG </p>\n<p></p>\n<ol>\n<li></li>\n<li> AI  token </li>\n</ol>\n<p>RAG  AI  AI </p>\n<p><img src=\"/typora-user-images/O1CN01zEQSHu1sQ8KTQSA2E_!!6000000005760-0-tps-3360-1859.jpg\" alt=\"Spring AI RAG\"></p>\n<ul>\n<li><a href=\"https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html\">ETL </a>  AI </li>\n<li>[ChatClient - RAG] <code>QuestionAnswerAdvisor</code> Advisor  RAG </li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a>Function Calling</h3><p> (LLM) </p>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\">Function Calling</a> API LLM </p>\n<p>Spring AI <code>@Bean</code> bean </p>\n<p><img src=\"/typora-user-images/O1CN01kiQh6L1hnWmm5gCAW_!!6000000004322-0-tps-3400-1838.jpg\" alt=\"Spring AI Function Calling\"></p>\n<ul>\n<li>1<code>name</code><code>description</code><code>input parameters</code></li>\n<li>2</li>\n<li>3Spring AI </li>\n<li>4</li>\n<li>5</li>\n</ul>\n<p><a href=\"https://docs.spring.io/spring-ai/reference/api/functions.html\"></a> AI </p>\n<h3 id=\"Evaluation\"><a href=\"#Evaluation\" class=\"headerlink\" title=\"Evaluation\"></a>Evaluation</h3><p></p>\n<p>Evaluation  AI </p>\n<p></p>\n<p>Vector Database</p>\n"},{"_content":"# Spring AI Alibaba-02-\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\n\n\n- ****IntelliJ IDEA\n- **JDK**17  IDEA  JDK\n- ****[](https://bailian.console.aliyun.com/) AI \n\n## \n\n\n\n**1ChatMemory** \n\n```java\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    /**\n     * \n     */\n    @Bean\n    public ChatMemory chatMemory() {\n        return new InMemoryChatMemory();\n    }\n}\n```\n\n**2ChatMemoryController**\n\nIDIDIDID\n\n~~~java\n//  chatClient.prompt() \nChatClient.CallResponseSpec response = chatClient.prompt()\n        //  .user(input) \n        .user(input)\n        //  .advisors  Lambda \n        .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                //  Lambda  .param  100\n                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n        //  .call() \n        .call();\n\n~~~\n\n\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatMemoryController {\n    private final ChatClient chatClient;\n\n    //  ChatModel AI  ChatMemory\n    public ChatMemoryController(ChatModel chatModel, ChatMemory chatMemory) {\n        //  ChatClient.Builder  ChatClient Advisor\n        this.chatClient = ChatClient.builder(chatModel)\n                .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory))\n                .build();\n    }\n\n    /**\n     * \n     * \n     */\n    @GetMapping(\"/multi/chat\")\n    public String chat(@RequestParam(value = \"userId\",defaultValue = \"10001\") String userId,\n                       @RequestParam(\"input\") String input) {\n        log.info(\"/multi/chat   input:  [{}]\", input);\n        //  chatClient.prompt() \n        ChatClient.CallResponseSpec response = chatClient.prompt()\n                //  .user(input) \n                .user(input)\n                //  .advisors  Lambda \n                .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                        //  Lambda  .param  100\n                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n                //  .call() \n                .call();\n        return response.content();\n    }\n}\n\n\n~~~\n\n\n\n\n\nhttp://127.0.0.1:8080/ai/v1/multi/chat\n\nuserId ID ID  ID \ninput\n\n\n\n\n\n![image-20250419181524113](typora-user-images/image-20250419181524113.png)\n\n\n\n![image-20250419181631076](typora-user-images/image-20250419181631076.png)\n\n\n\n**ID**\n\nID  lison002\n\n\n\n![image-20250419181745960](typora-user-images/image-20250419181745960.png)\n\nAI \n\n\n\n\n\n## -Redis\n\n\n\n****\n\n```\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n```\n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n    @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n Spring  Redis  ChatClient \n\n**ChatStorageMemoryController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatStorageMemoryController {\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private ChatMemory chatMemory;\n\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(value = \"/storage/chat\")\n    public String chat(@RequestParam String userId, @RequestParam String inputMsg) {\n\n        log.info(\"/redis/chat  userId: [{}],  input:  [{}]\", userId, inputMsg);\n\n        String text = chatClient.prompt()\n                .user(inputMsg)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory, userId, CHAT_HISTORY_SIZE))\n                .call()\n                .content();\n        log.info(\"text --> [{}]\", text);\n        return text;\n    }\n}\n\n~~~\n\n\n\n**application.yml**\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      password: xxxx\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n\n\n\n~~~\n\n\n\n****\n\nhttp://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=3\n\n****3\n\n![image-20250422114322913](typora-user-images/image-20250422114322913.png)\n\n****\n\n\n\n![image-20250422114422258](typora-user-images/image-20250422114422258.png)\n\n****\n\n![image-20250422114555482](typora-user-images/image-20250422114555482.png)\n\n\n\n **Redis **\n\n![image-20250422114642336](typora-user-images/image-20250422114642336.png)\n\n Redis ","source":"categories/Spring AI Alibaba-02-.md","raw":"# Spring AI Alibaba-02-\n\n\n\n`Lison `  `<dreamlison@163.com>`,  `v1.0.0`, `2025.04.19`\n\n[toc]\n\n\n\n\n\n- ****IntelliJ IDEA\n- **JDK**17  IDEA  JDK\n- ****[](https://bailian.console.aliyun.com/) AI \n\n## \n\n\n\n**1ChatMemory** \n\n```java\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    /**\n     * \n     */\n    @Bean\n    public ChatMemory chatMemory() {\n        return new InMemoryChatMemory();\n    }\n}\n```\n\n**2ChatMemoryController**\n\nIDIDIDID\n\n~~~java\n//  chatClient.prompt() \nChatClient.CallResponseSpec response = chatClient.prompt()\n        //  .user(input) \n        .user(input)\n        //  .advisors  Lambda \n        .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                //  Lambda  .param  100\n                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n        //  .call() \n        .call();\n\n~~~\n\n\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatMemoryController {\n    private final ChatClient chatClient;\n\n    //  ChatModel AI  ChatMemory\n    public ChatMemoryController(ChatModel chatModel, ChatMemory chatMemory) {\n        //  ChatClient.Builder  ChatClient Advisor\n        this.chatClient = ChatClient.builder(chatModel)\n                .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory))\n                .build();\n    }\n\n    /**\n     * \n     * \n     */\n    @GetMapping(\"/multi/chat\")\n    public String chat(@RequestParam(value = \"userId\",defaultValue = \"10001\") String userId,\n                       @RequestParam(\"input\") String input) {\n        log.info(\"/multi/chat   input:  [{}]\", input);\n        //  chatClient.prompt() \n        ChatClient.CallResponseSpec response = chatClient.prompt()\n                //  .user(input) \n                .user(input)\n                //  .advisors  Lambda \n                .advisors(spec -> spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)\n                        //  Lambda  .param  100\n                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100))\n                //  .call() \n                .call();\n        return response.content();\n    }\n}\n\n\n~~~\n\n\n\n\n\nhttp://127.0.0.1:8080/ai/v1/multi/chat\n\nuserId ID ID  ID \ninput\n\n\n\n\n\n![image-20250419181524113](typora-user-images/image-20250419181524113.png)\n\n\n\n![image-20250419181631076](typora-user-images/image-20250419181631076.png)\n\n\n\n**ID**\n\nID  lison002\n\n\n\n![image-20250419181745960](typora-user-images/image-20250419181745960.png)\n\nAI \n\n\n\n\n\n## -Redis\n\n\n\n****\n\n```\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n```\n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n    @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n Spring  Redis  ChatClient \n\n**ChatStorageMemoryController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class ChatStorageMemoryController {\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private ChatMemory chatMemory;\n\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(value = \"/storage/chat\")\n    public String chat(@RequestParam String userId, @RequestParam String inputMsg) {\n\n        log.info(\"/redis/chat  userId: [{}],  input:  [{}]\", userId, inputMsg);\n\n        String text = chatClient.prompt()\n                .user(inputMsg)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory, userId, CHAT_HISTORY_SIZE))\n                .call()\n                .content();\n        log.info(\"text --> [{}]\", text);\n        return text;\n    }\n}\n\n~~~\n\n\n\n**application.yml**\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      password: xxxx\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n\n\n\n~~~\n\n\n\n****\n\nhttp://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=3\n\n****3\n\n![image-20250422114322913](typora-user-images/image-20250422114322913.png)\n\n****\n\n\n\n![image-20250422114422258](typora-user-images/image-20250422114422258.png)\n\n****\n\n![image-20250422114555482](typora-user-images/image-20250422114555482.png)\n\n\n\n **Redis **\n\n![image-20250422114642336](typora-user-images/image-20250422114642336.png)\n\n Redis ","date":"2025-06-04T10:13:19.150Z","updated":"2025-04-29T10:41:32.331Z","path":"categories/Spring AI Alibaba-02-.html","_id":"cmbhshrya000anffy4ss6czdc","title":"","comments":1,"layout":"page","content":"<h1 id=\"Spring-AI-Alibaba-02-\"><a href=\"#Spring-AI-Alibaba-02-\" class=\"headerlink\" title=\"Spring AI Alibaba-02-\"></a>Spring AI Alibaba-02-</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p></p>\n<p></p>\n<ul>\n<li><strong></strong>IntelliJ IDEA</li>\n<li><strong>JDK</strong>17  IDEA  JDK</li>\n<li><strong></strong><a href=\"https://bailian.console.aliyun.com/\"></a> AI </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>1ChatMemory</strong> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2ChatMemoryController</strong></p>\n<p>IDIDIDID</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">        <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">        .user(input)</span><br><span class=\"line\">        <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">        .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">        <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">        .call();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  ChatModel AI  ChatMemory</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatMemoryController</span><span class=\"params\">(ChatModel chatModel, ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  ChatClient.Builder  ChatClient Advisor</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = ChatClient.builder(chatModel)</span><br><span class=\"line\">                .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory))</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/multi/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam(value = &quot;userId&quot;,defaultValue = &quot;10001&quot;)</span> String userId,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"meta\">@RequestParam(&quot;input&quot;)</span> String input)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/multi/chat   input:  [&#123;&#125;]&quot;</span>, input);</span><br><span class=\"line\">        <span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">        ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">                .user(input)</span><br><span class=\"line\">                <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">                .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                        <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">                <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">                .call();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response.content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><a href=\"http://127.0.0.1:8080/ai/v1/multi/chat%E3%80%82%E8%AF%A5%E6%8E%A5%E5%8F%A3%E6%8E%A5%E5%8F%97%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%9A\">http://127.0.0.1:8080/ai/v1/multi/chat</a></p>\n<p>userId ID ID  ID <br>input</p>\n<p><img src=\"/typora-user-images/image-20250419181524113.png\" alt=\"image-20250419181524113\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250419181631076.png\" alt=\"image-20250419181631076\"></p>\n<p><strong>ID</strong></p>\n<p>ID  lison002</p>\n<p><img src=\"/typora-user-images/image-20250419181745960.png\" alt=\"image-20250419181745960\"></p>\n<p>AI </p>\n<h2 id=\"-Redis\"><a href=\"#-Redis\" class=\"headerlink\" title=\"-Redis\"></a>-Redis</h2><p><strong></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Spring  Redis  ChatClient </p>\n<p><strong>ChatStorageMemoryController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/storage/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/redis/chat  userId: [&#123;&#125;],  input:  [&#123;&#125;]&quot;</span>, userId, inputMsg);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                .user(inputMsg)</span><br><span class=\"line\">                .advisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, userId, CHAT_HISTORY_SIZE))</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text --&gt; [&#123;&#125;]&quot;</span>, text);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>application.yml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<p><a href=\"http://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=%E4%B8%AD%E5%9B%BD%E8%BF%91%E4%BB%A33%E4%B8%AA%E5%90%8D%E4%BA%BA\">http://localhost:8080/ai/v1/storage/chat?userId=lison001&amp;inputMsg=3</a></p>\n<p>****3</p>\n<p><img src=\"/typora-user-images/image-20250422114322913.png\" alt=\"image-20250422114322913\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20250422114422258.png\" alt=\"image-20250422114422258\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20250422114555482.png\" alt=\"image-20250422114555482\"></p>\n<p> <strong>Redis </strong></p>\n<p><img src=\"/typora-user-images/image-20250422114642336.png\" alt=\"image-20250422114642336\"></p>\n<p> Redis </p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-02-\"><a href=\"#Spring-AI-Alibaba-02-\" class=\"headerlink\" title=\"Spring AI Alibaba-02-\"></a>Spring AI Alibaba-02-</h1><p><code>Lison </code>  <code>&lt;dreamlison@163.com&gt;</code>,  <code>v1.0.0</code>, <code>2025.04.19</code></p>\n<p>[toc]</p>\n<p></p>\n<p></p>\n<ul>\n<li><strong></strong>IntelliJ IDEA</li>\n<li><strong>JDK</strong>17  IDEA  JDK</li>\n<li><strong></strong><a href=\"https://bailian.console.aliyun.com/\"></a> AI </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>1ChatMemory</strong> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InMemoryChatMemory</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2ChatMemoryController</strong></p>\n<p>IDIDIDID</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">        <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">        .user(input)</span><br><span class=\"line\">        <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">        .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">        <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">        .call();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  ChatModel AI  ChatMemory</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatMemoryController</span><span class=\"params\">(ChatModel chatModel, ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  ChatClient.Builder  ChatClient Advisor</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.chatClient = ChatClient.builder(chatModel)</span><br><span class=\"line\">                .defaultAdvisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory))</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/multi/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam(value = &quot;userId&quot;,defaultValue = &quot;10001&quot;)</span> String userId,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"meta\">@RequestParam(&quot;input&quot;)</span> String input)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/multi/chat   input:  [&#123;&#125;]&quot;</span>, input);</span><br><span class=\"line\">        <span class=\"comment\">//  chatClient.prompt() </span></span><br><span class=\"line\">        ChatClient.<span class=\"type\">CallResponseSpec</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                <span class=\"comment\">//  .user(input) </span></span><br><span class=\"line\">                .user(input)</span><br><span class=\"line\">                <span class=\"comment\">//  .advisors  Lambda </span></span><br><span class=\"line\">                .advisors(spec -&gt; spec.param(AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY, userId)</span><br><span class=\"line\">                        <span class=\"comment\">//  Lambda  .param  100</span></span><br><span class=\"line\">                        .param(AbstractChatMemoryAdvisor.CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class=\"number\">100</span>))</span><br><span class=\"line\">                <span class=\"comment\">//  .call() </span></span><br><span class=\"line\">                .call();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response.content();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><a href=\"http://127.0.0.1:8080/ai/v1/multi/chat%E3%80%82%E8%AF%A5%E6%8E%A5%E5%8F%A3%E6%8E%A5%E5%8F%97%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%9A\">http://127.0.0.1:8080/ai/v1/multi/chat</a></p>\n<p>userId ID ID  ID <br>input</p>\n<p><img src=\"/typora-user-images/image-20250419181524113.png\" alt=\"image-20250419181524113\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250419181631076.png\" alt=\"image-20250419181631076\"></p>\n<p><strong>ID</strong></p>\n<p>ID  lison002</p>\n<p><img src=\"/typora-user-images/image-20250419181745960.png\" alt=\"image-20250419181745960\"></p>\n<p>AI </p>\n<h2 id=\"-Redis\"><a href=\"#-Redis\" class=\"headerlink\" title=\"-Redis\"></a>-Redis</h2><p><strong></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Spring  Redis  ChatClient </p>\n<p><strong>ChatStorageMemoryController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemoryController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/storage/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;/redis/chat  userId: [&#123;&#125;],  input:  [&#123;&#125;]&quot;</span>, userId, inputMsg);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> chatClient.prompt()</span><br><span class=\"line\">                .user(inputMsg)</span><br><span class=\"line\">                .advisors(<span class=\"keyword\">new</span> <span class=\"title class_\">MessageChatMemoryAdvisor</span>(chatMemory, userId, CHAT_HISTORY_SIZE))</span><br><span class=\"line\">                .call()</span><br><span class=\"line\">                .content();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;text --&gt; [&#123;&#125;]&quot;</span>, text);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>application.yml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<p><a href=\"http://localhost:8080/ai/v1/storage/chat?userId=lison001&inputMsg=%E4%B8%AD%E5%9B%BD%E8%BF%91%E4%BB%A33%E4%B8%AA%E5%90%8D%E4%BA%BA\">http://localhost:8080/ai/v1/storage/chat?userId=lison001&amp;inputMsg=3</a></p>\n<p>****3</p>\n<p><img src=\"/typora-user-images/image-20250422114322913.png\" alt=\"image-20250422114322913\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20250422114422258.png\" alt=\"image-20250422114422258\"></p>\n<p><strong></strong></p>\n<p><img src=\"/typora-user-images/image-20250422114555482.png\" alt=\"image-20250422114555482\"></p>\n<p> <strong>Redis </strong></p>\n<p><img src=\"/typora-user-images/image-20250422114642336.png\" alt=\"image-20250422114642336\"></p>\n<p> Redis </p>\n"},{"_content":"# Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES/Milvus + RAG \n\n\n\n[]AIAPI**Spring AI**Spring[AI]AI\n\n[toc]\n\n\n\n\n\n## Spring AI  Function CallingTool Calling  Agent \n\n### Spring AI \n\n#### Spring AI\n\nSpring AI\n\n* 20245301.0.0 Milestone 1API\n* 20248231.0.0 Milestone 2\n* 20241081.0.0 Milestone 3AI\n* 202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon\n* 20252141.0.0 Milestone 6\n\n\n\n#### Spring AI\n\nSpring AIAI\n\n* LLM\n* AI\n* \n* \n* \n\n### **Function Calling**\n\n#### \n\nAIAPIAI\n\n#### \n\nSpring AI\n\n**1**`Function`Java\n\n~~~java\n@Component\npublic class WeatherFunction implements Function<WeatherFunction.WeatherRequest, String> {\n    @Override\n    public String apply(WeatherRequest request) {\n        return \"The weather in \" + request.getCity() + \" is sunny.\";\n    }\n    public static class WeatherRequest {\n        private String city;\n        public String getCity() { return city; }\n        public void setCity(String city) { this.city = city; }\n    }\n}\n\n~~~\n\n**2**Spring BeanSpring AI\n\n~~~java\n@Configuration\npublic class FunctionConfig {\n    @Bean\n    @Description(\"\")\n    public Function<WeatherFunction.WeatherRequest, String> weatherFunction() {\n        return new WeatherFunction();\n    }\n}\n~~~\n\n**3**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withFunction(\"weatherFunction\").build())\n                .build();\n    }\n}\n~~~\n\n**4**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        WeatherFunction.WeatherRequest request = new WeatherFunction.WeatherRequest();\n        request.setCity(input);\n        String response = chatClient.prompt().user(input).functions(\"weatherFunction\").call().content();\n        return response;\n    }\n}\n~~~\n\n****Spring AI****Tool Calling\n\n### **Tool Calling**\n\n#### ****\n\nAI\n\n#### \n\n\n\n**1**\n\n~~~java\npublic interface WeatherTool {\n    String getWeather(String city);\n}\n~~~\n\n**2**\n\n~~~java\n@Component\npublic class WeatherToolImpl implements WeatherTool {\n    @Override\n    public String getWeather(String city) {\n        return \"The weather in \" + city + \" is sunny.\";\n    }\n}\n~~~\n\n**3Spring Bean**Spring BeanSpring\n\n~~~java\n@Configuration\npublic class ToolConfig {\n    @Bean\n    public WeatherTool weatherTool() {\n        return new WeatherToolImpl();\n    }\n}\n~~~\n\n**4**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withTool(\"weatherTool\").build())\n                .build();\n    }\n}\n\n~~~\n\n**5**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        String response = chatClient.prompt().user(input).tools(\"weatherTool\").call().content();\n        return response;\n    }\n}\n\n~~~\n\n### Agent\n\n#### \n\nAgent\n\n#### \n\n\n\nMCPLLMMCP\n\nSpring AIAI\nSpring AI\n\n### FunctionCallbacToolCallback\n\nSpring AIFunction CallbackDeprecatedTool CallbackAI\n\n**FunctionCallbackToolCallback**\n\nSpring AIFunctionCallbackToolCallback\n\n* ToolCallbackFunctionCallback\n* ToolCallback\n* FunctionCallbackSpring AIToolCallback\n\n\n\nSpring AIFunctionCallbackToolCallback\n\n\n\n## Spring AI + DeepSeek-R1 + ES/Milvus + RAG + Tool Calling\n\n### \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n\n\n![image-20250425104935964](typora-user-images/image-20250425104935964-5549379.png)\n\n\n\n**Elasticsearch**\n\n\n\n~~~yaml\n# base \nversion: '3.8'\nservices:\n\telasticsearch1:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.13.4\n    hostname: \"elasticsearch1\"\n    environment:\n      - TZ=Asia/Shanghai\n      - \"ES_JAVA_OPTS=-Xms84m -Xmx512m\"\n    ports:\n      - 9200:9200\n      - 9300:9300\n    volumes:\n      - /Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data \n      - /Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins \n      - /Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config  \n      - /Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs  \n    privileged: true\n    #restart: always\n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.7\n\n  vsftpd:\n    image: \"fauria/vsftpd\"\n    hostname: \"rabbitmq1\"\n    environment:\n      - FTP_USER=admin \n      - FTP_PASS=123456 \n      - PASV_MIN_PORT=21100\n      - PASV_MAX_PORT=21110 \n      - PASV_ADDRESS=172.18.0.8\n    ports:\n      - 21:21\n      - 21100-21110:21100-21110\n    volumes:\n      - /Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd\n      - /Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd\n    privileged: true\n    #restart: always\n    networks:\n      - nt_dev\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n![image-20250425174252871](typora-user-images/image-20250425174252871.png)\n\n### \n\n1.  Spring AI Spring AI  AI \n2.  Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2\n3.  Redis  Redis  Redis  MySQL  Redis + MySQL \n4.  ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 \n5. Tool Calling Tool Calling \n   *  1 RAG \n   *  2\n   *  3\n\n\n\n Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  \n\n\n\n## \n\n**Maven **\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.3</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <spring-boot.version>3.4.3</spring-boot.version>\n        <spring-ai.version>1.0.0-M6</spring-ai.version>\n        <alibaba.ai.version>1.0.0-M6.1</alibaba.ai.version>\n        <spring.ai.ollama.version>1.0.0-M6</spring.ai.ollama.version>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>${alibaba.ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-elasticsearch-store-spring-boot-starter</artifactId>\n            <version>${spring-ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n            <version>${spring-boot.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <repositories>\n        <repository>\n            <id>alimaven</id>\n            <name>aliyun maven</name>\n            <url>https://maven.aliyun.com/repository/public</url>\n        </repository>\n        <repository>\n            <id>spring-milestones</id>\n            <name>Spring Milestones</name>\n            <url>https://repo.spring.io/milestone</url>\n            <snapshots>\n                <enabled>false</enabled>\n            </snapshots>\n        </repository>\n        <repository>\n            <id>spring-snapshots</id>\n            <name>Spring Snapshots</name>\n            <url>https://repo.spring.io/snapshot</url>\n            <releases>\n                <enabled>false</enabled>\n            </releases>\n        </repository>\n    </repositories>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                            <version>1.18.36</version>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n~~~\n\nSpring BootSpring AIAlibaba Cloud AIMaven\n\n** `application.yml`**\n\n `model: deepseek-r1`, `model: text-embedding-v2`\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      elasticsearch:\n        initialize-schema: true\n        index-name: spring-ai-tag\n        # 1536\n        dimensions: 1536\n        similarity: cosine\n        batching-strategy: TOKEN_COUNT\n\n\n~~~\n\nRedisElasticsearchAI \n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n       @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                // \n                .defaultSystem(\"\")\n                // \n                .defaultAdvisors(\n                        new QuestionAnswerAdvisor(\n                                vectorStore,\n                                SearchRequest.builder()\n                                        .similarityThreshold(0.1) // \n                                        .topK(10) //  10 \n                                        .build()\n                        )\n                )\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n\n\n**DeepseekChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.Message;\nimport org.springframework.ai.document.Document;\nimport org.springframework.ai.document.DocumentReader;\nimport org.springframework.ai.rag.Query;\nimport org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;\nimport org.springframework.ai.reader.TextReader;\nimport org.springframework.ai.vectorstore.SearchRequest;\nimport org.springframework.ai.vectorstore.VectorStore;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @ClassName DeepseekChatController  //\n * @Description:\n * @Author: 200900681 \n * @CreateDate: 2025/4/25\n * @Version: 1.0    //\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class DeepseekChatController {\n\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private VectorStore vectorStore;\n    @Autowired\n    private ChatMemory chatMemory;\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(\"/data/load\")\n    public String loadData() throws IOException {\n        // 1. \n        DocumentReader reader = new TextReader(\"static/hospitalInfo.txt\");\n        List<Document> documents = reader.get();\n\n        // 2.\n        List<Document> splitDocuments =  new ArrayList<>();\n        for (Document document : documents) {\n            // \n            String content = document.getText();\n            // \n            String[] parts = content.split(\"\\\\n\\\\s*\\\\n\");\n            //  Document \n            for (String part : parts) {\n                splitDocuments.add(new Document(part.trim()));\n            }\n        }\n\n        log.info(\" [{}]\", splitDocuments.size());\n\n        // 3.\n        vectorStore.add(splitDocuments);\n\n        return \"success\";\n    }\n\n    @GetMapping(\"/select\")\n    public String search(@RequestParam(\"query\") String query) {\n        log.info(\"query is  [{}]\", query);\n        List<Document> results = vectorStore.similaritySearch(\n//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n\n        );\n        log.info(\"results is [{}]\", results);\n        return results.toString();\n    }\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/rewrite/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByRewrite(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1\n        QueryTransformer queryTransformer = RewriteQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n        // 2\n        Query queryByTransform = queryTransformer.transform(new Query(inputMsg));\n        // 3\n        return queryByTransform.text();\n    }\n\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/history/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByHistory(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1. \n        List<Message> history = chatMemory.get(userId, CHAT_HISTORY_SIZE);\n        // 2. \n        Query query = Query.builder()\n                .text(inputMsg)\n                .history(history)\n                .build();\n\n        // 3.  CompressionQueryTransformer\n        CompressionQueryTransformer queryTransformerByHis = CompressionQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n\n        // 4\n        Query queryByHistory = queryTransformerByHis.transform(query);\n\n        // 5\n        return queryByHistory.text();\n    }\n    \n}\n\n~~~\n\n\n\n\n\n\n\n\n\n****\n\nkimi\n\n- ``\n- 3 ``,``,``\n- 20\n\n~~~\n1. \n2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM\n2. \n(1):\n\n(2):\n\n(3):\n\n\n3. \n(1) \n \n 19853\n \n \n \n \n\n(2) \n \n 19907\n \n \n \n \n\n(3) \n \n 198211\n \n \n \n \n\n(4) \n \n 19884\n \n \n \n \n\n(5) \n \n 19809\n \n \n \n \n\n(6) \n \n 19931\n \n \n \n \n\n(7) \n \n 19875\n \n \n \n \n\n(8) \n \n 19918\n \n \n \n \n\n(9) \n \n 197912\n \n \n \n \n\n(10) \n \n 19862\n \n \n \n \n\n(11) \n \n 19837\n \n \n \n \n\n(12) \n \n 19924\n \n \n \n \n\n(13) \n \n 198110\n \n \n \n \n\n(14) \n \n 19896\n \n \n \n \n\n(15) \n \n 198411\n \n \n \n \n\n(16) \n \n 19903\n \n \n \n \n\n(17) \n \n 19889\n \n \n \n \n\n(18) \n \n 19941\n \n \n \n \n\n(19) \n \n 19858\n \n \n \n \n\n(20) \n \n 19915\n \n \n \n \n~~~\n\n\n\n\n\n## \n\n\n\n~~~\n\nhttp://127.0.0.1:8080/ai/v1/data/load\n\nhttp://127.0.0.1:8080/ai/v1/select\n\nhttp://127.0.0.1:8080/ai/v1/rag/chat\n~~~\n\n\n\n****\n\n>\n>http://127.0.0.1:8080/ai/v1/data/load\n\n\n\n![image-20250429172724826](typora-user-images/image-20250429172724826.png)\n\n![image-20250429180401580](typora-user-images/image-20250429180401580.png)\n\n>\n>http://127.0.0.1:8080/ai/v1/select?query=\n\n![image-20250429174959408](typora-user-images/image-20250429174959408.png)\n\nelasticsearch deepseek\n\nRAG+\n\n>- \n>- \n>- \n>- \n>- \n\n\n\n![image-20250429174851066](typora-user-images/image-20250429174851066.png)\n\n\n\n\n\n![image-20250429175228086](typora-user-images/image-20250429175228086.png)\n\n\n\n![image-20250429175342611](typora-user-images/image-20250429175342611.png)\n\n\n\n![image-20250429175421998](typora-user-images/image-20250429175421998.png)\n\n\n\n\n\n![image-20250429175540574](typora-user-images/image-20250429175540574.png)\n\n\n\n\n\n## milvus \n\n\n\n### Milvus\n\n**Docker-compose **\n\n~~~yaml\n#  etcd \n  etcd:\n    container_name: milvus-etcd  # \n    image: quay.io/coreos/etcd:v3.5.16  # \n    environment:\n      - ETCD_AUTO_COMPACTION_MODE=revision  # \n      - ETCD_AUTO_COMPACTION_RETENTION=1000  # \n      - ETCD_QUOTA_BACKEND_BYTES=4294967296  # \n      - ETCD_SNAPSHOT_COUNT=50000  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/etcd:/etcd  # \n    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls=http://0.0.0.0:2379 --data-dir /etcd  # \n    healthcheck:\n      test: [\"CMD\", \"etcdctl\", \"endpoint\", \"health\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n\n  #  MinIO \n  minio:\n    container_name: milvus-minio  # \n    image: minio/minio:RELEASE.2023-03-20T20-16-18Z  # \n    environment:\n      MINIO_ACCESS_KEY: minioadmin  # MinIO \n      MINIO_SECRET_KEY: minioadmin  # MinIO \n    ports:\n      - \"9001:9001\"  # \n      - \"9000:9000\"  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/minio:/minio_data  # \n    command: minio server /minio_data --console-address \":9001\"  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9000/minio/health/live\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.8   \n\n  #  Milvus \n  standalone:\n    container_name: milvus-standalone  # \n    image: milvusdb/milvus:v2.5.4  # \n    command: [\"milvus\", \"run\", \"standalone\"]  # \n    security_opt:\n    - seccomp:unconfined  # \n    environment:\n      ETCD_ENDPOINTS: etcd:2379  # etcd \n      MINIO_ADDRESS: minio:9000  # MinIO \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/milvus:/var/lib/milvus  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9091/healthz\"]  # \n      interval: 30s  # \n      start_period: 90s  # \n      timeout: 20s  # \n      retries: 3  # \n    ports:\n      - \"19530:19530\"  # \n      - \"9091:9091\"  # \n    depends_on:\n      - \"etcd\"  #  etcd \n      - \"minio\"  #  MinIO \n\n  #  Milvus Dashboard \n  dashboard:\n    image: zilliz/attu:v2.5  # \n    container_name: milvus-dashboard  # \n    environment:\n      MILVUS_URL: http://standalone:19530  # Milvus \n    ports:\n      - \"8000:3000\"  # \n    depends_on:\n      - standalone  #  Milvus \n      - etcd  #  etcd \n      - minio  #  MinIO \n\n# \nnetworks:\n  nt_dev:\n      external: true\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n\n\n****  `http://localhost:8000/`\n\n\n\n\n![image-20250429181131778](typora-user-images/image-20250429181131778.png)\n\n\n\n![image-20250429181039571](typora-user-images/image-20250429181039571.png)\n\n\n\n``milvus`,  `milvus-4321` (spring) `admin`, \n\n\n\n\n\n![image-20250429181312813](typora-user-images/image-20250429181312813.png)\n\n\n\n\n\n\n\n~~~xml\n  <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-milvus-store-spring-boot-starter</artifactId>\n </dependency>\n~~~\n\n\n\n\n\n\n\n\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  elasticsearch:\n    uris: http://127.0.0.1:9200\n    username:\n    password:\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      milvus:\n        client:\n          host: \"localhost\"\n          port: 19530\n          username: \"milvus\"\n          password: \"milvus-4321\"\n        databaseName: \"default\"\n        collectionName: \"vector_store\"\n        embeddingDimension: 1536\n        indexType: IVF_FLAT\n        metricType: COSINE\n        initialize-schema: true\n\n\n\n\n~~~\n\nRedisMilvusAI\n\n\n\n\n\n![image-20250429183142516](typora-user-images/image-20250429183142516.png)\n","source":"categories/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .md","raw":"# Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES/Milvus + RAG \n\n\n\n[]AIAPI**Spring AI**Spring[AI]AI\n\n[toc]\n\n\n\n\n\n## Spring AI  Function CallingTool Calling  Agent \n\n### Spring AI \n\n#### Spring AI\n\nSpring AI\n\n* 20245301.0.0 Milestone 1API\n* 20248231.0.0 Milestone 2\n* 20241081.0.0 Milestone 3AI\n* 202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon\n* 20252141.0.0 Milestone 6\n\n\n\n#### Spring AI\n\nSpring AIAI\n\n* LLM\n* AI\n* \n* \n* \n\n### **Function Calling**\n\n#### \n\nAIAPIAI\n\n#### \n\nSpring AI\n\n**1**`Function`Java\n\n~~~java\n@Component\npublic class WeatherFunction implements Function<WeatherFunction.WeatherRequest, String> {\n    @Override\n    public String apply(WeatherRequest request) {\n        return \"The weather in \" + request.getCity() + \" is sunny.\";\n    }\n    public static class WeatherRequest {\n        private String city;\n        public String getCity() { return city; }\n        public void setCity(String city) { this.city = city; }\n    }\n}\n\n~~~\n\n**2**Spring BeanSpring AI\n\n~~~java\n@Configuration\npublic class FunctionConfig {\n    @Bean\n    @Description(\"\")\n    public Function<WeatherFunction.WeatherRequest, String> weatherFunction() {\n        return new WeatherFunction();\n    }\n}\n~~~\n\n**3**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withFunction(\"weatherFunction\").build())\n                .build();\n    }\n}\n~~~\n\n**4**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        WeatherFunction.WeatherRequest request = new WeatherFunction.WeatherRequest();\n        request.setCity(input);\n        String response = chatClient.prompt().user(input).functions(\"weatherFunction\").call().content();\n        return response;\n    }\n}\n~~~\n\n****Spring AI****Tool Calling\n\n### **Tool Calling**\n\n#### ****\n\nAI\n\n#### \n\n\n\n**1**\n\n~~~java\npublic interface WeatherTool {\n    String getWeather(String city);\n}\n~~~\n\n**2**\n\n~~~java\n@Component\npublic class WeatherToolImpl implements WeatherTool {\n    @Override\n    public String getWeather(String city) {\n        return \"The weather in \" + city + \" is sunny.\";\n    }\n}\n~~~\n\n**3Spring Bean**Spring BeanSpring\n\n~~~java\n@Configuration\npublic class ToolConfig {\n    @Bean\n    public WeatherTool weatherTool() {\n        return new WeatherToolImpl();\n    }\n}\n~~~\n\n**4**Spring AI\n\n~~~java\n@Configuration\npublic class ChatConfig {\n    @Autowired\n    private ChatClient.Builder chatClientBuilder;\n\n    @Bean\n    public ChatClient chatClient() {\n        return chatClientBuilder\n                .withOptions(ChatOptions.builder().withTool(\"weatherTool\").build())\n                .build();\n    }\n}\n\n~~~\n\n**5**\n\n~~~java\n@RestController\npublic class ChatController {\n    @Autowired\n    private ChatClient chatClient;\n\n    @GetMapping(\"/chat\")\n    public String chat(@RequestParam String input) {\n        String response = chatClient.prompt().user(input).tools(\"weatherTool\").call().content();\n        return response;\n    }\n}\n\n~~~\n\n### Agent\n\n#### \n\nAgent\n\n#### \n\n\n\nMCPLLMMCP\n\nSpring AIAI\nSpring AI\n\n### FunctionCallbacToolCallback\n\nSpring AIFunction CallbackDeprecatedTool CallbackAI\n\n**FunctionCallbackToolCallback**\n\nSpring AIFunctionCallbackToolCallback\n\n* ToolCallbackFunctionCallback\n* ToolCallback\n* FunctionCallbackSpring AIToolCallback\n\n\n\nSpring AIFunctionCallbackToolCallback\n\n\n\n## Spring AI + DeepSeek-R1 + ES/Milvus + RAG + Tool Calling\n\n### \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n\n\n![image-20250425104935964](typora-user-images/image-20250425104935964-5549379.png)\n\n\n\n**Elasticsearch**\n\n\n\n~~~yaml\n# base \nversion: '3.8'\nservices:\n\telasticsearch1:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.13.4\n    hostname: \"elasticsearch1\"\n    environment:\n      - TZ=Asia/Shanghai\n      - \"ES_JAVA_OPTS=-Xms84m -Xmx512m\"\n    ports:\n      - 9200:9200\n      - 9300:9300\n    volumes:\n      - /Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data \n      - /Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins \n      - /Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config  \n      - /Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs  \n    privileged: true\n    #restart: always\n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.7\n\n  vsftpd:\n    image: \"fauria/vsftpd\"\n    hostname: \"rabbitmq1\"\n    environment:\n      - FTP_USER=admin \n      - FTP_PASS=123456 \n      - PASV_MIN_PORT=21100\n      - PASV_MAX_PORT=21110 \n      - PASV_ADDRESS=172.18.0.8\n    ports:\n      - 21:21\n      - 21100-21110:21100-21110\n    volumes:\n      - /Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd\n      - /Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd\n    privileged: true\n    #restart: always\n    networks:\n      - nt_dev\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n![image-20250425174252871](typora-user-images/image-20250425174252871.png)\n\n### \n\n1.  Spring AI Spring AI  AI \n2.  Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2\n3.  Redis  Redis  Redis  MySQL  Redis + MySQL \n4.  ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 \n5. Tool Calling Tool Calling \n   *  1 RAG \n   *  2\n   *  3\n\n\n\n Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  \n\n\n\n## \n\n**Maven **\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.4.3</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.lison.ai</groupId>\n    <artifactId>spring_ai_alibaba_demo</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>spring_ai_alibaba_demo</name>\n    <description> Spring AI Alibaba </description>\n    <properties>\n        <java.version>23</java.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <spring-boot.version>3.4.3</spring-boot.version>\n        <spring-ai.version>1.0.0-M6</spring-ai.version>\n        <alibaba.ai.version>1.0.0-M6.1</alibaba.ai.version>\n        <spring.ai.ollama.version>1.0.0-M6</spring.ai.ollama.version>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>com.alibaba.cloud.ai</groupId>\n            <artifactId>spring-ai-alibaba-starter</artifactId>\n            <version>${alibaba.ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-elasticsearch-store-spring-boot-starter</artifactId>\n            <version>${spring-ai.version}</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n            <version>${spring-boot.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <repositories>\n        <repository>\n            <id>alimaven</id>\n            <name>aliyun maven</name>\n            <url>https://maven.aliyun.com/repository/public</url>\n        </repository>\n        <repository>\n            <id>spring-milestones</id>\n            <name>Spring Milestones</name>\n            <url>https://repo.spring.io/milestone</url>\n            <snapshots>\n                <enabled>false</enabled>\n            </snapshots>\n        </repository>\n        <repository>\n            <id>spring-snapshots</id>\n            <name>Spring Snapshots</name>\n            <url>https://repo.spring.io/snapshot</url>\n            <releases>\n                <enabled>false</enabled>\n            </releases>\n        </repository>\n    </repositories>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <annotationProcessorPaths>\n                        <path>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                            <version>1.18.36</version>\n                        </path>\n                    </annotationProcessorPaths>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n~~~\n\nSpring BootSpring AIAlibaba Cloud AIMaven\n\n** `application.yml`**\n\n `model: deepseek-r1`, `model: text-embedding-v2`\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  ai:\n    dashscope:\n      api-key: sk-xxxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      elasticsearch:\n        initialize-schema: true\n        index-name: spring-ai-tag\n        # 1536\n        dimensions: 1536\n        similarity: cosine\n        batching-strategy: TOKEN_COUNT\n\n\n~~~\n\nRedisElasticsearchAI \n\n\n\n**RedisRedisConfig.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n\n@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\n        redisTemplate.setConnectionFactory(factory);\n        redisTemplate.setKeySerializer(new StringRedisSerializer());\n        redisTemplate.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.setHashKeySerializer(new StringRedisSerializer());\n        redisTemplate.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n}\n\n~~~\n\n>\n>\n> RedisTemplate JSON  JSON \n\n\n\n**ChatEntity.java**\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config;\n\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\n\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class ChatEntity implements Serializable {\n    String chatId;\n    String type;\n    String text;\n}\n\n~~~\n\n> ID Redis \n\n\n\n** Redis ChatStorageMemory.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.*;\nimport org.springframework.stereotype.Component;\nimport org.springframework.data.redis.core.RedisTemplate;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\n@Component\npublic class ChatStorageMemory implements ChatMemory {\n\n    private static final String KEY_PREFIX = \"chat:history:\";\n    private final RedisTemplate<String, Object> redisTemplate;\n\n    public ChatStorageMemory(RedisTemplate<String, Object> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n    }\n\n    @Override\n    public void add(String conversationId, List<Message> messages) {\n        String key = KEY_PREFIX + conversationId;\n        List<ChatEntity> listIn = new ArrayList<>();\n        for (Message msg : messages) {\n            String[] strs = msg.getText().split(\"</think>\");\n            String text = strs.length == 2 ? strs[1] : strs[0];\n\n            ChatEntity ent = new ChatEntity();\n            ent.setChatId(conversationId);\n            ent.setType(msg.getMessageType().getValue());\n            ent.setText(text);\n            listIn.add(ent);\n        }\n        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());\n        redisTemplate.expire(key, 30, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public List<Message> get(String conversationId, int lastN) {\n        String key = KEY_PREFIX + conversationId;\n        Long size = redisTemplate.opsForList().size(key);\n        if (size == null || size == 0) {\n            return Collections.emptyList();\n        }\n\n        int start = Math.max(0, (int) (size - lastN));\n        List<Object> listTmp = redisTemplate.opsForList().range(key, start, -1);\n        List<Message> listOut = new ArrayList<>();\n        ObjectMapper objectMapper = new ObjectMapper();\n        for (Object obj : listTmp) {\n            ChatEntity chat = objectMapper.convertValue(obj, ChatEntity.class);\n            if (MessageType.USER.getValue().equals(chat.getType())) {\n                listOut.add(new UserMessage(chat.getText()));\n            } else if (MessageType.ASSISTANT.getValue().equals(chat.getType())) {\n                listOut.add(new AssistantMessage(chat.getText()));\n            } else if (MessageType.SYSTEM.getValue().equals(chat.getType())) {\n                listOut.add(new SystemMessage(chat.getText()));\n            }\n        }\n        return listOut;\n    }\n\n    @Override\n    public void clear(String conversationId) {\n        redisTemplate.delete(KEY_PREFIX + conversationId);\n    }\n}\n\n\n~~~\n\n Redis \n\n\n\n **SpringAiChatConfig **\n\n\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.config.chat;\n\n\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.memory.InMemoryChatMemory;\nimport org.springframework.ai.chat.model.ChatModel;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.core.RedisTemplate;\n\n@Configuration\npublic class SpringAiChatConfig {\n\n\n    @Autowired\n    private ChatModel chatModel;\n\n       @Bean\n    public ChatClient chatClient(ChatMemory chatMemory) {\n        return ChatClient.builder(chatModel)\n                // \n                .defaultSystem(\"\")\n                // \n                .defaultAdvisors(\n                        new QuestionAnswerAdvisor(\n                                vectorStore,\n                                SearchRequest.builder()\n                                        .similarityThreshold(0.1) // \n                                        .topK(10) //  10 \n                                        .build()\n                        )\n                )\n                .build();\n    }\n\n    @Bean\n    public ChatMemory chatMemory(RedisTemplate<String, Object> redisTemplate) {\n        return new ChatStorageMemory(redisTemplate);\n    }\n}\n\n~~~\n\n\n\n**DeepseekChatController.java**\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.controller;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.chat.client.ChatClient;\nimport org.springframework.ai.chat.memory.ChatMemory;\nimport org.springframework.ai.chat.messages.Message;\nimport org.springframework.ai.document.Document;\nimport org.springframework.ai.document.DocumentReader;\nimport org.springframework.ai.rag.Query;\nimport org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;\nimport org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;\nimport org.springframework.ai.reader.TextReader;\nimport org.springframework.ai.vectorstore.SearchRequest;\nimport org.springframework.ai.vectorstore.VectorStore;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @ClassName DeepseekChatController  //\n * @Description:\n * @Author: 200900681 \n * @CreateDate: 2025/4/25\n * @Version: 1.0    //\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/ai/v1\")\npublic class DeepseekChatController {\n\n    @Autowired\n    private ChatClient chatClient;\n    @Autowired\n    private VectorStore vectorStore;\n    @Autowired\n    private ChatMemory chatMemory;\n    // \n    private final Integer CHAT_HISTORY_SIZE = 10;\n\n    @GetMapping(\"/data/load\")\n    public String loadData() throws IOException {\n        // 1. \n        DocumentReader reader = new TextReader(\"static/hospitalInfo.txt\");\n        List<Document> documents = reader.get();\n\n        // 2.\n        List<Document> splitDocuments =  new ArrayList<>();\n        for (Document document : documents) {\n            // \n            String content = document.getText();\n            // \n            String[] parts = content.split(\"\\\\n\\\\s*\\\\n\");\n            //  Document \n            for (String part : parts) {\n                splitDocuments.add(new Document(part.trim()));\n            }\n        }\n\n        log.info(\" [{}]\", splitDocuments.size());\n\n        // 3.\n        vectorStore.add(splitDocuments);\n\n        return \"success\";\n    }\n\n    @GetMapping(\"/select\")\n    public String search(@RequestParam(\"query\") String query) {\n        log.info(\"query is  [{}]\", query);\n        List<Document> results = vectorStore.similaritySearch(\n//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()\n\n        );\n        log.info(\"results is [{}]\", results);\n        return results.toString();\n    }\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/rewrite/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByRewrite(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1\n        QueryTransformer queryTransformer = RewriteQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n        // 2\n        Query queryByTransform = queryTransformer.transform(new Query(inputMsg));\n        // 3\n        return queryByTransform.text();\n    }\n\n\n    /**\n     * \n     * @param userId\n     * @param inputMsg\n     * @return\n     */\n    @GetMapping(value = \"/rag/history/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChatByHistory(@RequestParam String userId, @RequestParam String inputMsg) {\n        // 1. \n        List<Message> history = chatMemory.get(userId, CHAT_HISTORY_SIZE);\n        // 2. \n        Query query = Query.builder()\n                .text(inputMsg)\n                .history(history)\n                .build();\n\n        // 3.  CompressionQueryTransformer\n        CompressionQueryTransformer queryTransformerByHis = CompressionQueryTransformer.builder()\n                .chatClientBuilder(chatClient.mutate())\n                .build();\n\n        // 4\n        Query queryByHistory = queryTransformerByHis.transform(query);\n\n        // 5\n        return queryByHistory.text();\n    }\n    \n}\n\n~~~\n\n\n\n\n\n\n\n\n\n****\n\nkimi\n\n- ``\n- 3 ``,``,``\n- 20\n\n~~~\n1. \n2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM\n2. \n(1):\n\n(2):\n\n(3):\n\n\n3. \n(1) \n \n 19853\n \n \n \n \n\n(2) \n \n 19907\n \n \n \n \n\n(3) \n \n 198211\n \n \n \n \n\n(4) \n \n 19884\n \n \n \n \n\n(5) \n \n 19809\n \n \n \n \n\n(6) \n \n 19931\n \n \n \n \n\n(7) \n \n 19875\n \n \n \n \n\n(8) \n \n 19918\n \n \n \n \n\n(9) \n \n 197912\n \n \n \n \n\n(10) \n \n 19862\n \n \n \n \n\n(11) \n \n 19837\n \n \n \n \n\n(12) \n \n 19924\n \n \n \n \n\n(13) \n \n 198110\n \n \n \n \n\n(14) \n \n 19896\n \n \n \n \n\n(15) \n \n 198411\n \n \n \n \n\n(16) \n \n 19903\n \n \n \n \n\n(17) \n \n 19889\n \n \n \n \n\n(18) \n \n 19941\n \n \n \n \n\n(19) \n \n 19858\n \n \n \n \n\n(20) \n \n 19915\n \n \n \n \n~~~\n\n\n\n\n\n## \n\n\n\n~~~\n\nhttp://127.0.0.1:8080/ai/v1/data/load\n\nhttp://127.0.0.1:8080/ai/v1/select\n\nhttp://127.0.0.1:8080/ai/v1/rag/chat\n~~~\n\n\n\n****\n\n>\n>http://127.0.0.1:8080/ai/v1/data/load\n\n\n\n![image-20250429172724826](typora-user-images/image-20250429172724826.png)\n\n![image-20250429180401580](typora-user-images/image-20250429180401580.png)\n\n>\n>http://127.0.0.1:8080/ai/v1/select?query=\n\n![image-20250429174959408](typora-user-images/image-20250429174959408.png)\n\nelasticsearch deepseek\n\nRAG+\n\n>- \n>- \n>- \n>- \n>- \n\n\n\n![image-20250429174851066](typora-user-images/image-20250429174851066.png)\n\n\n\n\n\n![image-20250429175228086](typora-user-images/image-20250429175228086.png)\n\n\n\n![image-20250429175342611](typora-user-images/image-20250429175342611.png)\n\n\n\n![image-20250429175421998](typora-user-images/image-20250429175421998.png)\n\n\n\n\n\n![image-20250429175540574](typora-user-images/image-20250429175540574.png)\n\n\n\n\n\n## milvus \n\n\n\n### Milvus\n\n**Docker-compose **\n\n~~~yaml\n#  etcd \n  etcd:\n    container_name: milvus-etcd  # \n    image: quay.io/coreos/etcd:v3.5.16  # \n    environment:\n      - ETCD_AUTO_COMPACTION_MODE=revision  # \n      - ETCD_AUTO_COMPACTION_RETENTION=1000  # \n      - ETCD_QUOTA_BACKEND_BYTES=4294967296  # \n      - ETCD_SNAPSHOT_COUNT=50000  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/etcd:/etcd  # \n    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls=http://0.0.0.0:2379 --data-dir /etcd  # \n    healthcheck:\n      test: [\"CMD\", \"etcdctl\", \"endpoint\", \"health\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n\n  #  MinIO \n  minio:\n    container_name: milvus-minio  # \n    image: minio/minio:RELEASE.2023-03-20T20-16-18Z  # \n    environment:\n      MINIO_ACCESS_KEY: minioadmin  # MinIO \n      MINIO_SECRET_KEY: minioadmin  # MinIO \n    ports:\n      - \"9001:9001\"  # \n      - \"9000:9000\"  # \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/minio:/minio_data  # \n    command: minio server /minio_data --console-address \":9001\"  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9000/minio/health/live\"]  # \n      interval: 30s  # \n      timeout: 20s  # \n      retries: 3  # \n    networks:\n      nt_dev:\n        ipv4_address: 172.18.0.8   \n\n  #  Milvus \n  standalone:\n    container_name: milvus-standalone  # \n    image: milvusdb/milvus:v2.5.4  # \n    command: [\"milvus\", \"run\", \"standalone\"]  # \n    security_opt:\n    - seccomp:unconfined  # \n    environment:\n      ETCD_ENDPOINTS: etcd:2379  # etcd \n      MINIO_ADDRESS: minio:9000  # MinIO \n    volumes:\n      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/milvus:/var/lib/milvus  # \n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9091/healthz\"]  # \n      interval: 30s  # \n      start_period: 90s  # \n      timeout: 20s  # \n      retries: 3  # \n    ports:\n      - \"19530:19530\"  # \n      - \"9091:9091\"  # \n    depends_on:\n      - \"etcd\"  #  etcd \n      - \"minio\"  #  MinIO \n\n  #  Milvus Dashboard \n  dashboard:\n    image: zilliz/attu:v2.5  # \n    container_name: milvus-dashboard  # \n    environment:\n      MILVUS_URL: http://standalone:19530  # Milvus \n    ports:\n      - \"8000:3000\"  # \n    depends_on:\n      - standalone  #  Milvus \n      - etcd  #  etcd \n      - minio  #  MinIO \n\n# \nnetworks:\n  nt_dev:\n      external: true\n~~~\n\n\n\n~~~\ndocker compose up -d\n~~~\n\n\n\n****  `http://localhost:8000/`\n\n\n\n\n![image-20250429181131778](typora-user-images/image-20250429181131778.png)\n\n\n\n![image-20250429181039571](typora-user-images/image-20250429181039571.png)\n\n\n\n``milvus`,  `milvus-4321` (spring) `admin`, \n\n\n\n\n\n![image-20250429181312813](typora-user-images/image-20250429181312813.png)\n\n\n\n\n\n\n\n~~~xml\n  <dependency>\n            <groupId>org.springframework.ai</groupId>\n            <artifactId>spring-ai-milvus-store-spring-boot-starter</artifactId>\n </dependency>\n~~~\n\n\n\n\n\n\n\n\n\n~~~yaml\nserver:\n  port: 8080\nspring:\n  application:\n    name: AI Demo\n  data:\n    redis:\n      host: 127.0.0.1\n      port: 6379\n      database: 0\n  elasticsearch:\n    uris: http://127.0.0.1:9200\n    username:\n    password:\n  ai:\n    dashscope:\n      api-key: sk-xxxx\n      model: deepseek-r1\n      embedding:\n        options:\n          model: text-embedding-v2\n    vectorstore:\n      milvus:\n        client:\n          host: \"localhost\"\n          port: 19530\n          username: \"milvus\"\n          password: \"milvus-4321\"\n        databaseName: \"default\"\n        collectionName: \"vector_store\"\n        embeddingDimension: 1536\n        indexType: IVF_FLAT\n        metricType: COSINE\n        initialize-schema: true\n\n\n\n\n~~~\n\nRedisMilvusAI\n\n\n\n\n\n![image-20250429183142516](typora-user-images/image-20250429183142516.png)\n","date":"2025-06-04T10:13:19.151Z","updated":"2025-04-29T10:42:03.405Z","path":"categories/Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ESMilvus + RAG .html","_id":"cmbhshryb000bnffy5rjy005f","title":"","comments":1,"layout":"page","content":"<h1 id=\"Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\"><a href=\"#Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\" class=\"headerlink\" title=\"Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG \"></a>Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG </h1><p>[]AIAPI<strong>Spring AI</strong>Spring[AI]AI</p>\n<p>[toc]</p>\n<h2 id=\"Spring-AI--Function-CallingTool-Calling--Agent-\"><a href=\"#Spring-AI--Function-CallingTool-Calling--Agent-\" class=\"headerlink\" title=\"Spring AI  Function CallingTool Calling  Agent \"></a>Spring AI  Function CallingTool Calling  Agent </h2><h3 id=\"Spring-AI-\"><a href=\"#Spring-AI-\" class=\"headerlink\" title=\"Spring AI \"></a>Spring AI </h3><h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AI</p>\n<ul>\n<li>20245301.0.0 Milestone 1API</li>\n<li>20248231.0.0 Milestone 2</li>\n<li>20241081.0.0 Milestone 3AI</li>\n<li>202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon</li>\n<li>20252141.0.0 Milestone 6</li>\n</ul>\n<h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AIAI</p>\n<ul>\n<li>LLM</li>\n<li>AI</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a><strong>Function Calling</strong></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>AIAPIAI</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Spring AI</p>\n<p><strong>1</strong><code>Function</code>Java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherFunction</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Function</span>&lt;WeatherFunction.WeatherRequest, String&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">apply</span><span class=\"params\">(WeatherRequest request)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + request.getCity() + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherRequest</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String city;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getCity</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> city; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setCity</span><span class=\"params\">(String city)</span> &#123; <span class=\"built_in\">this</span>.city = city; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong>Spring BeanSpring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FunctionConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Function&lt;WeatherFunction.WeatherRequest, String&gt; weatherFunction() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withFunction(<span class=\"string\">&quot;weatherFunction&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        WeatherFunction.<span class=\"type\">WeatherRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>.WeatherRequest();</span><br><span class=\"line\">        request.setCity(input);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).functions(<span class=\"string\">&quot;weatherFunction&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong>Spring AI<strong></strong>Tool Calling</p>\n<h3 id=\"Tool-Calling\"><a href=\"#Tool-Calling\" class=\"headerlink\" title=\"Tool Calling\"></a><strong>Tool Calling</strong></h3><h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p>AI</p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p><strong>1</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherToolImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + city + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3Spring Bean</strong>Spring BeanSpring</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ToolConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> WeatherTool <span class=\"title function_\">weatherTool</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherToolImpl</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withTool(<span class=\"string\">&quot;weatherTool&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>5</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).tools(<span class=\"string\">&quot;weatherTool&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Agent\"><a href=\"#Agent\" class=\"headerlink\" title=\"Agent\"></a>Agent</h3><h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p>Agent</p>\n<h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p>MCPLLMMCP<br><br>Spring AIAI<br>Spring AI</p>\n<h3 id=\"FunctionCallbacToolCallback\"><a href=\"#FunctionCallbacToolCallback\" class=\"headerlink\" title=\"FunctionCallbacToolCallback\"></a>FunctionCallbacToolCallback</h3><p>Spring AIFunction CallbackDeprecatedTool CallbackAI</p>\n<p><strong>FunctionCallbackToolCallback</strong></p>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<ul>\n<li>ToolCallbackFunctionCallback</li>\n<li>ToolCallback</li>\n<li>FunctionCallbackSpring AIToolCallback</li>\n</ul>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<h2 id=\"Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\"><a href=\"#Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\" class=\"headerlink\" title=\"Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling\"></a>Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p><img src=\"/typora-user-images/image-20250425104935964-5549379.png\" alt=\"image-20250425104935964\"></p>\n<p><strong>Elasticsearch</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># base </span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">\t<span class=\"attr\">elasticsearch1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/elasticsearch/elasticsearch:8.13.4</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;elasticsearch1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;ES_JAVA_OPTS=-Xms84m -Xmx512m&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9200</span><span class=\"string\">:9200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9300</span><span class=\"string\">:9300</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config</span>  </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs</span>  </span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.7</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">vsftpd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">&quot;fauria/vsftpd&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;rabbitmq1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_USER=admin</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_PASS=123456</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MIN_PORT=21100</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MAX_PORT=21110</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_ADDRESS=172.18.0.8</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21</span><span class=\"string\">:21</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21100</span><span class=\"number\">-21110</span><span class=\"string\">:21100-21110</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nt_dev</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/typora-user-images/image-20250425174252871.png\" alt=\"image-20250425174252871\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> Spring AI Spring AI  AI </li>\n<li> Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2</li>\n<li> Redis  Redis  Redis  MySQL  Redis + MySQL </li>\n<li> ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 </li>\n<li>Tool Calling Tool Calling <ul>\n<li> 1 RAG </li>\n<li> 2</li>\n<li> 3</li>\n</ul>\n</li>\n</ol>\n<p> Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>Maven </strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-boot.version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">spring-boot.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-ai.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring-ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">alibaba.ai.version</span>&gt;</span>1.0.0-M6.1<span class=\"tag\">&lt;/<span class=\"name\">alibaba.ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.ai.ollama.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring.ai.ollama.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;alibaba.ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-elasticsearch-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Snapshots<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.18.36<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>Spring BootSpring AIAlibaba Cloud AIMaven</p>\n<p><strong> <code>application.yml</code></strong></p>\n<p> <code>model: deepseek-r1</code>, <code>model: text-embedding-v2</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">index-name:</span> <span class=\"string\">spring-ai-tag</span></span><br><span class=\"line\">        <span class=\"comment\"># 1536</span></span><br><span class=\"line\">        <span class=\"attr\">dimensions:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">similarity:</span> <span class=\"string\">cosine</span></span><br><span class=\"line\">        <span class=\"attr\">batching-strategy:</span> <span class=\"string\">TOKEN_COUNT</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisElasticsearchAI </p>\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultSystem(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">QuestionAnswerAdvisor</span>(</span><br><span class=\"line\">                                vectorStore,</span><br><span class=\"line\">                                SearchRequest.builder()</span><br><span class=\"line\">                                        .similarityThreshold(<span class=\"number\">0.1</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">                                        .topK(<span class=\"number\">10</span>) <span class=\"comment\">//  10 </span></span><br><span class=\"line\">                                        .build()</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>DeepseekChatController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.DocumentReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.Query;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.reader.TextReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.SearchRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.VectorStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@ClassName</span> DeepseekChatController  //</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span>: 200900681 </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@CreateDate</span>: 2025/4/25</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Version</span>: 1.0    //</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DeepseekChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> VectorStore vectorStore;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/data/load&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">loadData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        <span class=\"type\">DocumentReader</span> <span class=\"variable\">reader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TextReader</span>(<span class=\"string\">&quot;static/hospitalInfo.txt&quot;</span>);</span><br><span class=\"line\">        List&lt;Document&gt; documents = reader.get();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.</span></span><br><span class=\"line\">        List&lt;Document&gt; splitDocuments =  <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Document document : documents) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">content</span> <span class=\"operator\">=</span> document.getText();</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            String[] parts = content.split(<span class=\"string\">&quot;\\\\n\\\\s*\\\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//  Document </span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (String part : parts) &#123;</span><br><span class=\"line\">                splitDocuments.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>(part.trim()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot; [&#123;&#125;]&quot;</span>, splitDocuments.size());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.</span></span><br><span class=\"line\">        vectorStore.add(splitDocuments);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;success&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/select&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">search</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;query&quot;)</span> String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query is  [&#123;&#125;]&quot;</span>, query);</span><br><span class=\"line\">        List&lt;Document&gt; results = vectorStore.similaritySearch(</span><br><span class=\"line\"><span class=\"comment\">//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()</span></span><br><span class=\"line\">                SearchRequest.builder().query(query).similarityThreshold(<span class=\"number\">0.1</span>).topK(<span class=\"number\">10</span>).build()</span><br><span class=\"line\"></span><br><span class=\"line\">        );</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;results is [&#123;&#125;]&quot;</span>, results);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> results.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/rewrite/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByRewrite</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1</span></span><br><span class=\"line\">        <span class=\"type\">QueryTransformer</span> <span class=\"variable\">queryTransformer</span> <span class=\"operator\">=</span> RewriteQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"comment\">// 2</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByTransform</span> <span class=\"operator\">=</span> queryTransformer.transform(<span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(inputMsg));</span><br><span class=\"line\">        <span class=\"comment\">// 3</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByTransform.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/history/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByHistory</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        List&lt;Message&gt; history = chatMemory.get(userId, CHAT_HISTORY_SIZE);</span><br><span class=\"line\">        <span class=\"comment\">// 2. </span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> Query.builder()</span><br><span class=\"line\">                .text(inputMsg)</span><br><span class=\"line\">                .history(history)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.  CompressionQueryTransformer</span></span><br><span class=\"line\">        <span class=\"type\">CompressionQueryTransformer</span> <span class=\"variable\">queryTransformerByHis</span> <span class=\"operator\">=</span> CompressionQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByHistory</span> <span class=\"operator\">=</span> queryTransformerByHis.transform(query);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByHistory.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<p><strong></strong></p>\n<p>kimi</p>\n<ul>\n<li><code></code></li>\n<li>3 <code></code>,<code></code>,<code></code></li>\n<li>20</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. </span><br><span class=\"line\">2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM</span><br><span class=\"line\">2. </span><br><span class=\"line\">(1):</span><br><span class=\"line\"></span><br><span class=\"line\">(2):</span><br><span class=\"line\"></span><br><span class=\"line\">(3):</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">3. </span><br><span class=\"line\">(1) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19853</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(2) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19907</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(3) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198211</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(4) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19884</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(5) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19809</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(6) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19931</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(7) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19875</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(8) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19918</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(9) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 197912</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(10) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19862</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(11) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19837</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(12) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19924</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(13) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198110</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(14) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19896</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(15) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198411</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(16) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19903</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(17) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19889</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(18) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19941</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(19) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19858</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(20) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19915</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/data/load</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/select</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/rag/chat</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/data/load\">http://127.0.0.1:8080/ai/v1/data/load</a></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429172724826.png\" alt=\"image-20250429172724826\"></p>\n<p><img src=\"/typora-user-images/image-20250429180401580.png\" alt=\"image-20250429180401580\"></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/select?query=%E5%8C%BB%E9%99%A2%E4%BB%8B%E7%BB%8D\">http://127.0.0.1:8080/ai/v1/select?query=</a></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429174959408.png\" alt=\"image-20250429174959408\"></p>\n<p>elasticsearch deepseek</p>\n<p>RAG+</p>\n<blockquote>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429174851066.png\" alt=\"image-20250429174851066\"></p>\n<p><img src=\"/typora-user-images/image-20250429175228086.png\" alt=\"image-20250429175228086\"></p>\n<p><img src=\"/typora-user-images/image-20250429175342611.png\" alt=\"image-20250429175342611\"></p>\n<p><img src=\"/typora-user-images/image-20250429175421998.png\" alt=\"image-20250429175421998\"></p>\n<p><img src=\"/typora-user-images/image-20250429175540574.png\" alt=\"image-20250429175540574\"></p>\n<h2 id=\"milvus-\"><a href=\"#milvus-\" class=\"headerlink\" title=\"milvus \"></a>milvus </h2><h3 id=\"Milvus\"><a href=\"#Milvus\" class=\"headerlink\" title=\"Milvus\"></a>Milvus</h3><p><strong>Docker-compose </strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  etcd </span></span><br><span class=\"line\">  <span class=\"attr\">etcd:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">quay.io/coreos/etcd:v3.5.16</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_MODE=revision</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_RETENTION=1000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_QUOTA_BACKEND_BYTES=4294967296</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_SNAPSHOT_COUNT=50000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/etcd:/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">etcd</span> <span class=\"string\">-advertise-client-urls=http://127.0.0.1:2379</span> <span class=\"string\">-listen-client-urls=http://0.0.0.0:2379</span> <span class=\"string\">--data-dir</span> <span class=\"string\">/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;etcdctl&quot;</span>, <span class=\"string\">&quot;endpoint&quot;</span>, <span class=\"string\">&quot;health&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\">  <span class=\"attr\">minio:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-minio</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">minio/minio:RELEASE.2023-03-20T20-16-18Z</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ACCESS_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_SECRET_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9001:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9000:9000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/minio:/minio_data</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">minio</span> <span class=\"string\">server</span> <span class=\"string\">/minio_data</span> <span class=\"string\">--console-address</span> <span class=\"string\">&quot;:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9000/minio/health/live&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.8</span>   </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">  <span class=\"attr\">standalone:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-standalone</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">milvusdb/milvus:v2.5.4</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;milvus&quot;</span>, <span class=\"string\">&quot;run&quot;</span>, <span class=\"string\">&quot;standalone&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">security_opt:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">seccomp:unconfined</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ETCD_ENDPOINTS:</span> <span class=\"string\">etcd:2379</span>  <span class=\"comment\"># etcd </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ADDRESS:</span> <span class=\"string\">minio:9000</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/milvus:/var/lib/milvus</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9091/healthz&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">start_period:</span> <span class=\"string\">90s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;19530:19530&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9091:9091&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;etcd&quot;</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;minio&quot;</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus Dashboard </span></span><br><span class=\"line\">  <span class=\"attr\">dashboard:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zilliz/attu:v2.5</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-dashboard</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MILVUS_URL:</span> <span class=\"string\">http://standalone:19530</span>  <span class=\"comment\"># Milvus </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;8000:3000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">standalone</span>  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">etcd</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">minio</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">      <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong>  <code>http://localhost:8000/</code><br></p>\n<p><img src=\"/typora-user-images/image-20250429181131778.png\" alt=\"image-20250429181131778\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250429181039571.png\" alt=\"image-20250429181039571\"></p>\n<p>&#96;&#96;milvus<code>,  </code>milvus-4321<code>(spring)</code>admin&#96;, </p>\n<p><img src=\"/typora-user-images/image-20250429181312813.png\" alt=\"image-20250429181312813\"></p>\n<p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-milvus-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">    <span class=\"attr\">uris:</span> <span class=\"string\">http://127.0.0.1:9200</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">milvus:</span></span><br><span class=\"line\">        <span class=\"attr\">client:</span></span><br><span class=\"line\">          <span class=\"attr\">host:</span> <span class=\"string\">&quot;localhost&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">port:</span> <span class=\"number\">19530</span></span><br><span class=\"line\">          <span class=\"attr\">username:</span> <span class=\"string\">&quot;milvus&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"string\">&quot;milvus-4321&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">databaseName:</span> <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">collectionName:</span> <span class=\"string\">&quot;vector_store&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">embeddingDimension:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">indexType:</span> <span class=\"string\">IVF_FLAT</span></span><br><span class=\"line\">        <span class=\"attr\">metricType:</span> <span class=\"string\">COSINE</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisMilvusAI</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250429183142516.png\" alt=\"image-20250429183142516\"></p>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\"><a href=\"#Spring-AI-Alibaba-03-Spring-AI-DeepSeek-R1-ES-Milvus-RAG-\" class=\"headerlink\" title=\"Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG \"></a>Spring AI Alibaba-03- Spring AI + DeepSeek-R1 +  ES&#x2F;Milvus + RAG </h1><p>[]AIAPI<strong>Spring AI</strong>Spring[AI]AI</p>\n<p>[toc]</p>\n<h2 id=\"Spring-AI--Function-CallingTool-Calling--Agent-\"><a href=\"#Spring-AI--Function-CallingTool-Calling--Agent-\" class=\"headerlink\" title=\"Spring AI  Function CallingTool Calling  Agent \"></a>Spring AI  Function CallingTool Calling  Agent </h2><h3 id=\"Spring-AI-\"><a href=\"#Spring-AI-\" class=\"headerlink\" title=\"Spring AI \"></a>Spring AI </h3><h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AI</p>\n<ul>\n<li>20245301.0.0 Milestone 1API</li>\n<li>20248231.0.0 Milestone 2</li>\n<li>20241081.0.0 Milestone 3AI</li>\n<li>202411201.0.0 Milestone 4Amazon Bedrock Converse APIAmazon</li>\n<li>20252141.0.0 Milestone 6</li>\n</ul>\n<h4 id=\"Spring-AI\"><a href=\"#Spring-AI\" class=\"headerlink\" title=\"Spring AI\"></a>Spring AI</h4><p>Spring AIAI</p>\n<ul>\n<li>LLM</li>\n<li>AI</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"Function-Calling\"><a href=\"#Function-Calling\" class=\"headerlink\" title=\"Function Calling\"></a><strong>Function Calling</strong></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>AIAPIAI</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Spring AI</p>\n<p><strong>1</strong><code>Function</code>Java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherFunction</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Function</span>&lt;WeatherFunction.WeatherRequest, String&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">apply</span><span class=\"params\">(WeatherRequest request)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + request.getCity() + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherRequest</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String city;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">getCity</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> city; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setCity</span><span class=\"params\">(String city)</span> &#123; <span class=\"built_in\">this</span>.city = city; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong>Spring BeanSpring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FunctionConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Function&lt;WeatherFunction.WeatherRequest, String&gt; weatherFunction() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withFunction(<span class=\"string\">&quot;weatherFunction&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        WeatherFunction.<span class=\"type\">WeatherRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherFunction</span>.WeatherRequest();</span><br><span class=\"line\">        request.setCity(input);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).functions(<span class=\"string\">&quot;weatherFunction&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong>Spring AI<strong></strong>Tool Calling</p>\n<h3 id=\"Tool-Calling\"><a href=\"#Tool-Calling\" class=\"headerlink\" title=\"Tool Calling\"></a><strong>Tool Calling</strong></h3><h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p>AI</p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p><strong>1</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WeatherToolImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WeatherTool</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getWeather</span><span class=\"params\">(String city)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;The weather in &quot;</span> + city + <span class=\"string\">&quot; is sunny.&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3Spring Bean</strong>Spring BeanSpring</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ToolConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> WeatherTool <span class=\"title function_\">weatherTool</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WeatherToolImpl</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4</strong>Spring AI</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient.Builder chatClientBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chatClientBuilder</span><br><span class=\"line\">                .withOptions(ChatOptions.builder().withTool(<span class=\"string\">&quot;weatherTool&quot;</span>).build())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>5</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/chat&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">chat</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String input)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> chatClient.prompt().user(input).tools(<span class=\"string\">&quot;weatherTool&quot;</span>).call().content();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Agent\"><a href=\"#Agent\" class=\"headerlink\" title=\"Agent\"></a>Agent</h3><h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p>Agent</p>\n<h4 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<p>MCPLLMMCP<br><br>Spring AIAI<br>Spring AI</p>\n<h3 id=\"FunctionCallbacToolCallback\"><a href=\"#FunctionCallbacToolCallback\" class=\"headerlink\" title=\"FunctionCallbacToolCallback\"></a>FunctionCallbacToolCallback</h3><p>Spring AIFunction CallbackDeprecatedTool CallbackAI</p>\n<p><strong>FunctionCallbackToolCallback</strong></p>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<ul>\n<li>ToolCallbackFunctionCallback</li>\n<li>ToolCallback</li>\n<li>FunctionCallbackSpring AIToolCallback</li>\n</ul>\n<p>Spring AIFunctionCallbackToolCallback</p>\n<h2 id=\"Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\"><a href=\"#Spring-AI-DeepSeek-R1-ES-Milvus-RAG-Tool-Calling\" class=\"headerlink\" title=\"Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling\"></a>Spring AI + DeepSeek-R1 + ES&#x2F;Milvus + RAG + Tool Calling</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p><img src=\"/typora-user-images/image-20250425104935964-5549379.png\" alt=\"image-20250425104935964\"></p>\n<p><strong>Elasticsearch</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># base </span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.8&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">\t<span class=\"attr\">elasticsearch1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/elasticsearch/elasticsearch:8.13.4</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;elasticsearch1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;ES_JAVA_OPTS=-Xms84m -Xmx512m&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9200</span><span class=\"string\">:9200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9300</span><span class=\"string\">:9300</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/data:/usr/share/elasticsearch/data</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/plugins:/usr/share/elasticsearch/plugins</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/config:/usr/share/elasticsearch/config</span>  </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/elasticsearch1/logs:/usr/share/elasticsearch/logs</span>  </span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.7</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">vsftpd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">&quot;fauria/vsftpd&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">&quot;rabbitmq1&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_USER=admin</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">FTP_PASS=123456</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MIN_PORT=21100</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_MAX_PORT=21110</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">PASV_ADDRESS=172.18.0.8</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21</span><span class=\"string\">:21</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">21100</span><span class=\"number\">-21110</span><span class=\"string\">:21100-21110</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/file:/home/vsftpd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/Users/lison/work/data/dockerData/vsftpd/log/:/var/log/vsftpd</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#restart: always</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nt_dev</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/typora-user-images/image-20250425174252871.png\" alt=\"image-20250425174252871\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> Spring AI Spring AI  AI </li>\n<li> Spring AI Alibaba Spring AI Alibaba AI  DeepSeek-R1  text-embedding-v2</li>\n<li> Redis  Redis  Redis  MySQL  Redis + MySQL </li>\n<li> ElasticSearch RAG  text-embedding-v2  ElasticSearch  RAG  RAG  3  30 </li>\n<li>Tool Calling Tool Calling <ul>\n<li> 1 RAG </li>\n<li> 2</li>\n<li> 3</li>\n</ul>\n</li>\n</ol>\n<p> Spring AI + Spring AI Alibaba DeepSeek-R1 Redis RAG + ElasticSearch  Tool Calling AI  </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>Maven </strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.lison.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>spring_ai_alibaba_demo<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span> Spring AI Alibaba <span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>23<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.reporting.outputEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-boot.version</span>&gt;</span>3.4.3<span class=\"tag\">&lt;/<span class=\"name\">spring-boot.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring-ai.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring-ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">alibaba.ai.version</span>&gt;</span>1.0.0-M6.1<span class=\"tag\">&lt;/<span class=\"name\">alibaba.ai.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.ai.ollama.version</span>&gt;</span>1.0.0-M6<span class=\"tag\">&lt;/<span class=\"name\">spring.ai.ollama.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;alibaba.ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-elasticsearch-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-ai.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Snapshots<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">releases</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.18.36<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">annotationProcessorPaths</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">exclude</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">excludes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>Spring BootSpring AIAlibaba Cloud AIMaven</p>\n<p><strong> <code>application.yml</code></strong></p>\n<p> <code>model: deepseek-r1</code>, <code>model: text-embedding-v2</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">index-name:</span> <span class=\"string\">spring-ai-tag</span></span><br><span class=\"line\">        <span class=\"comment\"># 1536</span></span><br><span class=\"line\">        <span class=\"attr\">dimensions:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">similarity:</span> <span class=\"string\">cosine</span></span><br><span class=\"line\">        <span class=\"attr\">batching-strategy:</span> <span class=\"string\">TOKEN_COUNT</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisElasticsearchAI </p>\n<p><strong>RedisRedisConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> &#123;</span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        redisTemplate.setConnectionFactory(factory);</span><br><span class=\"line\">        redisTemplate.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        redisTemplate.setHashValueSerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class));</span><br><span class=\"line\">        redisTemplate.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> RedisTemplate JSON  JSON </p>\n</blockquote>\n<p><strong>ChatEntity.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.NoArgsConstructor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatEntity</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    String chatId;</span><br><span class=\"line\">    String type;</span><br><span class=\"line\">    String text;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> ID Redis </p>\n</blockquote>\n<p><strong> Redis ChatStorageMemory.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ChatStorageMemory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ChatMemory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">KEY_PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;chat:history:&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ChatStorageMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(String conversationId, List&lt;Message&gt; messages)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        List&lt;ChatEntity&gt; listIn = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Message msg : messages) &#123;</span><br><span class=\"line\">            String[] strs = msg.getText().split(<span class=\"string\">&quot;&lt;/think&gt;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">text</span> <span class=\"operator\">=</span> strs.length == <span class=\"number\">2</span> ? strs[<span class=\"number\">1</span>] : strs[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">ent</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatEntity</span>();</span><br><span class=\"line\">            ent.setChatId(conversationId);</span><br><span class=\"line\">            ent.setType(msg.getMessageType().getValue());</span><br><span class=\"line\">            ent.setText(text);</span><br><span class=\"line\">            listIn.add(ent);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        redisTemplate.opsForList().rightPushAll(key, listIn.toArray());</span><br><span class=\"line\">        redisTemplate.expire(key, <span class=\"number\">30</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title function_\">get</span><span class=\"params\">(String conversationId, <span class=\"type\">int</span> lastN)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> KEY_PREFIX + conversationId;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> redisTemplate.opsForList().size(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"literal\">null</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">start</span> <span class=\"operator\">=</span> Math.max(<span class=\"number\">0</span>, (<span class=\"type\">int</span>) (size - lastN));</span><br><span class=\"line\">        List&lt;Object&gt; listTmp = redisTemplate.opsForList().range(key, start, -<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Message&gt; listOut = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object obj : listTmp) &#123;</span><br><span class=\"line\">            <span class=\"type\">ChatEntity</span> <span class=\"variable\">chat</span> <span class=\"operator\">=</span> objectMapper.convertValue(obj, ChatEntity.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (MessageType.USER.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">UserMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.ASSISTANT.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">AssistantMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (MessageType.SYSTEM.getValue().equals(chat.getType())) &#123;</span><br><span class=\"line\">                listOut.add(<span class=\"keyword\">new</span> <span class=\"title class_\">SystemMessage</span>(chat.getText()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> listOut;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">(String conversationId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.delete(KEY_PREFIX + conversationId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> Redis </p>\n<p> <strong>SpringAiChatConfig </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.config.chat;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.InMemoryChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.model.ChatModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringAiChatConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatModel chatModel;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatClient <span class=\"title function_\">chatClient</span><span class=\"params\">(ChatMemory chatMemory)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ChatClient.builder(chatModel)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultSystem(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                .defaultAdvisors(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">QuestionAnswerAdvisor</span>(</span><br><span class=\"line\">                                vectorStore,</span><br><span class=\"line\">                                SearchRequest.builder()</span><br><span class=\"line\">                                        .similarityThreshold(<span class=\"number\">0.1</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">                                        .topK(<span class=\"number\">10</span>) <span class=\"comment\">//  10 </span></span><br><span class=\"line\">                                        .build()</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ChatMemory <span class=\"title function_\">chatMemory</span><span class=\"params\">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ChatStorageMemory</span>(redisTemplate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>DeepseekChatController.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.memory.ChatMemory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.chat.messages.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.document.DocumentReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.Query;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.CompressionQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.QueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.rag.preretrieval.query.transformation.RewriteQueryTransformer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.reader.TextReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.SearchRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.vectorstore.VectorStore;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@ClassName</span> DeepseekChatController  //</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span>:</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span>: 200900681 </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@CreateDate</span>: 2025/4/25</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Version</span>: 1.0    //</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/ai/v1&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DeepseekChatController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatClient chatClient;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> VectorStore vectorStore;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChatMemory chatMemory;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">CHAT_HISTORY_SIZE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/data/load&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">loadData</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        <span class=\"type\">DocumentReader</span> <span class=\"variable\">reader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TextReader</span>(<span class=\"string\">&quot;static/hospitalInfo.txt&quot;</span>);</span><br><span class=\"line\">        List&lt;Document&gt; documents = reader.get();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.</span></span><br><span class=\"line\">        List&lt;Document&gt; splitDocuments =  <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Document document : documents) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">content</span> <span class=\"operator\">=</span> document.getText();</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            String[] parts = content.split(<span class=\"string\">&quot;\\\\n\\\\s*\\\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//  Document </span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (String part : parts) &#123;</span><br><span class=\"line\">                splitDocuments.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Document</span>(part.trim()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot; [&#123;&#125;]&quot;</span>, splitDocuments.size());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.</span></span><br><span class=\"line\">        vectorStore.add(splitDocuments);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;success&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/select&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">search</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;query&quot;)</span> String query)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;query is  [&#123;&#125;]&quot;</span>, query);</span><br><span class=\"line\">        List&lt;Document&gt; results = vectorStore.similaritySearch(</span><br><span class=\"line\"><span class=\"comment\">//                SearchRequest.builder().query(query).similarityThreshold(0.1).topK(10).build()</span></span><br><span class=\"line\">                SearchRequest.builder().query(query).similarityThreshold(<span class=\"number\">0.1</span>).topK(<span class=\"number\">10</span>).build()</span><br><span class=\"line\"></span><br><span class=\"line\">        );</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;results is [&#123;&#125;]&quot;</span>, results);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> results.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/rewrite/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByRewrite</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1</span></span><br><span class=\"line\">        <span class=\"type\">QueryTransformer</span> <span class=\"variable\">queryTransformer</span> <span class=\"operator\">=</span> RewriteQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"comment\">// 2</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByTransform</span> <span class=\"operator\">=</span> queryTransformer.transform(<span class=\"keyword\">new</span> <span class=\"title class_\">Query</span>(inputMsg));</span><br><span class=\"line\">        <span class=\"comment\">// 3</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByTransform.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> inputMsg</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(value = &quot;/rag/history/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">ragChatByHistory</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> String userId, <span class=\"meta\">@RequestParam</span> String inputMsg)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1. </span></span><br><span class=\"line\">        List&lt;Message&gt; history = chatMemory.get(userId, CHAT_HISTORY_SIZE);</span><br><span class=\"line\">        <span class=\"comment\">// 2. </span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> Query.builder()</span><br><span class=\"line\">                .text(inputMsg)</span><br><span class=\"line\">                .history(history)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.  CompressionQueryTransformer</span></span><br><span class=\"line\">        <span class=\"type\">CompressionQueryTransformer</span> <span class=\"variable\">queryTransformerByHis</span> <span class=\"operator\">=</span> CompressionQueryTransformer.builder()</span><br><span class=\"line\">                .chatClientBuilder(chatClient.mutate())</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4</span></span><br><span class=\"line\">        <span class=\"type\">Query</span> <span class=\"variable\">queryByHistory</span> <span class=\"operator\">=</span> queryTransformerByHis.transform(query);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> queryByHistory.text();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<p><strong></strong></p>\n<p>kimi</p>\n<ul>\n<li><code></code></li>\n<li>3 <code></code>,<code></code>,<code></code></li>\n<li>20</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. </span><br><span class=\"line\">2023112.2100020020  60NBICBCTCV-290OCT700VisuMax SMILE 3.0CAD/CAM</span><br><span class=\"line\">2. </span><br><span class=\"line\">(1):</span><br><span class=\"line\"></span><br><span class=\"line\">(2):</span><br><span class=\"line\"></span><br><span class=\"line\">(3):</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">3. </span><br><span class=\"line\">(1) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19853</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(2) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19907</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(3) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198211</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(4) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19884</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(5) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19809</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(6) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19931</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(7) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19875</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(8) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19918</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(9) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 197912</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(10) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19862</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(11) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19837</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(12) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19924</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(13) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198110</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(14) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19896</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(15) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 198411</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(16) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19903</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(17) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19889</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(18) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19941</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(19) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19858</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">(20) </span><br><span class=\"line\"> </span><br><span class=\"line\"> 19915</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/data/load</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/select</span><br><span class=\"line\"></span><br><span class=\"line\">http://127.0.0.1:8080/ai/v1/rag/chat</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/data/load\">http://127.0.0.1:8080/ai/v1/data/load</a></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429172724826.png\" alt=\"image-20250429172724826\"></p>\n<p><img src=\"/typora-user-images/image-20250429180401580.png\" alt=\"image-20250429180401580\"></p>\n<blockquote>\n<p><br><a href=\"http://127.0.0.1:8080/ai/v1/select?query=%E5%8C%BB%E9%99%A2%E4%BB%8B%E7%BB%8D\">http://127.0.0.1:8080/ai/v1/select?query=</a></p>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429174959408.png\" alt=\"image-20250429174959408\"></p>\n<p>elasticsearch deepseek</p>\n<p>RAG+</p>\n<blockquote>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<p><img src=\"/typora-user-images/image-20250429174851066.png\" alt=\"image-20250429174851066\"></p>\n<p><img src=\"/typora-user-images/image-20250429175228086.png\" alt=\"image-20250429175228086\"></p>\n<p><img src=\"/typora-user-images/image-20250429175342611.png\" alt=\"image-20250429175342611\"></p>\n<p><img src=\"/typora-user-images/image-20250429175421998.png\" alt=\"image-20250429175421998\"></p>\n<p><img src=\"/typora-user-images/image-20250429175540574.png\" alt=\"image-20250429175540574\"></p>\n<h2 id=\"milvus-\"><a href=\"#milvus-\" class=\"headerlink\" title=\"milvus \"></a>milvus </h2><h3 id=\"Milvus\"><a href=\"#Milvus\" class=\"headerlink\" title=\"Milvus\"></a>Milvus</h3><p><strong>Docker-compose </strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  etcd </span></span><br><span class=\"line\">  <span class=\"attr\">etcd:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">quay.io/coreos/etcd:v3.5.16</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_MODE=revision</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_AUTO_COMPACTION_RETENTION=1000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_QUOTA_BACKEND_BYTES=4294967296</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ETCD_SNAPSHOT_COUNT=50000</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/etcd:/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">etcd</span> <span class=\"string\">-advertise-client-urls=http://127.0.0.1:2379</span> <span class=\"string\">-listen-client-urls=http://0.0.0.0:2379</span> <span class=\"string\">--data-dir</span> <span class=\"string\">/etcd</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;etcdctl&quot;</span>, <span class=\"string\">&quot;endpoint&quot;</span>, <span class=\"string\">&quot;health&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\">  <span class=\"attr\">minio:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-minio</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">minio/minio:RELEASE.2023-03-20T20-16-18Z</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ACCESS_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_SECRET_KEY:</span> <span class=\"string\">minioadmin</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9001:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9000:9000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/minio:/minio_data</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">minio</span> <span class=\"string\">server</span> <span class=\"string\">/minio_data</span> <span class=\"string\">--console-address</span> <span class=\"string\">&quot;:9001&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9000/minio/health/live&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.8</span>   </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">  <span class=\"attr\">standalone:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-standalone</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">milvusdb/milvus:v2.5.4</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;milvus&quot;</span>, <span class=\"string\">&quot;run&quot;</span>, <span class=\"string\">&quot;standalone&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">security_opt:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">seccomp:unconfined</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ETCD_ENDPOINTS:</span> <span class=\"string\">etcd:2379</span>  <span class=\"comment\"># etcd </span></span><br><span class=\"line\">      <span class=\"attr\">MINIO_ADDRESS:</span> <span class=\"string\">minio:9000</span>  <span class=\"comment\"># MinIO </span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">$&#123;DOCKER_VOLUME_DIRECTORY:-.&#125;/volumes/milvus:/var/lib/milvus</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> [<span class=\"string\">&quot;CMD&quot;</span>, <span class=\"string\">&quot;curl&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, <span class=\"string\">&quot;http://localhost:9091/healthz&quot;</span>]  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">start_period:</span> <span class=\"string\">90s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">20s</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">3</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;19530:19530&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;9091:9091&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;etcd&quot;</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;minio&quot;</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#  Milvus Dashboard </span></span><br><span class=\"line\">  <span class=\"attr\">dashboard:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zilliz/attu:v2.5</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">milvus-dashboard</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MILVUS_URL:</span> <span class=\"string\">http://standalone:19530</span>  <span class=\"comment\"># Milvus </span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;8000:3000&quot;</span>  <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">standalone</span>  <span class=\"comment\">#  Milvus </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">etcd</span>  <span class=\"comment\">#  etcd </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">minio</span>  <span class=\"comment\">#  MinIO </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">nt_dev:</span></span><br><span class=\"line\">      <span class=\"attr\">external:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong></strong>  <code>http://localhost:8000/</code><br></p>\n<p><img src=\"/typora-user-images/image-20250429181131778.png\" alt=\"image-20250429181131778\"></p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250429181039571.png\" alt=\"image-20250429181039571\"></p>\n<p>&#96;&#96;milvus<code>,  </code>milvus-4321<code>(spring)</code>admin&#96;, </p>\n<p><img src=\"/typora-user-images/image-20250429181312813.png\" alt=\"image-20250429181312813\"></p>\n<p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.ai<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-ai-milvus-store-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">AI</span> <span class=\"string\">Demo</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">      <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">    <span class=\"attr\">uris:</span> <span class=\"string\">http://127.0.0.1:9200</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span></span><br><span class=\"line\">  <span class=\"attr\">ai:</span></span><br><span class=\"line\">    <span class=\"attr\">dashscope:</span></span><br><span class=\"line\">      <span class=\"attr\">api-key:</span> <span class=\"string\">sk-xxxx</span></span><br><span class=\"line\">      <span class=\"attr\">model:</span> <span class=\"string\">deepseek-r1</span></span><br><span class=\"line\">      <span class=\"attr\">embedding:</span></span><br><span class=\"line\">        <span class=\"attr\">options:</span></span><br><span class=\"line\">          <span class=\"attr\">model:</span> <span class=\"string\">text-embedding-v2</span></span><br><span class=\"line\">    <span class=\"attr\">vectorstore:</span></span><br><span class=\"line\">      <span class=\"attr\">milvus:</span></span><br><span class=\"line\">        <span class=\"attr\">client:</span></span><br><span class=\"line\">          <span class=\"attr\">host:</span> <span class=\"string\">&quot;localhost&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">port:</span> <span class=\"number\">19530</span></span><br><span class=\"line\">          <span class=\"attr\">username:</span> <span class=\"string\">&quot;milvus&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"string\">&quot;milvus-4321&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">databaseName:</span> <span class=\"string\">&quot;default&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">collectionName:</span> <span class=\"string\">&quot;vector_store&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">embeddingDimension:</span> <span class=\"number\">1536</span></span><br><span class=\"line\">        <span class=\"attr\">indexType:</span> <span class=\"string\">IVF_FLAT</span></span><br><span class=\"line\">        <span class=\"attr\">metricType:</span> <span class=\"string\">COSINE</span></span><br><span class=\"line\">        <span class=\"attr\">initialize-schema:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>RedisMilvusAI</p>\n<p></p>\n<p><img src=\"/typora-user-images/image-20250429183142516.png\" alt=\"image-20250429183142516\"></p>\n"},{"_content":"# Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \n\n[toc]\n\n\n\n## \n\n\n\n### **Tool Calling **\n\n HTTP \n\n\n Spring AI  Tool Calling  OA \n\n\n\n### \n\nSpring AI  Tool Calling \n\n1. ****\n2. ****\n\n\n\n\n\n\n\n-  API\n-  OA \n-  RAG \n- \n-  vs  Tool Calling \n\n\n\n## \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** API [](https://www.weatherapi.com/)\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n Spring  Redis  ChatClient \n\n**Tool calling **\n\n1. ****\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"\")\npublic class HospitalService {\n\n    @Tool(description = \"\")\n    String registeInHos (@ToolParam(description = \"\", required = true) String docName,\n                         @ToolParam(description = \"\", required = true) String time ,\n                         @ToolParam(description = \"\", required = false) String desc,\n                         @ToolParam(description = \"ID\") String userId) {\n\n\n        String rtn1 = \"\"+docName+\"\"+time+\"\"+desc+\"\";\n        String rtn2 = \"\"+docName+\"\";\n\n\n\n\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n\n}\n\n\n~~~\n\n2. OA\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.lang3.StringUtils;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"OA\")\npublic class OaService {\n\n    private static int LEFT_DAYS = 5;\n    @Tool(description = \"\")\n    public String getCurrentDateTime() {\n        return \" \"+LEFT_DAYS+\" \";\n    }\n\n    @Tool(description = \"id(userId), (days)\")\n    String askForLeave(@ToolParam(description = \"\") String userId ,@ToolParam(description = \"\") String days) {\n        if(!StringUtils.isNumeric(days)){\n            throw new IllegalArgumentException(\"days\");\n        }\n        int dayInt = Integer.parseInt(days);\n        String rtn1 = \"\"+userId+\",\"+days+\"\";\n        String rtn2 = \"\";\n        return dayInt>=LEFT_DAYS?rtn2:rtn1;\n    }\n}\n\n\n\n~~~\n\n\n\n3. \n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\nimport java.util.Set;\n\n@Slf4j\n@Description(\"\")\npublic class RestaurantService {\n\n    private static int LEFT_DAYS = 5;\n    private static Set<String> RESTAURANT_NAME = Set.of( \"\", \"\", \"\", \"\", \"\");\n\n    @Tool(description = \"\")\n    public String queryRestaurantName(@ToolParam(description = \"\", required = true) String location) {\n        //  RESTAURANT_NAME \n        String rtn = RESTAURANT_NAME.stream().skip((int) (Math.random() * RESTAURANT_NAME.size())).limit(3).reduce((a, b) -> a + \"\" + b).get();\n        return \"\" + location + \" restaurantName\" + rtn;\n    }\n\n    @Tool(description = \"\")\n    String bookRestaurant (@ToolParam(description = \"\", required = true) String restName,\n                           @ToolParam(description = \"\", required = true) String time ,\n                           @ToolParam(description = \"\", required = true) String userNumber) {\n        String rtn1 = \"\"+restName+\"\"+time+\"\"+userNumber+\"\";\n        String rtn2 = \"\"+restName+\"\";\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n}\n\n~~~\n\n\n\n **ToolCallController.java**\n\n~~~\n  @GetMapping(value = \"/rag/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChat(@RequestParam String userId, @RequestParam String message) {\n        log.info(\"userId -> [{}], message --> [{}]\", userId, message);\n        String text = chatClient.prompt()\n                .user(message)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))\n                .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))\n                .call().content();\n        return text;\n    }\n~~~\n\n\n\n\n\n\n\n## \n\n1\n\n~~~\nhttp://localhost:8080/ai/v1/rag/simpleChat?message=\n~~~\n\n\n\n![image-20250508161105090](typora-user-images/image-20250508161105090.png)\n\n****\n\n- \n- \n\n\n\n2\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=\n~~~\n\n\n\n![image-20250508161546610](typora-user-images/image-20250508161546610.png)\n\n\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=2\n~~~\n\n\n\n![image-20250508162115569](typora-user-images/image-20250508162115569.png)\n\n\n\n****\n\n-  OA \n- \n\n","source":"categories/Spring AI Alibaba-04- Spring AI + + ToolCalling .md","raw":"# Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \n\n[toc]\n\n\n\n## \n\n\n\n### **Tool Calling **\n\n HTTP \n\n\n Spring AI  Tool Calling  OA \n\n\n\n### \n\nSpring AI  Tool Calling \n\n1. ****\n2. ****\n\n\n\n\n\n\n\n-  API\n-  OA \n-  RAG \n- \n-  vs  Tool Calling \n\n\n\n## \n\n- ****Windows 11\n- **Java **JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus\n- ****Maven 3.8.3+\n- **** API [](https://www.weatherapi.com/)\n- **** [](https://bailian.console.aliyun.com/)  [Deepseek](https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html)\n\n\n\n Spring  Redis  ChatClient \n\n**Tool calling **\n\n1. ****\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"\")\npublic class HospitalService {\n\n    @Tool(description = \"\")\n    String registeInHos (@ToolParam(description = \"\", required = true) String docName,\n                         @ToolParam(description = \"\", required = true) String time ,\n                         @ToolParam(description = \"\", required = false) String desc,\n                         @ToolParam(description = \"ID\") String userId) {\n\n\n        String rtn1 = \"\"+docName+\"\"+time+\"\"+desc+\"\";\n        String rtn2 = \"\"+docName+\"\";\n\n\n\n\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n\n}\n\n\n~~~\n\n2. OA\n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.lang3.StringUtils;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\n@Slf4j\n@Description(\"OA\")\npublic class OaService {\n\n    private static int LEFT_DAYS = 5;\n    @Tool(description = \"\")\n    public String getCurrentDateTime() {\n        return \" \"+LEFT_DAYS+\" \";\n    }\n\n    @Tool(description = \"id(userId), (days)\")\n    String askForLeave(@ToolParam(description = \"\") String userId ,@ToolParam(description = \"\") String days) {\n        if(!StringUtils.isNumeric(days)){\n            throw new IllegalArgumentException(\"days\");\n        }\n        int dayInt = Integer.parseInt(days);\n        String rtn1 = \"\"+userId+\",\"+days+\"\";\n        String rtn2 = \"\";\n        return dayInt>=LEFT_DAYS?rtn2:rtn1;\n    }\n}\n\n\n\n~~~\n\n\n\n3. \n\n~~~java\npackage com.lison.ai.spring_ai_alibaba_demo.toolcalling;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.ai.tool.annotation.Tool;\nimport org.springframework.ai.tool.annotation.ToolParam;\nimport org.springframework.context.annotation.Description;\n\nimport java.util.Set;\n\n@Slf4j\n@Description(\"\")\npublic class RestaurantService {\n\n    private static int LEFT_DAYS = 5;\n    private static Set<String> RESTAURANT_NAME = Set.of( \"\", \"\", \"\", \"\", \"\");\n\n    @Tool(description = \"\")\n    public String queryRestaurantName(@ToolParam(description = \"\", required = true) String location) {\n        //  RESTAURANT_NAME \n        String rtn = RESTAURANT_NAME.stream().skip((int) (Math.random() * RESTAURANT_NAME.size())).limit(3).reduce((a, b) -> a + \"\" + b).get();\n        return \"\" + location + \" restaurantName\" + rtn;\n    }\n\n    @Tool(description = \"\")\n    String bookRestaurant (@ToolParam(description = \"\", required = true) String restName,\n                           @ToolParam(description = \"\", required = true) String time ,\n                           @ToolParam(description = \"\", required = true) String userNumber) {\n        String rtn1 = \"\"+restName+\"\"+time+\"\"+userNumber+\"\";\n        String rtn2 = \"\"+restName+\"\";\n        return System.currentTimeMillis() % 4 == 0 ? rtn2 : rtn1;\n    }\n}\n\n~~~\n\n\n\n **ToolCallController.java**\n\n~~~\n  @GetMapping(value = \"/rag/chat\", produces = \"text/plain; charset=UTF-8\")\n    public String ragChat(@RequestParam String userId, @RequestParam String message) {\n        log.info(\"userId -> [{}], message --> [{}]\", userId, message);\n        String text = chatClient.prompt()\n                .user(message)\n                .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))\n                .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))\n                .call().content();\n        return text;\n    }\n~~~\n\n\n\n\n\n\n\n## \n\n1\n\n~~~\nhttp://localhost:8080/ai/v1/rag/simpleChat?message=\n~~~\n\n\n\n![image-20250508161105090](typora-user-images/image-20250508161105090.png)\n\n****\n\n- \n- \n\n\n\n2\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=\n~~~\n\n\n\n![image-20250508161546610](typora-user-images/image-20250508161546610.png)\n\n\n\n~~~\nhttp://localhost:8080/ai/v1/rag/chat?message=2\n~~~\n\n\n\n![image-20250508162115569](typora-user-images/image-20250508162115569.png)\n\n\n\n****\n\n-  OA \n- \n\n","date":"2025-06-04T10:13:19.151Z","updated":"2025-05-08T08:21:55.849Z","path":"categories/Spring AI Alibaba-04- Spring AI + + ToolCalling .html","_id":"cmbhshryf000cnffyfp1oebp1","title":"","comments":1,"layout":"page","content":"<h1 id=\"Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\"><a href=\"#Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\" class=\"headerlink\" title=\"Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \"></a>Spring AI Alibaba-04- Spring AI + RAG + ToolCalling </h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Tool-Calling-\"><a href=\"#Tool-Calling-\" class=\"headerlink\" title=\"Tool Calling \"></a><strong>Tool Calling </strong></h3><p> HTTP <br><br><br> Spring AI  Tool Calling  OA </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Spring AI  Tool Calling </p>\n<ol>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ol>\n<p></p>\n<ul>\n<li> API</li>\n<li> OA </li>\n<li> RAG </li>\n<li></li>\n<li> vs  Tool Calling </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> API <a href=\"https://www.weatherapi.com/\"></a></li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p> Spring  Redis  ChatClient </p>\n<p><strong>Tool calling </strong></p>\n<ol>\n<li><strong></strong></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HospitalService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">registeInHos</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String docName,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = false)</span> String desc,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;ID&quot;)</span> String userId)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+desc+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>OA</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;OA&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OaService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getCurrentDateTime</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot; &quot;</span>+LEFT_DAYS+<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;id(userId), (days)&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">askForLeave</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String userId ,<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String days)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!StringUtils.isNumeric(days))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;days&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">dayInt</span> <span class=\"operator\">=</span> Integer.parseInt(days);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+userId+<span class=\"string\">&quot;,&quot;</span>+days+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dayInt&gt;=LEFT_DAYS?rtn2:rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RestaurantService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Set&lt;String&gt; RESTAURANT_NAME = Set.of( <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">queryRestaurantName</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String location)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  RESTAURANT_NAME </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn</span> <span class=\"operator\">=</span> RESTAURANT_NAME.stream().skip((<span class=\"type\">int</span>) (Math.random() * RESTAURANT_NAME.size())).limit(<span class=\"number\">3</span>).reduce((a, b) -&gt; a + <span class=\"string\">&quot;&quot;</span> + b).get();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span> + location + <span class=\"string\">&quot; restaurantName&quot;</span> + rtn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">bookRestaurant</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String restName,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String userNumber)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+userNumber+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> <strong>ToolCallController.java</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GetMapping(value = &quot;/rag/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span><br><span class=\"line\">  public String ragChat(@RequestParam String userId, @RequestParam String message) &#123;</span><br><span class=\"line\">      log.info(&quot;userId -&gt; [&#123;&#125;], message --&gt; [&#123;&#125;]&quot;, userId, message);</span><br><span class=\"line\">      String text = chatClient.prompt()</span><br><span class=\"line\">              .user(message)</span><br><span class=\"line\">              .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))</span><br><span class=\"line\">              .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))</span><br><span class=\"line\">              .call().content();</span><br><span class=\"line\">      return text;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/simpleChat?message=</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/typora-user-images/image-20250508161105090.png\" alt=\"image-20250508161105090\"></p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20250508161546610.png\" alt=\"image-20250508161546610\"></p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=2</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20250508162115569.png\" alt=\"image-20250508162115569\"></p>\n<p><strong></strong></p>\n<ul>\n<li> OA </li>\n<li></li>\n</ul>\n","excerpt":"","more":"<h1 id=\"Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\"><a href=\"#Spring-AI-Alibaba-04-Spring-AI-RAG-ToolCalling-\" class=\"headerlink\" title=\"Spring AI Alibaba-04- Spring AI + RAG + ToolCalling \"></a>Spring AI Alibaba-04- Spring AI + RAG + ToolCalling </h1><p>[toc]</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Tool-Calling-\"><a href=\"#Tool-Calling-\" class=\"headerlink\" title=\"Tool Calling \"></a><strong>Tool Calling </strong></h3><p> HTTP <br><br><br> Spring AI  Tool Calling  OA </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Spring AI  Tool Calling </p>\n<ol>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ol>\n<p></p>\n<ul>\n<li> API</li>\n<li> OA </li>\n<li> RAG </li>\n<li></li>\n<li> vs  Tool Calling </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><strong></strong>Windows 11</li>\n<li><strong>Java </strong>JDK 17+ Spring Boot 3.4.4 ,Redis ElasticsearchMilvus</li>\n<li><strong></strong>Maven 3.8.3+</li>\n<li><strong></strong> API <a href=\"https://www.weatherapi.com/\"></a></li>\n<li><strong></strong> <a href=\"https://bailian.console.aliyun.com/\"></a>  <a href=\"https://bailian.console.aliyun.com/?tab=api#/api/?type=model&url=https%3A%2F%2Fhelp.aliyun.com%2Fdocument_detail%2F2868565.html\">Deepseek</a></li>\n</ul>\n<p> Spring  Redis  ChatClient </p>\n<p><strong>Tool calling </strong></p>\n<ol>\n<li><strong></strong></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HospitalService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">registeInHos</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String docName,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = false)</span> String desc,</span></span><br><span class=\"line\"><span class=\"params\">                         <span class=\"meta\">@ToolParam(description = &quot;ID&quot;)</span> String userId)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+desc+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+docName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>OA</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;OA&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">OaService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getCurrentDateTime</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot; &quot;</span>+LEFT_DAYS+<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;id(userId), (days)&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">askForLeave</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String userId ,<span class=\"meta\">@ToolParam(description = &quot;&quot;)</span> String days)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!StringUtils.isNumeric(days))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;days&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">dayInt</span> <span class=\"operator\">=</span> Integer.parseInt(days);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+userId+<span class=\"string\">&quot;,&quot;</span>+days+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dayInt&gt;=LEFT_DAYS?rtn2:rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<ol start=\"3\">\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lison.ai.spring_ai_alibaba_demo.toolcalling;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Description;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Description(&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RestaurantService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">LEFT_DAYS</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Set&lt;String&gt; RESTAURANT_NAME = Set.of( <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">queryRestaurantName</span><span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String location)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  RESTAURANT_NAME </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn</span> <span class=\"operator\">=</span> RESTAURANT_NAME.stream().skip((<span class=\"type\">int</span>) (Math.random() * RESTAURANT_NAME.size())).limit(<span class=\"number\">3</span>).reduce((a, b) -&gt; a + <span class=\"string\">&quot;&quot;</span> + b).get();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span> + location + <span class=\"string\">&quot; restaurantName&quot;</span> + rtn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Tool(description = &quot;&quot;)</span></span><br><span class=\"line\">    String <span class=\"title function_\">bookRestaurant</span> <span class=\"params\">(<span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String restName,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String time ,</span></span><br><span class=\"line\"><span class=\"params\">                           <span class=\"meta\">@ToolParam(description = &quot;&quot;, required = true)</span> String userNumber)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn1</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>+time+<span class=\"string\">&quot;&quot;</span>+userNumber+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">rtn2</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>+restName+<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis() % <span class=\"number\">4</span> == <span class=\"number\">0</span> ? rtn2 : rtn1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> <strong>ToolCallController.java</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GetMapping(value = &quot;/rag/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)</span><br><span class=\"line\">  public String ragChat(@RequestParam String userId, @RequestParam String message) &#123;</span><br><span class=\"line\">      log.info(&quot;userId -&gt; [&#123;&#125;], message --&gt; [&#123;&#125;]&quot;, userId, message);</span><br><span class=\"line\">      String text = chatClient.prompt()</span><br><span class=\"line\">              .user(message)</span><br><span class=\"line\">              .advisors(new MessageChatMemoryAdvisor(chatMemory,userId,100))</span><br><span class=\"line\">              .tools(new OaService(), new RestaurantService(),new HospitalService(),new WeatherService(webClient))</span><br><span class=\"line\">              .call().content();</span><br><span class=\"line\">      return text;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/simpleChat?message=</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/typora-user-images/image-20250508161105090.png\" alt=\"image-20250508161105090\"></p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20250508161546610.png\" alt=\"image-20250508161546610\"></p>\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://localhost:8080/ai/v1/rag/chat?message=2</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/typora-user-images/image-20250508162115569.png\" alt=\"image-20250508162115569\"></p>\n<p><strong></strong></p>\n<ul>\n<li> OA </li>\n<li></li>\n</ul>\n"},{"_content":"https://blog.csdn.net/chen2017sheng/article/details/145779143  AANl  \n\n\n\nhttps://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502 \n\n\n\nhttps://blog.csdn.net/weixin_42289362?type=blog","source":"categories/Untitled.md","raw":"https://blog.csdn.net/chen2017sheng/article/details/145779143  AANl  \n\n\n\nhttps://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502 \n\n\n\nhttps://blog.csdn.net/weixin_42289362?type=blog","date":"2025-06-04T10:13:19.226Z","updated":"2025-05-07T02:33:06.342Z","path":"categories/Untitled.html","_id":"cmbhshs0u000dnffy730h5s98","title":"","comments":1,"layout":"page","content":"<p><a href=\"https://blog.csdn.net/chen2017sheng/article/details/145779143\">https://blog.csdn.net/chen2017sheng/article/details/145779143</a>  AANl  </p>\n<p><a href=\"https://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502\">https://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502</a> </p>\n<p><a href=\"https://blog.csdn.net/weixin_42289362?type=blog\">https://blog.csdn.net/weixin_42289362?type=blog</a></p>\n","excerpt":"","more":"<p><a href=\"https://blog.csdn.net/chen2017sheng/article/details/145779143\">https://blog.csdn.net/chen2017sheng/article/details/145779143</a>  AANl  </p>\n<p><a href=\"https://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502\">https://blog.csdn.net/weixin_42289362/article/details/146314875?spm=1001.2014.3001.5502</a> </p>\n<p><a href=\"https://blog.csdn.net/weixin_42289362?type=blog\">https://blog.csdn.net/weixin_42289362?type=blog</a></p>\n"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"categories/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","date":"2025-06-04T10:31:53.477Z","updated":"2025-06-04T08:01:49.000Z","path":"categories/hello-world.html","_id":"cmbht5nsv0000fsfy0hbg0nhd","comments":1,"layout":"page","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"}],"Post":[{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2025-06-04T08:01:49.374Z","updated":"2025-06-04T08:01:49.374Z","comments":1,"layout":"post","photos":[],"_id":"cmbhrd5ei0001y2kyb7sccfmh","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[],"Tag":[]}}